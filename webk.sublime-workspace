{
	"auto_complete":
	{
		"selected_items":
		[
			[
				"rel",
				"relativeY"
			],
			[
				"p_s",
				"p_sector"
			],
			[
				"p_se",
				"p_sectorData"
			],
			[
				"slideC",
				"slideCountY"
			],
			[
				"ori",
				"originTilePos"
			],
			[
				"hitCou",
				"hitCountX"
			],
			[
				"gr",
				"groundForceY"
			],
			[
				"groundF",
				"groundForceX"
			],
			[
				"len",
				"lengthSquared"
			],
			[
				"wor",
				"worldList"
			],
			[
				"se",
				"sectorWidth"
			],
			[
				"bu",
				"bufferCollider"
			],
			[
				"cu",
				"currentCollider"
			],
			[
				"Coll",
				"CollisionSector"
			],
			[
				"on",
				"onPointerDown"
			],
			[
				"Asse",
				"AssetDatabase"
			],
			[
				"hea",
				"healthMaterial	Material"
			],
			[
				"for",
				"forwardAngle	float"
			],
			[
				"offse",
				"offsetAngle	float"
			],
			[
				"forw",
				"forwardAngle	float"
			],
			[
				"at",
				"attached	List<Actor>"
			],
			[
				"Ro",
				"Rotate(Vector3 axis, float angle)	void"
			],
			[
				"ret",
				"retargetTimer	BasicTimer"
			],
			[
				"tar",
				"targetPosition	Vector3"
			],
			[
				"ta",
				"targetTransform	Transform"
			],
			[
				"Is",
				"isAlive	bool"
			],
			[
				"acto",
				"actorTypeName	string"
			],
			[
				"primar",
				"primaryActorType	ActorType"
			],
			[
				"Game",
				"GameObject	GameObject"
			],
			[
				"atta",
				"AttachedInput(float deltaTime, float horizontalAxis, float verticalAxis, bool btnA, bool btnX)	void"
			],
			[
				"other",
				"otherBody	ActorBody"
			],
			[
				"Boat",
				"BoatCameraControl	BoatCameraControl"
			],
			[
				"rec",
				"RecomputeForward()	void"
			],
			[
				"thro",
				"throttleAmount	float"
			],
			[
				"C",
				"IsComplete()	bool"
			],
			[
				"Rec",
				"RecomputeForward()	void"
			],
			[
				"des",
				"desiredSpeed	float"
			],
			[
				"ac",
				"activeSelf	bool { get; }"
			],
			[
				"t",
				"transform	Transform { get; }"
			],
			[
				"Vec",
				"Vector3	Vector3"
			],
			[
				"hasB",
				"hasButtonX	bool"
			],
			[
				"GL_T",
				"GL_TEXTURE_2D"
			],
			[
				"glBi",
				"glBindTexture"
			],
			[
				"dr",
				"drawable"
			],
			[
				"draw",
				"drawables"
			],
			[
				"tex",
				"textureName"
			],
			[
				"GLEW",
				"GLEW_OK"
			],
			[
				"di",
				"display"
			],
			[
				"mar",
				"margin-top"
			],
			[
				"marg",
				"margin-left"
			],
			[
				"ma",
				"margin-left"
			],
			[
				"text",
				"text-align"
			],
			[
				"te",
				"text-align"
			],
			[
				"back",
				"background-size"
			],
			[
				"fon",
				"font-size"
			],
			[
				"font",
				"font-family"
			],
			[
				"Throw",
				"ThrowPhase"
			],
			[
				"FLYI",
				"FLYINGOFF"
			],
			[
				"Phy",
				"PhysicsState"
			],
			[
				"Ph",
				"PhysicsState"
			],
			[
				"s",
				"skeleton"
			],
			[
				"orig",
				"originalScale"
			],
			[
				"aimC",
				"aimChildren"
			],
			[
				"livin",
				"livingActors"
			],
			[
				"living",
				"livingItems"
			],
			[
				"game",
				"GameObject"
			],
			[
				"state",
				"stateLock"
			],
			[
				"nex",
				"nextParent"
			],
			[
				"next",
				"nextParent"
			],
			[
				"th",
				"throwTimer"
			],
			[
				"Ga",
				"GameObject"
			],
			[
				"reg",
				"regrowTimer"
			],
			[
				"Act",
				"ActorTeam"
			],
			[
				"body",
				"bodyParts"
			],
			[
				"spawn",
				"spawnType"
			],
			[
				"best",
				"bestDistSq"
			],
			[
				"Tar",
				"TargetNearest"
			],
			[
				"delta",
				"deltaTime"
			],
			[
				"shoul",
				"shouldThrow"
			],
			[
				"legL",
				"legLowerLeft"
			],
			[
				"CanT",
				"CanThrowStart"
			],
			[
				"throw",
				"thrower"
			],
			[
				"wea",
				"weapon"
			],
			[
				"thr",
				"thrower"
			],
			[
				"this",
				"thisRigidbody"
			],
			[
				"cha",
				"characterMask"
			],
			[
				"Glu",
				"GlueState"
			],
			[
				"glue",
				"glueState"
			],
			[
				"glu",
				"glueState"
			],
			[
				"spee",
				"speedUp"
			],
			[
				"debr",
				"debrisPart"
			],
			[
				"fa",
				"failedState"
			],
			[
				"Leg",
				"LegRightUpper"
			],
			[
				"weapon",
				"weaponType"
			],
			[
				"pare",
				"parentPart"
			],
			[
				"weapn",
				"weaponType"
			],
			[
				"switch",
				"switchThrowerType"
			],
			[
				"swi",
				"switchThrower"
			],
			[
				"thor",
				"thrower"
			],
			[
				"tho",
				"throwerPart"
			],
			[
				"we",
				"weaponPartIdx"
			],
			[
				"Thro",
				"ThrowPhase"
			],
			[
				"Thor",
				"ThrowPhase"
			],
			[
				"canW",
				"canWalkNormal"
			],
			[
				"local",
				"localScale"
			],
			[
				"Actor",
				"ActorBodyPart"
			],
			[
				"Body",
				"BodyPartType"
			],
			[
				"ve",
				"Vector3"
			],
			[
				"desired",
				"desiredPosition"
			],
			[
				"desi",
				"desiredPosition"
			],
			[
				"de",
				"desiredPosition"
			],
			[
				"sp",
				"spawnedObj"
			],
			[
				"dista",
				"distanceToObstacle"
			],
			[
				"U",
				"UnityEngine"
			],
			[
				"d",
				"desiredRotation"
			],
			[
				"en",
				"energyTimer"
			],
			[
				"axi",
				"axisX"
			],
			[
				"ax",
				"axisY"
			],
			[
				"v",
				"Vector2"
			],
			[
				"Acot",
				"ActorMotor"
			],
			[
				"chil",
				"childActor"
			],
			[
				"targe",
				"targetActor"
			],
			[
				"target",
				"targetVehicle"
			],
			[
				"oth",
				"otherEntity"
			],
			[
				"att",
				"attachedChildren"
			],
			[
				"D",
				"DestroySelf"
			],
			[
				"abil",
				"abilities"
			],
			[
				"regen",
				"Regen"
			]
		]
	},
	"buffers":
	[
		{
			"file": "common/serverjs/KWorld.js",
			"settings":
			{
				"buffer_size": 8408,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/serverjs/KActorSrv.js",
			"settings":
			{
				"buffer_size": 5113,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/commonjs/KActorData.js",
			"settings":
			{
				"buffer_size": 1361,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/clientjs/KActorCli.js",
			"settings":
			{
				"buffer_size": 7003,
				"line_ending": "Unix"
			}
		},
		{
			"contents": "Searching 42 files for \"'s'\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n 30004              if (failedPluginIds.length) {\n 30005                  errMessage += 'Loader plugin' +\n 30006:                     (failedPluginIds.length === 1 ? '' : 's') +\n 30007                      ' did not call ' +\n 30008                      'the load callback in the build:\\n' +\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n   78              {\n   79                  var command = user.commandQueue.pop();\n   80:                 if(command === 's')\n   81                  {\n   82                      var posX = user.userData.homePosition.x - 10+20*user.actors.length;\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n   98                  user.lastHeartbeat = new Date().getTime();\n   99                  io.emit('s-addUserData', user.userData );\n  100:                 user.commandQueue.push('s');\n  101:                 user.commandQueue.push('s');\n  102              	g_world.users.push(user);\n  103  \n\n4 matches across 3 files\n\n\nSearching 42 files for \"makeItemActor\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   51      }\n   52  \n   53:     KUserSrv.prototype.makeItemActor = function(p_heroActor, p_velocity) {\n   54          var userData = this.userData;\n   55          var shortName = userData.username.substring(0, 3);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  167          var uidx = KUtil.findUser(this.users, heroActor.actorData.userID);\n  168          var user = this.users[uidx];\n  169:         var punch = user.makeItemActor(heroActor, {x:1, y:1})\n  170          console.log('punch');\n  171      }\n  ...\n  175          var uidx = KUtil.findUser(this.users, heroActor.actorData.userID);\n  176          var user = this.users[uidx];\n  177:         var bullet = user.makeItemActor(heroActor, {x:1, y:1})\n  178          console.log('shoot');\n  179          console.log(chargeTime);\n\n3 matches across 2 files\n\n\nSearching 42 files for \"createactor\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n   87  \n   88                      var username = user.userData.username.substring(0, 3);\n   89:                     var actor = this.createActor(user, username, physics);\n   90                      if( user.mainActor === null )\n   91                      {\n   ..\n  117          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  118          var username = user.userData.username.substring(0, 3)+'punch';\n  119:         var punch = this.createActor(user, username, physics);\n  120          console.log('punch');\n  121      }\n  ...\n  132          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  133          var username = user.userData.username.substring(0, 3)+'shoot';\n  134:         var shoot = this.createActor(user, username, physics, io);\n  135          console.log('shoot');\n  136      }\n  137:     KWorld.prototype.createActor = function(user, name, physics)\n  138      {\n  139          var sector = this.getSectorRealPos(physics.x, physics.y);\n\n4 matches in 1 file\n\n\nSearching 42 files for \"lastVelocity\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\commonjs\\KActorData.js:\n    8          this.position = { x: 0, y: 0 };\n    9          this.velocity = { x: 0, y: 0 };\n   10:         this.lastVelocity = { x: 0, y: 0 };\n   11          this.actorState = 0;\n   12          this.speed = 0.4;\n   ..\n   23          this.position = { x: p_other.position.x, y: p_other.position.y };\n   24          this.velocity = { x: p_other.velocity.x, y: p_other.velocity.y };\n   25:         this.lastVelocity = { x: p_other.lastVelocity.x, y: p_other.lastVelocity.y };\n   26          this.speed = p_other.speed;\n   27          this.momentum = p_other.momentum;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   28      KActorSrv.prototype.momentumDesireMove = function(config)\n   29      {\n   30:         this.actorData.velocity.x += this.actorData.lastVelocity.x*this.actorData.momentum;\n   31:         this.actorData.velocity.y += this.actorData.lastVelocity.y*this.actorData.momentum;\n   32      }\n   33  \n   ..\n   72          this.circle.pos.x = Math.round(this.circle.pos.x);\n   73          this.circle.pos.y = Math.round(this.circle.pos.y);\n   74:         this.actorData.lastVelocity.x = this.circle.pos.x - this.actorData.position.x;\n   75:         this.actorData.lastVelocity.y = this.circle.pos.y - this.actorData.position.y;\n   76          this.actorData.position.x = this.circle.pos.x;\n   77          this.actorData.position.y = this.circle.pos.y;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KItemSrv.js:\n   16      KItemSrv.prototype.momentumDesireMove = function(config)\n   17      {\n   18:         this.actorData.velocity.x += this.actorData.lastVelocity.x*this.actorData.momentum;\n   19:         this.actorData.velocity.y += this.actorData.lastVelocity.y*this.actorData.momentum;\n   20      }\n   21  \n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  114          var posY = heroActor.actorData.position.y;\n  115          console.log(posX+\" \"+posY);\n  116:         var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117:         var velY = 0;//heroActor.actorData.lastVelocity.y;\n  118          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  ...\n  130          var posY = heroActor.actorData.position.y;\n  131          console.log(\"P\"+posX+\" \"+posY);\n  132:         var velX = heroActor.actorData.lastVelocity.x*chargeTime;\n  133:         var velY = heroActor.actorData.lastVelocity.y*chargeTime;\n  134          console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n\n14 matches across 4 files\n\n\nSearching 42 files for \"rfy\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  415        {\n  416          localInput.rfx = rsx;\n  417:         localInput.rfy = rsy;\n  418        }\n  419        var rslen = Math.min(1, Math.sqrt(rslensq) );\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 11273              this.gamepadSupportAvailable = (navigator.getGamepads ||\n 11274                  !!navigator.webkitGetGamepads || !!navigator.msGetGamepads || !!navigator.webkitGamepads);\n 11275:             this.buttonADataURL = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=\";\n 11276              this._callbackGamepadConnected = ongamedpadconnected;\n 11277              if (this.gamepadSupportAvailable) {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.js:\n    7  this._boundingInfo._checkCollision(t)&&(e.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var r=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return r;if(!this._generatePointsArray())return r;var n,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),h=this._submeshesOctree.intersectsRay(a);o=h.length,n=h.data}else n=this.subMeshes,o=n.length;for(var c=0;o>c;c++){var l=n[c];if(!(o>1)||l.canIntersects(t)){var u=l.intersects(t,this._positions,this.getIndices(),i);if(u&&(i||!s||u.distance<s.distance)&&(s=u,s.subMeshId=c,i))break}}if(s){var f=this.getWorldMatrix(),d=e.Vector3.TransformCoordinates(t.origin,f),p=t.direction.clone();p=p.scale(s.distance);var m=e.Vector3.TransformNormal(p,f),g=d.add(m);return r.hit=!0,r.distance=e.Vector3.Distance(d,g),r.pickedPoint=g,r.pickedMesh=this,r.bu=s.bu,r.bv=s.bv,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},i.prototype.clone=function(e,t,i){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},i.prototype.dispose=function(t){var i;for(this.getPhysicsImpostor()!==e.PhysicsEngine.NoImpostor&&this.setPhysicsState(e.PhysicsEngine.NoImpostor),i=0;i<this._intersectionsInProgress.length;i++){var r=this._intersectionsInProgress[i],n=r._intersectionsInProgress.indexOf(this);r._intersectionsInProgress.splice(n,1)}if(this._intersectionsInProgress=[],this.releaseSubMeshes(),this.getScene().removeMesh(this),t)for(i=0;i<this.getScene().meshes.length;i++){var o=this.getScene().meshes[i];o.parent===this&&(o.parent=null,o.computeWorldMatrix(!0))}else{for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);var s=this.getScene().meshes.slice(0);for(i=0;i<s.length;i++)s[i].parent===this&&s[i].dispose()}this._onAfterWorldMatrixUpdate=[],this._isDisposed=!0,this.onDispose&&this.onDispose()},i._BILLBOARDMODE_NONE=0,i._BILLBOARDMODE_X=1,i._BILLBOARDMODE_Y=2,i._BILLBOARDMODE_Z=4,i._BILLBOARDMODE_ALL=7,i}(e.Node);e.AbstractMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.diffuse=new e.Color3(1,1,1),this.specular=new e.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.includeOnlyWithLayerMask=0,this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this.excludeWithLayerMask=0,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,r.addLight(this)}return __extends(i,t),i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},i.prototype.transferToEffect=function(e,t,i){},i.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},i.prototype.canAffectMesh=function(e){return e?this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e)?!1:this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&e.layerMask)?!1:0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask?!1:!0:!0},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):t},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().removeLight(this)},i}(e.Node);e.Light=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,r),this.position=i}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this._transformedPosition?this._transformedPosition:this.position},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void t.setFloat4(i,this.position.x,this.position.y,this.position.z,0)},i.prototype.getShadowGenerator=function(){return null},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.PointLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r,n,o,s){t.call(this,e,s),this.position=i,this.direction=r,this.angle=n,this.exponent=o}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;e.Matrix.PerspectiveFovLHToRef(this.angle,1,n.minZ,n.maxZ,t)},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!1},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i,r){var n;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),this.computeTransformedPosition(),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),t.setFloat4(i,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),n=e.Vector3.Normalize(this._transformedDirection)):(t.setFloat4(i,this.position.x,this.position.y,this.position.z,this.exponent),n=e.Vector3.Normalize(this.direction)),t.setFloat4(r,n.x,n.y,n.z,Math.cos(.5*this.angle))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.SpotLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){t.call(this,i,n),this.direction=r,this.groundColor=new e.Color3(0,0,0)}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i,r){var n=e.Vector3.Normalize(this.direction);t.setFloat4(i,n.x,n.y,n.z,0),t.setColor3(r,this.groundColor.scale(this.intensity))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i}(e.Light);e.HemisphericLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,r),this.direction=i,this.shadowOrthoScale=.5,this.position=i.scale(-1)}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.setShadowProjectionMatrix=function(t,i,r){for(var n=Number.MAX_VALUE,o=Number.MIN_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,h=e.Vector3.Zero(),c=this.getScene().activeCamera,l=0;l<r.length;l++){var u=r[l];if(u){var f=u.getBoundingInfo();if(f)for(var d=f.boundingBox,p=0;p<d.vectorsWorld.length;p++)e.Vector3.TransformCoordinatesToRef(d.vectorsWorld[p],i,h),h.x<n&&(n=h.x),h.y<a&&(a=h.y),h.x>o&&(o=h.x),h.y>s&&(s=h.y)}}var m=o-n,g=s-a;e.Matrix.OrthoOffCenterLHToRef(n-m*this.shadowOrthoScale,o+m*this.shadowOrthoScale,a-g*this.shadowOrthoScale,s+g*this.shadowOrthoScale,-c.maxZ,c.maxZ,t)},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!0},i.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(i,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(i,this.direction.x,this.direction.y,this.direction.z,1)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.DirectionalLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,r){var n=this;this._filter=t.FILTER_NONE,this.blurScale=2,this._blurBoxOffset=0,this._bias=5e-5,this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._light=r,this._scene=r.getScene(),this._mapSize=i,r._shadowGenerator=this,this._shadowMap=new e.RenderTargetTexture(r.name+\"_shadowMap\",i,this._scene,!1),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.onAfterUnbind=function(){n.useBlurVarianceShadowMap&&(n._shadowMap2||(n._shadowMap2=new e.RenderTargetTexture(r.name+\"_shadowMap\",i,n._scene,!1),n._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,n._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,n._shadowMap2.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),n._downSamplePostprocess=new e.PassPostProcess(\"downScale\",1/n.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,n._scene.getEngine()),n._downSamplePostprocess.onApply=function(e){e.setTexture(\"textureSampler\",n._shadowMap)},n.blurBoxOffset=1),n._scene.postProcessManager.directRender([n._downSamplePostprocess,n._boxBlurPostprocess],n._shadowMap2.getInternalTexture()))};var o=function(t){var i=t.getRenderingMesh(),r=n._scene,o=r.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){o.enableEffect(n._effect),i._bind(t,n._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(n._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();n._effect.setTexture(\"diffuseSampler\",c),n._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&n._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,n._effect,e.Material.TriangleFillMode,s,a,function(e,t){return n._effect.setMatrix(\"world\",t)})}else n._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(e,t,i){var r;for(r=0;r<e.length;r++)o(e.data[r]);for(r=0;r<t.length;r++)o(t.data[r]);if(n._transparencyShadow)for(r=0;r<i.length;r++)o(i.data[r])},this._shadowMap.onClear=function(t){n.useBlurVarianceShadowMap||n.useVarianceShadowMap?t.clear(new e.Color4(0,0,0,0),!0,!0):t.clear(new e.Color4(1,1,1,1),!0,!0)}}return Object.defineProperty(t,\"FILTER_NONE\",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_VARIANCESHADOWMAP\",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_POISSONSAMPLING\",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_BLURVARIANCESHADOWMAP\",{get:function(){return t._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"bias\",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"blurBoxOffset\",{get:function(){return this._blurBoxOffset},set:function(t){var i=this;this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new e.PostProcess(\"DepthBoxBlur\",\"depthBoxBlur\",[\"screenSize\",\"boxOffset\"],[],1/this.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,\"#define OFFSET \"+t),this._boxBlurPostprocess.onApply=function(e){e.setFloat2(\"screenSize\",i._mapSize/i.blurScale,i._mapSize/i.blurScale)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"filter\",{get:function(){return this._filter},set:function(t){this._filter!==t&&(this._filter=t,this.useVarianceShadowMap||this.useBlurVarianceShadowMap?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"useVarianceShadowMap\",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"usePoissonSampling\",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===t.FILTER_VARIANCESHADOWMAP||this.filter===t.FILTER_BLURVARIANCESHADOWMAP)},set:function(e){this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"useBlurVarianceShadowMap\",{get:function(){return this.filter===t.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_BLURVARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var r=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&r.push(\"#define VSM\");var n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"shadowMap\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId())return this._transformMatrix;this._currentRenderID=t.getRenderId();var i=this._light.position,r=this._light.direction;return this._light.computeTransformedPosition()&&(i=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&i.equals(this._cachedPosition)&&r.equals(this._cachedDirection)||(this._cachedPosition=i.clone(),this._cachedDirection=r.clone(),e.Matrix.LookAtLHToRef(i,this._light.position.add(r),e.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){this._darkness=e>=1?1:0>=e?0:e},t.prototype.setTransparencyShadow=function(e){this._transparencyShadow=e},t.prototype._packHalf=function(t){var i=255*t,r=i-Math.floor(i);return new e.Vector2(t-r/255,r)},t.prototype.dispose=function(){this._shadowMap.dispose(),this._shadowMap2&&this._shadowMap2.dispose(),this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t._FILTER_BLURVARIANCESHADOWMAP=3,t}();e.ShadowGenerator=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e,t,i,r){return e.x>i.x+r?!1:i.x-r>t.x?!1:e.y>i.y+r?!1:i.y-r>t.y?!1:e.z>i.z+r?!1:i.z-r>t.z?!1:!0},i=function(e,t,i,r){var n=t*t-4*e*i,o={root:0,found:!1};if(0>n)return o;var s=Math.sqrt(n),a=(-t-s)/(2*e),h=(-t+s)/(2*e);if(a>h){var c=h;h=a,a=c}return a>0&&r>a?(o.root=a,o.found=!0,o):h>0&&r>h?(o.root=h,o.found=!0,o):o},r=function(){function r(){this.radius=new e.Vector3(1,1,1),this.retry=0,this.basePointWorld=e.Vector3.Zero(),this.velocityWorld=e.Vector3.Zero(),this.normalizedVelocity=e.Vector3.Zero(),this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero()}return r.prototype._initialize=function(t,i,r){this.velocity=i,e.Vector3.NormalizeToRef(i,this.normalizedVelocity),this.basePoint=t,t.multiplyToRef(this.radius,this.basePointWorld),i.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=r,this.collisionFound=!1},r.prototype._checkPointInTriangle=function(t,i,r,n,o){i.subtractToRef(t,this._tempVector),r.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return 0>s?!1:(n.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),0>s?!1:(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),s>=0))},r.prototype._canDoCollision=function(i,r,n,o){var s=e.Vector3.Distance(this.basePointWorld,i),a=Math.max(this.radius.x,this.radius.y,this.radius.z);return s>this.velocityWorldLength+a+r?!1:t(n,o,this.basePointWorld,this.velocityWorldLength+a)?!0:!1},r.prototype._testTriangle=function(t,r,n,o,s,a){var h,c=!1;r||(r=[]),r[t]||(r[t]=new e.Plane(0,0,0,0),r[t].copyFromPoints(n,o,s));var l=r[t];if(a||l.isFrontFacingTo(this.normalizedVelocity,0)){var u=l.signedDistanceTo(this.basePoint),f=e.Vector3.Dot(l.normal,this.velocity);if(0==f){if(Math.abs(u)>=1)return;c=!0,h=0}else{h=(-1-u)/f;var d=(1-u)/f;if(h>d){var p=d;d=h,h=p}if(h>1||0>d)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var m=!1,g=1;if(c||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,o,s,l.normal)&&(m=!0,g=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!m){var _=this.velocity.lengthSquared(),v=_;this.basePoint.subtractToRef(n,this._tempVector);var y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g);b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(n)),this.basePoint.subtractToRef(o,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(o)),this.basePoint.subtractToRef(s,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex);var M=this._edge.lengthSquared(),S=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex);if(v=M*-_+S*S,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*S*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found){var A=(S*b.root-T)/M;A>=0&&1>=A&&(g=b.root,m=!0,this._edge.scaleInPlace(A),n.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this.basePoint,this._baseToVertex),M=this._edge.lengthSquared(),S=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex),v=M*-_+S*S,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*S*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found&&(A=(S*b.root-T)/M,A>=0&&1>=A&&(g=b.root,m=!0,this._edge.scaleInPlace(A),o.addToRef(this._edge,this._collisionPoint))),n.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex),M=this._edge.lengthSquared(),S=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex),v=M*-_+S*S,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*S*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found&&(A=(S*b.root-T)/M,A>=0&&1>=A&&(g=b.root,m=!0,this._edge.scaleInPlace(A),s.addToRef(this._edge,this._collisionPoint)))}if(m){var D=g*this.velocity.length();(!this.collisionFound||D<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=D,this.collisionFound=!0)}}},r.prototype._collide=function(e,t,i,r,n,o,s){for(var a=r;n>a;a+=3){var h=t[i[a]-o],c=t[i[a+1]-o],l=t[i[a+2]-o];this._testTriangle(a,e,l,c,h,s)}},r.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this.nearestDistance/i.length()),this.basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},r}();e.Collider=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\"\",function(e){e[e.INIT=0]=\"INIT\",e[e.UPDATE=1]=\"UPDATE\",e[e.COLLIDE=2]=\"COLLIDE\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var t=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\"SUCCESS\",e[e.UNKNOWN_ERROR=1]=\"UNKNOWN_ERROR\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,r=function(){function r(){var n=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){n._addUpdateMeshesList[e.uniqueId]=r.SerializeMesh(e)},this.onGeometryUpdated=function(e){n._addUpdateGeometriesList[e.id]=r.SerializeGeometry(e)},this._afterRender=function(){if(n._init&&!(0==n._toRemoveGeometryArray.length&&0==n._toRemoveMeshesArray.length&&0==Object.keys(n._addUpdateGeometriesList).length&&0==Object.keys(n._addUpdateMeshesList).length||n._runningUpdated>4)){++n._runningUpdated;var e={updatedMeshes:n._addUpdateMeshesList,updatedGeometries:n._addUpdateGeometriesList,removedGeometries:n._toRemoveGeometryArray,removedMeshes:n._toRemoveMeshesArray},i={payload:e,taskType:t.UPDATE},r=[];for(var o in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(o)&&(r.push(i.payload.updatedGeometries[o].indices.buffer),r.push(i.payload.updatedGeometries[o].normals.buffer),r.push(i.payload.updatedGeometries[o].positions.buffer));n._worker.postMessage(i,r),n._addUpdateMeshesList={},n._addUpdateGeometriesList={},n._toRemoveGeometryArray=[],n._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(r){var o=r.data;if(o.error!=i.SUCCESS)return void e.Tools.Warn(\"error returned from worker!\");switch(o.taskType){case t.INIT:n._init=!0,n._scene.meshes.forEach(function(e){n.onMeshAdded(e)}),n._scene.getGeometries().forEach(function(e){n.onGeometryAdded(e)});break;case t.UPDATE:n._runningUpdated--;break;case t.COLLIDE:n._runningCollisionTask=!1;var s=o.payload;if(!n._collisionsCallbackArray[s.collisionId])return;n._collisionsCallbackArray[s.collisionId](s.collisionId,e.Vector3.FromArray(s.newPosition),n._scene.getMeshByUniqueID(s.collidedMeshUniqueId)),n._collisionsCallbackArray[s.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return r.prototype.getNewPosition=function(e,i,r,n,o,s,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(r.radius,this._scaledPosition),i.divideToRef(r.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=s;var h={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:r.radius.asArray()},collisionId:a,excludedMeshUniqueId:o?o.uniqueId:null,maximumRetry:n},c={payload:h,taskType:t.COLLIDE};this._worker.postMessage(c)}},r.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var r=e.WorkerIncluded?e.Engine.CodeRepository+\"Collisions/babylon.collisionWorker.js\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\"application/javascript\"}));this._worker=new Worker(r),this._worker.onmessage=this._onMessageFromWorker;var n={payload:{},taskType:t.INIT};this._worker.postMessage(n)},r.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},r.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},r.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},r.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},r.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},r.SerializeMesh=function(e){var t=[];e.subMeshes&&(t=e.subMeshes.map(function(e,t){return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:t,checkCollisions:e.checkCollisions}},r.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(t.getIndices()||[])}},r}();e.CollisionCoordinatorWorker=r;var n=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,i,r,n,o,s){e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,this._finalPosition,n),this._finalPosition.multiplyInPlace(i.radius),o(s,this._finalPosition,i.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,i,r,n,o,s){void 0===s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(r.retry>=n)return void o.copyFrom(t);r._initialize(t,i,a);for(var h=0;h<this._scene.meshes.length;h++){var c=this._scene.meshes[h];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==s&&c._checkCollision(r)}return r.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&r._getResponse(t,i),i.length()<=a?void o.copyFrom(t):(r.retry++,void this._collideWithWorld(t,i,r,n,o,s))):void t.addToRef(i,o)},t}();e.CollisionCoordinatorLegacy=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.compensateDistorsion=!0}return Object.defineProperty(t.prototype,\"aspectRatio\",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"aspectRatioFov\",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"leftHMatrix\",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightHMatrix\",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(-i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"leftPreViewMatrix\",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightPreViewMatrix\",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t;var i=function(i){function r(t,n,o){i.call(this,t,o),this.position=n,this.upVector=e.Vector3.Up(),this.orthoLeft=null,\n    8  this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this.mode=r.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=r.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=r.RIG_MODE_NONE,this._rigCameras=new Array,this._computedViewMatrix=e.Matrix.Identity(),this._projectionMatrix=new e.Matrix,this._postProcesses=new Array,this._postProcessesTakenIndices=[],this._activeMeshes=new e.SmartArray(256),this._globalPosition=e.Vector3.Zero(),o.addCamera(this),o.activeCamera||(o.activeCamera=this)}return __extends(r,i),Object.defineProperty(r,\"PERSPECTIVE_CAMERA\",{get:function(){return r._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ORTHOGRAPHIC_CAMERA\",{get:function(){return r._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"FOVMODE_VERTICAL_FIXED\",{get:function(){return r._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"FOVMODE_HORIZONTAL_FIXED\",{get:function(){return r._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_NONE\",{get:function(){return r._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_ANAGLYPH\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_OVERUNDER\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_VR\",{get:function(){return r._RIG_MODE_VR},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"globalPosition\",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),r.prototype.getActiveMeshes=function(){return this._activeMeshes},r.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},r.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},r.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this);var t=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()},r.prototype._updateFromScene=function(){this.updateCache(),this._update()},r.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},r.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===r.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},r.prototype.attachControl=function(e){},r.prototype.detachControl=function(e){},r.prototype._update=function(){this._checkInputs(),this.cameraRigMode!==r.RIG_MODE_NONE&&this._updateRigCameras()},r.prototype._checkInputs=function(){},r.prototype.attachPostProcess=function(t,i){if(void 0===i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1)return e.Tools.Error(\"You're trying to reuse a post process not defined as reusable.\"),0;if(null==i||0>i)return this._postProcesses.push(t),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1;var r=0;if(this._postProcesses[i]){for(var n=this._postProcesses.length-1,o=n;o>=i+1;--o)this._postProcesses[o+1]=this._postProcesses[o];r=1}for(o=0;o<this._postProcessesTakenIndices.length;++o)if(!(this._postProcessesTakenIndices[o]<i)){n=this._postProcessesTakenIndices.length-1;for(var s=n;s>=o;--s)this._postProcessesTakenIndices[s+1]=this._postProcessesTakenIndices[s]+r;this._postProcessesTakenIndices[o]=i;break}r||-1!=this._postProcessesTakenIndices.indexOf(i)||this._postProcessesTakenIndices.push(i);var a=i+r;return this._postProcesses[a]=t,a},r.prototype.detachPostProcess=function(e,t){void 0===t&&(t=null);var i=[];if(t)for(t=t instanceof Array?t:[t],o=0;o<t.length;o++){var r=this._postProcesses[t[o]];r===e?(delete this._postProcesses[t[o]],s=this._postProcessesTakenIndices.indexOf(t[o]),this._postProcessesTakenIndices.splice(s,1)):i.push(o)}else for(var n=this._postProcesses.length,o=0;n>o;o++)if(this._postProcesses[o]===e){delete this._postProcesses[o];var s=this._postProcessesTakenIndices.indexOf(o);this._postProcessesTakenIndices.splice(s,1)}return i},r.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=e.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},r.prototype._getViewMatrix=function(){return e.Matrix.Identity()},r.prototype.getViewMatrix=function(t){return this._computedViewMatrix=this._computeViewMatrix(t),!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},r.prototype._computeViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},r.prototype.getProjectionMatrix=function(t){if(!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var i=this.getEngine();if(this.mode===r.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),e.Matrix.PerspectiveFovLHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode),this._projectionMatrix;var n=i.getRenderWidth()/2,o=i.getRenderHeight()/2;return e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},r.prototype.dispose=function(){for(this.getScene().removeCamera(this);this._rigCameras.length>0;)this._rigCameras.pop().dispose();for(var e=0;e<this._postProcessesTakenIndices.length;++e)this._postProcesses[this._postProcessesTakenIndices[e]].dispose(this)},r.prototype.setCameraRigMode=function(i,n){for(;this._rigCameras.length>0;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=i,this._cameraRigParams={},this.cameraRigMode){case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this._rigCameras.push(this.createRigCamera(this.name+\"_L\",0)),this._rigCameras.push(this.createRigCamera(this.name+\"_R\",1))}var o=new Array;switch(this.cameraRigMode){case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:o.push(new e.PassPostProcess(this.name+\"_passthru\",1,this._rigCameras[0])),this._rigCameras[0].isIntermediate=!0,o.push(new e.AnaglyphPostProcess(this.name+\"_anaglyph\",1,this._rigCameras[1])),o[1].onApply=function(e){e.setTextureFromPostProcess(\"leftSampler\",o[0])};break;case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:var s=this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,a=this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:0,h=1-a;o.push(new e.PassPostProcess(this.name+\"_passthru\",1,this._rigCameras[a])),this._rigCameras[a].isIntermediate=!0,o.push(new e.StereoscopicInterlacePostProcess(this.name+\"_stereoInterlace\",this._rigCameras[h],o[0],s));break;case r.RIG_MODE_VR:this._rigCameras.push(this.createRigCamera(this.name+\"_L\",0)),this._rigCameras.push(this.createRigCamera(this.name+\"_R\",1));var c=n.vrCameraMetrics||t.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=c,this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=c.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=c.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess(\"VR_Distort_Compensation_Left\",this._rigCameras[0],!1,c)),this._rigCameras[1]._cameraRigParams.vrMetrics=this._rigCameras[0]._cameraRigParams.vrMetrics,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=c.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=c.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess(\"VR_Distort_Compensation_Right\",this._rigCameras[1],!0,c))}this._update()},r.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams[t]=i,\"interaxialDistance\"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(i/.0637))},r.prototype.createRigCamera=function(e,t){return null},r.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov;this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},r._PERSPECTIVE_CAMERA=0,r._ORTHOGRAPHIC_CAMERA=1,r._FOVMODE_VERTICAL_FIXED=0,r._FOVMODE_HORIZONTAL_FIXED=1,r._RIG_MODE_NONE=0,r._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r._RIG_MODE_VR=20,r}(e.Node);e.Camera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){t.call(this,i,r,n),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0),this.rotation=new e.Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.lockedTarget=null,this._currentTarget=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._camMatrix=e.Matrix.Zero(),this._cameraTransformMatrix=e.Matrix.Zero(),this._cameraRotationMatrix=e.Matrix.Zero(),this._referencePoint=new e.Vector3(0,0,1),this._transformedReferencePoint=e.Vector3.Zero(),this._lookAtTemp=e.Matrix.Zero(),this._tempMatrix=e.Matrix.Zero()}return __extends(i,t),i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&this._cache.rotation.equals(this.rotation)},i.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*(e.getDeltaTime()/(10*e.getFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);this.rotation.y=i.x>=0?-Math.atan(i.z/i.x)+Math.PI/2:-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=-Math.acos(e.Vector3.Dot(new e.Vector3(0,1,0),this.upVector)),isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),r&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var n=Math.PI/2*.95;this.rotation.x>n&&(this.rotation.x=n),this.rotation.x<-n&&(this.rotation.x=-n)}i&&(Math.abs(this.cameraDirection.x)<e.Engine.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<e.Engine.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<e.Engine.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<e.Engine.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<e.Engine.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},i.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(0!==this.upVector.x||1!==this.upVector.y||0!==this.upVector.z?(e.Matrix.LookAtLHToRef(e.Vector3.Zero(),this._referencePoint,this.upVector,this._lookAtTemp),e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},i.prototype._getVRViewMatrix=function(){return e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),e.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._cameraRigParams.vrActualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._cameraRigParams.vrActualUp,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._viewMatrix),this._viewMatrix},i.prototype.createRigCamera=function(t,r){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var n=new i(t,this.position.clone(),this.getScene());return this.cameraRigMode===e.Camera.RIG_MODE_VR&&(n._cameraRigParams={},n._cameraRigParams.vrActualUp=new e.Vector3(0,0,0),n._getViewMatrix=n._getVRViewMatrix),n}return null},i.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var i=this._rigCameras[0],r=this._rigCameras[1];this.cameraRigMode===e.Camera.RIG_MODE_VR?(i.rotation.x=r.rotation.x=this.rotation.x,i.rotation.y=r.rotation.y=this.rotation.y,i.rotation.z=r.rotation.z=this.rotation.z,i.position.copyFrom(this.position),r.position.copyFrom(this.position)):(i.setTarget(this.getTarget()),r.setTarget(this.getTarget()),this._getRigCamPosition(-this._cameraRigParams.stereoHalfAngle,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle,r.position))}t.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPosition=function(t,i){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var r=this.getTarget();e.Matrix.Translation(-r.x,-r.y,-r.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(r.x,r.y,r.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,i)},i}(e.Camera);e.TargetCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){var o=this;t.call(this,i,r,n),this.ellipsoid=new e.Vector3(.5,1,.5),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.checkCollisions=!1,this.applyGravity=!1,this.angularSensibility=2e3,this._keys=[],this._collider=new e.Collider,this._needMoveForGravity=!1,this._oldPosition=e.Vector3.Zero(),this._diffPosition=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius);var n=function(t){o._newPosition.copyFrom(t),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition);o.position.clone();o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&r&&o.onCollide(r))};n(i)}}return __extends(i,t),i.prototype.attachControl=function(t,i){var r,n=this,o=this.getEngine();this._attachedElement||(this._attachedElement=t,void 0===this._onMouseDown&&(this._onMouseDown=function(e){r={x:e.clientX,y:e.clientY},i||e.preventDefault()},this._onMouseUp=function(e){r=null,i||e.preventDefault()},this._onMouseOut=function(e){r=null,n._keys=[],i||e.preventDefault()},this._onMouseMove=function(e){if(r||o.isPointerLock){var t,s;o.isPointerLock?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,s=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0):(t=e.clientX-r.x,s=e.clientY-r.y),n.cameraRotation.y+=t/n.angularSensibility,n.cameraRotation.x+=s/n.angularSensibility,r={x:e.clientX,y:e.clientY},i||e.preventDefault()}},this._onKeyDown=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);-1===t&&n._keys.push(e.keyCode),i||e.preventDefault()}},this._onKeyUp=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);t>=0&&n._keys.splice(t,1),i||e.preventDefault()}},this._onLostFocus=function(){n._keys=[]},this._reset=function(){n._keys=[],r=null,n.cameraDirection=new e.Vector3(0,0,0),n.cameraRotation=new e.Vector2(0,0)}),t.addEventListener(\"mousedown\",this._onMouseDown,!1),t.addEventListener(\"mouseup\",this._onMouseUp,!1),t.addEventListener(\"mouseout\",this._onMouseOut,!1),t.addEventListener(\"mousemove\",this._onMouseMove,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedElement==t&&(t.removeEventListener(\"mousedown\",this._onMouseDown),t.removeEventListener(\"mouseup\",this._onMouseUp),t.removeEventListener(\"mouseout\",this._onMouseOut),t.removeEventListener(\"mousemove\",this._onMouseMove),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]),this._attachedElement=null,this._reset&&this._reset())},i.prototype._collideWithWorld=function(t){var i;i=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid,this.applyGravity&&t.addInPlace(this.getScene().gravity),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero());for(var i=0;i<this._keys.length;i++){var r=this._keys[i],n=this._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(r)?this._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(r)?this._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(r)?this._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(r)&&this._localDirection.copyFromFloats(0,0,-n),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)}t.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},i}(e.TargetCamera);e.FreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,i,r),this.radius=12,this.rotationOffset=0,this.heightOffset=4,this.cameraAcceleration=.05,this.maxCameraSpeed=20}return __extends(i,t),i.prototype.getRadians=function(e){return e*Math.PI/180},i.prototype.follow=function(t){if(t){var i;if(t.rotationQuaternion){var r=new e.Matrix;t.rotationQuaternion.toRotationMatrix(r),i=Math.atan2(r.m[8],r.m[10])}else i=t.rotation.y;var n=this.getRadians(this.rotationOffset)+i,o=t.position.x+Math.sin(n)*this.radius,s=t.position.z+Math.cos(n)*this.radius,a=o-this.position.x,h=t.position.y+this.heightOffset-this.position.y,c=s-this.position.z,l=a*this.cameraAcceleration*2,u=h*this.cameraAcceleration,f=c*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=1>l?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=1>u?-this.maxCameraSpeed:this.maxCameraSpeed),(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=1>f?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+l,this.position.y+u,this.position.z+f),this.setTarget(t.position)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow(this.target)},i}(e.TargetCamera);e.FollowCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,i,r),this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.angularSensibility=2e5,this.moveSensibility=500}return __extends(i,t),i.prototype.attachControl=function(t,i){var r,n=this;this._attachedCanvas||(this._attachedCanvas=t,void 0===this._onPointerDown&&(this._onPointerDown=function(e){i||e.preventDefault(),n._pointerPressed.push(e.pointerId),1===n._pointerPressed.length&&(r={x:e.clientX,y:e.clientY})},this._onPointerUp=function(e){i||e.preventDefault();var t=n._pointerPressed.indexOf(e.pointerId);-1!==t&&(n._pointerPressed.splice(t,1),0==t&&(r=null,n._offsetX=null,n._offsetY=null))},this._onPointerMove=function(e){if(i||e.preventDefault(),r){var t=n._pointerPressed.indexOf(e.pointerId);0==t&&(n._offsetX=e.clientX-r.x,n._offsetY=-(e.clientY-r.y))}},this._onLostFocus=function(){n._offsetX=null,n._offsetY=null}),t.addEventListener(\"pointerdown\",this._onPointerDown),t.addEventListener(\"pointerup\",this._onPointerUp),t.addEventListener(\"pointerout\",this._onPointerUp),t.addEventListener(\"pointermove\",this._onPointerMove),e.Tools.RegisterTopRootEvents([{name:\"blur\",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedCanvas==t&&(t.removeEventListener(\"pointerdown\",this._onPointerDown),t.removeEventListener(\"pointerup\",this._onPointerUp),t.removeEventListener(\"pointerout\",this._onPointerUp),t.removeEventListener(\"pointermove\",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:\"blur\",handler:this._onLostFocus}]),this._attachedCanvas=null)},i.prototype._checkInputs=function(){if(this._offsetX){if(this.cameraRotation.y+=this._offsetX/this.angularSensibility,this._pointerPressed.length>1)this.cameraRotation.x+=-this._offsetY/this.angularSensibility;else{var i=this._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,this._cameraRotationMatrix))}t.prototype._checkInputs.call(this)}},i}(e.FreeCamera);e.TouchCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=e.Tools.GetPointerPrefix(),i=function(i){function r(t,r,n,o,s,a){var h=this;i.call(this,t,e.Vector3.Zero(),a),this.alpha=r,this.beta=n,this.radius=o,this.target=s,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.angularSensibility=1e3,this.wheelPrecision=3,this.pinchPrecision=2,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.zoomOnFactor=1,this.targetScreenOffset=e.Vector2.Zero(),this.pinchInwards=!0,this.allowUpsideDown=!0,this._keys=[],this._viewMatrix=new e.Matrix,this.checkCollisions=!1,this.collisionRadius=new e.Vector3(.5,.5,.5),this._collider=new e.Collider,this._previousPosition=e.Vector3.Zero(),this._collisionVelocity=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),h.getScene().workerCollisions&&h.checkCollisions&&i.multiplyInPlace(h._collider.radius),r?(h.setPosition(h.position),h.onCollide&&h.onCollide(r)):h._previousPosition.copyFrom(h.position);var n=Math.cos(h.alpha),o=Math.sin(h.alpha),s=Math.cos(h.beta),a=Math.sin(h.beta),c=h._getTargetPosition();c.addToRef(new e.Vector3(h.radius*n*a,h.radius*s,h.radius*o*a),h._newPosition),h.position.copyFrom(h._newPosition);var l=h.upVector;if(h.allowUpsideDown&&h.beta<0){var l=l.clone();l=l.negate()}e.Matrix.LookAtLHToRef(h.position,c,l,h._viewMatrix),h._viewMatrix.m[12]+=h.targetScreenOffset.x,h._viewMatrix.m[13]+=h.targetScreenOffset.y,h._collisionTriggered=!1},this.target||(this.target=e.Vector3.Zero()),this.getViewMatrix()}return __extends(r,i),r.prototype._getTargetPosition=function(){return this.target.position||this.target},r.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=void 0},r.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset=this.targetScreenOffset.clone()},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},r.prototype.attachControl=function(i,r){var n,o=this,s=0,a=new e.SmartCollection;if(!this._attachedElement){this._attachedElement=i;var h=this.getEngine();void 0===this._onPointerDown&&(this._onPointerDown=function(e){a.add(e.pointerId,{x:e.clientX,y:e.clientY,type:e.pointerType}),n=a.item(e.pointerId),r||e.preventDefault()},this._onPointerUp=function(e){n=null,s=0,a.empty(),r||e.preventDefault()},this._onPointerMove=function(e){switch(r||e.preventDefault(),a.count){case 1:var t=e.clientX-n.x,i=e.clientY-n.y;o.inertialAlphaOffset-=t/o.angularSensibility,o.inertialBetaOffset-=i/o.angularSensibility,n.x=e.clientX,n.y=e.clientY;break;case 2:a.item(e.pointerId).x=e.clientX,a.item(e.pointerId).y=e.clientY;var h=o.pinchInwards?1:-1,c=a.getItemByIndex(0).x-a.getItemByIndex(1).x,l=a.getItemByIndex(0).y-a.getItemByIndex(1).y,u=c*c+l*l;if(0===s)return void(s=u);u!==s&&(o.inertialRadiusOffset+=(u-s)/(o.pinchPrecision*o.wheelPrecision*o.angularSensibility*h),s=u);break;default:a.item(e.pointerId)&&(a.item(e.pointerId).x=e.clientX,a.item(e.pointerId).y=e.clientY)}},this._onMouseMove=function(e){if(h.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;o.inertialAlphaOffset-=t/o.angularSensibility,o.inertialBetaOffset-=i/o.angularSensibility,r||e.preventDefault()}},this._wheel=function(e){var t=0;e.wheelDelta?t=e.wheelDelta/(40*o.wheelPrecision):e.detail&&(t=-e.detail/o.wheelPrecision),t&&(o.inertialRadiusOffset+=t),e.preventDefault&&(r||e.preventDefault())},this._onKeyDown=function(e){if(-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){var t=o._keys.indexOf(e.keyCode);-1===t&&o._keys.push(e.keyCode),e.preventDefault&&(r||e.preventDefault())}},this._onKeyUp=function(e){if(-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){\n    9: var t=o._keys.indexOf(e.keyCode);t>=0&&o._keys.splice(t,1),e.preventDefault&&(r||e.preventDefault())}},this._onLostFocus=function(){o._keys=[],a.empty(),s=0,n=null},this._onGestureStart=function(e){void 0!==window.MSGesture&&(o._MSGestureHandler||(o._MSGestureHandler=new MSGesture,o._MSGestureHandler.target=i),o._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){o.radius*=e.scale,e.preventDefault&&(r||(e.stopPropagation(),e.preventDefault()))},this._reset=function(){o._keys=[],o.inertialAlphaOffset=0,o.inertialBetaOffset=0,o.inertialRadiusOffset=0,a.empty(),s=0,n=null}),i.addEventListener(t+\"down\",this._onPointerDown,!1),i.addEventListener(t+\"up\",this._onPointerUp,!1),i.addEventListener(t+\"out\",this._onPointerUp,!1),i.addEventListener(t+\"move\",this._onPointerMove,!1),i.addEventListener(\"mousemove\",this._onMouseMove,!1),i.addEventListener(\"MSPointerDown\",this._onGestureStart,!1),i.addEventListener(\"MSGestureChange\",this._onGesture,!1),i.addEventListener(\"mousewheel\",this._wheel,!1),i.addEventListener(\"DOMMouseScroll\",this._wheel,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}])}},r.prototype.detachControl=function(i){this._attachedElement===i&&(i.removeEventListener(t+\"down\",this._onPointerDown),i.removeEventListener(t+\"up\",this._onPointerUp),i.removeEventListener(t+\"out\",this._onPointerUp),i.removeEventListener(t+\"move\",this._onPointerMove),i.removeEventListener(\"mousemove\",this._onMouseMove),i.removeEventListener(\"MSPointerDown\",this._onGestureStart),i.removeEventListener(\"MSGestureChange\",this._onGesture),i.removeEventListener(\"mousewheel\",this._wheel),i.removeEventListener(\"DOMMouseScroll\",this._wheel),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},r.prototype._checkInputs=function(){if(!this._collisionTriggered){for(var t=0;t<this._keys.length;t++){var r=this._keys[t];-1!==this.keysLeft.indexOf(r)?this.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(r)?this.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(r)?this.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(r)&&(this.inertialBetaOffset+=.01)}(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Engine.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Engine.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<e.Engine.Epsilon&&(this.inertialRadiusOffset=0)),this._checkLimits(),i.prototype._checkInputs.call(this)}},r.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},r.prototype.setPosition=function(e){var t=e.subtract(this._getTargetPosition());this.radius=t.length(),this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2))),t.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(t.y/this.radius),this._checkLimits()},r.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),r=Math.cos(this.beta),n=Math.sin(this.beta),o=this._getTargetPosition();if(o.addToRef(new e.Vector3(this.radius*t*n,this.radius*r,this.radius*i*n),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;if(this.allowUpsideDown&&this.beta<0){var s=s.clone();s=s.negate()}e.Matrix.LookAtLHToRef(this.position,o,s,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._viewMatrix},r.prototype.zoomOn=function(t){t=t||this.getScene().meshes;var i=e.Mesh.MinMax(t),r=e.Vector3.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r})},r.prototype.focusOn=function(t){var i,r;void 0===t.min?(i=t||this.getScene().meshes,i=e.Mesh.MinMax(i),r=e.Vector3.Distance(i.min,i.max)):(i=t,r=t.distance),this.target=e.Mesh.Center(i),this.maxZ=2*r},r.prototype.createRigCamera=function(t,i){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var n=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);return new r(t,this.alpha+n,this.beta,this.radius,this.target,this.getScene())}},r.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var t=this._rigCameras[0],r=this._rigCameras[1];t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.beta=r.beta=this.beta,t.radius=r.radius=this.radius}i.prototype._updateRigCameras.call(this)},r}(e.Camera);e.ArcRotateCamera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){var n=this;t.call(this,e,i,r),this._offsetX=null,this._offsetY=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0,this.angularSensibility=1e4,this.moveSensibility=50,window.addEventListener(\"resize\",function(){n._initialOrientationGamma=null},!1)}return __extends(i,t),i.prototype.attachControl=function(e,t){var i=this;this._attachedCanvas||(this._attachedCanvas=e,this._orientationChanged||(this._orientationChanged=function(e){i._initialOrientationGamma||(i._initialOrientationGamma=e.gamma,i._initialOrientationBeta=e.beta),i._orientationGamma=e.gamma,i._orientationBeta=e.beta,i._offsetY=i._initialOrientationBeta-i._orientationBeta,i._offsetX=i._initialOrientationGamma-i._orientationGamma}),window.addEventListener(\"deviceorientation\",this._orientationChanged))},i.prototype.detachControl=function(e){this._attachedCanvas==e&&(window.removeEventListener(\"deviceorientation\",this._orientationChanged),this._attachedCanvas=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0)},i.prototype._checkInputs=function(){if(this._offsetX){this.cameraRotation.y-=this._offsetX/this.angularSensibility;var i=this._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,this._cameraRotationMatrix)),t.prototype._checkInputs.call(this)}},i}(e.FreeCamera);e.DeviceOrientationCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){var t=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported=\"GamepadEvent\"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this.buttonADataURL=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=\",this._callbackGamepadConnected=e,this.gamepadSupportAvailable?(this.gamepadEventSupported?(window.addEventListener(\"gamepadconnected\",function(e){t._onGamepadConnected(e)},!1),window.addEventListener(\"gamepaddisconnected\",function(e){t._onGamepadDisconnected(e)},!1)):this._startMonitoringGamepads(),this.oneGamepadConnected||this._insertGamepadDOMInstructions()):this._insertGamepadDOMNotSupported()}return e.prototype._insertGamepadDOMInstructions=function(){e.gamepadDOMInfo=document.createElement(\"div\");var t=document.createElement(\"img\");t.src=this.buttonADataURL;var i=document.createElement(\"span\");i.innerHTML=\"<strong>to activate gamepad</strong>\",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.appendChild(i),e.gamepadDOMInfo.style.position=\"absolute\",e.gamepadDOMInfo.style.width=\"100%\",e.gamepadDOMInfo.style.height=\"48px\",e.gamepadDOMInfo.style.bottom=\"0px\",e.gamepadDOMInfo.style.backgroundColor=\"rgba(1, 1, 1, 0.15)\",e.gamepadDOMInfo.style.textAlign=\"center\",e.gamepadDOMInfo.style.zIndex=\"10\",t.style.position=\"relative\",t.style.bottom=\"8px\",i.style.position=\"relative\",i.style.fontSize=\"32px\",i.style.bottom=\"32px\",i.style.color=\"green\",document.body.appendChild(e.gamepadDOMInfo)},e.prototype._insertGamepadDOMNotSupported=function(){e.gamepadDOMInfo=document.createElement(\"div\");var t=document.createElement(\"span\");t.innerHTML=\"<strong>gamepad not supported</strong>\",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.style.position=\"absolute\",e.gamepadDOMInfo.style.width=\"100%\",e.gamepadDOMInfo.style.height=\"40px\",e.gamepadDOMInfo.style.bottom=\"0px\",e.gamepadDOMInfo.style.backgroundColor=\"rgba(1, 1, 1, 0.15)\",e.gamepadDOMInfo.style.textAlign=\"center\",e.gamepadDOMInfo.style.zIndex=\"10\",t.style.position=\"relative\",t.style.fontSize=\"32px\",t.style.color=\"red\",document.body.appendChild(e.gamepadDOMInfo)},e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo)},e.prototype._onGamepadConnected=function(e){var t=this._addNewGamepad(e.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t),this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(t){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var i;return i=-1!==t.id.search(\"Xbox 360\")||-1!==t.id.search(\"xinput\")?new a(t.id,t.index,t):new n(t.id,t.index,t),this.babylonGamepads.push(i),i},e.prototype._onGamepadDisconnected=function(e){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==e.gamepad.index){this.babylonGamepads.splice(t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){e._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){e._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){e._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(e[t].index in this.babylonGamepads)this.babylonGamepads[t].browserGamepad=e[t];else{var i=this._addNewGamepad(e[t]);this._callbackGamepadConnected&&this._callbackGamepadConnected(i)}},e}();e.Gamepads=t;var i=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=i;var r=function(){function e(e,t,i){this.id=e,this.index=t,this.browserGamepad=i,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,\"leftStick\",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"rightStick\",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},e}();e.Gamepad=r;var n=function(e){function t(t,i,r){e.call(this,t,i,r),this.id=t,this.index=i,this.gamepad=r,this._buttons=new Array(r.buttons.length)}return __extends(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(r);e.GenericPad=n,function(e){e[e.A=0]=\"A\",e[e.B=1]=\"B\",e[e.X=2]=\"X\",e[e.Y=3]=\"Y\",e[e.Start=4]=\"Start\",e[e.Back=5]=\"Back\",e[e.LB=6]=\"LB\",e[e.RB=7]=\"RB\",e[e.LeftStick=8]=\"LeftStick\",e[e.RightStick=9]=\"RightStick\"}(e.Xbox360Button||(e.Xbox360Button={}));var o=e.Xbox360Button;!function(e){e[e.Up=0]=\"Up\",e[e.Down=1]=\"Down\",e[e.Left=2]=\"Left\",e[e.Right=3]=\"Right\"}(e.Xbox360Dpad||(e.Xbox360Dpad={}));var s=e.Xbox360Dpad,a=function(e){function t(){e.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return __extends(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,\"leftTrigger\",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightTrigger\",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(this._ondpaddown&&1===e&&this._ondpaddown(i),this._ondpadup&&0===e&&this._ondpadup(i)),e},Object.defineProperty(t.prototype,\"buttonA\",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,o.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonB\",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,o.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonX\",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,o.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonY\",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,o.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonStart\",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,o.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonBack\",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,o.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonLB\",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,o.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonRB\",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,o.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonLeftStick\",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,o.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonRightStick\",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,o.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadUp\",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,s.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadDown\",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,s.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadLeft\",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,s.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadRight\",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,s.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t}(r);e.Xbox360Pad=a}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){var o=this;t.call(this,i,r,n),this.angularSensibility=200,this.moveSensibility=75,this._gamepads=new e.Gamepads(function(e){o._onNewGameConnected(e)})}return __extends(i,t),i.prototype._onNewGameConnected=function(e){0===e.index&&(this._gamepad=e)},i.prototype._checkInputs=function(){if(this._gamepad){var i=this._gamepad.leftStick,r=i.x/this.moveSensibility,n=i.y/this.moveSensibility;i.x=Math.abs(r)>.005?0+r:0,i.y=Math.abs(n)>.005?0+n:0;var o=this._gamepad.rightStick,s=o.x/this.angularSensibility,a=o.y/this.angularSensibility;o.x=Math.abs(s)>.001?0+s:0,o.y=Math.abs(a)>.001?0+a:0;var h=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),c=50*this._computeLocalCameraSpeed(),l=e.Vector3.TransformCoordinates(new e.Vector3(i.x*c,0,-i.y*c),h);this.cameraDirection=this.cameraDirection.add(l),this.cameraRotation=this.cameraRotation.add(new e.Vector2(o.y,o.x))}t.prototype._checkInputs.call(this)},i.prototype.dispose=function(){this._gamepads.dispose(),t.prototype.dispose.call(this)},i}(e.FreeCamera);e.GamepadCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._scene=e}return t.prototype._renderParticles=function(t,i){if(0!==this._scene._activeParticleSystems.length){for(var r=e.Tools.Now,n=0;n<this._scene._activeParticleSystems.length;n++){var o=this._scene._activeParticleSystems.data[n];o.renderingGroupId===t&&(this._clearDepthBuffer(),o.emitter.position&&i&&-1===i.indexOf(o.emitter)||(this._scene._activeParticles+=o.render()))}this._scene._particlesDuration+=e.Tools.Now-r}},t.prototype._renderSprites=function(t){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var i=e.Tools.Now,r=0;r<this._scene.spriteManagers.length;r++){var n=this._scene.spriteManagers[r];n.renderingGroupId===t&&(this._clearDepthBuffer(),n.render())}this._scene._spritesDuration+=e.Tools.Now-i}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype.render=function(e,i,r,n){for(var o=0;o<t.MAX_RENDERINGGROUPS;o++){this._depthBufferAlreadyCleaned=!1;var s=this._renderingGroups[o],a=!1;s&&(this._clearDepthBuffer(),s.render(e)||(this._renderingGroups.splice(o,1),a=!0)),n&&this._renderSprites(o),r&&this._renderParticles(o,i),a&&o--}},t.prototype.reset=function(){for(var e in this._renderingGroups){var t=this._renderingGroups[e];t.prepare()}},t.prototype.dispatch=function(t){var i=t.getMesh(),r=i.renderingGroupId||0;this._renderingGroups[r]||(this._renderingGroups[r]=new e.RenderingGroup(r,this._scene)),this._renderingGroups[r].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();e.RenderingManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._scene=i}return t.prototype.render=function(t){if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return!1;var i,r,n=this._scene.getEngine();for(i=0;i<this._opaqueSubMeshes.length;i++)r=this._opaqueSubMeshes.data[i],r.render();for(n.setAlphaTesting(!0),i=0;i<this._alphaTestSubMeshes.length;i++)r=this._alphaTestSubMeshes.data[i],r.render();if(n.setAlphaTesting(!1),this._transparentSubMeshes.length){for(i=0;i<this._transparentSubMeshes.length;i++)r=this._transparentSubMeshes.data[i],r._alphaIndex=r.getMesh().alphaIndex,r._distanceToCamera=r.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length();var o=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(o.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),n.setAlphaMode(e.Engine.ALPHA_COMBINE),i=0;i<o.length;i++)r=o[i],r.render();n.setAlphaMode(e.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(e){var t=e.getMaterial(),i=e.getMesh();t.needAlphaBlending()||i.visibility<1||i.hasVertexAlpha?this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},t}();e.RenderingGroup=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i){this.autoClear=!0,this.clearColor=new e.Color3(.2,.2,.3),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this.forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.cameraToUseForPointers=null,this.fogEnabled=!0,this.fogMode=t.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.shadowsEnabled=!0,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new e.StandardMaterial(\"default material\",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.skeletonsEnabled=!0,this.skeletons=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArray(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=0,this._activeIndices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._toBeDisposed=new e.SmartArray(256),this._onReadyCallbacks=new Array,this._pendingData=[],this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArray(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArray(32),this._activeBones=0,\n   10  this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._uniqueIdCounter=0,this._engine=i,i.scenes.push(this),this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),this.postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new e.BoundingBoxRenderer(this),this._outlineRenderer=new e.OutlineRenderer(this),this.attachControl(),this._debugLayer=new e.DebugLayer(this),this.mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0}),this.simplificationQueue=new e.SimplificationQueue,this.workerCollisions=!1}return Object.defineProperty(t,\"FOGMODE_NONE\",{get:function(){return t._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_EXP\",{get:function(){return t._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_EXP2\",{get:function(){return t._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_LINEAR\",{get:function(){return t._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"debugLayer\",{get:function(){return this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"workerCollisions\",{get:function(){return this._workerCollisions},set:function(t){t=t&&!!Worker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"meshUnderPointer\",{get:function(){return this._meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"pointerX\",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"pointerY\",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},t.prototype.getOutlineRenderer=function(){return this._outlineRenderer},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices},t.prototype.getActiveIndices=function(){return this._activeIndices},t.prototype.getActiveParticles=function(){return this._activeParticles},t.prototype.getActiveBones=function(){return this._activeBones},t.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},t.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},t.prototype.getRenderDuration=function(){return this._renderDuration},t.prototype.getParticlesDuration=function(){return this._particlesDuration},t.prototype.getSpritesDuration=function(){return this._spritesDuration},t.prototype.getAnimationRatio=function(){return this._animationRatio},t.prototype.getRenderId=function(){return this._renderId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},t.prototype.attachControl=function(){var t=this;this._onPointerMove=function(e){var i=t._engine.getRenderingCanvas();t._updatePointerPosition(e);var r=t.pick(t._pointerX,t._pointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPointerTriggers},!1,t.cameraToUseForPointers);r.hit?(t._meshUnderPointer=r.pickedMesh,t.setPointerOverMesh(r.pickedMesh),i.style.cursor=\"pointer\"):(t.setPointerOverMesh(null),i.style.cursor=\"\",t._meshUnderPointer=null)},this._onPointerDown=function(i){var r=null;t.onPointerDown||(r=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPickTriggers}),t._updatePointerPosition(i);var n=t.pick(t._pointerX,t._pointerY,r,!1,t.cameraToUseForPointers);if(n.hit&&n.pickedMesh.actionManager){switch(i.button){case 0:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i));break;case 1:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i));break;case 2:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i))}n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i))}t.onPointerDown&&t.onPointerDown(i,n)},this._onPointerUp=function(i){var r=null;t.onPointerUp||(r=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnPickUpTrigger)}),t._updatePointerPosition(i);var n=t.pick(t._pointerX,t._pointerY,r,!1,t.cameraToUseForPointers);n.hit&&n.pickedMesh.actionManager&&n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i)),t.onPointerUp&&t.onPointerUp(i,n)},this._onKeyDown=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(t,i))},this._onKeyUp=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(t,i))};var i=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().addEventListener(i+\"move\",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener(i+\"down\",this._onPointerDown,!1),this._engine.getRenderingCanvas().addEventListener(i+\"up\",this._onPointerUp,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp}])},t.prototype.detachControl=function(){var t=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+\"move\",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(t+\"down\",this._onPointerDown),this._engine.getRenderingCanvas().removeEventListener(t+\"up\",this._onPointerUp),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp}])},t.prototype.isReady=function(){if(this._pendingData.length>0)return!1;for(var t=0;t<this._geometries.length;t++){var i=this._geometries[t];if(i.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var r=this.meshes[t];if(!r.isReady())return!1;var n=r.material;if(n&&!n.isReady(r))return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null},t.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},t.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},t.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},t.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this._pendingData.indexOf(e);-1!==t&&this._pendingData.splice(t,1)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},t.prototype.executeWhenReady=function(e){var t=this;this._onReadyCallbacks.push(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype._checkIsReady=function(){var e=this;return this.isReady()?(this._onReadyCallbacks.forEach(function(e){e()}),this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},t.prototype.beginAnimation=function(t,i,r,n,o,s,a){if(void 0===o&&(o=1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,i,r,n,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),c=0;c<h.length;c++)this.beginAnimation(h[c],i,r,n,o,s,a);return a},t.prototype.beginDirectAnimation=function(t,i,r,n,o,s,a){void 0===s&&(s=1);var h=new e.Animatable(this,t,r,n,o,s,a,i);return h},t.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},t.prototype.stopAnimation=function(e){var t=this.getAnimatableByTarget(e);t&&t.stop()},t.prototype._animate=function(){if(this.animationsEnabled){this._animationStartDate||(this._animationStartDate=e.Tools.Now);for(var t=e.Tools.Now,i=t-this._animationStartDate,r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r]._animate(i)}},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},t.prototype.addMesh=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.meshes.push(e);this.collisionCoordinator.onMeshAdded(e),this.onNewMeshAdded&&this.onNewMeshAdded(e,t,this)},t.prototype.removeMesh=function(e){var t=this.meshes.indexOf(e);return-1!==t&&this.meshes.splice(t,1),this.collisionCoordinator.onMeshRemoved(e),this.onMeshRemoved&&this.onMeshRemoved(e),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);return-1!==t&&this.lights.splice(t,1),this.onLightRemoved&&this.onLightRemoved(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(this.activeCamera=this.cameras.length>0?this.cameras[0]:null),this.onCameraRemoved&&this.onCameraRemoved(e),t},t.prototype.addLight=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.lights.push(e);this.onNewLightAdded&&this.onNewLightAdded(e,t,this)},t.prototype.addCamera=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.cameras.push(e);this.onNewCameraAdded&&this.onNewCameraAdded(e,t,this)},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!t&&this.getGeometryByID(e.id)?!1:(this._geometries.push(e),this.collisionCoordinator.onGeometryAdded(e),this.onGeometryAdded&&this.onGeometryAdded(e),!0)},t.prototype.removeGeometry=function(e){var t=this._geometries.indexOf(e);return t>-1?(this._geometries.splice(t,1),this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemoved&&this.onGeometryRemoved(e),!0):!1},t.prototype.getGeometries=function(){return this._geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getLightByName(e);return i?i:this.getCameraByName(e)},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getSoundByName=function(e){for(var t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];for(var i=0;i<this.soundTracks.length;i++)for(t=0;t<this.soundTracks[i].soundCollection.length;t++)if(this.soundTracks[i].soundCollection[t].name===e)return this.soundTracks[i].soundCollection[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype._evaluateSubMesh=function(e,t){if(t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var i=e.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concat(i.getRenderTargetTextures())),this._activeIndices+=e.indexCount,this._renderingManager.dispatch(e))}},t.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._boundingBoxRenderer.reset(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix);var t,i;if(this._selectionOctree){var r=this._selectionOctree.select(this._frustumPlanes);t=r.data,i=r.length}else i=this.meshes.length,t=this.meshes;for(var n=0;i>n;n++){var o=t[n];if(!o.isBlocked&&(this._totalVertices+=o.getTotalVertices(),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);s&&(o._preActivate(),(o.alwaysSelectAsActiveMesh||o.isVisible&&o.visibility>0&&0!==(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),this._activeMesh(s)))}}var a=e.Tools.Now;if(this.particlesEnabled){e.Tools.StartPerformanceCounter(\"Particles\",this.particleSystems.length>0);for(var h=0;h<this.particleSystems.length;h++){var c=this.particleSystems[h];c.isStarted()&&(!c.emitter.position||c.emitter&&c.emitter.isEnabled())&&(this._activeParticleSystems.push(c),c.animate())}e.Tools.EndPerformanceCounter(\"Particles\",this.particleSystems.length>0)}this._particlesDuration+=e.Tools.Now-a},t.prototype._activeMesh=function(e){if(e.skeleton&&this.skeletonsEnabled&&this._activeSkeletons.pushNoDuplicate(e.skeleton),(e.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),e&&e.subMeshes){var t,i;if(e._submeshesOctree&&e.useOctreeForRenderingSelection){var r=e._submeshesOctree.select(this._frustumPlanes);t=r.length,i=r.data}else i=e.subMeshes,t=i.length;for(var n=0;t>n;n++){var o=i[n];this._evaluateSubMesh(o,e)}}},t.prototype.updateTransformMatrix=function(e){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._renderForCamera=function(t){var i=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error(\"Active camera not set\");e.Tools.StartPerformanceCounter(\"Rendering camera \"+this.activeCamera.name),i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera);var r=e.Tools.Now;e.Tools.StartPerformanceCounter(\"Active meshes evaluation\"),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=e.Tools.Now-r,e.Tools.EndPerformanceCounter(\"Active meshes evaluation\");for(var n=0;n<this._activeSkeletons.length;n++){var o=this._activeSkeletons.data[n];o.prepare()}var s=e.Tools.Now;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter(\"Render targets\",this._renderTargets.length>0);for(var a=0;a<this._renderTargets.length;a++){var h=this._renderTargets.data[a];if(h._shouldRender()){this._renderId++;var c=h.activeCamera&&h.activeCamera!==this.activeCamera;h.render(c,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter(\"Render targets\",this._renderTargets.length>0),this._renderId++}this._renderTargets.length>0&&i.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-s,this.postProcessManager._prepareFrame();var l=e.Tools.Now;if(this.layers.length){i.setDepthBuffer(!1);var u,f;for(u=0;u<this.layers.length;u++)f=this.layers[u],f.isBackground&&f.render();i.setDepthBuffer(!0)}if(e.Tools.StartPerformanceCounter(\"Main render\"),this._renderingManager.render(null,null,!0,!0),e.Tools.EndPerformanceCounter(\"Main render\"),this._boundingBoxRenderer.render(),this.lensFlaresEnabled){e.Tools.StartPerformanceCounter(\"Lens flares\",this.lensFlareSystems.length>0);for(var d=0;d<this.lensFlareSystems.length;d++)this.lensFlareSystems[d].render();e.Tools.EndPerformanceCounter(\"Lens flares\",this.lensFlareSystems.length>0)}if(this.layers.length){for(i.setDepthBuffer(!1),u=0;u<this.layers.length;u++)f=this.layers[u],f.isBackground||f.render();i.setDepthBuffer(!0)}this._renderDuration+=e.Tools.Now-l,this.postProcessManager._finalizeFrame(t.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.afterCameraRender&&this.afterCameraRender(this.activeCamera),e.Tools.EndPerformanceCounter(\"Rendering camera \"+this.activeCamera.name)},t.prototype._processSubCameras=function(t){if(t.cameraRigMode===e.Camera.RIG_MODE_NONE)return void this._renderForCamera(t);for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i]);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},t.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++)for(var i=this._meshesForIntersections.data[t],r=0;r<i.actionManager.actions.length;r++){var n=i.actionManager.actions[r];if(n.trigger===e.ActionManager.OnIntersectionEnterTrigger||n.trigger===e.ActionManager.OnIntersectionExitTrigger){var o=n.getTriggerParameter(),s=o instanceof e.AbstractMesh?o:o.mesh,a=s.intersectsMesh(i,o.usePreciseIntersection),h=i._intersectionsInProgress.indexOf(s);a&&-1===h?n.trigger===e.ActionManager.OnIntersectionEnterTrigger?(n._executeCurrent(e.ActionEvent.CreateNew(i)),i._intersectionsInProgress.push(s)):n.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._intersectionsInProgress.push(s):!a&&h>-1&&(n.trigger===e.ActionManager.OnIntersectionExitTrigger&&n._executeCurrent(e.ActionEvent.CreateNew(i)),i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger)&&n.trigger!==e.ActionManager.OnIntersectionExitTrigger||i._intersectionsInProgress.splice(h,1))}}},t.prototype.render=function(){var i=e.Tools.Now;this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this.getEngine().resetDrawCalls(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),e.Tools.StartPerformanceCounter(\"Scene rendering\"),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger,null),this.simplificationQueue.running||this.simplificationQueue.executeNext(),this.beforeRender&&this.beforeRender();for(var r=0;r<this._onBeforeRenderCallbacks.length;r++)this._onBeforeRenderCallbacks[r]();var n=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*n,this._animate(),this._physicsEngine&&(e.Tools.StartPerformanceCounter(\"Physics\"),this._physicsEngine._runOneStep(n/1e3),e.Tools.EndPerformanceCounter(\"Physics\"));var o=e.Tools.Now,s=this.getEngine(),a=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter(\"Custom render targets\",this.customRenderTargets.length>0);for(var h=0;h<this.customRenderTargets.length;h++){var c=this.customRenderTargets[h];if(c._shouldRender()){if(this._renderId++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error(\"Active camera not set\");s.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter(\"Custom render targets\",this.customRenderTargets.length>0),this._renderId++}if(this.customRenderTargets.length>0&&s.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-o,this.activeCamera=a,this.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter(\"Procedural textures\",this._proceduralTextures.length>0);for(var l=0;l<this._proceduralTextures.length;l++){var u=this._proceduralTextures[l];u._shouldRender()&&u.render()}e.Tools.EndPerformanceCounter(\"Procedural textures\",this._proceduralTextures.length>0)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var f=0;f<this.lights.length;f++){var d=this.lights[f],p=d.getShadowGenerator();d.isEnabled()&&p&&-1!==p.getShadowMap().getScene().textures.indexOf(p.getShadowMap())&&this._renderTargets.push(p.getShadowMap())}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var m=this._renderId,g=0;g<this.activeCameras.length;g++)this._renderId=m,this._processSubCameras(this.activeCameras[g]);else{if(!this.activeCamera)throw new Error(\"No camera defined\");this._processSubCameras(this.activeCamera)}for(this._checkIntersections(),this._updateAudioParameters(),this.afterRender&&this.afterRender(),r=0;r<this._onAfterRenderCallbacks.length;r++)this._onAfterRenderCallbacks[r]();for(var _=0;_<this._toBeDisposed.length;_++)this._toBeDisposed.data[_].dispose(),this._toBeDisposed[_]=null;this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),e.Tools.EndPerformanceCounter(\"Scene rendering\"),this._lastFrameDuration=e.Tools.Now-i},t.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||0!==this.soundTracks.length)){var t,i=e.Engine.audioEngine;if(t=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera,t&&i.canUseWebAudio){i.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z);var r=e.Matrix.Invert(t.getViewMatrix()),n=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),r);n.normalize(),i.audioContext.listener.setOrientation(n.x,n.y,n.z,0,1,0);for(var o=0;o<this.mainSoundTrack.soundCollection.length;o++){var s=this.mainSoundTrack.soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}for(o=0;o<this.soundTracks.length;o++)for(var a=0;a<this.soundTracks[o].soundCollection.length;a++)s=this.soundTracks[o].soundCollection[a],s.useCustomAttenuation&&s.updateDistanceFromListener()}}},Object.defineProperty(t.prototype,\"audioEnabled\",{get:function(){return this._audioEnabled},set:function(e){this._audioEnabled=e,this._audioEnabled?this._enableAudio():this._disableAudio()},enumerable:!0,configurable:!0}),t.prototype._disableAudio=function(){for(var e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].pause();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].pause()},t.prototype._enableAudio=function(){for(var e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].isPaused&&this.mainSoundTrack.soundCollection[e].play();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].isPaused&&this.soundTracks[e].soundCollection[t].play()},Object.defineProperty(t.prototype,\"headphone\",{get:function(){return this._headphone},set:function(e){this._headphone=e,this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),t.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToHRTF()},t.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToEqualPower()},t.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new e.DepthRenderer(this),this._depthRenderer)},t.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this._depthRenderer&&this._depthRenderer.dispose(),this.debugLayer.hide(),this.onDispose&&this.onDispose(),this._onBeforeRenderCallbacks=[],this._onAfterRenderCallbacks=[],this.detachControl(),this.disposeSounds();var e,t=this._engine.getRenderingCanvas();for(e=0;e<this.cameras.length;e++)this.cameras[e].detachControl(t);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),e=this._engine.scenes.indexOf(this),e>-1&&this._engine.scenes.splice(e,1),this._engine.wipeCaches()},t.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].dispose()},t.prototype.getWorldExtends=function(){for(var t=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=0;r<this.meshes.length;r++){var n=this.meshes[r];n.computeWorldMatrix(!0);var o=n.getBoundingInfo().boundingBox.minimumWorld,s=n.getBoundingInfo().boundingBox.maximumWorld;e.Tools.CheckExtends(o,t,i),e.Tools.CheckExtends(s,t,i)}return{min:t,max:i}},t.prototype.createOrUpdateSelectionOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,i));var r=this.getWorldExtends();return this._selectionOctree.update(r.min,r.max,this.meshes),this._selectionOctree},t.prototype.createPickingRay=function(t,i,r,n){var o=this._engine;if(!n){if(!this.activeCamera)throw new Error(\"Active camera not set\");n=this.activeCamera}var s=n.viewport,a=s.toGlobal(o);return t=t/this._engine.getHardwareScalingLevel()-a.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-a.y-a.height),e.Ray.CreateNew(t,i,a.width,a.height,r?r:e.Matrix.Identity(),n.getViewMatrix(),n.getProjectionMatrix())},t.prototype._internalPick=function(t,i,r){for(var n=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(i){if(!i(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),h=t(a),c=s.intersects(h,r);if(c&&c.hit&&(r||null==n||!(c.distance>=n.distance))&&(n=c,r))break}return n||new e.PickingInfo},t.prototype.pick=function(e,t,i,r,n){var o=this;return this._internalPick(function(i){return o.createPickingRay(e,t,i,n)},i,r)},t.prototype.pickWithRay=function(t,i,r){var n=this;return this._internalPick(function(i){return n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(n._pickWithRayInverseMatrix),e.Ray.Transform(t,n._pickWithRayInverseMatrix)},i,r)},t.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},t.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},t.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.prototype.enablePhysics=function(t,i){return this._physicsEngine?!0:(this._physicsEngine=new e.PhysicsEngine(i),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(t),!0):(this._physicsEngine=null,!1))},t.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},t.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},t.prototype.setGravity=function(e){this._physicsEngine&&this._physicsEngine._setGravity(e)},t.prototype.createCompoundImpostor=function(e,t){if(e.parts&&(t=e,e=e.parts),!this._physicsEngine)return null;for(var i=0;i<e.length;i++){var r=e[i].mesh;r._physicImpostor=e[i].impostor,r._physicsMass=t.mass/e.length,r._physicsFriction=t.friction,r._physicRestitution=t.restitution}return this._physicsEngine._registerMeshesAsCompound(e,t)},t.prototype.deleteCompoundImpostor=function(t){for(var i=0;i<t.parts.length;i++){var r=t.parts[i].mesh;r._physicImpostor=e.PhysicsEngine.NoImpostor,this._physicsEngine._unregisterMesh(r)}},t.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new e.HemisphericLight(\"default light\",e.Vector3.Up(),this),\n   11  !this.activeCamera){var t=new e.FreeCamera(\"default camera\",e.Vector3.Zero(),this),i=this.getWorldExtends(),r=i.min.add(i.max.subtract(i.min).scale(.5));t.position=new e.Vector3(r.x,r.y,i.min.z-(i.max.z-i.min.z)),t.setTarget(r),this.activeCamera=t}},t.prototype._getByTags=function(t,i,r){if(void 0===i)return t;var n=[];r=r||function(e){};for(var o in t){var s=t[o];e.Tags.MatchesQuery(s,i)&&(n.push(s),r(s))}return n},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t._FOGMODE_NONE=0,t._FOGMODE_EXP=1,t._FOGMODE_EXP2=2,t._FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}();e.Scene=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,r,n,o,s,a){if(this._engine=i instanceof e.Mesh?i.getScene().getEngine():i,this._updatable=o,this._data=r,s||this.create(),this._kind=n,a)return void(this._strideSize=a);switch(n){case t.PositionKind:this._strideSize=3;break;case t.NormalKind:this._strideSize=3;break;case t.UVKind:this._strideSize=2;break;case t.UV2Kind:this._strideSize=2;break;case t.ColorKind:this._strideSize=4;break;case t.MatricesIndicesKind:this._strideSize=4;break;case t.MatricesWeightsKind:this._strideSize=4}}return t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.create=function(e){(e||!this._buffer)&&(e=e||this._data,this._buffer||(this._buffer=this._updatable?this._engine.createDynamicVertexBuffer(4*e.length):this._engine.createVertexBuffer(e)),this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e))},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,t),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Object.defineProperty(t,\"PositionKind\",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"NormalKind\",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"UVKind\",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"UV2Kind\",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"ColorKind\",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"MatricesIndicesKind\",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"MatricesWeightsKind\",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),t._PositionKind=\"position\",t._NormalKind=\"normal\",t._UVKind=\"uv\",t._UV2Kind=\"uv2\",t._ColorKind=\"color\",t._MatricesIndicesKind=\"matricesIndices\",t._MatricesWeightsKind=\"matricesWeights\",t}();e.VertexBuffer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i.getScene()),i.instances.push(this),this._sourceMesh=i,this.position.copyFrom(i.position),this.rotation.copyFrom(i.rotation),this.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(this.rotationQuaternion=i.rotationQuaternion.clone()),this.infiniteDistance=i.infiniteDistance,this.setPivotMatrix(i.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return __extends(i,t),Object.defineProperty(i.prototype,\"receiveShadows\",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"visibility\",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"skeleton\",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,\"sourceMesh\",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(e){return this._sourceMesh.getVerticesData(e)},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,\"_positions\",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this._sourceMesh.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}this._updateBoundingInfo()},i.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},i.prototype._activate=function(e){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e)},i.prototype.getLOD=function(e){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh)},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,r){var n=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,n,[\"name\"],[]),this.refreshBoundingInfo(),i&&(n.parent=i),!r)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent===this&&s.clone(s.name,n)}return n.computeWorldMatrix(!0),n},i.prototype.dispose=function(e){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1),t.prototype.dispose.call(this,e)},i}(e.AbstractMesh);e.InstancedMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var i=function(i){function r(n,o,s,a,h){if(void 0===s&&(s=null),i.call(this,n,o),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._LODLevels=new Array,this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new t,this._instancesBufferSize=2048,this._sideOrientation=r._DEFAULTSIDE,this._areNormalsFrozen=!1,a){if(a._geometry&&a._geometry.applyToMesh(this),e.Tools.DeepCopy(a,this,[\"name\",\"material\",\"skeleton\",\"instances\"],[]),this.material=a.material,!h)for(var c=0;c<o.meshes.length;c++){var l=o.meshes[c];if(l.parent===a){l.clone(n+\".\"+l.name,this,h)}}for(c=0;c<o.particleSystems.length;c++){var u=o.particleSystems[c];u.emitter===a&&u.clone(u.name,this)}this.computeWorldMatrix(!0)}null!==s&&(this.parent=s)}return __extends(r,i),Object.defineProperty(r,\"FRONTSIDE\",{get:function(){return r._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"BACKSIDE\",{get:function(){return r._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"DOUBLESIDE\",{get:function(){return r._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"DEFAULTSIDE\",{get:function(){return r._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"NO_CAP\",{get:function(){return r._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_START\",{get:function(){return r._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_END\",{get:function(){return r._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_ALL\",{get:function(){return r._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"hasLODLevels\",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),r.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},r.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return e.Tools.Warn(\"You cannot use a mesh as LOD level twice\"),this;var r=new e.Internals.MeshLODLevel(t,i);return this._LODLevels.push(r),i&&(i._masterMesh=this),this._sortLODLevels(),this},r.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var i=this._LODLevels[t];if(i.distance===e)return i.mesh}return null},r.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},r.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var i=(t?t:this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.position).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var r=0;r<this._LODLevels.length;r++){var n=this._LODLevels[r];if(n.distance<i)return n.mesh&&(n.mesh._preActivate(),n.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,n.mesh),n.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(r.prototype,\"geometry\",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},r.prototype.getVerticesData=function(e,t){return this._geometry?this._geometry.getVerticesData(e,t):null},r.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):void 0},r.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},r.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=[];if(this._delayInfo)for(var t in this._delayInfo)e.push(t);return e}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(e){return this._geometry?this._geometry.getIndices(e):[]},Object.defineProperty(r.prototype,\"isBlocked\",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),r.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isReady.call(this)},r.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(r.prototype,\"sideOrientation\",{get:function(){return this._sideOrientation},set:function(e){this._sideOrientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"areNormalsFrozen\",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),r.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},r.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},r.prototype._preActivate=function(){var e=this.getScene().getRenderId();this._preActivateId!==e&&(this._preActivateId=e,this._visibleInstances=null)},r.prototype._registerInstanceForRenderId=function(e,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e)},r.prototype.refreshBoundingInfo=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo();this._updateBoundingInfo()},r.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new e.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},r.prototype.subdivide=function(t){if(!(1>t)){for(var i=this.getTotalIndices(),r=i/t|0,n=0;r%3!==0;)r++;this.releaseSubMeshes();for(var o=0;t>o&&!(n>=i);o++)e.SubMesh.CreateFromIndices(0,n,Math.min(r,i-n),this),n+=r;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,r,n){if(t instanceof Array){var o=i;i=t,t=o,e.Tools.Warn(\"Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable).\")}if(this._geometry)this._geometry.setVerticesData(t,i,r,n);else{var s=new e.VertexData;s.set(i,t);var a=this.getScene();new e.Geometry(e.Geometry.RandomId(),a,s,r,this)}},r.prototype.updateVerticesData=function(e,t,i,r){this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i))},r.prototype.updateVerticesDataDirectly=function(e,t,i,r){this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(e,t,i,!1)):this._geometry.updateVerticesDataDirectly(e,t,i))},r.prototype.updateMeshPositions=function(t,i){void 0===i&&(i=!0);var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(t(r),this.updateVerticesData(e.VertexBuffer.PositionKind,r,!1,!1),i){var n=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.NormalKind);e.VertexData.ComputeNormals(r,n,o),this.updateVerticesData(e.VertexBuffer.NormalKind,o,!1,!1)}},r.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(e.Geometry.RandomId());t.applyToMesh(this)}},r.prototype.setIndices=function(t,i){if(this._geometry)this._geometry.setIndices(t,i);else{var r=new e.VertexData;r.indices=t;var n=this.getScene();new e.Geometry(e.Geometry.RandomId(),n,r,!1,this)}},r.prototype._bind=function(t,i,r){var n,o=this.getScene().getEngine();switch(r){case e.Material.PointFillMode:n=null;break;case e.Material.WireFrameFillMode:n=t.getLinesIndexBuffer(this.getIndices(),o);break;default:case e.Material.TriangleFillMode:n=this._geometry.getIndexBuffer()}o.bindMultiBuffers(this._geometry.getVertexBuffers(),n,i)},r.prototype._draw=function(t,i,r){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var n=this.getScene().getEngine();switch(i){case e.Material.PointFillMode:n.drawPointClouds(t.verticesStart,t.verticesCount,r);break;case e.Material.WireFrameFillMode:n.draw(!1,0,t.linesIndexCount,r);break;default:n.draw(!0,t.indexStart,t.indexCount,r)}}},r.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},r.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},r.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},r.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},r.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var i=t.getRenderId();this._batchCache.visibleInstances[e]=this._visibleInstances[i];var r=this._renderId;if(!this._batchCache.visibleInstances[e]&&this._visibleInstances.defaultRenderId&&(this._batchCache.visibleInstances[e]=this._visibleInstances[this._visibleInstances.defaultRenderId],i=Math.max(this._visibleInstances.defaultRenderId,i),r=Math.max(this._visibleInstances.selfDefaultRenderId,i)),this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length){if(this._renderIdForInstances[e]===i)return this._batchCache.mustReturn=!0,this._batchCache;i!==r&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},r.prototype._renderWithInstances=function(e,t,i,r,n){for(var o=i.visibleInstances[e._id],s=o.length+1,a=16*s*4;this._instancesBufferSize<a;)this._instancesBufferSize*=2;(!this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(this._worldMatricesInstancesBuffer&&n.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=n.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4));var h=0,c=0,l=this.getWorldMatrix();if(i.renderSelf[e._id]&&(l.copyToArray(this._worldMatricesInstancesArray,h),h+=16,c++),o)for(var u=0;u<o.length;u++){var f=o[u];f.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,h),h+=16,c++}var d=r.getAttributeLocationByName(\"world0\"),p=r.getAttributeLocationByName(\"world1\"),m=r.getAttributeLocationByName(\"world2\"),g=r.getAttributeLocationByName(\"world3\"),_=[d,p,m,g];n.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,_),this._draw(e,t,c),n.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,_)},r.prototype._processRendering=function(e,t,i,r,n,o){var s=this.getScene(),a=s.getEngine();if(n)this._renderWithInstances(e,i,r,t,a);else if(r.renderSelf[e._id]&&(o&&o(!1,this.getWorldMatrix()),this._draw(e,i)),r.visibleInstances[e._id])for(var h=0;h<r.visibleInstances[e._id].length;h++){var c=r.visibleInstances[e._id][h],l=c.getWorldMatrix();o&&o(!0,l),this._draw(e,i)}},r.prototype.render=function(t){var i=this.getScene(),r=this._getInstancesRenderList(t._id);if(!r.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){for(var n=0;n<this._onBeforeRenderCallbacks.length;n++)this._onBeforeRenderCallbacks[n](this);var o=i.getEngine(),s=null!==o.getCaps().instancedArrays&&null!==r.visibleInstances[t._id]&&void 0!==r.visibleInstances[t._id],a=t.getMaterial();if(a&&a.isReady(this,s)){var h=o.getDepthWrite();this.renderOutline&&(o.setDepthWrite(!1),i.getOutlineRenderer().render(t,r),o.setDepthWrite(h)),a._preBind();var c=a.getEffect(),l=i.forcePointsCloud?e.Material.PointFillMode:i.forceWireframe?e.Material.WireFrameFillMode:a.fillMode;this._bind(t,c,l);var u=this.getWorldMatrix();if(a.bind(u,this),this._processRendering(t,c,l,r,s,function(e,t){e&&a.bindOnlyWorldMatrix(t)}),a.unbind(),this.renderOutline&&h&&(o.setDepthWrite(!0),o.setColorWrite(!1),i.getOutlineRenderer().render(t,r),o.setColorWrite(!0)),this.renderOverlay){var f=o.getAlphaMode();o.setAlphaMode(e.Engine.ALPHA_COMBINE),i.getOutlineRenderer().render(t,r,!0),o.setAlphaMode(f)}for(n=0;n<this._onAfterRenderCallbacks.length;n++)this._onAfterRenderCallbacks[n](this)}}},r.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[t];i.emitter===this&&e.push(i)}return e},r.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var r=this.getScene().particleSystems[i];-1!==t.indexOf(r.emitter)&&e.push(r)}return e},r.prototype.getChildren=function(){for(var e=[],t=0;t<this.getScene().meshes.length;t++){var i=this.getScene().meshes[t];i.parent===this&&e.push(i)}return e},r.prototype._checkDelayState=function(){var t=this,i=this,r=this.getScene();if(this._geometry)this._geometry.load(r);else if(i.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,r._addPendingData(i);var n=-1!==this.delayLoadingFile.indexOf(\".babylonbinarymeshdata\");e.Tools.LoadFile(this.delayLoadingFile,function(i){i instanceof ArrayBuffer?t._delayLoadingFunction(i,t):t._delayLoadingFunction(JSON.parse(i),t),t.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._removePendingData(t)},function(){},r.database,n)}},r.prototype.isInFrustum=function(t){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isInFrustum.call(this,t)?(this._checkDelayState(),!0):!1},r.prototype.setMaterialByID=function(e){for(var t=this.getScene().materials,i=0;i<t.length;i++)if(t[i].id===e)return void(this.material=t[i]);var r=this.getScene().multiMaterials;for(i=0;i<r.length;i++)if(r[i].id===e)return void(this.material=r[i])},r.prototype.getAnimatables=function(){var e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},r.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(e.VertexBuffer.PositionKind)){this._resetPointsArrayCache();for(var i=this.getVerticesData(e.VertexBuffer.PositionKind),r=[],n=0;n<i.length;n+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(i,n),t).toArray(r,n);if(this.setVerticesData(e.VertexBuffer.PositionKind,r,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(i=this.getVerticesData(e.VertexBuffer.NormalKind),r=[],n=0;n<i.length;n+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(i,n),t).toArray(r,n);this.setVerticesData(e.VertexBuffer.NormalKind,r,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable())}}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},r.prototype.clone=function(e,t,i){return new r(e,this.getScene(),t,this,i)},r.prototype.dispose=function(e){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._worldMatricesInstancesBuffer&&(this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length;)this.instances[0].dispose();i.prototype.dispose.call(this,e)},r.prototype.applyDisplacementMap=function(t,i,r,n){var o=this,s=this.getScene(),a=function(e){var t=document.createElement(\"canvas\"),s=t.getContext(\"2d\"),a=e.width,h=e.height;t.width=a,t.height=h,s.drawImage(e,0,0);var c=s.getImageData(0,0,a,h).data;o.applyDisplacementMapFromBuffer(c,a,h,i,r),n&&n(o)};e.Tools.LoadImage(t,a,function(){},s.database)},r.prototype.applyDisplacementMapFromBuffer=function(t,i,r,n,o){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return void e.Tools.Warn(\"Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing\");for(var s=this.getVerticesData(e.VertexBuffer.PositionKind),a=this.getVerticesData(e.VertexBuffer.NormalKind),h=this.getVerticesData(e.VertexBuffer.UVKind),c=e.Vector3.Zero(),l=e.Vector3.Zero(),u=e.Vector2.Zero(),f=0;f<s.length;f+=3){e.Vector3.FromArrayToRef(s,f,c),e.Vector3.FromArrayToRef(a,f,l),e.Vector2.FromArrayToRef(h,f/3*2,u);var d=Math.abs(u.x)*i%i|0,p=Math.abs(u.y)*r%r|0,m=4*(d+p*i),g=t[m]/255,_=t[m+1]/255,v=t[m+2]/255,y=.3*g+.59*_+.11*v;l.normalize(),l.scaleInPlace(n+(o-n)*y),c=c.add(l),c.toArray(s,f)}e.VertexData.ComputeNormals(s,this.getIndices(),a),this.updateVerticesData(e.VertexBuffer.PositionKind,s),this.updateVerticesData(e.VertexBuffer.NormalKind,a)},r.prototype.convertToFlatShadedMesh=function(){for(var t=this.getVerticesDataKinds(),i=[],r=[],n=[],o=!1,s=0;s<t.length;s++){var a=t[s],h=this.getVertexBuffer(a);a!==e.VertexBuffer.NormalKind?(i[a]=h,r[a]=i[a].getData(),n[a]=[]):(o=h.isUpdatable(),t.splice(s,1),s--)}for(var c=this.subMeshes.slice(0),l=this.getIndices(),u=this.getTotalIndices(),f=0;u>f;f++){var d=l[f];for(s=0;s<t.length;s++){a=t[s];for(var p=i[a].getStrideSize(),m=0;p>m;m++)n[a].push(r[a][d*p+m])}}var g=[],_=n[e.VertexBuffer.PositionKind];for(f=0;u>f;f+=3){l[f]=f,l[f+1]=f+1,l[f+2]=f+2;for(var v=e.Vector3.FromArray(_,3*f),y=e.Vector3.FromArray(_,3*(f+1)),x=e.Vector3.FromArray(_,3*(f+2)),b=v.subtract(y),M=x.subtract(y),S=e.Vector3.Normalize(e.Vector3.Cross(b,M)),T=0;3>T;T++)g.push(S.x),g.push(S.y),g.push(S.z)}for(this.setIndices(l),this.setVerticesData(e.VertexBuffer.NormalKind,g,o),s=0;s<t.length;s++)a=t[s],this.setVerticesData(a,n[a],i[a].isUpdatable());this.releaseSubMeshes();for(var A=0;A<c.length;A++){var D=c[A];new e.SubMesh(D.materialIndex,D.indexStart,D.indexCount,D.indexStart,D.indexCount,this)}this.synchronizeInstances()},r.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){var t=this.instances[e];t._syncSubMeshes()}},r.prototype.simplify=function(t,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=e.SimplificationType.quadtreeRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:i,mesh:this,simplificationType:r,successCallback:n})},r.prototype.optimizeIndices=function(t){for(var i=this,r=this.getIndices(),n=this.getVerticesData(e.VertexBuffer.PositionKind),o=[],s=0;s<n.length;s+=3)o.push(e.Vector3.FromArray(n,s));var a=[];e.AsyncLoop.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],r=0;t>r;++r){var n=o[r];if(i.equals(n)){a[t]=r;break}}},function(){for(var e=0;e<r.length;++e)r[e]=a[r[e]]||r[e];var n=i.subMeshes.slice(0);i.setIndices(r),i.subMeshes=n,t&&t(i)})},r.CreateRibbon=function(t,i,n,o,s,a,h,c,l){if(void 0===c&&(c=r.DEFAULTSIDE),void 0===l&&(l=null),l){var u=function(e){for(var t=i[0].length,n=0,o=l.sideOrientation===r.DOUBLESIDE?2:1,s=1;o>=s;s++)for(var a=0;a<i.length;a++){var h=i[a],c=h.length;t=c>t?t:c;for(var u=0;t>u;)e[n]=h[u].x,e[n+1]=h[u].y,e[n+2]=h[u].z,u++,n+=3}},f=!l.areNormalsFrozen;return l.updateMeshPositions(u,f),l}var d=new r(t,a);d.sideOrientation=c;var p=e.VertexData.CreateRibbon(i,n,o,s,c);return p.applyToMesh(d,h),d},r.CreateDisc=function(t,i,n,o,s,a){void 0===a&&(a=r.DEFAULTSIDE);var h=new r(t,o),c=e.VertexData.CreateDisc(i,n,a);return c.applyToMesh(h,s),h},r.CreateBox=function(t,i,n,o,s){void 0===s&&(s=r.DEFAULTSIDE);var a=new r(t,n),h=e.VertexData.CreateBox(i,s);return h.applyToMesh(a,o),a},r.CreateSphere=function(t,i,n,o,s,a){void 0===a&&(a=r.DEFAULTSIDE);var h=new r(t,o),c=e.VertexData.CreateSphere(i,n,a);return c.applyToMesh(h,s),h},r.CreateCylinder=function(t,i,n,o,s,a,h,c,l){void 0===l&&(l=r.DEFAULTSIDE),void 0!==h&&h instanceof e.Scene||(void 0!==h&&(c=h),h=a,a=1);var u=new r(t,h),f=e.VertexData.CreateCylinder(i,n,o,s,a);return f.applyToMesh(u,c),u},r.CreateTorus=function(t,i,n,o,s,a,h){void 0===h&&(h=r.DEFAULTSIDE);var c=new r(t,s),l=e.VertexData.CreateTorus(i,n,o,h);return l.applyToMesh(c,a),c},r.CreateTorusKnot=function(t,i,n,o,s,a,h,c,l,u){void 0===u&&(u=r.DEFAULTSIDE);var f=new r(t,c),d=e.VertexData.CreateTorusKnot(i,n,o,s,a,h,u);return d.applyToMesh(f,l),f},r.CreateLines=function(t,i,r,n,o){if(void 0===o&&(o=null),o){var s=function(e){for(var t=0,r=0;r<i.length;r++)e[t]=i[r].x,e[t+1]=i[r].y,e[t+2]=i[r].z,t+=3};return o.updateMeshPositions(s,!1),o}var a=new e.LinesMesh(t,r,n),h=e.VertexData.CreateLines(i);return h.applyToMesh(a,n),a},r.CreateDashedLines=function(t,i,r,n,o,s,a,h){if(void 0===h&&(h=null),h){var c=function(t){var r=e.Vector3.Zero(),n=t.length/6,o=0,s=0,a=0,c=0,l=0,u=0,f=0,d=0;for(f=0;f<i.length-1;f++)i[f+1].subtractToRef(i[f],r),o+=r.length();for(a=o/n,c=h.dashSize*a/(h.dashSize+h.gapSize),f=0;f<i.length-1;f++)for(i[f+1].subtractToRef(i[f],r),s=Math.floor(r.length()/a),r.normalize(),d=0;s>d&&u<t.length;)l=a*d,t[u]=i[f].x+l*r.x,t[u+1]=i[f].y+l*r.y,t[u+2]=i[f].z+l*r.z,t[u+3]=i[f].x+(l+c)*r.x,t[u+4]=i[f].y+(l+c)*r.y,t[u+5]=i[f].z+(l+c)*r.z,u+=6,d++;for(;u<t.length;)t[u]=i[f].x,t[u+1]=i[f].y,t[u+2]=i[f].z,u+=3};return h.updateMeshPositions(c,!1),h}var l=new e.LinesMesh(t,s,a),u=e.VertexData.CreateDashedLines(i,r,n,o);return u.applyToMesh(l,a),l.dashSize=r,l.gapSize=n,l},r.ExtrudeShape=function(e,t,i,n,o,s,a,h,c,l){void 0===c&&(c=r.DEFAULTSIDE),void 0===l&&(l=null),n=n||1,o=o||0;var u=r._ExtrudeShapeGeneric(e,t,i,n,o,null,null,!1,!1,s,!1,a,h,c,l);return u},r.ExtrudeShapeCustom=function(e,t,i,n,o,s,a,h,c,l,u,f){void 0===u&&(u=r.DEFAULTSIDE),void 0===f&&(f=null);var d=r._ExtrudeShapeGeneric(e,t,i,null,null,n,o,s,a,h,!0,c,l,u,f);return d},r._ExtrudeShapeGeneric=function(t,i,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=function(t,i,n,o,s,a,h,c,l,u){for(var f=n.getTangents(),d=n.getNormals(),p=n.getBinormals(),m=n.getDistances(),g=0,_=function(e,t){return s},v=function(e,t){return a},y=u?c:v,x=u?h:_,b=0,M=0;M<i.length;M++){for(var S=new Array,T=y(M,m[M]),A=x(M,m[M]),D=0;D<t.length;D++){var E=e.Matrix.RotationAxis(f[M],g),C=f[M].scale(t[D].z).add(d[M].scale(t[D].x)).add(p[M].scale(t[D].y)),w=e.Vector3.TransformCoordinates(C,E).scaleInPlace(A).add(i[M]);S.push(w)}o[b]=S,g+=T,b++}var I=function(t){var i,r=Array(),n=e.Vector3.Zero();for(i=0;i<t.length;i++)n.addInPlace(t[i]);for(n.scaleInPlace(1/t.length),i=0;i<t.length;i++)r.push(n);return r};switch(l){case r.NO_CAP:break;case r.CAP_START:o.unshift(I(o[0]));break;case r.CAP_END:o.push(I(o[o.length-1]));break;case r.CAP_ALL:o.unshift(I(o[0])),o.push(I(o[o.length-1]))}return o};if(g){var v=g.path3D.update(n),y=_(i,n,g.path3D,g.pathArray,o,s,a,h,g.cap,f);return g=r.CreateRibbon(null,y,null,null,null,null,null,null,g)}var v=new e.Path3D(n),x=new Array;u=0>u||u>3?0:u;var y=_(i,n,v,x,o,s,a,h,u,f),b=r.CreateRibbon(t,y,c,l,0,d,p,m);return b.pathArray=y,b.path3D=v,b.cap=u,b},r.CreateLathe=function(t,i,n,o,s,a,h){void 0===h&&(h=r.DEFAULTSIDE),n=n||1,o=o||60*n;for(var c=2*Math.PI,l=(e.Axis.Y,new Array),u=0;0===i[u].x;)u++;var f=i[u];for(u=0;u<i.length;u++)l.push(i[u].subtract(f));var d,p=c/o,m=new Array;for(u=0;o>u;u++)d=new e.Vector3(Math.cos(u*p)*n,0,Math.sin(u*p)*n),m.push(d);m.push(m[0]);var g=function(){return 1},_=function(){return 0},v=r.ExtrudeShapeCustom(t,l,m,g,_,!0,!1,r.NO_CAP,s,a,h);return v},r.CreatePlane=function(t,i,n,o,s){void 0===s&&(s=r.DEFAULTSIDE);var a=new r(t,n),h=e.VertexData.CreatePlane(i,s);return h.applyToMesh(a,o),a},r.CreateGround=function(t,i,r,n,o,s){var a=new e.GroundMesh(t,o);a._setReady(!1),a._subdivisions=n;var h=e.VertexData.CreateGround(i,r,n);return h.applyToMesh(a,s),a._setReady(!0),a},r.CreateTiledGround=function(t,i,n,o,s,a,h,c,l){var u=new r(t,c),f=e.VertexData.CreateTiledGround(i,n,o,s,a,h);return f.applyToMesh(u,l),u},r.CreateGroundFromHeightMap=function(t,i,r,n,o,s,a,h,c,l){var u=new e.GroundMesh(t,h);u._subdivisions=o,u._setReady(!1);var f=function(t){var i=document.createElement(\"canvas\"),h=i.getContext(\"2d\"),f=t.width,d=t.height;i.width=f,i.height=d,h.drawImage(t,0,0);var p=h.getImageData(0,0,f,d).data,m=e.VertexData.CreateGroundFromHeightMap(r,n,o,s,a,p,f,d);m.applyToMesh(u,c),u._setReady(!0),l&&l(u)};return e.Tools.LoadImage(i,f,function(){},h.database),u},r.CreateTube=function(t,i,n,o,s,a,h,c,l,u){void 0===l&&(l=r.DEFAULTSIDE),void 0===u&&(u=null);var f=function(t,i,n,o,s,a,h){for(var c,l,u,f,d,p=i.getTangents(),m=i.getNormals(),g=i.getDistances(),_=2*Math.PI,v=_/s,y=function(e,t){return o},x=a||y,b=0,M=0;M<t.length;M++){l=x(M,g[M]),c=Array(),u=m[M];for(var S=0;s>S;S++)d=e.Matrix.RotationAxis(p[M],v*S),f=e.Vector3.TransformCoordinates(u,d).scaleInPlace(l).add(t[M]),c.push(f);c.push(c[0]),n[b]=c,b++}var T=function(e,i){for(var r=Array(),n=0;e>n;n++)r.push(t[i]);return r};switch(h){case r.NO_CAP:break;case r.CAP_START:n.unshift(T(s+1,0));break;case r.CAP_END:n.push(T(s+1,t.length-1));break;case r.CAP_ALL:n.unshift(T(s+1,0)),n.push(T(s+1,t.length-1))}return n};if(u){var d=u.path3D.update(i),p=f(i,d,u.pathArray,n,u.tessellation,s,u.cap);return u=r.CreateRibbon(null,p,null,null,null,null,null,null,u)}var d=new e.Path3D(i),m=new Array;a=0>a||a>3?0:a;var p=f(i,d,m,n,o,s,a),g=r.CreateRibbon(t,p,!1,!0,0,h,c,l);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.noworker.js:\n    7  this._boundingInfo._checkCollision(t)&&(e.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var r=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return r;if(!this._generatePointsArray())return r;var n,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),h=this._submeshesOctree.intersectsRay(a);o=h.length,n=h.data}else n=this.subMeshes,o=n.length;for(var c=0;o>c;c++){var l=n[c];if(!(o>1)||l.canIntersects(t)){var u=l.intersects(t,this._positions,this.getIndices(),i);if(u&&(i||!s||u.distance<s.distance)&&(s=u,s.subMeshId=c,i))break}}if(s){var f=this.getWorldMatrix(),d=e.Vector3.TransformCoordinates(t.origin,f),p=t.direction.clone();p=p.scale(s.distance);var m=e.Vector3.TransformNormal(p,f),g=d.add(m);return r.hit=!0,r.distance=e.Vector3.Distance(d,g),r.pickedPoint=g,r.pickedMesh=this,r.bu=s.bu,r.bv=s.bv,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},i.prototype.clone=function(e,t,i){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},i.prototype.dispose=function(t){var i;for(this.getPhysicsImpostor()!==e.PhysicsEngine.NoImpostor&&this.setPhysicsState(e.PhysicsEngine.NoImpostor),i=0;i<this._intersectionsInProgress.length;i++){var r=this._intersectionsInProgress[i],n=r._intersectionsInProgress.indexOf(this);r._intersectionsInProgress.splice(n,1)}if(this._intersectionsInProgress=[],this.releaseSubMeshes(),this.getScene().removeMesh(this),t)for(i=0;i<this.getScene().meshes.length;i++){var o=this.getScene().meshes[i];o.parent===this&&(o.parent=null,o.computeWorldMatrix(!0))}else{for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);var s=this.getScene().meshes.slice(0);for(i=0;i<s.length;i++)s[i].parent===this&&s[i].dispose()}this._onAfterWorldMatrixUpdate=[],this._isDisposed=!0,this.onDispose&&this.onDispose()},i._BILLBOARDMODE_NONE=0,i._BILLBOARDMODE_X=1,i._BILLBOARDMODE_Y=2,i._BILLBOARDMODE_Z=4,i._BILLBOARDMODE_ALL=7,i}(e.Node);e.AbstractMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.diffuse=new e.Color3(1,1,1),this.specular=new e.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.includeOnlyWithLayerMask=0,this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this.excludeWithLayerMask=0,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,r.addLight(this)}return __extends(i,t),i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},i.prototype.transferToEffect=function(e,t,i){},i.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},i.prototype.canAffectMesh=function(e){return e?this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e)?!1:this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&e.layerMask)?!1:0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask?!1:!0:!0},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):t},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().removeLight(this)},i}(e.Node);e.Light=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,r),this.position=i}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this._transformedPosition?this._transformedPosition:this.position},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void t.setFloat4(i,this.position.x,this.position.y,this.position.z,0)},i.prototype.getShadowGenerator=function(){return null},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.PointLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r,n,o,s){t.call(this,e,s),this.position=i,this.direction=r,this.angle=n,this.exponent=o}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;e.Matrix.PerspectiveFovLHToRef(this.angle,1,n.minZ,n.maxZ,t)},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!1},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i,r){var n;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),this.computeTransformedPosition(),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),t.setFloat4(i,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),n=e.Vector3.Normalize(this._transformedDirection)):(t.setFloat4(i,this.position.x,this.position.y,this.position.z,this.exponent),n=e.Vector3.Normalize(this.direction)),t.setFloat4(r,n.x,n.y,n.z,Math.cos(.5*this.angle))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.SpotLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){t.call(this,i,n),this.direction=r,this.groundColor=new e.Color3(0,0,0)}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i,r){var n=e.Vector3.Normalize(this.direction);t.setFloat4(i,n.x,n.y,n.z,0),t.setColor3(r,this.groundColor.scale(this.intensity))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i}(e.Light);e.HemisphericLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,r),this.direction=i,this.shadowOrthoScale=.5,this.position=i.scale(-1)}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.setShadowProjectionMatrix=function(t,i,r){for(var n=Number.MAX_VALUE,o=Number.MIN_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,h=e.Vector3.Zero(),c=this.getScene().activeCamera,l=0;l<r.length;l++){var u=r[l];if(u){var f=u.getBoundingInfo();if(f)for(var d=f.boundingBox,p=0;p<d.vectorsWorld.length;p++)e.Vector3.TransformCoordinatesToRef(d.vectorsWorld[p],i,h),h.x<n&&(n=h.x),h.y<a&&(a=h.y),h.x>o&&(o=h.x),h.y>s&&(s=h.y)}}var m=o-n,g=s-a;e.Matrix.OrthoOffCenterLHToRef(n-m*this.shadowOrthoScale,o+m*this.shadowOrthoScale,a-g*this.shadowOrthoScale,s+g*this.shadowOrthoScale,-c.maxZ,c.maxZ,t)},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!0},i.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(i,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(i,this.direction.x,this.direction.y,this.direction.z,1)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.DirectionalLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,r){var n=this;this._filter=t.FILTER_NONE,this.blurScale=2,this._blurBoxOffset=0,this._bias=5e-5,this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._light=r,this._scene=r.getScene(),this._mapSize=i,r._shadowGenerator=this,this._shadowMap=new e.RenderTargetTexture(r.name+\"_shadowMap\",i,this._scene,!1),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.onAfterUnbind=function(){n.useBlurVarianceShadowMap&&(n._shadowMap2||(n._shadowMap2=new e.RenderTargetTexture(r.name+\"_shadowMap\",i,n._scene,!1),n._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,n._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,n._shadowMap2.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),n._downSamplePostprocess=new e.PassPostProcess(\"downScale\",1/n.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,n._scene.getEngine()),n._downSamplePostprocess.onApply=function(e){e.setTexture(\"textureSampler\",n._shadowMap)},n.blurBoxOffset=1),n._scene.postProcessManager.directRender([n._downSamplePostprocess,n._boxBlurPostprocess],n._shadowMap2.getInternalTexture()))};var o=function(t){var i=t.getRenderingMesh(),r=n._scene,o=r.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){o.enableEffect(n._effect),i._bind(t,n._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(n._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();n._effect.setTexture(\"diffuseSampler\",c),n._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&n._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,n._effect,e.Material.TriangleFillMode,s,a,function(e,t){return n._effect.setMatrix(\"world\",t)})}else n._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(e,t,i){var r;for(r=0;r<e.length;r++)o(e.data[r]);for(r=0;r<t.length;r++)o(t.data[r]);if(n._transparencyShadow)for(r=0;r<i.length;r++)o(i.data[r])},this._shadowMap.onClear=function(t){n.useBlurVarianceShadowMap||n.useVarianceShadowMap?t.clear(new e.Color4(0,0,0,0),!0,!0):t.clear(new e.Color4(1,1,1,1),!0,!0)}}return Object.defineProperty(t,\"FILTER_NONE\",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_VARIANCESHADOWMAP\",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_POISSONSAMPLING\",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FILTER_BLURVARIANCESHADOWMAP\",{get:function(){return t._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"bias\",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"blurBoxOffset\",{get:function(){return this._blurBoxOffset},set:function(t){var i=this;this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new e.PostProcess(\"DepthBoxBlur\",\"depthBoxBlur\",[\"screenSize\",\"boxOffset\"],[],1/this.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,\"#define OFFSET \"+t),this._boxBlurPostprocess.onApply=function(e){e.setFloat2(\"screenSize\",i._mapSize/i.blurScale,i._mapSize/i.blurScale)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"filter\",{get:function(){return this._filter},set:function(t){this._filter!==t&&(this._filter=t,this.useVarianceShadowMap||this.useBlurVarianceShadowMap?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"useVarianceShadowMap\",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"usePoissonSampling\",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===t.FILTER_VARIANCESHADOWMAP||this.filter===t.FILTER_BLURVARIANCESHADOWMAP)},set:function(e){this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"useBlurVarianceShadowMap\",{get:function(){return this.filter===t.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_BLURVARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var r=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&r.push(\"#define VSM\");var n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"shadowMap\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId())return this._transformMatrix;this._currentRenderID=t.getRenderId();var i=this._light.position,r=this._light.direction;return this._light.computeTransformedPosition()&&(i=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&i.equals(this._cachedPosition)&&r.equals(this._cachedDirection)||(this._cachedPosition=i.clone(),this._cachedDirection=r.clone(),e.Matrix.LookAtLHToRef(i,this._light.position.add(r),e.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){this._darkness=e>=1?1:0>=e?0:e},t.prototype.setTransparencyShadow=function(e){this._transparencyShadow=e},t.prototype._packHalf=function(t){var i=255*t,r=i-Math.floor(i);return new e.Vector2(t-r/255,r)},t.prototype.dispose=function(){this._shadowMap.dispose(),this._shadowMap2&&this._shadowMap2.dispose(),this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t._FILTER_BLURVARIANCESHADOWMAP=3,t}();e.ShadowGenerator=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e,t,i,r){return e.x>i.x+r?!1:i.x-r>t.x?!1:e.y>i.y+r?!1:i.y-r>t.y?!1:e.z>i.z+r?!1:i.z-r>t.z?!1:!0},i=function(e,t,i,r){var n=t*t-4*e*i,o={root:0,found:!1};if(0>n)return o;var s=Math.sqrt(n),a=(-t-s)/(2*e),h=(-t+s)/(2*e);if(a>h){var c=h;h=a,a=c}return a>0&&r>a?(o.root=a,o.found=!0,o):h>0&&r>h?(o.root=h,o.found=!0,o):o},r=function(){function r(){this.radius=new e.Vector3(1,1,1),this.retry=0,this.basePointWorld=e.Vector3.Zero(),this.velocityWorld=e.Vector3.Zero(),this.normalizedVelocity=e.Vector3.Zero(),this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero()}return r.prototype._initialize=function(t,i,r){this.velocity=i,e.Vector3.NormalizeToRef(i,this.normalizedVelocity),this.basePoint=t,t.multiplyToRef(this.radius,this.basePointWorld),i.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=r,this.collisionFound=!1},r.prototype._checkPointInTriangle=function(t,i,r,n,o){i.subtractToRef(t,this._tempVector),r.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return 0>s?!1:(n.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),0>s?!1:(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),s>=0))},r.prototype._canDoCollision=function(i,r,n,o){var s=e.Vector3.Distance(this.basePointWorld,i),a=Math.max(this.radius.x,this.radius.y,this.radius.z);return s>this.velocityWorldLength+a+r?!1:t(n,o,this.basePointWorld,this.velocityWorldLength+a)?!0:!1},r.prototype._testTriangle=function(t,r,n,o,s,a){var h,c=!1;r||(r=[]),r[t]||(r[t]=new e.Plane(0,0,0,0),r[t].copyFromPoints(n,o,s));var l=r[t];if(a||l.isFrontFacingTo(this.normalizedVelocity,0)){var u=l.signedDistanceTo(this.basePoint),f=e.Vector3.Dot(l.normal,this.velocity);if(0==f){if(Math.abs(u)>=1)return;c=!0,h=0}else{h=(-1-u)/f;var d=(1-u)/f;if(h>d){var p=d;d=h,h=p}if(h>1||0>d)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var m=!1,g=1;if(c||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,o,s,l.normal)&&(m=!0,g=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!m){var _=this.velocity.lengthSquared(),v=_;this.basePoint.subtractToRef(n,this._tempVector);var y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g);b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(n)),this.basePoint.subtractToRef(o,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(o)),this.basePoint.subtractToRef(s,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=i(v,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex);var M=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex);if(v=M*-_+A*A,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*A*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found){var S=(A*b.root-T)/M;S>=0&&1>=S&&(g=b.root,m=!0,this._edge.scaleInPlace(S),n.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this.basePoint,this._baseToVertex),M=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex),v=M*-_+A*A,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*A*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found&&(S=(A*b.root-T)/M,S>=0&&1>=S&&(g=b.root,m=!0,this._edge.scaleInPlace(S),o.addToRef(this._edge,this._collisionPoint))),n.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex),M=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),T=e.Vector3.Dot(this._edge,this._baseToVertex),v=M*-_+A*A,y=2*M*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*A*T,x=M*(1-this._baseToVertex.lengthSquared())+T*T,b=i(v,y,x,g),b.found&&(S=(A*b.root-T)/M,S>=0&&1>=S&&(g=b.root,m=!0,this._edge.scaleInPlace(S),s.addToRef(this._edge,this._collisionPoint)))}if(m){var E=g*this.velocity.length();(!this.collisionFound||E<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=E,this.collisionFound=!0)}}},r.prototype._collide=function(e,t,i,r,n,o,s){for(var a=r;n>a;a+=3){var h=t[i[a]-o],c=t[i[a+1]-o],l=t[i[a+2]-o];this._testTriangle(a,e,l,c,h,s)}},r.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this.nearestDistance/i.length()),this.basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},r}();e.Collider=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\"\",function(e){e[e.INIT=0]=\"INIT\",e[e.UPDATE=1]=\"UPDATE\",e[e.COLLIDE=2]=\"COLLIDE\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var t=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\"SUCCESS\",e[e.UNKNOWN_ERROR=1]=\"UNKNOWN_ERROR\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,r=function(){function r(){var n=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){n._addUpdateMeshesList[e.uniqueId]=r.SerializeMesh(e)},this.onGeometryUpdated=function(e){n._addUpdateGeometriesList[e.id]=r.SerializeGeometry(e)},this._afterRender=function(){if(n._init&&!(0==n._toRemoveGeometryArray.length&&0==n._toRemoveMeshesArray.length&&0==Object.keys(n._addUpdateGeometriesList).length&&0==Object.keys(n._addUpdateMeshesList).length||n._runningUpdated>4)){++n._runningUpdated;var e={updatedMeshes:n._addUpdateMeshesList,updatedGeometries:n._addUpdateGeometriesList,removedGeometries:n._toRemoveGeometryArray,removedMeshes:n._toRemoveMeshesArray},i={payload:e,taskType:t.UPDATE},r=[];for(var o in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(o)&&(r.push(i.payload.updatedGeometries[o].indices.buffer),r.push(i.payload.updatedGeometries[o].normals.buffer),r.push(i.payload.updatedGeometries[o].positions.buffer));n._worker.postMessage(i,r),n._addUpdateMeshesList={},n._addUpdateGeometriesList={},n._toRemoveGeometryArray=[],n._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(r){var o=r.data;if(o.error!=i.SUCCESS)return void e.Tools.Warn(\"error returned from worker!\");switch(o.taskType){case t.INIT:n._init=!0,n._scene.meshes.forEach(function(e){n.onMeshAdded(e)}),n._scene.getGeometries().forEach(function(e){n.onGeometryAdded(e)});break;case t.UPDATE:n._runningUpdated--;break;case t.COLLIDE:n._runningCollisionTask=!1;var s=o.payload;if(!n._collisionsCallbackArray[s.collisionId])return;n._collisionsCallbackArray[s.collisionId](s.collisionId,e.Vector3.FromArray(s.newPosition),n._scene.getMeshByUniqueID(s.collidedMeshUniqueId)),n._collisionsCallbackArray[s.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return r.prototype.getNewPosition=function(e,i,r,n,o,s,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(r.radius,this._scaledPosition),i.divideToRef(r.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=s;var h={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:r.radius.asArray()},collisionId:a,excludedMeshUniqueId:o?o.uniqueId:null,maximumRetry:n},c={payload:h,taskType:t.COLLIDE};this._worker.postMessage(c)}},r.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var r=e.WorkerIncluded?e.Engine.CodeRepository+\"Collisions/babylon.collisionWorker.js\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\"application/javascript\"}));this._worker=new Worker(r),this._worker.onmessage=this._onMessageFromWorker;var n={payload:{},taskType:t.INIT};this._worker.postMessage(n)},r.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},r.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},r.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},r.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},r.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},r.SerializeMesh=function(e){var t=[];e.subMeshes&&(t=e.subMeshes.map(function(e,t){return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:t,checkCollisions:e.checkCollisions}},r.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(t.getIndices()||[])}},r}();e.CollisionCoordinatorWorker=r;var n=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,i,r,n,o,s){e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,this._finalPosition,n),this._finalPosition.multiplyInPlace(i.radius),o(s,this._finalPosition,i.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,i,r,n,o,s){void 0===s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(r.retry>=n)return void o.copyFrom(t);r._initialize(t,i,a);for(var h=0;h<this._scene.meshes.length;h++){var c=this._scene.meshes[h];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==s&&c._checkCollision(r)}return r.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&r._getResponse(t,i),i.length()<=a?void o.copyFrom(t):(r.retry++,void this._collideWithWorld(t,i,r,n,o,s))):void t.addToRef(i,o)},t}();e.CollisionCoordinatorLegacy=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.compensateDistorsion=!0}return Object.defineProperty(t.prototype,\"aspectRatio\",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"aspectRatioFov\",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"leftHMatrix\",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightHMatrix\",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(-i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"leftPreViewMatrix\",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightPreViewMatrix\",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t;var i=function(i){function r(t,n,o){i.call(this,t,o),this.position=n,this.upVector=e.Vector3.Up(),this.orthoLeft=null,\n    8  this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this.mode=r.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=r.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=r.RIG_MODE_NONE,this._rigCameras=new Array,this._computedViewMatrix=e.Matrix.Identity(),this._projectionMatrix=new e.Matrix,this._postProcesses=new Array,this._postProcessesTakenIndices=[],this._activeMeshes=new e.SmartArray(256),this._globalPosition=e.Vector3.Zero(),o.addCamera(this),o.activeCamera||(o.activeCamera=this)}return __extends(r,i),Object.defineProperty(r,\"PERSPECTIVE_CAMERA\",{get:function(){return r._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ORTHOGRAPHIC_CAMERA\",{get:function(){return r._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"FOVMODE_VERTICAL_FIXED\",{get:function(){return r._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"FOVMODE_HORIZONTAL_FIXED\",{get:function(){return r._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_NONE\",{get:function(){return r._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_ANAGLYPH\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_STEREOSCOPIC_OVERUNDER\",{get:function(){return r._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"RIG_MODE_VR\",{get:function(){return r._RIG_MODE_VR},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"globalPosition\",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),r.prototype.getActiveMeshes=function(){return this._activeMeshes},r.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},r.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},r.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this);var t=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()},r.prototype._updateFromScene=function(){this.updateCache(),this._update()},r.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},r.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===r.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},r.prototype.attachControl=function(e){},r.prototype.detachControl=function(e){},r.prototype._update=function(){this._checkInputs(),this.cameraRigMode!==r.RIG_MODE_NONE&&this._updateRigCameras()},r.prototype._checkInputs=function(){},r.prototype.attachPostProcess=function(t,i){if(void 0===i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1)return e.Tools.Error(\"You're trying to reuse a post process not defined as reusable.\"),0;if(null==i||0>i)return this._postProcesses.push(t),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1;var r=0;if(this._postProcesses[i]){for(var n=this._postProcesses.length-1,o=n;o>=i+1;--o)this._postProcesses[o+1]=this._postProcesses[o];r=1}for(o=0;o<this._postProcessesTakenIndices.length;++o)if(!(this._postProcessesTakenIndices[o]<i)){n=this._postProcessesTakenIndices.length-1;for(var s=n;s>=o;--s)this._postProcessesTakenIndices[s+1]=this._postProcessesTakenIndices[s]+r;this._postProcessesTakenIndices[o]=i;break}r||-1!=this._postProcessesTakenIndices.indexOf(i)||this._postProcessesTakenIndices.push(i);var a=i+r;return this._postProcesses[a]=t,a},r.prototype.detachPostProcess=function(e,t){void 0===t&&(t=null);var i=[];if(t)for(t=t instanceof Array?t:[t],o=0;o<t.length;o++){var r=this._postProcesses[t[o]];r===e?(delete this._postProcesses[t[o]],s=this._postProcessesTakenIndices.indexOf(t[o]),this._postProcessesTakenIndices.splice(s,1)):i.push(o)}else for(var n=this._postProcesses.length,o=0;n>o;o++)if(this._postProcesses[o]===e){delete this._postProcesses[o];var s=this._postProcessesTakenIndices.indexOf(o);this._postProcessesTakenIndices.splice(s,1)}return i},r.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=e.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},r.prototype._getViewMatrix=function(){return e.Matrix.Identity()},r.prototype.getViewMatrix=function(t){return this._computedViewMatrix=this._computeViewMatrix(t),!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},r.prototype._computeViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},r.prototype.getProjectionMatrix=function(t){if(!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var i=this.getEngine();if(this.mode===r.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),e.Matrix.PerspectiveFovLHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode),this._projectionMatrix;var n=i.getRenderWidth()/2,o=i.getRenderHeight()/2;return e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},r.prototype.dispose=function(){for(this.getScene().removeCamera(this);this._rigCameras.length>0;)this._rigCameras.pop().dispose();for(var e=0;e<this._postProcessesTakenIndices.length;++e)this._postProcesses[this._postProcessesTakenIndices[e]].dispose(this)},r.prototype.setCameraRigMode=function(i,n){for(;this._rigCameras.length>0;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=i,this._cameraRigParams={},this.cameraRigMode){case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this._rigCameras.push(this.createRigCamera(this.name+\"_L\",0)),this._rigCameras.push(this.createRigCamera(this.name+\"_R\",1))}var o=new Array;switch(this.cameraRigMode){case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:o.push(new e.PassPostProcess(this.name+\"_passthru\",1,this._rigCameras[0])),this._rigCameras[0].isIntermediate=!0,o.push(new e.AnaglyphPostProcess(this.name+\"_anaglyph\",1,this._rigCameras[1])),o[1].onApply=function(e){e.setTextureFromPostProcess(\"leftSampler\",o[0])};break;case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:var s=this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,a=this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:0,h=1-a;o.push(new e.PassPostProcess(this.name+\"_passthru\",1,this._rigCameras[a])),this._rigCameras[a].isIntermediate=!0,o.push(new e.StereoscopicInterlacePostProcess(this.name+\"_stereoInterlace\",this._rigCameras[h],o[0],s));break;case r.RIG_MODE_VR:this._rigCameras.push(this.createRigCamera(this.name+\"_L\",0)),this._rigCameras.push(this.createRigCamera(this.name+\"_R\",1));var c=n.vrCameraMetrics||t.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=c,this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=c.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=c.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess(\"VR_Distort_Compensation_Left\",this._rigCameras[0],!1,c)),this._rigCameras[1]._cameraRigParams.vrMetrics=this._rigCameras[0]._cameraRigParams.vrMetrics,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=c.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=c.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess(\"VR_Distort_Compensation_Right\",this._rigCameras[1],!0,c))}this._update()},r.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams[t]=i,\"interaxialDistance\"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(i/.0637))},r.prototype.createRigCamera=function(e,t){return null},r.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov;this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},r._PERSPECTIVE_CAMERA=0,r._ORTHOGRAPHIC_CAMERA=1,r._FOVMODE_VERTICAL_FIXED=0,r._FOVMODE_HORIZONTAL_FIXED=1,r._RIG_MODE_NONE=0,r._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r._RIG_MODE_VR=20,r}(e.Node);e.Camera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){t.call(this,i,r,n),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0),this.rotation=new e.Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.lockedTarget=null,this._currentTarget=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._camMatrix=e.Matrix.Zero(),this._cameraTransformMatrix=e.Matrix.Zero(),this._cameraRotationMatrix=e.Matrix.Zero(),this._referencePoint=new e.Vector3(0,0,1),this._transformedReferencePoint=e.Vector3.Zero(),this._lookAtTemp=e.Matrix.Zero(),this._tempMatrix=e.Matrix.Zero()}return __extends(i,t),i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&this._cache.rotation.equals(this.rotation)},i.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*(e.getDeltaTime()/(10*e.getFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);this.rotation.y=i.x>=0?-Math.atan(i.z/i.x)+Math.PI/2:-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=-Math.acos(e.Vector3.Dot(new e.Vector3(0,1,0),this.upVector)),isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),r&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var n=Math.PI/2*.95;this.rotation.x>n&&(this.rotation.x=n),this.rotation.x<-n&&(this.rotation.x=-n)}i&&(Math.abs(this.cameraDirection.x)<e.Engine.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<e.Engine.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<e.Engine.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<e.Engine.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<e.Engine.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},i.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(0!==this.upVector.x||1!==this.upVector.y||0!==this.upVector.z?(e.Matrix.LookAtLHToRef(e.Vector3.Zero(),this._referencePoint,this.upVector,this._lookAtTemp),e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},i.prototype._getVRViewMatrix=function(){return e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),e.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._cameraRigParams.vrActualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._cameraRigParams.vrActualUp,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._viewMatrix),this._viewMatrix},i.prototype.createRigCamera=function(t,r){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var n=new i(t,this.position.clone(),this.getScene());return this.cameraRigMode===e.Camera.RIG_MODE_VR&&(n._cameraRigParams={},n._cameraRigParams.vrActualUp=new e.Vector3(0,0,0),n._getViewMatrix=n._getVRViewMatrix),n}return null},i.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var i=this._rigCameras[0],r=this._rigCameras[1];this.cameraRigMode===e.Camera.RIG_MODE_VR?(i.rotation.x=r.rotation.x=this.rotation.x,i.rotation.y=r.rotation.y=this.rotation.y,i.rotation.z=r.rotation.z=this.rotation.z,i.position.copyFrom(this.position),r.position.copyFrom(this.position)):(i.setTarget(this.getTarget()),r.setTarget(this.getTarget()),this._getRigCamPosition(-this._cameraRigParams.stereoHalfAngle,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle,r.position))}t.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPosition=function(t,i){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var r=this.getTarget();e.Matrix.Translation(-r.x,-r.y,-r.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(r.x,r.y,r.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,i)},i}(e.Camera);e.TargetCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){var o=this;t.call(this,i,r,n),this.ellipsoid=new e.Vector3(.5,1,.5),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.checkCollisions=!1,this.applyGravity=!1,this.angularSensibility=2e3,this._keys=[],this._collider=new e.Collider,this._needMoveForGravity=!1,this._oldPosition=e.Vector3.Zero(),this._diffPosition=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius);var n=function(t){o._newPosition.copyFrom(t),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition);o.position.clone();o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&r&&o.onCollide(r))};n(i)}}return __extends(i,t),i.prototype.attachControl=function(t,i){var r,n=this,o=this.getEngine();this._attachedElement||(this._attachedElement=t,void 0===this._onMouseDown&&(this._onMouseDown=function(e){r={x:e.clientX,y:e.clientY},i||e.preventDefault()},this._onMouseUp=function(e){r=null,i||e.preventDefault()},this._onMouseOut=function(e){r=null,n._keys=[],i||e.preventDefault()},this._onMouseMove=function(e){if(r||o.isPointerLock){var t,s;o.isPointerLock?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,s=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0):(t=e.clientX-r.x,s=e.clientY-r.y),n.cameraRotation.y+=t/n.angularSensibility,n.cameraRotation.x+=s/n.angularSensibility,r={x:e.clientX,y:e.clientY},i||e.preventDefault()}},this._onKeyDown=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);-1===t&&n._keys.push(e.keyCode),i||e.preventDefault()}},this._onKeyUp=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);t>=0&&n._keys.splice(t,1),i||e.preventDefault()}},this._onLostFocus=function(){n._keys=[]},this._reset=function(){n._keys=[],r=null,n.cameraDirection=new e.Vector3(0,0,0),n.cameraRotation=new e.Vector2(0,0)}),t.addEventListener(\"mousedown\",this._onMouseDown,!1),t.addEventListener(\"mouseup\",this._onMouseUp,!1),t.addEventListener(\"mouseout\",this._onMouseOut,!1),t.addEventListener(\"mousemove\",this._onMouseMove,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedElement==t&&(t.removeEventListener(\"mousedown\",this._onMouseDown),t.removeEventListener(\"mouseup\",this._onMouseUp),t.removeEventListener(\"mouseout\",this._onMouseOut),t.removeEventListener(\"mousemove\",this._onMouseMove),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]),this._attachedElement=null,this._reset&&this._reset())},i.prototype._collideWithWorld=function(t){var i;i=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid,this.applyGravity&&t.addInPlace(this.getScene().gravity),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero());for(var i=0;i<this._keys.length;i++){var r=this._keys[i],n=this._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(r)?this._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(r)?this._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(r)?this._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(r)&&this._localDirection.copyFromFloats(0,0,-n),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)}t.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},i}(e.TargetCamera);e.FreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,i,r),this.radius=12,this.rotationOffset=0,this.heightOffset=4,this.cameraAcceleration=.05,this.maxCameraSpeed=20}return __extends(i,t),i.prototype.getRadians=function(e){return e*Math.PI/180},i.prototype.follow=function(t){if(t){var i;if(t.rotationQuaternion){var r=new e.Matrix;t.rotationQuaternion.toRotationMatrix(r),i=Math.atan2(r.m[8],r.m[10])}else i=t.rotation.y;var n=this.getRadians(this.rotationOffset)+i,o=t.position.x+Math.sin(n)*this.radius,s=t.position.z+Math.cos(n)*this.radius,a=o-this.position.x,h=t.position.y+this.heightOffset-this.position.y,c=s-this.position.z,l=a*this.cameraAcceleration*2,u=h*this.cameraAcceleration,f=c*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=1>l?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=1>u?-this.maxCameraSpeed:this.maxCameraSpeed),(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=1>f?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+l,this.position.y+u,this.position.z+f),this.setTarget(t.position)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow(this.target)},i}(e.TargetCamera);e.FollowCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){t.call(this,e,i,r),this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.angularSensibility=2e5,this.moveSensibility=500}return __extends(i,t),i.prototype.attachControl=function(t,i){var r,n=this;this._attachedCanvas||(this._attachedCanvas=t,void 0===this._onPointerDown&&(this._onPointerDown=function(e){i||e.preventDefault(),n._pointerPressed.push(e.pointerId),1===n._pointerPressed.length&&(r={x:e.clientX,y:e.clientY})},this._onPointerUp=function(e){i||e.preventDefault();var t=n._pointerPressed.indexOf(e.pointerId);-1!==t&&(n._pointerPressed.splice(t,1),0==t&&(r=null,n._offsetX=null,n._offsetY=null))},this._onPointerMove=function(e){if(i||e.preventDefault(),r){var t=n._pointerPressed.indexOf(e.pointerId);0==t&&(n._offsetX=e.clientX-r.x,n._offsetY=-(e.clientY-r.y))}},this._onLostFocus=function(){n._offsetX=null,n._offsetY=null}),t.addEventListener(\"pointerdown\",this._onPointerDown),t.addEventListener(\"pointerup\",this._onPointerUp),t.addEventListener(\"pointerout\",this._onPointerUp),t.addEventListener(\"pointermove\",this._onPointerMove),e.Tools.RegisterTopRootEvents([{name:\"blur\",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedCanvas==t&&(t.removeEventListener(\"pointerdown\",this._onPointerDown),t.removeEventListener(\"pointerup\",this._onPointerUp),t.removeEventListener(\"pointerout\",this._onPointerUp),t.removeEventListener(\"pointermove\",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:\"blur\",handler:this._onLostFocus}]),this._attachedCanvas=null)},i.prototype._checkInputs=function(){if(this._offsetX){if(this.cameraRotation.y+=this._offsetX/this.angularSensibility,this._pointerPressed.length>1)this.cameraRotation.x+=-this._offsetY/this.angularSensibility;else{var i=this._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,this._cameraRotationMatrix))}t.prototype._checkInputs.call(this)}},i}(e.FreeCamera);e.TouchCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=e.Tools.GetPointerPrefix(),i=function(i){function r(t,r,n,o,s,a){var h=this;i.call(this,t,e.Vector3.Zero(),a),this.alpha=r,this.beta=n,this.radius=o,this.target=s,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.angularSensibility=1e3,this.wheelPrecision=3,this.pinchPrecision=2,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.zoomOnFactor=1,this.targetScreenOffset=e.Vector2.Zero(),this.pinchInwards=!0,this.allowUpsideDown=!0,this._keys=[],this._viewMatrix=new e.Matrix,this.checkCollisions=!1,this.collisionRadius=new e.Vector3(.5,.5,.5),this._collider=new e.Collider,this._previousPosition=e.Vector3.Zero(),this._collisionVelocity=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),h.getScene().workerCollisions&&h.checkCollisions&&i.multiplyInPlace(h._collider.radius),r?(h.setPosition(h.position),h.onCollide&&h.onCollide(r)):h._previousPosition.copyFrom(h.position);var n=Math.cos(h.alpha),o=Math.sin(h.alpha),s=Math.cos(h.beta),a=Math.sin(h.beta),c=h._getTargetPosition();c.addToRef(new e.Vector3(h.radius*n*a,h.radius*s,h.radius*o*a),h._newPosition),h.position.copyFrom(h._newPosition);var l=h.upVector;if(h.allowUpsideDown&&h.beta<0){var l=l.clone();l=l.negate()}e.Matrix.LookAtLHToRef(h.position,c,l,h._viewMatrix),h._viewMatrix.m[12]+=h.targetScreenOffset.x,h._viewMatrix.m[13]+=h.targetScreenOffset.y,h._collisionTriggered=!1},this.target||(this.target=e.Vector3.Zero()),this.getViewMatrix()}return __extends(r,i),r.prototype._getTargetPosition=function(){return this.target.position||this.target},r.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=void 0},r.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset=this.targetScreenOffset.clone()},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},r.prototype.attachControl=function(i,r){var n,o=this,s=0,a=new e.SmartCollection;if(!this._attachedElement){this._attachedElement=i;var h=this.getEngine();void 0===this._onPointerDown&&(this._onPointerDown=function(e){a.add(e.pointerId,{x:e.clientX,y:e.clientY,type:e.pointerType}),n=a.item(e.pointerId),r||e.preventDefault()},this._onPointerUp=function(e){n=null,s=0,a.empty(),r||e.preventDefault()},this._onPointerMove=function(e){switch(r||e.preventDefault(),a.count){case 1:var t=e.clientX-n.x,i=e.clientY-n.y;o.inertialAlphaOffset-=t/o.angularSensibility,o.inertialBetaOffset-=i/o.angularSensibility,n.x=e.clientX,n.y=e.clientY;break;case 2:a.item(e.pointerId).x=e.clientX,a.item(e.pointerId).y=e.clientY;var h=o.pinchInwards?1:-1,c=a.getItemByIndex(0).x-a.getItemByIndex(1).x,l=a.getItemByIndex(0).y-a.getItemByIndex(1).y,u=c*c+l*l;if(0===s)return void(s=u);u!==s&&(o.inertialRadiusOffset+=(u-s)/(o.pinchPrecision*o.wheelPrecision*o.angularSensibility*h),s=u);break;default:a.item(e.pointerId)&&(a.item(e.pointerId).x=e.clientX,a.item(e.pointerId).y=e.clientY)}},this._onMouseMove=function(e){if(h.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;o.inertialAlphaOffset-=t/o.angularSensibility,o.inertialBetaOffset-=i/o.angularSensibility,r||e.preventDefault()}},this._wheel=function(e){var t=0;e.wheelDelta?t=e.wheelDelta/(40*o.wheelPrecision):e.detail&&(t=-e.detail/o.wheelPrecision),t&&(o.inertialRadiusOffset+=t),e.preventDefault&&(r||e.preventDefault())},this._onKeyDown=function(e){if(-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){var t=o._keys.indexOf(e.keyCode);-1===t&&o._keys.push(e.keyCode),e.preventDefault&&(r||e.preventDefault())}},this._onKeyUp=function(e){if(-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){\n    9: var t=o._keys.indexOf(e.keyCode);t>=0&&o._keys.splice(t,1),e.preventDefault&&(r||e.preventDefault())}},this._onLostFocus=function(){o._keys=[],a.empty(),s=0,n=null},this._onGestureStart=function(e){void 0!==window.MSGesture&&(o._MSGestureHandler||(o._MSGestureHandler=new MSGesture,o._MSGestureHandler.target=i),o._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){o.radius*=e.scale,e.preventDefault&&(r||(e.stopPropagation(),e.preventDefault()))},this._reset=function(){o._keys=[],o.inertialAlphaOffset=0,o.inertialBetaOffset=0,o.inertialRadiusOffset=0,a.empty(),s=0,n=null}),i.addEventListener(t+\"down\",this._onPointerDown,!1),i.addEventListener(t+\"up\",this._onPointerUp,!1),i.addEventListener(t+\"out\",this._onPointerUp,!1),i.addEventListener(t+\"move\",this._onPointerMove,!1),i.addEventListener(\"mousemove\",this._onMouseMove,!1),i.addEventListener(\"MSPointerDown\",this._onGestureStart,!1),i.addEventListener(\"MSGestureChange\",this._onGesture,!1),i.addEventListener(\"mousewheel\",this._wheel,!1),i.addEventListener(\"DOMMouseScroll\",this._wheel,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}])}},r.prototype.detachControl=function(i){this._attachedElement===i&&(i.removeEventListener(t+\"down\",this._onPointerDown),i.removeEventListener(t+\"up\",this._onPointerUp),i.removeEventListener(t+\"out\",this._onPointerUp),i.removeEventListener(t+\"move\",this._onPointerMove),i.removeEventListener(\"mousemove\",this._onMouseMove),i.removeEventListener(\"MSPointerDown\",this._onGestureStart),i.removeEventListener(\"MSGestureChange\",this._onGesture),i.removeEventListener(\"mousewheel\",this._wheel),i.removeEventListener(\"DOMMouseScroll\",this._wheel),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp},{name:\"blur\",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},r.prototype._checkInputs=function(){if(!this._collisionTriggered){for(var t=0;t<this._keys.length;t++){var r=this._keys[t];-1!==this.keysLeft.indexOf(r)?this.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(r)?this.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(r)?this.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(r)&&(this.inertialBetaOffset+=.01)}(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Engine.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Engine.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<e.Engine.Epsilon&&(this.inertialRadiusOffset=0)),this._checkLimits(),i.prototype._checkInputs.call(this)}},r.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},r.prototype.setPosition=function(e){var t=e.subtract(this._getTargetPosition());this.radius=t.length(),this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2))),t.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(t.y/this.radius),this._checkLimits()},r.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),r=Math.cos(this.beta),n=Math.sin(this.beta),o=this._getTargetPosition();if(o.addToRef(new e.Vector3(this.radius*t*n,this.radius*r,this.radius*i*n),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;if(this.allowUpsideDown&&this.beta<0){var s=s.clone();s=s.negate()}e.Matrix.LookAtLHToRef(this.position,o,s,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._viewMatrix},r.prototype.zoomOn=function(t){t=t||this.getScene().meshes;var i=e.Mesh.MinMax(t),r=e.Vector3.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r})},r.prototype.focusOn=function(t){var i,r;void 0===t.min?(i=t||this.getScene().meshes,i=e.Mesh.MinMax(i),r=e.Vector3.Distance(i.min,i.max)):(i=t,r=t.distance),this.target=e.Mesh.Center(i),this.maxZ=2*r},r.prototype.createRigCamera=function(t,i){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var n=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);return new r(t,this.alpha+n,this.beta,this.radius,this.target,this.getScene())}},r.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var t=this._rigCameras[0],r=this._rigCameras[1];t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.beta=r.beta=this.beta,t.radius=r.radius=this.radius}i.prototype._updateRigCameras.call(this)},r}(e.Camera);e.ArcRotateCamera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,r){var n=this;t.call(this,e,i,r),this._offsetX=null,this._offsetY=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0,this.angularSensibility=1e4,this.moveSensibility=50,window.addEventListener(\"resize\",function(){n._initialOrientationGamma=null},!1)}return __extends(i,t),i.prototype.attachControl=function(e,t){var i=this;this._attachedCanvas||(this._attachedCanvas=e,this._orientationChanged||(this._orientationChanged=function(e){i._initialOrientationGamma||(i._initialOrientationGamma=e.gamma,i._initialOrientationBeta=e.beta),i._orientationGamma=e.gamma,i._orientationBeta=e.beta,i._offsetY=i._initialOrientationBeta-i._orientationBeta,i._offsetX=i._initialOrientationGamma-i._orientationGamma}),window.addEventListener(\"deviceorientation\",this._orientationChanged))},i.prototype.detachControl=function(e){this._attachedCanvas==e&&(window.removeEventListener(\"deviceorientation\",this._orientationChanged),this._attachedCanvas=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0)},i.prototype._checkInputs=function(){if(this._offsetX){this.cameraRotation.y-=this._offsetX/this.angularSensibility;var i=this._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,this._cameraRotationMatrix)),t.prototype._checkInputs.call(this)}},i}(e.FreeCamera);e.DeviceOrientationCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){var t=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported=\"GamepadEvent\"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this.buttonADataURL=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=\",this._callbackGamepadConnected=e,this.gamepadSupportAvailable?(this.gamepadEventSupported?(window.addEventListener(\"gamepadconnected\",function(e){t._onGamepadConnected(e)},!1),window.addEventListener(\"gamepaddisconnected\",function(e){t._onGamepadDisconnected(e)},!1)):this._startMonitoringGamepads(),this.oneGamepadConnected||this._insertGamepadDOMInstructions()):this._insertGamepadDOMNotSupported()}return e.prototype._insertGamepadDOMInstructions=function(){e.gamepadDOMInfo=document.createElement(\"div\");var t=document.createElement(\"img\");t.src=this.buttonADataURL;var i=document.createElement(\"span\");i.innerHTML=\"<strong>to activate gamepad</strong>\",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.appendChild(i),e.gamepadDOMInfo.style.position=\"absolute\",e.gamepadDOMInfo.style.width=\"100%\",e.gamepadDOMInfo.style.height=\"48px\",e.gamepadDOMInfo.style.bottom=\"0px\",e.gamepadDOMInfo.style.backgroundColor=\"rgba(1, 1, 1, 0.15)\",e.gamepadDOMInfo.style.textAlign=\"center\",e.gamepadDOMInfo.style.zIndex=\"10\",t.style.position=\"relative\",t.style.bottom=\"8px\",i.style.position=\"relative\",i.style.fontSize=\"32px\",i.style.bottom=\"32px\",i.style.color=\"green\",document.body.appendChild(e.gamepadDOMInfo)},e.prototype._insertGamepadDOMNotSupported=function(){e.gamepadDOMInfo=document.createElement(\"div\");var t=document.createElement(\"span\");t.innerHTML=\"<strong>gamepad not supported</strong>\",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.style.position=\"absolute\",e.gamepadDOMInfo.style.width=\"100%\",e.gamepadDOMInfo.style.height=\"40px\",e.gamepadDOMInfo.style.bottom=\"0px\",e.gamepadDOMInfo.style.backgroundColor=\"rgba(1, 1, 1, 0.15)\",e.gamepadDOMInfo.style.textAlign=\"center\",e.gamepadDOMInfo.style.zIndex=\"10\",t.style.position=\"relative\",t.style.fontSize=\"32px\",t.style.color=\"red\",document.body.appendChild(e.gamepadDOMInfo)},e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo)},e.prototype._onGamepadConnected=function(e){var t=this._addNewGamepad(e.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t),this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(t){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var i;return i=-1!==t.id.search(\"Xbox 360\")||-1!==t.id.search(\"xinput\")?new a(t.id,t.index,t):new n(t.id,t.index,t),this.babylonGamepads.push(i),i},e.prototype._onGamepadDisconnected=function(e){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==e.gamepad.index){this.babylonGamepads.splice(t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){e._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){e._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){e._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(e[t].index in this.babylonGamepads)this.babylonGamepads[t].browserGamepad=e[t];else{var i=this._addNewGamepad(e[t]);this._callbackGamepadConnected&&this._callbackGamepadConnected(i)}},e}();e.Gamepads=t;var i=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=i;var r=function(){function e(e,t,i){this.id=e,this.index=t,this.browserGamepad=i,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,\"leftStick\",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"rightStick\",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},e}();e.Gamepad=r;var n=function(e){function t(t,i,r){e.call(this,t,i,r),this.id=t,this.index=i,this.gamepad=r,this._buttons=new Array(r.buttons.length)}return __extends(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(r);e.GenericPad=n,function(e){e[e.A=0]=\"A\",e[e.B=1]=\"B\",e[e.X=2]=\"X\",e[e.Y=3]=\"Y\",e[e.Start=4]=\"Start\",e[e.Back=5]=\"Back\",e[e.LB=6]=\"LB\",e[e.RB=7]=\"RB\",e[e.LeftStick=8]=\"LeftStick\",e[e.RightStick=9]=\"RightStick\"}(e.Xbox360Button||(e.Xbox360Button={}));var o=e.Xbox360Button;!function(e){e[e.Up=0]=\"Up\",e[e.Down=1]=\"Down\",e[e.Left=2]=\"Left\",e[e.Right=3]=\"Right\"}(e.Xbox360Dpad||(e.Xbox360Dpad={}));var s=e.Xbox360Dpad,a=function(e){function t(){e.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return __extends(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,\"leftTrigger\",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"rightTrigger\",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(this._ondpaddown&&1===e&&this._ondpaddown(i),this._ondpadup&&0===e&&this._ondpadup(i)),e},Object.defineProperty(t.prototype,\"buttonA\",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,o.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonB\",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,o.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonX\",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,o.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonY\",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,o.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonStart\",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,o.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonBack\",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,o.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonLB\",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,o.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonRB\",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,o.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonLeftStick\",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,o.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"buttonRightStick\",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,o.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadUp\",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,s.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadDown\",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,s.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadLeft\",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,s.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"dPadRight\",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,s.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t}(r);e.Xbox360Pad=a}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){var o=this;t.call(this,i,r,n),this.angularSensibility=200,this.moveSensibility=75,this._gamepads=new e.Gamepads(function(e){o._onNewGameConnected(e)})}return __extends(i,t),i.prototype._onNewGameConnected=function(e){0===e.index&&(this._gamepad=e)},i.prototype._checkInputs=function(){if(this._gamepad){var i=this._gamepad.leftStick,r=i.x/this.moveSensibility,n=i.y/this.moveSensibility;i.x=Math.abs(r)>.005?0+r:0,i.y=Math.abs(n)>.005?0+n:0;var o=this._gamepad.rightStick,s=o.x/this.angularSensibility,a=o.y/this.angularSensibility;o.x=Math.abs(s)>.001?0+s:0,o.y=Math.abs(a)>.001?0+a:0;var h=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),c=50*this._computeLocalCameraSpeed(),l=e.Vector3.TransformCoordinates(new e.Vector3(i.x*c,0,-i.y*c),h);this.cameraDirection=this.cameraDirection.add(l),this.cameraRotation=this.cameraRotation.add(new e.Vector2(o.y,o.x))}t.prototype._checkInputs.call(this)},i.prototype.dispose=function(){this._gamepads.dispose(),t.prototype.dispose.call(this)},i}(e.FreeCamera);e.GamepadCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._scene=e}return t.prototype._renderParticles=function(t,i){if(0!==this._scene._activeParticleSystems.length){for(var r=e.Tools.Now,n=0;n<this._scene._activeParticleSystems.length;n++){var o=this._scene._activeParticleSystems.data[n];o.renderingGroupId===t&&(this._clearDepthBuffer(),o.emitter.position&&i&&-1===i.indexOf(o.emitter)||(this._scene._activeParticles+=o.render()))}this._scene._particlesDuration+=e.Tools.Now-r}},t.prototype._renderSprites=function(t){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var i=e.Tools.Now,r=0;r<this._scene.spriteManagers.length;r++){var n=this._scene.spriteManagers[r];n.renderingGroupId===t&&(this._clearDepthBuffer(),n.render())}this._scene._spritesDuration+=e.Tools.Now-i}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype.render=function(e,i,r,n){for(var o=0;o<t.MAX_RENDERINGGROUPS;o++){this._depthBufferAlreadyCleaned=!1;var s=this._renderingGroups[o],a=!1;s&&(this._clearDepthBuffer(),s.render(e)||(this._renderingGroups.splice(o,1),a=!0)),n&&this._renderSprites(o),r&&this._renderParticles(o,i),a&&o--}},t.prototype.reset=function(){for(var e in this._renderingGroups){var t=this._renderingGroups[e];t.prepare()}},t.prototype.dispatch=function(t){var i=t.getMesh(),r=i.renderingGroupId||0;this._renderingGroups[r]||(this._renderingGroups[r]=new e.RenderingGroup(r,this._scene)),this._renderingGroups[r].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();e.RenderingManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._scene=i}return t.prototype.render=function(t){if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return!1;var i,r,n=this._scene.getEngine();for(i=0;i<this._opaqueSubMeshes.length;i++)r=this._opaqueSubMeshes.data[i],r.render();for(n.setAlphaTesting(!0),i=0;i<this._alphaTestSubMeshes.length;i++)r=this._alphaTestSubMeshes.data[i],r.render();if(n.setAlphaTesting(!1),this._transparentSubMeshes.length){for(i=0;i<this._transparentSubMeshes.length;i++)r=this._transparentSubMeshes.data[i],r._alphaIndex=r.getMesh().alphaIndex,r._distanceToCamera=r.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length();var o=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(o.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),n.setAlphaMode(e.Engine.ALPHA_COMBINE),i=0;i<o.length;i++)r=o[i],r.render();n.setAlphaMode(e.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(e){var t=e.getMaterial(),i=e.getMesh();t.needAlphaBlending()||i.visibility<1||i.hasVertexAlpha?this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},t}();e.RenderingGroup=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i){this.autoClear=!0,this.clearColor=new e.Color3(.2,.2,.3),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this.forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.cameraToUseForPointers=null,this.fogEnabled=!0,this.fogMode=t.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.shadowsEnabled=!0,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new e.StandardMaterial(\"default material\",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.skeletonsEnabled=!0,this.skeletons=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArray(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=0,this._activeIndices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._toBeDisposed=new e.SmartArray(256),this._onReadyCallbacks=new Array,this._pendingData=[],this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArray(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArray(32),this._activeBones=0,\n   10  this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._uniqueIdCounter=0,this._engine=i,i.scenes.push(this),this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),this.postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new e.BoundingBoxRenderer(this),this._outlineRenderer=new e.OutlineRenderer(this),this.attachControl(),this._debugLayer=new e.DebugLayer(this),this.mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0}),this.simplificationQueue=new e.SimplificationQueue,this.workerCollisions=!1}return Object.defineProperty(t,\"FOGMODE_NONE\",{get:function(){return t._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_EXP\",{get:function(){return t._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_EXP2\",{get:function(){return t._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"FOGMODE_LINEAR\",{get:function(){return t._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"debugLayer\",{get:function(){return this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"workerCollisions\",{get:function(){return this._workerCollisions},set:function(t){t=t&&!!Worker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"meshUnderPointer\",{get:function(){return this._meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"pointerX\",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"pointerY\",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},t.prototype.getOutlineRenderer=function(){return this._outlineRenderer},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices},t.prototype.getActiveIndices=function(){return this._activeIndices},t.prototype.getActiveParticles=function(){return this._activeParticles},t.prototype.getActiveBones=function(){return this._activeBones},t.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},t.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},t.prototype.getRenderDuration=function(){return this._renderDuration},t.prototype.getParticlesDuration=function(){return this._particlesDuration},t.prototype.getSpritesDuration=function(){return this._spritesDuration},t.prototype.getAnimationRatio=function(){return this._animationRatio},t.prototype.getRenderId=function(){return this._renderId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},t.prototype.attachControl=function(){var t=this;this._onPointerMove=function(e){var i=t._engine.getRenderingCanvas();t._updatePointerPosition(e);var r=t.pick(t._pointerX,t._pointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPointerTriggers},!1,t.cameraToUseForPointers);r.hit?(t._meshUnderPointer=r.pickedMesh,t.setPointerOverMesh(r.pickedMesh),i.style.cursor=\"pointer\"):(t.setPointerOverMesh(null),i.style.cursor=\"\",t._meshUnderPointer=null)},this._onPointerDown=function(i){var r=null;t.onPointerDown||(r=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPickTriggers}),t._updatePointerPosition(i);var n=t.pick(t._pointerX,t._pointerY,r,!1,t.cameraToUseForPointers);if(n.hit&&n.pickedMesh.actionManager){switch(i.button){case 0:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i));break;case 1:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i));break;case 2:n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i))}n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i))}t.onPointerDown&&t.onPointerDown(i,n)},this._onPointerUp=function(i){var r=null;t.onPointerUp||(r=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnPickUpTrigger)}),t._updatePointerPosition(i);var n=t.pick(t._pointerX,t._pointerY,r,!1,t.cameraToUseForPointers);n.hit&&n.pickedMesh.actionManager&&n.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(n.pickedMesh,i)),t.onPointerUp&&t.onPointerUp(i,n)},this._onKeyDown=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(t,i))},this._onKeyUp=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(t,i))};var i=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().addEventListener(i+\"move\",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener(i+\"down\",this._onPointerDown,!1),this._engine.getRenderingCanvas().addEventListener(i+\"up\",this._onPointerUp,!1),e.Tools.RegisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp}])},t.prototype.detachControl=function(){var t=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+\"move\",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(t+\"down\",this._onPointerDown),this._engine.getRenderingCanvas().removeEventListener(t+\"up\",this._onPointerUp),e.Tools.UnregisterTopRootEvents([{name:\"keydown\",handler:this._onKeyDown},{name:\"keyup\",handler:this._onKeyUp}])},t.prototype.isReady=function(){if(this._pendingData.length>0)return!1;for(var t=0;t<this._geometries.length;t++){var i=this._geometries[t];if(i.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var r=this.meshes[t];if(!r.isReady())return!1;var n=r.material;if(n&&!n.isReady(r))return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null},t.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},t.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},t.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},t.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this._pendingData.indexOf(e);-1!==t&&this._pendingData.splice(t,1)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},t.prototype.executeWhenReady=function(e){var t=this;this._onReadyCallbacks.push(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype._checkIsReady=function(){var e=this;return this.isReady()?(this._onReadyCallbacks.forEach(function(e){e()}),this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},t.prototype.beginAnimation=function(t,i,r,n,o,s,a){if(void 0===o&&(o=1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,i,r,n,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),c=0;c<h.length;c++)this.beginAnimation(h[c],i,r,n,o,s,a);return a},t.prototype.beginDirectAnimation=function(t,i,r,n,o,s,a){void 0===s&&(s=1);var h=new e.Animatable(this,t,r,n,o,s,a,i);return h},t.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},t.prototype.stopAnimation=function(e){var t=this.getAnimatableByTarget(e);t&&t.stop()},t.prototype._animate=function(){if(this.animationsEnabled){this._animationStartDate||(this._animationStartDate=e.Tools.Now);for(var t=e.Tools.Now,i=t-this._animationStartDate,r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r]._animate(i)}},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},t.prototype.addMesh=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.meshes.push(e);this.collisionCoordinator.onMeshAdded(e),this.onNewMeshAdded&&this.onNewMeshAdded(e,t,this)},t.prototype.removeMesh=function(e){var t=this.meshes.indexOf(e);return-1!==t&&this.meshes.splice(t,1),this.collisionCoordinator.onMeshRemoved(e),this.onMeshRemoved&&this.onMeshRemoved(e),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);return-1!==t&&this.lights.splice(t,1),this.onLightRemoved&&this.onLightRemoved(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(this.activeCamera=this.cameras.length>0?this.cameras[0]:null),this.onCameraRemoved&&this.onCameraRemoved(e),t},t.prototype.addLight=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.lights.push(e);this.onNewLightAdded&&this.onNewLightAdded(e,t,this)},t.prototype.addCamera=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.cameras.push(e);this.onNewCameraAdded&&this.onNewCameraAdded(e,t,this)},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!t&&this.getGeometryByID(e.id)?!1:(this._geometries.push(e),this.collisionCoordinator.onGeometryAdded(e),this.onGeometryAdded&&this.onGeometryAdded(e),!0)},t.prototype.removeGeometry=function(e){var t=this._geometries.indexOf(e);return t>-1?(this._geometries.splice(t,1),this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemoved&&this.onGeometryRemoved(e),!0):!1},t.prototype.getGeometries=function(){return this._geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getLightByName(e);return i?i:this.getCameraByName(e)},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getSoundByName=function(e){for(var t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];for(var i=0;i<this.soundTracks.length;i++)for(t=0;t<this.soundTracks[i].soundCollection.length;t++)if(this.soundTracks[i].soundCollection[t].name===e)return this.soundTracks[i].soundCollection[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype._evaluateSubMesh=function(e,t){if(t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var i=e.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concat(i.getRenderTargetTextures())),this._activeIndices+=e.indexCount,this._renderingManager.dispatch(e))}},t.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._boundingBoxRenderer.reset(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix);var t,i;if(this._selectionOctree){var r=this._selectionOctree.select(this._frustumPlanes);t=r.data,i=r.length}else i=this.meshes.length,t=this.meshes;for(var n=0;i>n;n++){var o=t[n];if(!o.isBlocked&&(this._totalVertices+=o.getTotalVertices(),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);s&&(o._preActivate(),(o.alwaysSelectAsActiveMesh||o.isVisible&&o.visibility>0&&0!==(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),this._activeMesh(s)))}}var a=e.Tools.Now;if(this.particlesEnabled){e.Tools.StartPerformanceCounter(\"Particles\",this.particleSystems.length>0);for(var h=0;h<this.particleSystems.length;h++){var c=this.particleSystems[h];c.isStarted()&&(!c.emitter.position||c.emitter&&c.emitter.isEnabled())&&(this._activeParticleSystems.push(c),c.animate())}e.Tools.EndPerformanceCounter(\"Particles\",this.particleSystems.length>0)}this._particlesDuration+=e.Tools.Now-a},t.prototype._activeMesh=function(e){if(e.skeleton&&this.skeletonsEnabled&&this._activeSkeletons.pushNoDuplicate(e.skeleton),(e.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),e&&e.subMeshes){var t,i;if(e._submeshesOctree&&e.useOctreeForRenderingSelection){var r=e._submeshesOctree.select(this._frustumPlanes);t=r.length,i=r.data}else i=e.subMeshes,t=i.length;for(var n=0;t>n;n++){var o=i[n];this._evaluateSubMesh(o,e)}}},t.prototype.updateTransformMatrix=function(e){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._renderForCamera=function(t){var i=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error(\"Active camera not set\");e.Tools.StartPerformanceCounter(\"Rendering camera \"+this.activeCamera.name),i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera);var r=e.Tools.Now;e.Tools.StartPerformanceCounter(\"Active meshes evaluation\"),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=e.Tools.Now-r,e.Tools.EndPerformanceCounter(\"Active meshes evaluation\");for(var n=0;n<this._activeSkeletons.length;n++){var o=this._activeSkeletons.data[n];o.prepare()}var s=e.Tools.Now;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter(\"Render targets\",this._renderTargets.length>0);for(var a=0;a<this._renderTargets.length;a++){var h=this._renderTargets.data[a];if(h._shouldRender()){this._renderId++;var c=h.activeCamera&&h.activeCamera!==this.activeCamera;h.render(c,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter(\"Render targets\",this._renderTargets.length>0),this._renderId++}this._renderTargets.length>0&&i.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-s,this.postProcessManager._prepareFrame();var l=e.Tools.Now;if(this.layers.length){i.setDepthBuffer(!1);var u,f;for(u=0;u<this.layers.length;u++)f=this.layers[u],f.isBackground&&f.render();i.setDepthBuffer(!0)}if(e.Tools.StartPerformanceCounter(\"Main render\"),this._renderingManager.render(null,null,!0,!0),e.Tools.EndPerformanceCounter(\"Main render\"),this._boundingBoxRenderer.render(),this.lensFlaresEnabled){e.Tools.StartPerformanceCounter(\"Lens flares\",this.lensFlareSystems.length>0);for(var d=0;d<this.lensFlareSystems.length;d++)this.lensFlareSystems[d].render();e.Tools.EndPerformanceCounter(\"Lens flares\",this.lensFlareSystems.length>0)}if(this.layers.length){for(i.setDepthBuffer(!1),u=0;u<this.layers.length;u++)f=this.layers[u],f.isBackground||f.render();i.setDepthBuffer(!0)}this._renderDuration+=e.Tools.Now-l,this.postProcessManager._finalizeFrame(t.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.afterCameraRender&&this.afterCameraRender(this.activeCamera),e.Tools.EndPerformanceCounter(\"Rendering camera \"+this.activeCamera.name)},t.prototype._processSubCameras=function(t){if(t.cameraRigMode===e.Camera.RIG_MODE_NONE)return void this._renderForCamera(t);for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i]);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},t.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++)for(var i=this._meshesForIntersections.data[t],r=0;r<i.actionManager.actions.length;r++){var n=i.actionManager.actions[r];if(n.trigger===e.ActionManager.OnIntersectionEnterTrigger||n.trigger===e.ActionManager.OnIntersectionExitTrigger){var o=n.getTriggerParameter(),s=o instanceof e.AbstractMesh?o:o.mesh,a=s.intersectsMesh(i,o.usePreciseIntersection),h=i._intersectionsInProgress.indexOf(s);a&&-1===h?n.trigger===e.ActionManager.OnIntersectionEnterTrigger?(n._executeCurrent(e.ActionEvent.CreateNew(i)),i._intersectionsInProgress.push(s)):n.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._intersectionsInProgress.push(s):!a&&h>-1&&(n.trigger===e.ActionManager.OnIntersectionExitTrigger&&n._executeCurrent(e.ActionEvent.CreateNew(i)),i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger)&&n.trigger!==e.ActionManager.OnIntersectionExitTrigger||i._intersectionsInProgress.splice(h,1))}}},t.prototype.render=function(){var i=e.Tools.Now;this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this.getEngine().resetDrawCalls(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),e.Tools.StartPerformanceCounter(\"Scene rendering\"),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger,null),this.simplificationQueue.running||this.simplificationQueue.executeNext(),this.beforeRender&&this.beforeRender();for(var r=0;r<this._onBeforeRenderCallbacks.length;r++)this._onBeforeRenderCallbacks[r]();var n=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*n,this._animate(),this._physicsEngine&&(e.Tools.StartPerformanceCounter(\"Physics\"),this._physicsEngine._runOneStep(n/1e3),e.Tools.EndPerformanceCounter(\"Physics\"));var o=e.Tools.Now,s=this.getEngine(),a=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter(\"Custom render targets\",this.customRenderTargets.length>0);for(var h=0;h<this.customRenderTargets.length;h++){var c=this.customRenderTargets[h];if(c._shouldRender()){if(this._renderId++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error(\"Active camera not set\");s.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter(\"Custom render targets\",this.customRenderTargets.length>0),this._renderId++}if(this.customRenderTargets.length>0&&s.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-o,this.activeCamera=a,this.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter(\"Procedural textures\",this._proceduralTextures.length>0);for(var l=0;l<this._proceduralTextures.length;l++){var u=this._proceduralTextures[l];u._shouldRender()&&u.render()}e.Tools.EndPerformanceCounter(\"Procedural textures\",this._proceduralTextures.length>0)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var f=0;f<this.lights.length;f++){var d=this.lights[f],p=d.getShadowGenerator();d.isEnabled()&&p&&-1!==p.getShadowMap().getScene().textures.indexOf(p.getShadowMap())&&this._renderTargets.push(p.getShadowMap())}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var m=this._renderId,g=0;g<this.activeCameras.length;g++)this._renderId=m,this._processSubCameras(this.activeCameras[g]);else{if(!this.activeCamera)throw new Error(\"No camera defined\");this._processSubCameras(this.activeCamera)}for(this._checkIntersections(),this._updateAudioParameters(),this.afterRender&&this.afterRender(),r=0;r<this._onAfterRenderCallbacks.length;r++)this._onAfterRenderCallbacks[r]();for(var _=0;_<this._toBeDisposed.length;_++)this._toBeDisposed.data[_].dispose(),this._toBeDisposed[_]=null;this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),e.Tools.EndPerformanceCounter(\"Scene rendering\"),this._lastFrameDuration=e.Tools.Now-i},t.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||0!==this.soundTracks.length)){var t,i=e.Engine.audioEngine;if(t=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera,t&&i.canUseWebAudio){i.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z);var r=e.Matrix.Invert(t.getViewMatrix()),n=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),r);n.normalize(),i.audioContext.listener.setOrientation(n.x,n.y,n.z,0,1,0);for(var o=0;o<this.mainSoundTrack.soundCollection.length;o++){var s=this.mainSoundTrack.soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}for(o=0;o<this.soundTracks.length;o++)for(var a=0;a<this.soundTracks[o].soundCollection.length;a++)s=this.soundTracks[o].soundCollection[a],s.useCustomAttenuation&&s.updateDistanceFromListener()}}},Object.defineProperty(t.prototype,\"audioEnabled\",{get:function(){return this._audioEnabled},set:function(e){this._audioEnabled=e,this._audioEnabled?this._enableAudio():this._disableAudio()},enumerable:!0,configurable:!0}),t.prototype._disableAudio=function(){for(var e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].pause();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].pause()},t.prototype._enableAudio=function(){for(var e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].isPaused&&this.mainSoundTrack.soundCollection[e].play();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].isPaused&&this.soundTracks[e].soundCollection[t].play()},Object.defineProperty(t.prototype,\"headphone\",{get:function(){return this._headphone},set:function(e){this._headphone=e,this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),t.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToHRTF()},t.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToEqualPower()},t.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new e.DepthRenderer(this),this._depthRenderer)},t.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this._depthRenderer&&this._depthRenderer.dispose(),this.debugLayer.hide(),this.onDispose&&this.onDispose(),this._onBeforeRenderCallbacks=[],this._onAfterRenderCallbacks=[],this.detachControl(),this.disposeSounds();var e,t=this._engine.getRenderingCanvas();for(e=0;e<this.cameras.length;e++)this.cameras[e].detachControl(t);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),e=this._engine.scenes.indexOf(this),e>-1&&this._engine.scenes.splice(e,1),this._engine.wipeCaches()},t.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].dispose()},t.prototype.getWorldExtends=function(){for(var t=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=0;r<this.meshes.length;r++){var n=this.meshes[r];n.computeWorldMatrix(!0);var o=n.getBoundingInfo().boundingBox.minimumWorld,s=n.getBoundingInfo().boundingBox.maximumWorld;e.Tools.CheckExtends(o,t,i),e.Tools.CheckExtends(s,t,i)}return{min:t,max:i}},t.prototype.createOrUpdateSelectionOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,i));var r=this.getWorldExtends();return this._selectionOctree.update(r.min,r.max,this.meshes),this._selectionOctree},t.prototype.createPickingRay=function(t,i,r,n){var o=this._engine;if(!n){if(!this.activeCamera)throw new Error(\"Active camera not set\");n=this.activeCamera}var s=n.viewport,a=s.toGlobal(o);return t=t/this._engine.getHardwareScalingLevel()-a.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-a.y-a.height),e.Ray.CreateNew(t,i,a.width,a.height,r?r:e.Matrix.Identity(),n.getViewMatrix(),n.getProjectionMatrix())},t.prototype._internalPick=function(t,i,r){for(var n=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(i){if(!i(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),h=t(a),c=s.intersects(h,r);if(c&&c.hit&&(r||null==n||!(c.distance>=n.distance))&&(n=c,r))break}return n||new e.PickingInfo},t.prototype.pick=function(e,t,i,r,n){var o=this;return this._internalPick(function(i){return o.createPickingRay(e,t,i,n)},i,r)},t.prototype.pickWithRay=function(t,i,r){var n=this;return this._internalPick(function(i){return n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(n._pickWithRayInverseMatrix),e.Ray.Transform(t,n._pickWithRayInverseMatrix)},i,r)},t.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},t.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},t.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.prototype.enablePhysics=function(t,i){return this._physicsEngine?!0:(this._physicsEngine=new e.PhysicsEngine(i),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(t),!0):(this._physicsEngine=null,!1))},t.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},t.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},t.prototype.setGravity=function(e){this._physicsEngine&&this._physicsEngine._setGravity(e)},t.prototype.createCompoundImpostor=function(e,t){if(e.parts&&(t=e,e=e.parts),!this._physicsEngine)return null;for(var i=0;i<e.length;i++){var r=e[i].mesh;r._physicImpostor=e[i].impostor,r._physicsMass=t.mass/e.length,r._physicsFriction=t.friction,r._physicRestitution=t.restitution}return this._physicsEngine._registerMeshesAsCompound(e,t)},t.prototype.deleteCompoundImpostor=function(t){for(var i=0;i<t.parts.length;i++){var r=t.parts[i].mesh;r._physicImpostor=e.PhysicsEngine.NoImpostor,this._physicsEngine._unregisterMesh(r)}},t.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new e.HemisphericLight(\"default light\",e.Vector3.Up(),this),\n   11  !this.activeCamera){var t=new e.FreeCamera(\"default camera\",e.Vector3.Zero(),this),i=this.getWorldExtends(),r=i.min.add(i.max.subtract(i.min).scale(.5));t.position=new e.Vector3(r.x,r.y,i.min.z-(i.max.z-i.min.z)),t.setTarget(r),this.activeCamera=t}},t.prototype._getByTags=function(t,i,r){if(void 0===i)return t;var n=[];r=r||function(e){};for(var o in t){var s=t[o];e.Tags.MatchesQuery(s,i)&&(n.push(s),r(s))}return n},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t._FOGMODE_NONE=0,t._FOGMODE_EXP=1,t._FOGMODE_EXP2=2,t._FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}();e.Scene=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,r,n,o,s,a){if(this._engine=i instanceof e.Mesh?i.getScene().getEngine():i,this._updatable=o,this._data=r,s||this.create(),this._kind=n,a)return void(this._strideSize=a);switch(n){case t.PositionKind:this._strideSize=3;break;case t.NormalKind:this._strideSize=3;break;case t.UVKind:this._strideSize=2;break;case t.UV2Kind:this._strideSize=2;break;case t.ColorKind:this._strideSize=4;break;case t.MatricesIndicesKind:this._strideSize=4;break;case t.MatricesWeightsKind:this._strideSize=4}}return t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.create=function(e){(e||!this._buffer)&&(e=e||this._data,this._buffer||(this._buffer=this._updatable?this._engine.createDynamicVertexBuffer(4*e.length):this._engine.createVertexBuffer(e)),this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e))},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,t),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Object.defineProperty(t,\"PositionKind\",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"NormalKind\",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"UVKind\",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"UV2Kind\",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"ColorKind\",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"MatricesIndicesKind\",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,\"MatricesWeightsKind\",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),t._PositionKind=\"position\",t._NormalKind=\"normal\",t._UVKind=\"uv\",t._UV2Kind=\"uv2\",t._ColorKind=\"color\",t._MatricesIndicesKind=\"matricesIndices\",t._MatricesWeightsKind=\"matricesWeights\",t}();e.VertexBuffer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i.getScene()),i.instances.push(this),this._sourceMesh=i,this.position.copyFrom(i.position),this.rotation.copyFrom(i.rotation),this.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(this.rotationQuaternion=i.rotationQuaternion.clone()),this.infiniteDistance=i.infiniteDistance,this.setPivotMatrix(i.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return __extends(i,t),Object.defineProperty(i.prototype,\"receiveShadows\",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"visibility\",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"skeleton\",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,\"sourceMesh\",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(e){return this._sourceMesh.getVerticesData(e)},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,\"_positions\",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this._sourceMesh.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}this._updateBoundingInfo()},i.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},i.prototype._activate=function(e){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e)},i.prototype.getLOD=function(e){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh)},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,r){var n=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,n,[\"name\"],[]),this.refreshBoundingInfo(),i&&(n.parent=i),!r)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent===this&&s.clone(s.name,n)}return n.computeWorldMatrix(!0),n},i.prototype.dispose=function(e){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1),t.prototype.dispose.call(this,e)},i}(e.AbstractMesh);e.InstancedMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var i=function(i){function r(n,o,s,a,h){if(void 0===s&&(s=null),i.call(this,n,o),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._LODLevels=new Array,this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new t,this._instancesBufferSize=2048,this._sideOrientation=r._DEFAULTSIDE,this._areNormalsFrozen=!1,a){if(a._geometry&&a._geometry.applyToMesh(this),e.Tools.DeepCopy(a,this,[\"name\",\"material\",\"skeleton\",\"instances\"],[]),this.material=a.material,!h)for(var c=0;c<o.meshes.length;c++){var l=o.meshes[c];if(l.parent===a){l.clone(n+\".\"+l.name,this,h)}}for(c=0;c<o.particleSystems.length;c++){var u=o.particleSystems[c];u.emitter===a&&u.clone(u.name,this)}this.computeWorldMatrix(!0)}null!==s&&(this.parent=s)}return __extends(r,i),Object.defineProperty(r,\"FRONTSIDE\",{get:function(){return r._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"BACKSIDE\",{get:function(){return r._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"DOUBLESIDE\",{get:function(){return r._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"DEFAULTSIDE\",{get:function(){return r._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"NO_CAP\",{get:function(){return r._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_START\",{get:function(){return r._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_END\",{get:function(){return r._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"CAP_ALL\",{get:function(){return r._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"hasLODLevels\",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),r.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},r.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return e.Tools.Warn(\"You cannot use a mesh as LOD level twice\"),this;var r=new e.Internals.MeshLODLevel(t,i);return this._LODLevels.push(r),i&&(i._masterMesh=this),this._sortLODLevels(),this},r.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var i=this._LODLevels[t];if(i.distance===e)return i.mesh}return null},r.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},r.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var i=(t?t:this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.position).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var r=0;r<this._LODLevels.length;r++){var n=this._LODLevels[r];if(n.distance<i)return n.mesh&&(n.mesh._preActivate(),n.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,n.mesh),n.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(r.prototype,\"geometry\",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},r.prototype.getVerticesData=function(e,t){return this._geometry?this._geometry.getVerticesData(e,t):null},r.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):void 0},r.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},r.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=[];if(this._delayInfo)for(var t in this._delayInfo)e.push(t);return e}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(e){return this._geometry?this._geometry.getIndices(e):[]},Object.defineProperty(r.prototype,\"isBlocked\",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),r.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isReady.call(this)},r.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(r.prototype,\"sideOrientation\",{get:function(){return this._sideOrientation},set:function(e){this._sideOrientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,\"areNormalsFrozen\",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),r.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},r.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},r.prototype._preActivate=function(){var e=this.getScene().getRenderId();this._preActivateId!==e&&(this._preActivateId=e,this._visibleInstances=null)},r.prototype._registerInstanceForRenderId=function(e,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e)},r.prototype.refreshBoundingInfo=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo();this._updateBoundingInfo()},r.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new e.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},r.prototype.subdivide=function(t){if(!(1>t)){for(var i=this.getTotalIndices(),r=i/t|0,n=0;r%3!==0;)r++;this.releaseSubMeshes();for(var o=0;t>o&&!(n>=i);o++)e.SubMesh.CreateFromIndices(0,n,Math.min(r,i-n),this),n+=r;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,r,n){if(t instanceof Array){var o=i;i=t,t=o,e.Tools.Warn(\"Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable).\")}if(this._geometry)this._geometry.setVerticesData(t,i,r,n);else{var s=new e.VertexData;s.set(i,t);var a=this.getScene();new e.Geometry(e.Geometry.RandomId(),a,s,r,this)}},r.prototype.updateVerticesData=function(e,t,i,r){this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i))},r.prototype.updateVerticesDataDirectly=function(e,t,i,r){this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(e,t,i,!1)):this._geometry.updateVerticesDataDirectly(e,t,i))},r.prototype.updateMeshPositions=function(t,i){void 0===i&&(i=!0);var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(t(r),this.updateVerticesData(e.VertexBuffer.PositionKind,r,!1,!1),i){var n=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.NormalKind);e.VertexData.ComputeNormals(r,n,o),this.updateVerticesData(e.VertexBuffer.NormalKind,o,!1,!1)}},r.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(e.Geometry.RandomId());t.applyToMesh(this)}},r.prototype.setIndices=function(t,i){if(this._geometry)this._geometry.setIndices(t,i);else{var r=new e.VertexData;r.indices=t;var n=this.getScene();new e.Geometry(e.Geometry.RandomId(),n,r,!1,this)}},r.prototype._bind=function(t,i,r){var n,o=this.getScene().getEngine();switch(r){case e.Material.PointFillMode:n=null;break;case e.Material.WireFrameFillMode:n=t.getLinesIndexBuffer(this.getIndices(),o);break;default:case e.Material.TriangleFillMode:n=this._geometry.getIndexBuffer()}o.bindMultiBuffers(this._geometry.getVertexBuffers(),n,i)},r.prototype._draw=function(t,i,r){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var n=this.getScene().getEngine();switch(i){case e.Material.PointFillMode:n.drawPointClouds(t.verticesStart,t.verticesCount,r);break;case e.Material.WireFrameFillMode:n.draw(!1,0,t.linesIndexCount,r);break;default:n.draw(!0,t.indexStart,t.indexCount,r)}}},r.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},r.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},r.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},r.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},r.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var i=t.getRenderId();this._batchCache.visibleInstances[e]=this._visibleInstances[i];var r=this._renderId;if(!this._batchCache.visibleInstances[e]&&this._visibleInstances.defaultRenderId&&(this._batchCache.visibleInstances[e]=this._visibleInstances[this._visibleInstances.defaultRenderId],i=Math.max(this._visibleInstances.defaultRenderId,i),r=Math.max(this._visibleInstances.selfDefaultRenderId,i)),this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length){if(this._renderIdForInstances[e]===i)return this._batchCache.mustReturn=!0,this._batchCache;i!==r&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},r.prototype._renderWithInstances=function(e,t,i,r,n){for(var o=i.visibleInstances[e._id],s=o.length+1,a=16*s*4;this._instancesBufferSize<a;)this._instancesBufferSize*=2;(!this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(this._worldMatricesInstancesBuffer&&n.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=n.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4));var h=0,c=0,l=this.getWorldMatrix();if(i.renderSelf[e._id]&&(l.copyToArray(this._worldMatricesInstancesArray,h),h+=16,c++),o)for(var u=0;u<o.length;u++){var f=o[u];f.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,h),h+=16,c++}var d=r.getAttributeLocationByName(\"world0\"),p=r.getAttributeLocationByName(\"world1\"),m=r.getAttributeLocationByName(\"world2\"),g=r.getAttributeLocationByName(\"world3\"),_=[d,p,m,g];n.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,_),this._draw(e,t,c),n.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,_)},r.prototype._processRendering=function(e,t,i,r,n,o){var s=this.getScene(),a=s.getEngine();if(n)this._renderWithInstances(e,i,r,t,a);else if(r.renderSelf[e._id]&&(o&&o(!1,this.getWorldMatrix()),this._draw(e,i)),r.visibleInstances[e._id])for(var h=0;h<r.visibleInstances[e._id].length;h++){var c=r.visibleInstances[e._id][h],l=c.getWorldMatrix();o&&o(!0,l),this._draw(e,i)}},r.prototype.render=function(t){var i=this.getScene(),r=this._getInstancesRenderList(t._id);if(!r.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){for(var n=0;n<this._onBeforeRenderCallbacks.length;n++)this._onBeforeRenderCallbacks[n](this);var o=i.getEngine(),s=null!==o.getCaps().instancedArrays&&null!==r.visibleInstances[t._id]&&void 0!==r.visibleInstances[t._id],a=t.getMaterial();if(a&&a.isReady(this,s)){var h=o.getDepthWrite();this.renderOutline&&(o.setDepthWrite(!1),i.getOutlineRenderer().render(t,r),o.setDepthWrite(h)),a._preBind();var c=a.getEffect(),l=i.forcePointsCloud?e.Material.PointFillMode:i.forceWireframe?e.Material.WireFrameFillMode:a.fillMode;this._bind(t,c,l);var u=this.getWorldMatrix();if(a.bind(u,this),this._processRendering(t,c,l,r,s,function(e,t){e&&a.bindOnlyWorldMatrix(t)}),a.unbind(),this.renderOutline&&h&&(o.setDepthWrite(!0),o.setColorWrite(!1),i.getOutlineRenderer().render(t,r),o.setColorWrite(!0)),this.renderOverlay){var f=o.getAlphaMode();o.setAlphaMode(e.Engine.ALPHA_COMBINE),i.getOutlineRenderer().render(t,r,!0),o.setAlphaMode(f)}for(n=0;n<this._onAfterRenderCallbacks.length;n++)this._onAfterRenderCallbacks[n](this)}}},r.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[t];i.emitter===this&&e.push(i)}return e},r.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var r=this.getScene().particleSystems[i];-1!==t.indexOf(r.emitter)&&e.push(r)}return e},r.prototype.getChildren=function(){for(var e=[],t=0;t<this.getScene().meshes.length;t++){var i=this.getScene().meshes[t];i.parent===this&&e.push(i)}return e},r.prototype._checkDelayState=function(){var t=this,i=this,r=this.getScene();if(this._geometry)this._geometry.load(r);else if(i.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,r._addPendingData(i);var n=-1!==this.delayLoadingFile.indexOf(\".babylonbinarymeshdata\");e.Tools.LoadFile(this.delayLoadingFile,function(i){i instanceof ArrayBuffer?t._delayLoadingFunction(i,t):t._delayLoadingFunction(JSON.parse(i),t),t.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._removePendingData(t)},function(){},r.database,n)}},r.prototype.isInFrustum=function(t){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isInFrustum.call(this,t)?(this._checkDelayState(),!0):!1},r.prototype.setMaterialByID=function(e){for(var t=this.getScene().materials,i=0;i<t.length;i++)if(t[i].id===e)return void(this.material=t[i]);var r=this.getScene().multiMaterials;for(i=0;i<r.length;i++)if(r[i].id===e)return void(this.material=r[i])},r.prototype.getAnimatables=function(){var e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},r.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(e.VertexBuffer.PositionKind)){this._resetPointsArrayCache();for(var i=this.getVerticesData(e.VertexBuffer.PositionKind),r=[],n=0;n<i.length;n+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(i,n),t).toArray(r,n);if(this.setVerticesData(e.VertexBuffer.PositionKind,r,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(i=this.getVerticesData(e.VertexBuffer.NormalKind),r=[],n=0;n<i.length;n+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(i,n),t).toArray(r,n);this.setVerticesData(e.VertexBuffer.NormalKind,r,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable())}}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},r.prototype.clone=function(e,t,i){return new r(e,this.getScene(),t,this,i)},r.prototype.dispose=function(e){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._worldMatricesInstancesBuffer&&(this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length;)this.instances[0].dispose();i.prototype.dispose.call(this,e)},r.prototype.applyDisplacementMap=function(t,i,r,n){var o=this,s=this.getScene(),a=function(e){var t=document.createElement(\"canvas\"),s=t.getContext(\"2d\"),a=e.width,h=e.height;t.width=a,t.height=h,s.drawImage(e,0,0);var c=s.getImageData(0,0,a,h).data;o.applyDisplacementMapFromBuffer(c,a,h,i,r),n&&n(o)};e.Tools.LoadImage(t,a,function(){},s.database)},r.prototype.applyDisplacementMapFromBuffer=function(t,i,r,n,o){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return void e.Tools.Warn(\"Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing\");for(var s=this.getVerticesData(e.VertexBuffer.PositionKind),a=this.getVerticesData(e.VertexBuffer.NormalKind),h=this.getVerticesData(e.VertexBuffer.UVKind),c=e.Vector3.Zero(),l=e.Vector3.Zero(),u=e.Vector2.Zero(),f=0;f<s.length;f+=3){e.Vector3.FromArrayToRef(s,f,c),e.Vector3.FromArrayToRef(a,f,l),e.Vector2.FromArrayToRef(h,f/3*2,u);var d=Math.abs(u.x)*i%i|0,p=Math.abs(u.y)*r%r|0,m=4*(d+p*i),g=t[m]/255,_=t[m+1]/255,v=t[m+2]/255,y=.3*g+.59*_+.11*v;l.normalize(),l.scaleInPlace(n+(o-n)*y),c=c.add(l),c.toArray(s,f)}e.VertexData.ComputeNormals(s,this.getIndices(),a),this.updateVerticesData(e.VertexBuffer.PositionKind,s),this.updateVerticesData(e.VertexBuffer.NormalKind,a)},r.prototype.convertToFlatShadedMesh=function(){for(var t=this.getVerticesDataKinds(),i=[],r=[],n=[],o=!1,s=0;s<t.length;s++){var a=t[s],h=this.getVertexBuffer(a);a!==e.VertexBuffer.NormalKind?(i[a]=h,r[a]=i[a].getData(),n[a]=[]):(o=h.isUpdatable(),t.splice(s,1),s--)}for(var c=this.subMeshes.slice(0),l=this.getIndices(),u=this.getTotalIndices(),f=0;u>f;f++){var d=l[f];for(s=0;s<t.length;s++){a=t[s];for(var p=i[a].getStrideSize(),m=0;p>m;m++)n[a].push(r[a][d*p+m])}}var g=[],_=n[e.VertexBuffer.PositionKind];for(f=0;u>f;f+=3){l[f]=f,l[f+1]=f+1,l[f+2]=f+2;for(var v=e.Vector3.FromArray(_,3*f),y=e.Vector3.FromArray(_,3*(f+1)),x=e.Vector3.FromArray(_,3*(f+2)),b=v.subtract(y),M=x.subtract(y),A=e.Vector3.Normalize(e.Vector3.Cross(b,M)),T=0;3>T;T++)g.push(A.x),g.push(A.y),g.push(A.z)}for(this.setIndices(l),this.setVerticesData(e.VertexBuffer.NormalKind,g,o),s=0;s<t.length;s++)a=t[s],this.setVerticesData(a,n[a],i[a].isUpdatable());this.releaseSubMeshes();for(var S=0;S<c.length;S++){var E=c[S];new e.SubMesh(E.materialIndex,E.indexStart,E.indexCount,E.indexStart,E.indexCount,this)}this.synchronizeInstances()},r.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){var t=this.instances[e];t._syncSubMeshes()}},r.prototype.simplify=function(t,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=e.SimplificationType.quadtreeRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:i,mesh:this,simplificationType:r,successCallback:n})},r.prototype.optimizeIndices=function(t){for(var i=this,r=this.getIndices(),n=this.getVerticesData(e.VertexBuffer.PositionKind),o=[],s=0;s<n.length;s+=3)o.push(e.Vector3.FromArray(n,s));var a=[];e.AsyncLoop.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],r=0;t>r;++r){var n=o[r];if(i.equals(n)){a[t]=r;break}}},function(){for(var e=0;e<r.length;++e)r[e]=a[r[e]]||r[e];var n=i.subMeshes.slice(0);i.setIndices(r),i.subMeshes=n,t&&t(i)})},r.CreateRibbon=function(t,i,n,o,s,a,h,c,l){if(void 0===c&&(c=r.DEFAULTSIDE),void 0===l&&(l=null),l){var u=function(e){for(var t=i[0].length,n=0,o=l.sideOrientation===r.DOUBLESIDE?2:1,s=1;o>=s;s++)for(var a=0;a<i.length;a++){var h=i[a],c=h.length;t=c>t?t:c;for(var u=0;t>u;)e[n]=h[u].x,e[n+1]=h[u].y,e[n+2]=h[u].z,u++,n+=3}},f=!l.areNormalsFrozen;return l.updateMeshPositions(u,f),l}var d=new r(t,a);d.sideOrientation=c;var p=e.VertexData.CreateRibbon(i,n,o,s,c);return p.applyToMesh(d,h),d},r.CreateDisc=function(t,i,n,o,s,a){void 0===a&&(a=r.DEFAULTSIDE);var h=new r(t,o),c=e.VertexData.CreateDisc(i,n,a);return c.applyToMesh(h,s),h},r.CreateBox=function(t,i,n,o,s){void 0===s&&(s=r.DEFAULTSIDE);var a=new r(t,n),h=e.VertexData.CreateBox(i,s);return h.applyToMesh(a,o),a},r.CreateSphere=function(t,i,n,o,s,a){void 0===a&&(a=r.DEFAULTSIDE);var h=new r(t,o),c=e.VertexData.CreateSphere(i,n,a);return c.applyToMesh(h,s),h},r.CreateCylinder=function(t,i,n,o,s,a,h,c,l){void 0===l&&(l=r.DEFAULTSIDE),void 0!==h&&h instanceof e.Scene||(void 0!==h&&(c=h),h=a,a=1);var u=new r(t,h),f=e.VertexData.CreateCylinder(i,n,o,s,a);return f.applyToMesh(u,c),u},r.CreateTorus=function(t,i,n,o,s,a,h){void 0===h&&(h=r.DEFAULTSIDE);var c=new r(t,s),l=e.VertexData.CreateTorus(i,n,o,h);return l.applyToMesh(c,a),c},r.CreateTorusKnot=function(t,i,n,o,s,a,h,c,l,u){void 0===u&&(u=r.DEFAULTSIDE);var f=new r(t,c),d=e.VertexData.CreateTorusKnot(i,n,o,s,a,h,u);return d.applyToMesh(f,l),f},r.CreateLines=function(t,i,r,n,o){if(void 0===o&&(o=null),o){var s=function(e){for(var t=0,r=0;r<i.length;r++)e[t]=i[r].x,e[t+1]=i[r].y,e[t+2]=i[r].z,t+=3};return o.updateMeshPositions(s,!1),o}var a=new e.LinesMesh(t,r,n),h=e.VertexData.CreateLines(i);return h.applyToMesh(a,n),a},r.CreateDashedLines=function(t,i,r,n,o,s,a,h){if(void 0===h&&(h=null),h){var c=function(t){var r=e.Vector3.Zero(),n=t.length/6,o=0,s=0,a=0,c=0,l=0,u=0,f=0,d=0;for(f=0;f<i.length-1;f++)i[f+1].subtractToRef(i[f],r),o+=r.length();for(a=o/n,c=h.dashSize*a/(h.dashSize+h.gapSize),f=0;f<i.length-1;f++)for(i[f+1].subtractToRef(i[f],r),s=Math.floor(r.length()/a),r.normalize(),d=0;s>d&&u<t.length;)l=a*d,t[u]=i[f].x+l*r.x,t[u+1]=i[f].y+l*r.y,t[u+2]=i[f].z+l*r.z,t[u+3]=i[f].x+(l+c)*r.x,t[u+4]=i[f].y+(l+c)*r.y,t[u+5]=i[f].z+(l+c)*r.z,u+=6,d++;for(;u<t.length;)t[u]=i[f].x,t[u+1]=i[f].y,t[u+2]=i[f].z,u+=3};return h.updateMeshPositions(c,!1),h}var l=new e.LinesMesh(t,s,a),u=e.VertexData.CreateDashedLines(i,r,n,o);return u.applyToMesh(l,a),l.dashSize=r,l.gapSize=n,l},r.ExtrudeShape=function(e,t,i,n,o,s,a,h,c,l){void 0===c&&(c=r.DEFAULTSIDE),void 0===l&&(l=null),n=n||1,o=o||0;var u=r._ExtrudeShapeGeneric(e,t,i,n,o,null,null,!1,!1,s,!1,a,h,c,l);return u},r.ExtrudeShapeCustom=function(e,t,i,n,o,s,a,h,c,l,u,f){void 0===u&&(u=r.DEFAULTSIDE),void 0===f&&(f=null);var d=r._ExtrudeShapeGeneric(e,t,i,null,null,n,o,s,a,h,!0,c,l,u,f);return d},r._ExtrudeShapeGeneric=function(t,i,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=function(t,i,n,o,s,a,h,c,l,u){for(var f=n.getTangents(),d=n.getNormals(),p=n.getBinormals(),m=n.getDistances(),g=0,_=function(e,t){return s},v=function(e,t){return a},y=u?c:v,x=u?h:_,b=0,M=0;M<i.length;M++){for(var A=new Array,T=y(M,m[M]),S=x(M,m[M]),E=0;E<t.length;E++){var C=e.Matrix.RotationAxis(f[M],g),D=f[M].scale(t[E].z).add(d[M].scale(t[E].x)).add(p[M].scale(t[E].y)),P=e.Vector3.TransformCoordinates(D,C).scaleInPlace(S).add(i[M]);A.push(P)}o[b]=A,g+=T,b++}var w=function(t){var i,r=Array(),n=e.Vector3.Zero();for(i=0;i<t.length;i++)n.addInPlace(t[i]);for(n.scaleInPlace(1/t.length),i=0;i<t.length;i++)r.push(n);return r};switch(l){case r.NO_CAP:break;case r.CAP_START:o.unshift(w(o[0]));break;case r.CAP_END:o.push(w(o[o.length-1]));break;case r.CAP_ALL:o.unshift(w(o[0])),o.push(w(o[o.length-1]))}return o};if(g){var v=g.path3D.update(n),y=_(i,n,g.path3D,g.pathArray,o,s,a,h,g.cap,f);return g=r.CreateRibbon(null,y,null,null,null,null,null,null,g)}var v=new e.Path3D(n),x=new Array;u=0>u||u>3?0:u;var y=_(i,n,v,x,o,s,a,h,u,f),b=r.CreateRibbon(t,y,c,l,0,d,p,m);return b.pathArray=y,b.path3D=v,b.cap=u,b},r.CreateLathe=function(t,i,n,o,s,a,h){void 0===h&&(h=r.DEFAULTSIDE),n=n||1,o=o||60*n;for(var c=2*Math.PI,l=(e.Axis.Y,new Array),u=0;0===i[u].x;)u++;var f=i[u];for(u=0;u<i.length;u++)l.push(i[u].subtract(f));var d,p=c/o,m=new Array;for(u=0;o>u;u++)d=new e.Vector3(Math.cos(u*p)*n,0,Math.sin(u*p)*n),m.push(d);m.push(m[0]);var g=function(){return 1},_=function(){return 0},v=r.ExtrudeShapeCustom(t,l,m,g,_,!0,!1,r.NO_CAP,s,a,h);return v},r.CreatePlane=function(t,i,n,o,s){void 0===s&&(s=r.DEFAULTSIDE);var a=new r(t,n),h=e.VertexData.CreatePlane(i,s);return h.applyToMesh(a,o),a},r.CreateGround=function(t,i,r,n,o,s){var a=new e.GroundMesh(t,o);a._setReady(!1),a._subdivisions=n;var h=e.VertexData.CreateGround(i,r,n);return h.applyToMesh(a,s),a._setReady(!0),a},r.CreateTiledGround=function(t,i,n,o,s,a,h,c,l){var u=new r(t,c),f=e.VertexData.CreateTiledGround(i,n,o,s,a,h);return f.applyToMesh(u,l),u},r.CreateGroundFromHeightMap=function(t,i,r,n,o,s,a,h,c,l){var u=new e.GroundMesh(t,h);u._subdivisions=o,u._setReady(!1);var f=function(t){var i=document.createElement(\"canvas\"),h=i.getContext(\"2d\"),f=t.width,d=t.height;i.width=f,i.height=d,h.drawImage(t,0,0);var p=h.getImageData(0,0,f,d).data,m=e.VertexData.CreateGroundFromHeightMap(r,n,o,s,a,p,f,d);m.applyToMesh(u,c),u._setReady(!0),l&&l(u)};return e.Tools.LoadImage(i,f,function(){},h.database),u},r.CreateTube=function(t,i,n,o,s,a,h,c,l,u){void 0===l&&(l=r.DEFAULTSIDE),void 0===u&&(u=null);var f=function(t,i,n,o,s,a,h){for(var c,l,u,f,d,p=i.getTangents(),m=i.getNormals(),g=i.getDistances(),_=2*Math.PI,v=_/s,y=function(e,t){return o},x=a||y,b=0,M=0;M<t.length;M++){l=x(M,g[M]),c=Array(),u=m[M];for(var A=0;s>A;A++)d=e.Matrix.RotationAxis(p[M],v*A),f=e.Vector3.TransformCoordinates(u,d).scaleInPlace(l).add(t[M]),c.push(f);c.push(c[0]),n[b]=c,b++}var T=function(e,i){for(var r=Array(),n=0;e>n;n++)r.push(t[i]);return r};switch(h){case r.NO_CAP:break;case r.CAP_START:n.unshift(T(s+1,0));break;case r.CAP_END:n.push(T(s+1,t.length-1));break;case r.CAP_ALL:n.unshift(T(s+1,0)),n.push(T(s+1,t.length-1))}return n};if(u){var d=u.path3D.update(i),p=f(i,d,u.pathArray,n,u.tessellation,s,u.cap);return u=r.CreateRibbon(null,p,null,null,null,null,null,null,u)}var d=new e.Path3D(i),m=new Array;a=0>a||a>3?0:a;var p=f(i,d,m,n,o,s,a),g=r.CreateRibbon(t,p,!1,!0,0,h,c,l);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\commonjs\\KInputData.js:\n    8          this.lsy = 0;\n    9          this.rfx = 0;\n   10:         this.rfy = 1;\n   11          this.rsx = 0;\n   12          this.rsy = 0;\n   ..\n   22          this.lsy = p_inputData.lsy;\n   23          this.rfx = p_inputData.rfx;\n   24:         this.rfy = p_inputData.rfy;\n   25          this.rsx = p_inputData.rsx;\n   26          this.rsy = p_inputData.rsy;\n\n7 matches across 5 files\n\n\nSearching 42 files for \"'0'\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KUserCli.js:\n   38      {\n   39        \n   40:       socket.emit('0', this.mainActor.inputData);\n   41      }\n   42    }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n 4838      function octalToDecimal(ch) {\n 4839          // \\0 is not octal escape sequence\n 4840:         var octal = (ch !== '0'), code = '01234567'.indexOf(ch);\n 4841  \n 4842          if (index < length && isOctalDigit(source[index])) {\n ....\n 5429          while (index < length) {\n 5430              ch = source[index];\n 5431:             if (ch !== '0' && ch !== '1') {\n 5432                  break;\n 5433              }\n ....\n 5463          if (isOctalDigit(prefix)) {\n 5464              octal = true;\n 5465:             number = '0' + source[index++];\n 5466          } else {\n 5467              octal = false;\n ....\n 5529  \n 5530              // Hex number starts with '0x'.\n 5531:             // Octal number starts with '0'.\n 5532              // Octal number in ES6 starts with '0o'.\n 5533              // Binary number in ES6 starts with '0b'.\n 5534:             if (number === '0') {\n 5535                  if (ch === 'x' || ch === 'X') {\n 5536                      ++index;\n ....\n 5759  \n 5760                      default:\n 5761:                         if (ch === '0') {\n 5762                              if (isDecimalDigit(source.charCodeAt(index))) {\n 5763                                  // Illegal: \\01 \\02 and so on\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n  150  \n  151      	// Heartbeat function, update everytime\n  152:         socket.on('0', function(inputData) {\n  153              user.lastHeartbeat = new Date().getTime();\n  154              if( user.mainActor !== null )\n\n8 matches across 3 files\n\n\nSearching 42 files for \"addModel\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KActorCli.js:\n   20  \n   21  \n   22:     KActorCli.prototype.addModel = function()\n   23      {\n   24          \n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  296        actor = new KActorCli();\n  297        actor.actorData.clone(p_actorData);\n  298:       actor.addModel();\n  299        this.actors.push(actor);\n  300      }\n\n2 matches across 2 files\n\n\nSearching 42 files for \"addModel\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KActorCli.js:\n   20  \n   21  \n   22:     KActorCli.prototype.addModel = function(visual)\n   23      {\n   24          console.log(visual);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  297        actor.actorData.clone(p_actorData);\n  298        if( actor.actorData.)\n  299:       actor.addModel();\n  300        this.actors.push(actor);\n  301      }\n\n2 matches across 2 files\n\n\nSearching 42 files for \"KActorSrv\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n    4      var SAT     = require('sat');\n    5      var g_unit = 10; // 10 \n    6:     var KActorSrv = function(p_userID, p_actorID, p_name, p_sector, p_visual) \n    7      { \n    8          \n    .\n   21          this.chargeTime = 0;\n   22      }\n   23:     KActorSrv.prototype.addCircle = function(p_x, p_y, p_r)\n   24      {        \n   25          this.circle = new SAT.Circle(new SAT.Vector(p_x, p_y), p_r);;\n   ..\n   29  \n   30      \n   31:     KActorSrv.prototype.beforeMove = function(config)\n   32      {\n   33          this.actorData.facingHead.x = this.inputData.lsx;\n   ..\n   36          this.actorData.facingEngine.y = this.inputData.rsy;\n   37      }\n   38:     KActorSrv.prototype.momentumDesireMove = function(config)\n   39      {\n   40          this.actorData.velocity.x += this.actorData.lastVelocity.x*this.actorData.momentum;\n   ..\n   42      }\n   43  \n   44:     KActorSrv.prototype.inputDesireMove = function(config)\n   45      {\n   46          var velX = this.inputData.lsx;\n   ..\n   59      }\n   60  \n   61:     KActorSrv.prototype.finishDesireMove = function()\n   62      {\n   63          this.circle.pos.x = this.actorData.position.x + this.actorData.velocity.x;\n   ..\n   66      }\n   67  \n   68:     KActorSrv.prototype.attemptMove = function()\n   69      {\n   70          var diffX = this.circle.pos.x - this.actorData.position.x;\n   ..\n   78      }\n   79  \n   80:     KActorSrv.prototype.applyMove = function()\n   81      {\n   82          this.circle.pos.x = Math.round(this.circle.pos.x);\n   ..\n   91      }\n   92  \n   93:     KActorSrv.prototype.collisionProcess = function(overlapX, overlapY, amount) \n   94      {\n   95          this.circle.pos.x += overlapX*amount*1;\n   ..\n   98      }\n   99  \n  100:     KActorSrv.prototype.collisionMoveTo = function(posX, posY) \n  101      {\n  102          this.circle.pos.x = posX;\n  ...\n  104      }\n  105  \n  106:     KActorSrv.prototype.collisionStop = function() \n  107      {\n  108          this.circle.pos.x = this.actorData.position.x;\n  ...\n  112      }\n  113  \n  114:     KActorSrv.prototype.getRealCircle = function(offsetX, offsetY)\n  115      {\n  116          return { \n  ...\n  120  \n  121  \n  122:     KActorSrv.prototype.doAbilities = function(config, world)\n  123      {\n  124          \n  ...\n  149      }\n  150  \n  151:     return KActorSrv;  \n  152  });\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KItemSrv.js:\n   20      }\n   21  \n   22:     KActorSrv.prototype.finishDesireMove = function()\n   23      {\n   24          this.circle.pos.x = this.actorData.position.x + this.actorData.velocity.x;\n   ..\n   26      }\n   27  \n   28:     return KActorSrv;  \n   29  });\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n    1: define([\"common/KUserData\",\"server/KActorSrv\"], \n    2:     function (KUserData, KActorSrv) \n    3  { \n    4      var SAT     = require('sat');\n    .\n   27  \n   28          var actorID = this.userData.userID+this.actors.length;\n   29:         var actor = new KActorSrv(this.userData.userID, actorID, p_name+actorID, p_sector);\n   30          actor.addCircle(p_physics.x, p_physics.y, p_physics.r);\n   31          this.actors.push(actor.actorID);\n   ..\n   45  \n   46          var circle = new SAT.Circle(new SAT.Vector(posX, posY), g_unit*0.4);\n   47:         var actor = new KActorSrv(userData.userID, actorID, shortName+actorID, circle, p_sector, \"a\");\n   48          this.actors.push(actor.actorID);\n   49          this.userData.actorIDs.push(actor.actorID);\n   ..\n   58  \n   59          var circle = new SAT.Circle(p_heroActor.circle.pos, g_unit*0.1);\n   60:         var actor = new KActorSrv(userData.userID, actorID, shortName+actorID, circle, p_heroActor.sector, \"p\");\n   61          actor.actorData.velocity.x = p_velocity.x;\n   62          actor.actorData.velocity.y = p_velocity.y;\n\n21 matches across 3 files\n\n\nSearching 42 files for \"makeActor\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   24      }\n   25  \n   26:     KUserSrv.prototype.makeActor = function(p_name, p_physics, p_sector, p_visual) {    \n   27  \n   28          var actorID = this.userData.userID+this.actors.length;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  142          var sector = this.getSectorRealPos(physics.x, physics.y);\n  143  \n  144:         var actor = user.makeActor(name, physics, sector);\n  145          this.actors.push(actor);\n  146  \n\n2 matches across 2 files\n\n\nSearching 42 files for \"console.log\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\app.js:\n   80  function validNick() {\n   81      var regex = /^\\w*$/;\n   82:     //console.log('Regex Test', regex.exec(playerNameInput.value));\n   83      return regex.exec(playerNameInput.value) !== null;\n   84  }\n   ..\n   97      socket.on('s-pong', function () {\n   98          var latency = Date.now() - startPingTime;\n   99:         console.log('Latency: ' + latency + 'ms');\n  100      });\n  101  \n  ...\n  108  \n  109      socket.on('s-kick', function () {\n  110:         console.log('kicked');\n  111          \n  112      });\n  ...\n  126  \n  127      game.setupGameSocket(socket);\n  128:     console.log(socket);\n  129  }\n  130  \n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\prep.js:\n    6  var hudCanvas = null;\n    7  \n    8: var checkNick = function() { console.log('checkNick'); }\n    9  var doHandleKeyDown = function(key) { }\n   10  var doHandleKeyUp = function(key) { }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KActorCli.js:\n   22      KActorCli.prototype.addModel = function(visual)\n   23      {\n   24:         console.log(visual);\n   25          if( visual === \"A\")\n   26          {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  226          if( idx < 0 )\n  227          {\n  228:           //console.log(idx);\n  229:           //console.log(userData);\n  230:           //console.log(userData.userID);\n  231          }\n  232          else\n  ...\n  240          if( idx < 0 )\n  241          {\n  242:           //console.log(idx);\n  243:           //console.log(actorData);\n  244:           //console.log(actorData.actorID);\n  245          }\n  246          else\n  ...\n  309      if( uidx < 0 )\n  310      {\n  311:       console.log('rcvAddActor missing user');\n  312:       console.log(p_actorData.userID);\n  313      }\n  314      else\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KSectorCli.js:\n   37  			}\n   38  		}\n   39: 		console.log('populated'+this.secX+','+this.secY);\n   40  		this.isPopulated = true;\n   41  	}\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n   32  \n   33      function showHelp() {\n   34:         console.log('See https://github.com/jrburke/r.js for usage.');\n   35      }\n   36  \n   ..\n   48  \n   49          exists = function () {\n   50:             console.log('x.js exists not applicable in browser env');\n   51              return false;\n   52          };\n   ..\n  124          };\n  125  \n  126:         //Define a console.log for easier logging. Don't\n  127          //get fancy though.\n  128          if (typeof console === 'undefined') {\n  ...\n  238          };\n  239  \n  240:         //Define a console.log for easier logging. Don't\n  241          //get fancy though.\n  242          if (typeof console === 'undefined') {\n  ...\n 1246                      //resolve the plugin, as it is built into that paths layer.\n 1247                      if (bundleId) {\n 1248:                         console.log(bundleId);\n 1249                          this.map.url = context.nameToUrl(bundleId);\n 1250                          this.load();\n ....\n 3369  \n 3370      function mkDir(dir) {\n 3371:         console.log('mkDir is no-op in browser');\n 3372      }\n 3373  \n 3374      function mkFullDir(dir) {\n 3375:         console.log('mkFullDir is no-op in browser');\n 3376      }\n 3377  \n ....\n 3435  \n 3436          getFilteredFileList: function (startDir, regExpFilters, makeUnixPaths) {\n 3437:             console.log('file.getFilteredFileList is no-op in browser');\n 3438          },\n 3439  \n 3440          copyDir: function (srcDir, destDir, regExpFilter, onlyCopyNew) {\n 3441:             console.log('file.copyDir is no-op in browser');\n 3442  \n 3443          },\n 3444  \n 3445          copyFile: function (srcFileName, destFileName, onlyCopyNew) {\n 3446:             console.log('file.copyFile is no-op in browser');\n 3447          },\n 3448  \n ....\n 3451           */\n 3452          renameFile: function (from, to) {\n 3453:             console.log('file.renameFile is no-op in browser');\n 3454          },\n 3455  \n ....\n 3498  \n 3499          deleteFile: function (fileName) {\n 3500:             console.log('file.deleteFile is no-op in browser');\n 3501          },\n 3502  \n ....\n 3505           */\n 3506          deleteEmptyDirs: function (startDir) {\n 3507:             console.log('file.deleteEmptyDirs is no-op in browser');\n 3508          }\n 3509      };\n ....\n 4457  define('browser/print', function () {\n 4458      function print(msg) {\n 4459:         console.log(msg);\n 4460      }\n 4461  \n ....\n 4477  define('node/print', function () {\n 4478      function print(msg) {\n 4479:         console.log(msg);\n 4480      }\n 4481  \n ....\n 23611                                  compressor.warn(ex.toString());\n 23612                              } else {\n 23613:                                 console.log(ex);\n 23614                                  throw ex;\n 23615                              }\n .....\n 24829          //moz_to_me = parse(moz_to_me).print_to_string({ beautify: true });\n 24830          //me_to_moz = parse(me_to_moz).print_to_string({ beautify: true });\n 24831:         //console.log(moz_to_me);\n 24832  \n 24833          moz_to_me = new Function(\"my_start_token\", \"my_end_token\", \"from_moz\", \"return(\" + moz_to_me + \")\")(\n .....\n 28305                      if (commonJsPath === \"convert\") {\n 28306                          //A request just to convert one file.\n 28307:                         console.log('\\n\\n' + commonJs.convert(savePath, file.readFile(savePath)));\n 28308                      } else {\n 28309:                         console.log(\"No files to convert in directory: \" + commonJsPath);\n 28310                      }\n 28311                  }\n .....\n 28360  \n 28361              } catch (e) {\n 28362:                 console.log(\"commonJs.convert: COULD NOT CONVERT: \" + fileName + \", so skipping it. Error was: \" + e);\n 28363                  return fileContents;\n 28364              }\n .....\n 29053                  }\n 29054  \n 29055:                 //console.log('PLUGIN COLLECTOR: ' + JSON.stringify(pluginCollector, null, \"  \"));\n 29056  \n 29057  \n .....\n 29554                      process.stdout.write(content);\n 29555                  } else {\n 29556:                     console.log(content);\n 29557                  }\n 29558              };\n .....\n 30471                      // turned off error logging. Since quit is\n 30472                      // called want to be sure a message is printed.\n 30473:                     console.log(err);\n 30474                      quit(1);\n 30475                  };\n .....\n 30569  \n 30570      } else if (commandOption === 'v') {\n 30571:         console.log('r.js: ' + version +\n 30572                      ', RequireJS: ' + this.requirejsVars.require.version +\n 30573                      ', UglifyJS2: 2.4.23, UglifyJS: 1.3.4');\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\pixi.js:\n 14092          else\n 14093          {\n 14094:           //  console.log(\"<<>>\")\n 14095              if (!sms.reverse)\n 14096              {\n .....\n 14536          });\n 14537  \n 14538:         console.log( makePropSetter( key, \" bloop\", uniform.type )  )\n 14539    //      Object.def\n 14540          //    location = uniform._location,\n .....\n 14884      if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS))\n 14885      {\n 14886:         console.log(this.gl.getShaderInfoLog(shader));\n 14887          return null;\n 14888      }\n .....\n 18150      }\n 18151  \n 18152:   //  console.log(frame);\n 18153  \n 18154      /**\n .....\n 19410              ];\n 19411  \n 19412:             window.console.log.apply(console, args); //jshint ignore:line\n 19413          }\n 19414          else if (window.console)\n 19415          {\n 19416:             window.console.log('Pixi.js ' + CONST.VERSION + ' - ' + type + ' - http://www.pixijs.com/'); //jshint ignore:line\n 19417          }\n 19418  \n .....\n 24766  InteractionManager.prototype.processTouchStart = function ( displayObject, hit )\n 24767  {\n 24768:     //console.log(\"hit\" + hit)\n 24769      if(hit)\n 24770      {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 4701          Tools._LogEnabled = function (message) {\n 4702              var formattedMessage = Tools._FormatMessage(message);\n 4703:             console.log(\"BJS - \" + formattedMessage);\n 4704              var entry = \"<div style='color:white'>\" + formattedMessage + \"</div><br>\";\n 4705              Tools._AddLogEntry(entry);\n ....\n 30387              });\n 30388              if (gCount > 1) {\n 30389:                 console.log(triangle, gCount);\n 30390              }\n 30391              return gCount > 1;\n .....\n 31853  //# sourceMappingURL=babylon.stereoscopicCameras.js.map\n 31854  BABYLON.Effect.ShadersStore={\"anaglyphPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n\\tvec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",\"blackAndWhitePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tfloat luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\tgl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",\"blurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat weights[7];\\r\\n\\tweights[0] = 0.05;\\r\\n\\tweights[1] = 0.1;\\r\\n\\tweights[2] = 0.2;\\r\\n\\tweights[3] = 0.3;\\r\\n\\tweights[4] = 0.2;\\r\\n\\tweights[5] = 0.1;\\r\\n\\tweights[6] = 0.05;\\r\\n\\r\\n\\tvec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n\\tvec2 texelStep = texelSize * direction * blurWidth;\\r\\n\\tvec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n\\tvec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n\\tvec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n\\tfor (int i = 0; i < 7; i++)\\r\\n\\t{\\r\\n\\t\\tbaseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n\\t\\ttexelOffset += texelStep;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"brickPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfBricksWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfBricksHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.05;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n\\t\\tif (brickColorSwitch == 0.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n\\t\\telse if (brickColorSwitch == 2.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"chromaticAberrationPixelShader\":\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tfloat radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n\\t\\t+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tfloat radius = sqrt(radius2);\\r\\n\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tif (chromatic_aberration > 0.0) {\\r\\n\\t\\t//index of refraction of each color channel, causing chromatic dispersion\\r\\n\\t\\tvec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n\\t\\tfloat ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n\\t\\tfloat ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n\\t\\t// shifts for red, green & blue\\r\\n\\t\\tvec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n\\t\\toriginal.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n\\t\\toriginal.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n\\t\\toriginal.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = original;\\r\\n}\",\"cloudPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n\\tvec2 p = vUV * 12.0;\\r\\n\\tvec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n\\tgl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",\"colorPixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"colorVertexShader\":\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",\"colorCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// screen render\\r\\nuniform sampler2D colorTable;\\t\\t// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;\\t\\t// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n\\tfloat sliceSize = 1.0 / width;              // space of 1 slice\\r\\n\\tfloat slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n\\tfloat sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n\\tfloat zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n\\tfloat zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n\\tfloat xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n\\tfloat s0 = xOffset + (zSlice0 * sliceSize);\\r\\n\\tfloat s1 = xOffset + (zSlice1 * sliceSize);\\r\\n\\tvec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n\\tvec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n\\tfloat zOffset = mod(uv.z * width, 1.0);\\r\\n\\tvec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 screen_color = texture2D(textureSampler, vUV);\\r\\n\\tgl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",\"convolutionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n\\tvec4 colorSum =\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n\\tfloat kernelWeight =\\r\\n\\t\\tkernel[0] +\\r\\n\\t\\tkernel[1] +\\r\\n\\t\\tkernel[2] +\\r\\n\\t\\tkernel[3] +\\r\\n\\t\\tkernel[4] +\\r\\n\\t\\tkernel[5] +\\r\\n\\t\\tkernel[6] +\\r\\n\\t\\tkernel[7] +\\r\\n\\t\\tkernel[8];\\r\\n\\r\\n\\tif (kernelWeight <= 0.0) {\\r\\n\\t\\tkernelWeight = 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",\"defaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn vPositionUVW;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n\\treturn dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn darkness;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat visibility = 1.;\\r\\n\\r\\n\\tvec2 poissonDisk[4];\\r\\n\\tpoissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n\\tpoissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n\\tpoissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n\\tpoissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n\\t// Poisson Sampling\\r\\n\\tfloat biasedDepth = depth.z - bias;\\r\\n\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n\\treturn visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n\\treturn clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n\\tfloat p = smoothstep(compare - bias, compare, moments.x);\\r\\n\\tfloat variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n\\tfloat d = compare - moments.x;\\r\\n\\tfloat p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n\\treturn clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n\\t// get edge vectors of the pixel triangle\\r\\n\\tvec3 dp1 = dFdx(p);\\r\\n\\tvec3 dp2 = dFdy(p);\\r\\n\\tvec2 duv1 = dFdx(uv);\\r\\n\\tvec2 duv2 = dFdy(uv);\\r\\n\\r\\n\\t// solve the linear system\\r\\n\\tvec3 dp2perp = cross(dp2, normal);\\r\\n\\tvec3 dp1perp = cross(normal, dp1);\\r\\n\\tvec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n\\tvec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n\\t// construct a scale-invariant frame \\r\\n\\tfloat invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n\\treturn mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n\\tvec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n\\tmap = map * 255. / 127. - 128. / 127.;\\r\\n\\tmat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n\\treturn normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n\\tvec3 diffuse;\\r\\n\\tvec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tfloat attenuation = 1.0;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n\\t\\tattenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\t\\tlightVectorW = normalize(direction);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n\\tresult.diffuse = ndl * diffuseColor * attenuation;\\r\\n\\tresult.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\tvec3 lightVectorW = normalize(direction);\\r\\n\\tfloat attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n\\t\\tresult.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult.diffuse = vec3(0.);\\r\\n\\tresult.specular = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n\\tresult.specular = specComp * specularColor;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n\\talpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n#ifdef NORMAL\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n\\tvec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tnormalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tlightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tlightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tlightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF0\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF1\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF2\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF3\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n\\talpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"defaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n\\tfinalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n\\r\\n\\t// Point size\\r\\n#ifdef POINTSIZE\\r\\n\\tgl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",\"depthPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tfloat depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n\\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",\"depthVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"depthBoxBlurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 colorDepth = vec4(0.0);\\r\\n\\r\\n\\tfor (int x = -OFFSET; x <= OFFSET; x++)\\r\\n\\t\\tfor (int y = -OFFSET; y <= OFFSET; y++)\\r\\n\\t\\t\\tcolorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n\\tgl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",\"depthOfFieldPixelShader\":\"// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;\\t\\t// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;\\t\\t// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI \\t\\t3.14159265\\r\\n#define TWOPI \\t6.28318530\\r\\n#define inverse_focal_length 0.1\\t// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n\\tfloat noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n\\tfloat noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n\\treturn clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n\\tif (distortion == 0.0) { return coords; }\\r\\n\\r\\n\\tvec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n\\tvec2 dist_coords = vec2(0.5, 0.5);\\r\\n\\tdist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n\\tdist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n\\tfloat dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n\\tdist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n\\treturn dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n\\t// compute coords with offset (a random angle is added)\\r\\n\\tvec2 coords = distorted_coords;\\r\\n\\tfloat angle = rand(coords * 100.0).x * TWOPI;\\r\\n\\tcoords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n\\tcolor += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n\\treturn weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n\\treturn min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n\\tvec4 col = texture2D(textureSampler, distorted_coords);\\r\\n\\tif (size == 0.0) { return col; }\\r\\n\\r\\n\\t// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n\\t// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n\\tfloat blur_level = getBlurLevel(size);\\r\\n\\r\\n\\tfloat w = (size / screen_width);\\r\\n\\tfloat h = (size / screen_height);\\r\\n\\tfloat total_weight = 1.0;\\r\\n\\tvec2 sample_coords;\\r\\n\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n\\tif (blur_level > 1.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n\\t}\\r\\n\\r\\n\\tif (blur_level > 2.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n\\t}\\r\\n\\r\\n\\tcol /= total_weight;\\t\\t// scales color according to weights\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t// darken if out of focus\\r\\n\\tif (darken > 0.0) {\\r\\n\\t\\tcol.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n\\t}\\r\\n\\r\\n\\t// blur levels debug\\r\\n\\t// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n\\t// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n\\t// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n\\t// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n\\tcentered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tradius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tradius = sqrt(radius2);\\r\\n\\tdistorted_coords = getDistortedCoords(vUV);\\t\\t// we distort the screen coordinates (lens \\\"magnifying\\\" effect)\\r\\n\\tvec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);\\t// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n\\tfloat depth = texture2D(depthSampler, distorted_coords).r;\\t// depth value from DepthRenderer: 0 to 1\\r\\n\\tfloat distance = near + (far - near)*depth;\\t\\t// actual distance from the lens\\r\\n\\tvec4 color = texture2D(textureSampler, vUV);\\t// original raster\\r\\n\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// screen_distance is precomputed in code\\r\\n\\tfloat coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n\\t// disable blur\\r\\n\\tif (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n\\t// blur from edge blur effect\\r\\n\\tfloat edge_blur_amount = 0.0;\\r\\n\\tif (edge_blur > 0.0) {\\r\\n\\t\\tedge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n\\t}\\r\\n\\r\\n\\t// total blur amount\\r\\n\\tfloat blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n\\t// apply blur if necessary\\r\\n\\tif (blur_amount == 0.0) {\\r\\n\\t\\tgl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\r\\n\\t\\t// add blurred color\\r\\n\\t\\tgl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n\\t\\t// if we have computed highlights: enhance highlights\\r\\n\\t\\tif (highlights) {\\r\\n\\t\\t\\tgl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (blur_noise) {\\r\\n\\t\\t\\t// we put a slight amount of noise in the blurred color\\r\\n\\t\\t\\tvec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n\\t\\t\\tvec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n\\t\\t\\tgl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\t// apply grain\\r\\n\\tif (grain_amount > 0.0) {\\r\\n\\t\\tvec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n\\t\\tgl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n\\t}\\r\\n\\r\\n}\\r\\n\",\"displayPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",\"filterPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n\\tvec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",\"firePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\tvec2 p = vUV * 8.0;\\r\\n\\tfloat q = fbm(p - time * 0.1);\\r\\n\\tvec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n\\tvec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n\\tvec3 color = c * cos(shift * vUV.y);\\r\\n\\tfloat luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n\\tgl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",\"fxaaPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n\\tvec2 localTexelSize = texelSize;\\r\\n\\tvec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbM = texture2D(textureSampler, vUV);\\r\\n\\tvec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n\\tfloat lumaNW = dot(rgbNW, luma);\\r\\n\\tfloat lumaNE = dot(rgbNE, luma);\\r\\n\\tfloat lumaSW = dot(rgbSW, luma);\\r\\n\\tfloat lumaSE = dot(rgbSE, luma);\\r\\n\\tfloat lumaM = dot(rgbM, luma);\\r\\n\\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n\\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n\\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n\\tfloat dirReduce = max(\\r\\n\\t\\t(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n\\t\\tFXAA_REDUCE_MIN);\\r\\n\\r\\n\\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n\\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n\\t\\tmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n\\t\\tdir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n\\tvec4 rgbA = 0.5 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n\\tvec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * 0.5));\\r\\n\\tfloat lumaB = dot(rgbB, luma);\\r\\n\\tif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n\\t\\tgl_FragColor = rgbA;\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tgl_FragColor = rgbB;\\r\\n\\t}\\r\\n}\",\"grassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n\\tcolor = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n\\tcolor = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n\\tcolor = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"layerPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"layerVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"legacydefaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION\\t4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n\\treturn dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn 0.;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n\\tif (t <= moments.x)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat variance = moments.y - (moments.x * moments.x);\\r\\n\\tvariance = max(variance, 0.);\\r\\n\\r\\n\\tfloat d = t - moments.x;\\r\\n\\treturn variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n\\tresult[0] = ndl * diffuseColor.rgb;\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n\\t\\tresult[1] = specComp * specularColor * spotAtten;\\r\\n\\t\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult[0] = vec3(0.);\\r\\n\\tresult[1] = vec3(0.);\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tmat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tmat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tmat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"legacydefaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn position;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n}\",\"lensFlarePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"lensFlareVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",\"lensHighlightsPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n\\tvec4 highlight = color;\\r\\n\\tfloat luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n\\tfloat lum_threshold;\\r\\n\\tif (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n\\telse { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n\\tluminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n\\thighlight *= luminance * gain;\\r\\n\\thighlight.a = 1.0;\\r\\n\\r\\n\\treturn highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\t// quick exit if no highlight computing\\r\\n\\tif (gain == -1.0) {\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t\\treturn;\\r\\n\\t}\\r\\n\\r\\n\\tfloat w = 2.0 / screen_width;\\r\\n\\tfloat h = 2.0 / screen_height;\\r\\n\\r\\n\\tfloat weight = 1.0;\\r\\n\\r\\n\\t// compute blurred color\\r\\n\\tvec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n\\tif (pentagon) {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n\\t}\\r\\n\\r\\n\\tblurred /= 39.0;\\r\\n\\r\\n\\tgl_FragColor = blurred;\\r\\n\\r\\n\\t//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",\"marblePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n\\tfloat val = 0.0;\\r\\n\\tfloat freq = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++)\\r\\n\\t{\\r\\n\\t\\tval += abs(noise(P*freq) / freq);\\r\\n\\t\\tfreq *= 2.07;\\r\\n\\t}\\r\\n\\treturn val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n\\tvec3 col;\\r\\n\\tx = 0.5*(x + 1.);\\r\\n\\tx = sqrt(x);             \\r\\n\\tx = sqrt(x);\\r\\n\\tx = sqrt(x);\\r\\n\\tcol = vec3(.2 + .75*x);  \\r\\n\\tcol.b *= 0.95;           \\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfTilesWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfTilesHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.01;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n\\t\\tt += amplitude * turbulence(brickvUV.xy);\\r\\n\\t\\tt = sin(t);\\r\\n\\t\\tcolor = marble_color(t);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 0.0);\\r\\n}\",\"outlinePixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"outlineVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tvec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"particlesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",\"particlesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n\\tvec3 cornerPos;\\r\\n\\tfloat size = options.y;\\r\\n\\tfloat angle = options.x;\\r\\n\\tvec2 offset = options.zw;\\r\\n\\r\\n\\tcornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\t\\r\\n\\tvColor = color;\\r\\n\\tvUV = offset;\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tvec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",\"passPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tgl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",\"postprocessVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"proceduralVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvPosition = position;\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"refractionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n\\tfloat ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n\\tvec2 uv = vUV - vec2(0.5);\\r\\n\\tvec2 offset = uv * depth * ref;\\r\\n\\tvec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",\"roadPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n\\tvec3 color = roadColor * ratioy;\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"shadowMapPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n\\tconst vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n\\tvec4 res = fract(depth * bit_shift);\\r\\n\\tres -= res.xxyz * bit_mask;\\r\\n\\r\\n\\treturn res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n\\tconst vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n\\tvec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n\\treturn color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tfloat depth = vPosition.z / vPosition.w;\\r\\n\\tdepth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n\\tfloat moment1 = depth;\\r\\n\\tfloat moment2 = moment1 * moment1;\\r\\n\\r\\n\\tgl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n\\tgl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",\"shadowMapVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n\\tvPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\tgl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"spritesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tif (alphaTest) \\r\\n\\t{\\r\\n\\t\\tif (baseColor.a < 0.95)\\r\\n\\t\\t\\tdiscard;\\r\\n\\t}\\r\\n\\r\\n\\tbaseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tbaseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"spritesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n\\tvec2 cornerPos;\\r\\n\\t\\r\\n\\tfloat angle = position.w;\\r\\n\\tvec2 size = vec2(options.x, options.y);\\r\\n\\tvec2 offset = options.zw;\\r\\n\\tvec2 uvScale = textureInfos.xy;\\r\\n\\r\\n\\tcornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n\\t// Color\\r\\n\\tvColor = color;\\r\\n\\t\\r\\n\\t// Texture\\r\\n\\tvec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n\\tvUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",\"ssaoPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n\\tfloat depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n\\tfloat depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tconst float base = 0.2;\\r\\n\\r\\n\\tvec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n\\tfloat depth = texture2D(textureSampler, vUV).r;\\r\\n\\tvec3 position = vec3(vUV, depth);\\r\\n\\tvec3 normal = normalFromDepth(depth, vUV);\\r\\n\\tfloat radiusDepth = radius / depth;\\r\\n\\tfloat occlusion = 0.0;\\r\\n\\r\\n\\tvec3 ray;\\r\\n\\tvec3 hemiRay;\\r\\n\\tfloat occlusionDepth;\\r\\n\\tfloat difference;\\r\\n\\r\\n\\tfor (int i = 0; i < SAMPLES; i++)\\r\\n\\t{\\r\\n\\t\\tray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n\\t\\themiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n\\t\\tocclusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n\\t\\tdifference = depth - occlusionDepth;\\r\\n\\r\\n\\t\\tocclusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n\\t}\\r\\n\\r\\n\\tfloat ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n\\tfloat result = clamp(ao + base, 0.0, 1.0);\\r\\n\\tgl_FragColor.r = result;\\r\\n\\tgl_FragColor.g = result;\\r\\n\\tgl_FragColor.b = result;\\r\\n\\tgl_FragColor.a = 1.0;\\r\\n}\\r\\n\",\"ssaoCombinePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",\"stereoscopicInterlacePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n\\t    useCamB = vUV.x > 0.5;\\r\\n\\t    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n\\t    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n\\t    useCamB = vUV.y > 0.5;\\r\\n\\t    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n\\t    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\"volumetricLightScatteringPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n\\tvec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n\\tvec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n\\t\\tvec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",\"volumetricLightScatteringPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n\\tvec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (diffuseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n\\tfloat alpha = 1.0;\\r\\n\\r\\n\\t#ifdef OPACITYRGB\\r\\n\\topacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n\\t#else\\r\\n\\talpha *= opacityColor.a * opacityLevel;\\r\\n\\t#endif\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, alpha);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n\\t#endif\\r\\n\\r\\n\\tgl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = diffuseColor;\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, 1.0);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",\"vrDistortionCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n\\tvec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n\\tfloat rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n\\tvec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n\\treturn LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 tc = HmdWarp(vUV);\\r\\n\\tif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\telse{\\r\\n\\t\\tgl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n\\t}\\r\\n}\",\"woodPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n\\tvec3 wood = woodColor * ratioy;\\r\\n\\tgl_FragColor = vec4(wood, 1.0);\\r\\n}\"};\n 31855: BABYLON.CollisionWorker=\"var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\\\"no mesh geometry id\\\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\\\"couldn't find geometry\\\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\\\"./babylon.collisionCoordinator.js\\\"),importScripts(\\\"./babylon.collider.js\\\"),importScripts(\\\"../Math/babylon.math.js\\\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\\\"single worker init\\\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\\\"\\\",function(e){e[e.INIT=0]=\\\"INIT\\\",e[e.UPDATE=1]=\\\"UPDATE\\\",e[e.COLLIDE=2]=\\\"COLLIDE\\\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\\\"SUCCESS\\\",e[e.UNKNOWN_ERROR=1]=\\\"UNKNOWN_ERROR\\\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\\\"error returned from worker!\\\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\\\"Collisions/babylon.collisionWorker.js\\\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\\\"application/javascript\\\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\"}\\\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\" A:\\\"+this.a+\\\"}\\\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\"}\\\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"W:\\\"+this.w+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\" W:\\\"+this.w+\\\"}\\\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\\\"LOCAL\\\",t[t.WORLD=1]=\\\"WORLD\\\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\\\"CW\\\",t[t.CCW=1]=\\\"CCW\\\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\\\"step size should be less than 1.\\\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\\\"cannot add lines to closed paths\\\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\\\"cannot add arcs to closed paths\\\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\\\"normalized length position should be between 0 and 1.\\\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\\\"internal error\\\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\\\"continue\\\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\\\"IsEnabled\\\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\\\"x\\\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\\\"y\\\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\\\"z\\\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));\";\n 31856  if (((window && window.module) || (!window && module)) && module.exports) {\n 31857      module.exports = BABYLON;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var S=a.prototype.multiplyToArray,T=a.prototype.invertToRef,A=a.LookAtLHToRef,D=n.TransformCoordinatesToRef,E=n.TransformCoordinatesFromFloatsToRef,C=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=T,a.LookAtLHToRef=A,n.TransformCoordinatesToRef=D,n.TransformCoordinatesFromFloatsToRef=E,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=C}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,S,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,S=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,S=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,S=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,S=-1}var A=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",D=t[A](o,u,l,x,M,S,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,D)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,S=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[S]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var S,T,A,D,E,C,w,I,P,R,L=new Int32Array(a,0,d);if(L[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(S=L[b]){case l:T=8,A=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(S))}P=1,L[g]&o&&c!==!1&&(P=Math.max(1,L[y]));for(var O=L[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(D=L[v],E=L[_],w=L[m]+4,R=0;P>R;++R){if(h.isRGB)24==O?(C=D*E*3,I=t.GetRGBArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGB,D,E,0,i.RGB,i.UNSIGNED_BYTE,I)):(C=D*E*4,I=t.GetRGBAArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGBA,D,E,0,i.RGBA,i.UNSIGNED_BYTE,I));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=D,z=Math.floor((D+V-1)/V)*V;C=z*(E-1)+N,I=t.GetLuminanceArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.LUMINANCE,D,E,0,i.LUMINANCE,i.UNSIGNED_BYTE,I)}else C=Math.max(4,D)/4*Math.max(4,E)/4*T,I=new Uint8Array(a,w,C),i.compressedTexImage2D(F,R,A,D,E,0,I);w+=C,D*=.5,E*=.5,D=Math.max(1,D),E=Math.max(1,E)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   27  legacydefaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return position;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n}\",lensFlarePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",lensFlareVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",lensHighlightsPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n	vec4 highlight = color;\\r\\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n	float lum_threshold;\\r\\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n	highlight *= luminance * gain;\\r\\n	highlight.a = 1.0;\\r\\n\\r\\n	return highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	// quick exit if no highlight computing\\r\\n	if (gain == -1.0) {\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n		return;\\r\\n	}\\r\\n\\r\\n	float w = 2.0 / screen_width;\\r\\n	float h = 2.0 / screen_height;\\r\\n\\r\\n	float weight = 1.0;\\r\\n\\r\\n	// compute blurred color\\r\\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n	if (pentagon) {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n	}\\r\\n	else {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n	}\\r\\n\\r\\n	blurred /= 39.0;\\r\\n\\r\\n	gl_FragColor = blurred;\\r\\n\\r\\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",marblePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n	float val = 0.0;\\r\\n	float freq = 1.0;\\r\\n	for (int i = 0; i < 4; i++)\\r\\n	{\\r\\n		val += abs(noise(P*freq) / freq);\\r\\n		freq *= 2.07;\\r\\n	}\\r\\n	return val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n	vec3 col;\\r\\n	x = 0.5*(x + 1.);\\r\\n	x = sqrt(x);             \\r\\n	x = sqrt(x);\\r\\n	x = sqrt(x);\\r\\n	col = vec3(.2 + .75*x);  \\r\\n	col.b *= 0.95;           \\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n	float brickW = 1.0 / numberOfTilesWidth;\\r\\n	float brickH = 1.0 / numberOfTilesHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.01;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n		t += amplitude * turbulence(brickvUV.xy);\\r\\n		t = sin(t);\\r\\n		color = marble_color(t);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 0.0);\\r\\n}\",outlinePixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",outlineVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	vec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",particlesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",particlesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n	vec3 cornerPos;\\r\\n	float size = options.y;\\r\\n	float angle = options.x;\\r\\n	vec2 offset = options.zw;\\r\\n\\r\\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n	\\r\\n	vColor = color;\\r\\n	vUV = offset;\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",passPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	gl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",postprocessVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",proceduralVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n	vPosition = position;\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",refractionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n	vec2 uv = vUV - vec2(0.5);\\r\\n	vec2 offset = uv * depth * ref;\\r\\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",roadPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n	vec3 color = roadColor * ratioy;\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",shadowMapPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n	vec4 res = fract(depth * bit_shift);\\r\\n	res -= res.xxyz * bit_mask;\\r\\n\\r\\n	return res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n	vec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n	return color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n	float depth = vPosition.z / vPosition.w;\\r\\n	depth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n	float moment1 = depth;\\r\\n	float moment2 = moment1 * moment1;\\r\\n\\r\\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n	gl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",shadowMapVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n	gl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",spritesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	if (alphaTest) \\r\\n	{\\r\\n		if (baseColor.a < 0.95)\\r\\n			discard;\\r\\n	}\\r\\n\\r\\n	baseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",spritesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n	vec2 cornerPos;\\r\\n	\\r\\n	float angle = position.w;\\r\\n	vec2 size = vec2(options.x, options.y);\\r\\n	vec2 offset = options.zw;\\r\\n	vec2 uvScale = textureInfos.xy;\\r\\n\\r\\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n	// Color\\r\\n	vColor = color;\\r\\n	\\r\\n	// Texture\\r\\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",ssaoPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	const float base = 0.2;\\r\\n\\r\\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n	float depth = texture2D(textureSampler, vUV).r;\\r\\n	vec3 position = vec3(vUV, depth);\\r\\n	vec3 normal = normalFromDepth(depth, vUV);\\r\\n	float radiusDepth = radius / depth;\\r\\n	float occlusion = 0.0;\\r\\n\\r\\n	vec3 ray;\\r\\n	vec3 hemiRay;\\r\\n	float occlusionDepth;\\r\\n	float difference;\\r\\n\\r\\n	for (int i = 0; i < SAMPLES; i++)\\r\\n	{\\r\\n		ray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n		hemiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n		difference = depth - occlusionDepth;\\r\\n\\r\\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n	}\\r\\n\\r\\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n	float result = clamp(ao + base, 0.0, 1.0);\\r\\n	gl_FragColor.r = result;\\r\\n	gl_FragColor.g = result;\\r\\n	gl_FragColor.b = result;\\r\\n	gl_FragColor.a = 1.0;\\r\\n}\\r\\n\",ssaoCombinePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",stereoscopicInterlacePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n	    useCamB = vUV.x > 0.5;\\r\\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n	    useCamB = vUV.y > 0.5;\\r\\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\n   28: volumetricLightScatteringPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",volumetricLightScatteringPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (diffuseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n	float alpha = 1.0;\\r\\n\\r\\n	#ifdef OPACITYRGB\\r\\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n	#else\\r\\n	alpha *= opacityColor.a * opacityLevel;\\r\\n	#endif\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, alpha);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n	#endif\\r\\n\\r\\n	gl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = diffuseColor;\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, 1.0);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",vrDistortionCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n	float rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n	return LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 tc = HmdWarp(vUV);\\r\\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	else{\\r\\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n	}\\r\\n}\",woodPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n	vec3 wood = woodColor * ratioy;\\r\\n	gl_FragColor = vec4(wood, 1.0);\\r\\n}\"},BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\"no mesh geometry id\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\"couldn\\'t find geometry\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\"./babylon.collisionCoordinator.js\"),importScripts(\"./babylon.collider.js\"),importScripts(\"../Math/babylon.math.js\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\"single worker init\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\"\",function(e){e[e.INIT=0]=\"INIT\",e[e.UPDATE=1]=\"UPDATE\",e[e.COLLIDE=2]=\"COLLIDE\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\"SUCCESS\",e[e.UNKNOWN_ERROR=1]=\"UNKNOWN_ERROR\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\"error returned from worker!\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\"Collisions/babylon.collisionWorker.js\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\"application/javascript\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\"}\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\" A:\"+this.a+\"}\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\"}\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"W:\"+this.w+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\" W:\"+this.w+\"}\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\"LOCAL\",t[t.WORLD=1]=\"WORLD\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\"CW\",t[t.CCW=1]=\"CCW\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\"step size should be less than 1.\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\"cannot add lines to closed paths\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\"normalized length position should be between 0 and 1.\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\"internal error\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\"continue\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\"IsEnabled\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\"x\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\"y\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\"z\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));',\n   29  (window&&window.module||!window&&module)&&module.exports&&(module.exports=BABYLON);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.noworker.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var A=a.prototype.multiplyToArray,T=a.prototype.invertToRef,S=a.LookAtLHToRef,E=n.TransformCoordinatesToRef,C=n.TransformCoordinatesFromFloatsToRef,D=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=A,a.prototype.invertToRef=T,a.LookAtLHToRef=S,n.TransformCoordinatesToRef=E,n.TransformCoordinatesFromFloatsToRef=C,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=D}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,A,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,A=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,A=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,A=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,A=-1}var S=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",E=t[S](o,u,l,x,M,A,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,E)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,A=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[A]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var A,T,S,E,C,D,P,w,I,L,R=new Int32Array(a,0,d);if(R[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(A=R[b]){case l:T=8,S=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(A))}I=1,R[g]&o&&c!==!1&&(I=Math.max(1,R[y]));for(var O=R[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(E=R[v],C=R[_],P=R[m]+4,L=0;I>L;++L){if(h.isRGB)24==O?(D=E*C*3,w=t.GetRGBArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGB,E,C,0,i.RGB,i.UNSIGNED_BYTE,w)):(D=E*C*4,w=t.GetRGBAArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGBA,E,C,0,i.RGBA,i.UNSIGNED_BYTE,w));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=E,k=Math.floor((E+V-1)/V)*V;D=k*(C-1)+N,w=t.GetLuminanceArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.LUMINANCE,E,C,0,i.LUMINANCE,i.UNSIGNED_BYTE,w)}else D=Math.max(4,E)/4*Math.max(4,C)/4*T,w=new Uint8Array(a,P,D),i.compressedTexImage2D(F,L,S,E,C,0,w);P+=D,E*=.5,C*=.5,E=Math.max(1,E),C=Math.max(1,C)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\cannon.js:\n  423      numVecs++;\n  424      if(numVecs > 180)\n  425:         console.log(numVecs+\" created\");\n  426       */\n  427  };\n  ...\n 2198          //var inertia = b.calculateTransformedInertia(m,q);\n 2199          b.calculateLocalInertia(m,childInertia); // Todo transform!\n 2200:         //console.log(childInertia,m,b.volume(),V);\n 2201  \n 2202          // Add its inertia using the parallel axis theorem, i.e.\n ....\n 2358          n.negate(n);\n 2359          this.faceNormals.push(n);\n 2360:         //console.log(n.toString());\n 2361          var vertex = this.vertices[this.faces[i][0]];\n 2362          if(n.dot(vertex)<0){\n ....\n 2477          var minB = maxminB[1];\n 2478          if(maxA<minB || maxB<minA){\n 2479:             //console.log(minA,maxA,minB,maxB);\n 2480              return false; // Separated\n 2481          }\n ....\n 2516              quatA.vmult(faceANormalWS3,faceANormalWS3);\n 2517              //posA.vadd(faceANormalWS3,faceANormalWS3); // Needed?\n 2518:             //console.log(\"face normal:\",hullA.faceNormals[i].toString(),\"world face normal:\",faceANormalWS3);\n 2519              var d = hullA.testSepAxis(faceANormalWS3, hullB, posA, quatA, posB, quatB);\n 2520              if(d===false){\n ....\n 2534              quatB.vmult(Worldnormal1,Worldnormal1);\n 2535              //posB.vadd(Worldnormal1,Worldnormal1);\n 2536:             //console.log(\"facenormal\",hullB.faceNormals[i].toString(),\"world:\",Worldnormal1.toString());\n 2537              curPlaneTests++;\n 2538              var d = hullA.testSepAxis(Worldnormal1, hullB,posA,quatA,posB,quatB);\n ....\n 2557              //posA.vadd(worldEdge0,worldEdge0); // needed?\n 2558  \n 2559:             //console.log(\"edge0:\",worldEdge0.toString());\n 2560  \n 2561              for(var e1=0; e1<hullB.uniqueEdges.length; e1++){\n ....\n 2563                  quatB.vmult(worldEdge1,worldEdge1);\n 2564                  //posB.vadd(worldEdge1,worldEdge1); // needed?\n 2565:                 //console.log(\"edge1:\",worldEdge1.toString());\n 2566                  worldEdge0.cross(worldEdge1,Cross);\n 2567                  curEdgeEdge++;\n ....\n 2694          }\n 2695          if (closestFaceA<0){\n 2696:             console.log(\"--- did not find any closest face... ---\");\n 2697              return;\n 2698          }\n 2699:         //console.log(\"closest A: \",closestFaceA);\n 2700          // Get the face and construct connected faces\n 2701          var polyA = hullA.faces[closestFaceA];\n ....\n 2744  \n 2745              // Clip face against our constructed plane\n 2746:             //console.log(\"clipping polygon \",printFace(closestFaceA),\" against plane \",planeNormalWS, planeEqWS);\n 2747              this.clipFaceAgainstPlane(pVtxIn, pVtxOut, planeNormalWS, planeEqWS);\n 2748:             //console.log(\" - clip result: \",pVtxOut);\n 2749  \n 2750              // Throw away all clipped points, but save the reamining until next clip\n ....\n 2757          }\n 2758  \n 2759:         //console.log(\"Resulting points after clip:\",pVtxIn);\n 2760  \n 2761          // only keep contact points that are behind the witness face\n ....\n 2769          for (var i=0; i<pVtxIn.length; i++){\n 2770              var depth = planeNormalWS.dot(pVtxIn[i]) + planeEqWS; //???\n 2771:             /*console.log(\"depth calc from normal=\",planeNormalWS.toString(),\" and constant \"+planeEqWS+\" and vertex \",pVtxIn[i].toString(),\" gives \"+depth);*/\n 2772              if (depth <=minDist){\n 2773:                 console.log(\"clamped: depth=\"+depth+\" to minDist=\"+(minDist+\"\"));\n 2774                  depth = minDist;\n 2775              }\n ....\n 2778                  var point = pVtxIn[i];\n 2779                  if(depth<=0){\n 2780:                     /*console.log(\"Got contact point \",point.toString(),\n 2781                        \", depth=\",depth,\n 2782                        \"contact normal=\",separatingNormal.toString(),\n ....\n 3678  \n 3679              if(other.shape instanceof CANNON.Plane){\n 3680:                 //console.log(p.position.z+\"<\"+other.aabbmin.z+\" = \",p.position.z < other.aabbmin.z);\n 3681              }\n 3682  \n ....\n 5598              var q = convexConvex_q;\n 5599              si.clipAgainstHull(xi,qi,sj,xj,qj,sepAxis,-100,100,res);\n 5600:             //console.log(res.length);\n 5601              for(var j=0; j!==res.length; j++){\n 5602                  var r = makeResult(bi,bj);\n ....\n 6627      }\n 6628  \n 6629:     //console.log(\"GWlambda:\",GWlambda);\n 6630  \n 6631      return GWlambda;\n ....\n 6854      }\n 6855  \n 6856:     //console.log(\"GWlambda:\",GWlambda);\n 6857  \n 6858      return GWlambda;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KSectorSrv.js:\n  235      KSectorSrv.prototype.draw = function()\n  236      {\n  237:         console.log('actors'+this.actorList.length);\n  238          for(var row=this.sectorUnit-1; row>=0; --row)\n  239          {\n  240:             console.log(this.groundList[row]);\n  241          }\n  242      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  113          var posX = heroActor.actorData.position.x;\n  114          var posY = heroActor.actorData.position.y;\n  115:         console.log(posX+\" \"+posY);\n  116          var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117          var velY = 0;//heroActor.actorData.lastVelocity.y;\n  ...\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  120          var punch = this.createActor(user, username, physics, \"P\");\n  121:         console.log('punch');\n  122      }\n  123  \n  ...\n  129          var posX = heroActor.actorData.position.x;\n  130          var posY = heroActor.actorData.position.y;\n  131:         console.log(\"P\"+posX+\" \"+posY);\n  132          var velX = heroActor.actorData.lastVelocity.x*chargeTime;\n  133          var velY = heroActor.actorData.lastVelocity.y*chargeTime;\n  134:         console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  136          var username = user.userData.username.substring(0, 3)+'shoot';\n  137          var shoot = this.createActor(user, username, physics, \"S\");\n  138:         console.log('shoot');\n  139      }\n  140      KWorld.prototype.createActor = function(user, name, physics, visual)\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n   70  \n   71      io.on('connection', function (socket) {\n   72:     	console.log(\"Socket setup start\");\n   73      	\n   74  \n   ..\n   80  \n   81      	socket.on('c-userLaunch', function (populatedUserData) {\n   82:             console.log('Connection ' + populatedUserData.socketid + ' connecting');\n   83  \n   84              if (KUtil.findIndex(g_world.users, populatedUserData.socketid) > -1) {\n   85:                 console.log('That userID is already connected, kicking');\n   86                  socket.disconnect();\n   87              } else if (!KUtil.validNick(populatedUserData.username)) {\n   ..\n   90              } else {\n   91                  user.userData.clone(populatedUserData);\n   92:                 console.log('Connection ' + user.userData.socketid + ' connected');\n   93                  g_sockets[user.userData.socketid] = socket;\n   94  \n   95                  sendAddPacketsToSocket(user.userData.socketid);\n   96:                 console.log('Sent first data to ' + user.userData.socketid);\n   97  \n   98                  user.lastHeartbeat = new Date().getTime();\n   ..\n  102              	g_world.users.push(user);\n  103  \n  104:                 console.log('Total users: ' + g_world.users.length);\n  105              }\n  106  \n  ...\n  117          socket.on('c-requestSector', function (sectorData) {\n  118              \n  119:             console.log('requested sector');\n  120:             console.log(sectorData);\n  121  \n  122              var sector = g_world.getSectorSecPos(sectorData.x,sectorData.y);\n  ...\n  138                  turnLength: config.turnLength\n  139              });\n  140:             console.log('Connection ' + user.userData.socketid + ' initialized');\n  141          });\n  142  \n  ...\n  144              if (KUtil.findIndex(g_world.users, user.userData.socketid) > -1)\n  145                  g_world.users.splice(KUtil.findIndex(g_world.users, user.userData.socketid), 1);\n  146:             console.log('Connection' + user.userData.socketid + ' disconnected');\n  147  \n  148              socket.broadcast.emit('playerDisconnect', { name: user.userData.username });\n  ...\n  158              else\n  159              {\n  160:                 console.log('missing main actor');\n  161:                 console.log(user);\n  162              }\n  163          });\n  164:         console.log('Socket setup finish');\n  165      });\n  166      serverPort = process.env.PORT || config.port;\n  167      http.listen(serverPort, function() {\n  168:       console.log(\"Server is listening on port \" + serverPort);\n  169      });\n  170  \n  ...\n  208  \n  209  function sendReport() {\n  210: 	console.log('users');\n  211      g_world.users.forEach( function(user) \n  212      {\n  213:     	console.log(user.userData.socketid+','+user.userData.userID);\n  214  	});\n  215: 	console.log('actors');\n  216  	g_world.actors.forEach( function(actor) \n  217      {\n  218:         console.log(actor.actorData.actorname);\n  219:         console.log(actor.actorData.position);\n  220      });\n  221:     //console.log('sectorZero');\n  222      //var sector = g_world.getSectorSecPos(0,0);\n  223      //sector.draw();\n\n105 matches across 14 files\n\n\nSearching 42 files for \"console.log\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\app.js:\n   80  function validNick() {\n   81      var regex = /^\\w*$/;\n   82:     //console.log('Regex Test', regex.exec(playerNameInput.value));\n   83      return regex.exec(playerNameInput.value) !== null;\n   84  }\n   ..\n   97      socket.on('s-pong', function () {\n   98          var latency = Date.now() - startPingTime;\n   99:         console.log('Latency: ' + latency + 'ms');\n  100      });\n  101  \n  ...\n  108  \n  109      socket.on('s-kick', function () {\n  110:         console.log('kicked');\n  111          \n  112      });\n  ...\n  126  \n  127      game.setupGameSocket(socket);\n  128:     console.log(socket);\n  129  }\n  130  \n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\prep.js:\n    6  var hudCanvas = null;\n    7  \n    8: var checkNick = function() { console.log('checkNick'); }\n    9  var doHandleKeyDown = function(key) { }\n   10  var doHandleKeyUp = function(key) { }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  226          if( idx < 0 )\n  227          {\n  228:           //console.log(idx);\n  229:           //console.log(userData);\n  230:           //console.log(userData.userID);\n  231          }\n  232          else\n  ...\n  240          if( idx < 0 )\n  241          {\n  242:           //console.log(idx);\n  243:           //console.log(actorData);\n  244:           //console.log(actorData.actorID);\n  245          }\n  246          else\n  ...\n  309      if( uidx < 0 )\n  310      {\n  311:       console.log('rcvAddActor missing user');\n  312:       console.log(p_actorData.userID);\n  313      }\n  314      else\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KSectorCli.js:\n   37  			}\n   38  		}\n   39: 		console.log('populated'+this.secX+','+this.secY);\n   40  		this.isPopulated = true;\n   41  	}\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n   32  \n   33      function showHelp() {\n   34:         console.log('See https://github.com/jrburke/r.js for usage.');\n   35      }\n   36  \n   ..\n   48  \n   49          exists = function () {\n   50:             console.log('x.js exists not applicable in browser env');\n   51              return false;\n   52          };\n   ..\n  124          };\n  125  \n  126:         //Define a console.log for easier logging. Don't\n  127          //get fancy though.\n  128          if (typeof console === 'undefined') {\n  ...\n  238          };\n  239  \n  240:         //Define a console.log for easier logging. Don't\n  241          //get fancy though.\n  242          if (typeof console === 'undefined') {\n  ...\n 1246                      //resolve the plugin, as it is built into that paths layer.\n 1247                      if (bundleId) {\n 1248:                         console.log(bundleId);\n 1249                          this.map.url = context.nameToUrl(bundleId);\n 1250                          this.load();\n ....\n 3369  \n 3370      function mkDir(dir) {\n 3371:         console.log('mkDir is no-op in browser');\n 3372      }\n 3373  \n 3374      function mkFullDir(dir) {\n 3375:         console.log('mkFullDir is no-op in browser');\n 3376      }\n 3377  \n ....\n 3435  \n 3436          getFilteredFileList: function (startDir, regExpFilters, makeUnixPaths) {\n 3437:             console.log('file.getFilteredFileList is no-op in browser');\n 3438          },\n 3439  \n 3440          copyDir: function (srcDir, destDir, regExpFilter, onlyCopyNew) {\n 3441:             console.log('file.copyDir is no-op in browser');\n 3442  \n 3443          },\n 3444  \n 3445          copyFile: function (srcFileName, destFileName, onlyCopyNew) {\n 3446:             console.log('file.copyFile is no-op in browser');\n 3447          },\n 3448  \n ....\n 3451           */\n 3452          renameFile: function (from, to) {\n 3453:             console.log('file.renameFile is no-op in browser');\n 3454          },\n 3455  \n ....\n 3498  \n 3499          deleteFile: function (fileName) {\n 3500:             console.log('file.deleteFile is no-op in browser');\n 3501          },\n 3502  \n ....\n 3505           */\n 3506          deleteEmptyDirs: function (startDir) {\n 3507:             console.log('file.deleteEmptyDirs is no-op in browser');\n 3508          }\n 3509      };\n ....\n 4457  define('browser/print', function () {\n 4458      function print(msg) {\n 4459:         console.log(msg);\n 4460      }\n 4461  \n ....\n 4477  define('node/print', function () {\n 4478      function print(msg) {\n 4479:         console.log(msg);\n 4480      }\n 4481  \n ....\n 23611                                  compressor.warn(ex.toString());\n 23612                              } else {\n 23613:                                 console.log(ex);\n 23614                                  throw ex;\n 23615                              }\n .....\n 24829          //moz_to_me = parse(moz_to_me).print_to_string({ beautify: true });\n 24830          //me_to_moz = parse(me_to_moz).print_to_string({ beautify: true });\n 24831:         //console.log(moz_to_me);\n 24832  \n 24833          moz_to_me = new Function(\"my_start_token\", \"my_end_token\", \"from_moz\", \"return(\" + moz_to_me + \")\")(\n .....\n 28305                      if (commonJsPath === \"convert\") {\n 28306                          //A request just to convert one file.\n 28307:                         console.log('\\n\\n' + commonJs.convert(savePath, file.readFile(savePath)));\n 28308                      } else {\n 28309:                         console.log(\"No files to convert in directory: \" + commonJsPath);\n 28310                      }\n 28311                  }\n .....\n 28360  \n 28361              } catch (e) {\n 28362:                 console.log(\"commonJs.convert: COULD NOT CONVERT: \" + fileName + \", so skipping it. Error was: \" + e);\n 28363                  return fileContents;\n 28364              }\n .....\n 29053                  }\n 29054  \n 29055:                 //console.log('PLUGIN COLLECTOR: ' + JSON.stringify(pluginCollector, null, \"  \"));\n 29056  \n 29057  \n .....\n 29554                      process.stdout.write(content);\n 29555                  } else {\n 29556:                     console.log(content);\n 29557                  }\n 29558              };\n .....\n 30471                      // turned off error logging. Since quit is\n 30472                      // called want to be sure a message is printed.\n 30473:                     console.log(err);\n 30474                      quit(1);\n 30475                  };\n .....\n 30569  \n 30570      } else if (commandOption === 'v') {\n 30571:         console.log('r.js: ' + version +\n 30572                      ', RequireJS: ' + this.requirejsVars.require.version +\n 30573                      ', UglifyJS2: 2.4.23, UglifyJS: 1.3.4');\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\pixi.js:\n 14092          else\n 14093          {\n 14094:           //  console.log(\"<<>>\")\n 14095              if (!sms.reverse)\n 14096              {\n .....\n 14536          });\n 14537  \n 14538:         console.log( makePropSetter( key, \" bloop\", uniform.type )  )\n 14539    //      Object.def\n 14540          //    location = uniform._location,\n .....\n 14884      if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS))\n 14885      {\n 14886:         console.log(this.gl.getShaderInfoLog(shader));\n 14887          return null;\n 14888      }\n .....\n 18150      }\n 18151  \n 18152:   //  console.log(frame);\n 18153  \n 18154      /**\n .....\n 19410              ];\n 19411  \n 19412:             window.console.log.apply(console, args); //jshint ignore:line\n 19413          }\n 19414          else if (window.console)\n 19415          {\n 19416:             window.console.log('Pixi.js ' + CONST.VERSION + ' - ' + type + ' - http://www.pixijs.com/'); //jshint ignore:line\n 19417          }\n 19418  \n .....\n 24766  InteractionManager.prototype.processTouchStart = function ( displayObject, hit )\n 24767  {\n 24768:     //console.log(\"hit\" + hit)\n 24769      if(hit)\n 24770      {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 4701          Tools._LogEnabled = function (message) {\n 4702              var formattedMessage = Tools._FormatMessage(message);\n 4703:             console.log(\"BJS - \" + formattedMessage);\n 4704              var entry = \"<div style='color:white'>\" + formattedMessage + \"</div><br>\";\n 4705              Tools._AddLogEntry(entry);\n ....\n 30387              });\n 30388              if (gCount > 1) {\n 30389:                 console.log(triangle, gCount);\n 30390              }\n 30391              return gCount > 1;\n .....\n 31853  //# sourceMappingURL=babylon.stereoscopicCameras.js.map\n 31854  BABYLON.Effect.ShadersStore={\"anaglyphPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n\\tvec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",\"blackAndWhitePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tfloat luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\tgl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",\"blurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat weights[7];\\r\\n\\tweights[0] = 0.05;\\r\\n\\tweights[1] = 0.1;\\r\\n\\tweights[2] = 0.2;\\r\\n\\tweights[3] = 0.3;\\r\\n\\tweights[4] = 0.2;\\r\\n\\tweights[5] = 0.1;\\r\\n\\tweights[6] = 0.05;\\r\\n\\r\\n\\tvec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n\\tvec2 texelStep = texelSize * direction * blurWidth;\\r\\n\\tvec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n\\tvec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n\\tvec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n\\tfor (int i = 0; i < 7; i++)\\r\\n\\t{\\r\\n\\t\\tbaseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n\\t\\ttexelOffset += texelStep;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"brickPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfBricksWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfBricksHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.05;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n\\t\\tif (brickColorSwitch == 0.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n\\t\\telse if (brickColorSwitch == 2.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"chromaticAberrationPixelShader\":\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tfloat radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n\\t\\t+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tfloat radius = sqrt(radius2);\\r\\n\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tif (chromatic_aberration > 0.0) {\\r\\n\\t\\t//index of refraction of each color channel, causing chromatic dispersion\\r\\n\\t\\tvec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n\\t\\tfloat ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n\\t\\tfloat ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n\\t\\t// shifts for red, green & blue\\r\\n\\t\\tvec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n\\t\\toriginal.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n\\t\\toriginal.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n\\t\\toriginal.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = original;\\r\\n}\",\"cloudPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n\\tvec2 p = vUV * 12.0;\\r\\n\\tvec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n\\tgl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",\"colorPixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"colorVertexShader\":\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",\"colorCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// screen render\\r\\nuniform sampler2D colorTable;\\t\\t// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;\\t\\t// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n\\tfloat sliceSize = 1.0 / width;              // space of 1 slice\\r\\n\\tfloat slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n\\tfloat sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n\\tfloat zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n\\tfloat zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n\\tfloat xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n\\tfloat s0 = xOffset + (zSlice0 * sliceSize);\\r\\n\\tfloat s1 = xOffset + (zSlice1 * sliceSize);\\r\\n\\tvec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n\\tvec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n\\tfloat zOffset = mod(uv.z * width, 1.0);\\r\\n\\tvec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 screen_color = texture2D(textureSampler, vUV);\\r\\n\\tgl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",\"convolutionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n\\tvec4 colorSum =\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n\\tfloat kernelWeight =\\r\\n\\t\\tkernel[0] +\\r\\n\\t\\tkernel[1] +\\r\\n\\t\\tkernel[2] +\\r\\n\\t\\tkernel[3] +\\r\\n\\t\\tkernel[4] +\\r\\n\\t\\tkernel[5] +\\r\\n\\t\\tkernel[6] +\\r\\n\\t\\tkernel[7] +\\r\\n\\t\\tkernel[8];\\r\\n\\r\\n\\tif (kernelWeight <= 0.0) {\\r\\n\\t\\tkernelWeight = 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",\"defaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn vPositionUVW;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n\\treturn dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn darkness;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat visibility = 1.;\\r\\n\\r\\n\\tvec2 poissonDisk[4];\\r\\n\\tpoissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n\\tpoissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n\\tpoissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n\\tpoissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n\\t// Poisson Sampling\\r\\n\\tfloat biasedDepth = depth.z - bias;\\r\\n\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n\\treturn visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n\\treturn clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n\\tfloat p = smoothstep(compare - bias, compare, moments.x);\\r\\n\\tfloat variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n\\tfloat d = compare - moments.x;\\r\\n\\tfloat p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n\\treturn clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n\\t// get edge vectors of the pixel triangle\\r\\n\\tvec3 dp1 = dFdx(p);\\r\\n\\tvec3 dp2 = dFdy(p);\\r\\n\\tvec2 duv1 = dFdx(uv);\\r\\n\\tvec2 duv2 = dFdy(uv);\\r\\n\\r\\n\\t// solve the linear system\\r\\n\\tvec3 dp2perp = cross(dp2, normal);\\r\\n\\tvec3 dp1perp = cross(normal, dp1);\\r\\n\\tvec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n\\tvec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n\\t// construct a scale-invariant frame \\r\\n\\tfloat invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n\\treturn mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n\\tvec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n\\tmap = map * 255. / 127. - 128. / 127.;\\r\\n\\tmat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n\\treturn normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n\\tvec3 diffuse;\\r\\n\\tvec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tfloat attenuation = 1.0;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n\\t\\tattenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\t\\tlightVectorW = normalize(direction);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n\\tresult.diffuse = ndl * diffuseColor * attenuation;\\r\\n\\tresult.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\tvec3 lightVectorW = normalize(direction);\\r\\n\\tfloat attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n\\t\\tresult.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult.diffuse = vec3(0.);\\r\\n\\tresult.specular = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n\\tresult.specular = specComp * specularColor;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n\\talpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n#ifdef NORMAL\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n\\tvec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tnormalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tlightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tlightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tlightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF0\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF1\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF2\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF3\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n\\talpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"defaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n\\tfinalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n\\r\\n\\t// Point size\\r\\n#ifdef POINTSIZE\\r\\n\\tgl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",\"depthPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tfloat depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n\\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",\"depthVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"depthBoxBlurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 colorDepth = vec4(0.0);\\r\\n\\r\\n\\tfor (int x = -OFFSET; x <= OFFSET; x++)\\r\\n\\t\\tfor (int y = -OFFSET; y <= OFFSET; y++)\\r\\n\\t\\t\\tcolorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n\\tgl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",\"depthOfFieldPixelShader\":\"// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;\\t\\t// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;\\t\\t// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI \\t\\t3.14159265\\r\\n#define TWOPI \\t6.28318530\\r\\n#define inverse_focal_length 0.1\\t// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n\\tfloat noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n\\tfloat noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n\\treturn clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n\\tif (distortion == 0.0) { return coords; }\\r\\n\\r\\n\\tvec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n\\tvec2 dist_coords = vec2(0.5, 0.5);\\r\\n\\tdist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n\\tdist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n\\tfloat dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n\\tdist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n\\treturn dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n\\t// compute coords with offset (a random angle is added)\\r\\n\\tvec2 coords = distorted_coords;\\r\\n\\tfloat angle = rand(coords * 100.0).x * TWOPI;\\r\\n\\tcoords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n\\tcolor += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n\\treturn weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n\\treturn min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n\\tvec4 col = texture2D(textureSampler, distorted_coords);\\r\\n\\tif (size == 0.0) { return col; }\\r\\n\\r\\n\\t// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n\\t// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n\\tfloat blur_level = getBlurLevel(size);\\r\\n\\r\\n\\tfloat w = (size / screen_width);\\r\\n\\tfloat h = (size / screen_height);\\r\\n\\tfloat total_weight = 1.0;\\r\\n\\tvec2 sample_coords;\\r\\n\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n\\tif (blur_level > 1.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n\\t}\\r\\n\\r\\n\\tif (blur_level > 2.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n\\t}\\r\\n\\r\\n\\tcol /= total_weight;\\t\\t// scales color according to weights\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t// darken if out of focus\\r\\n\\tif (darken > 0.0) {\\r\\n\\t\\tcol.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n\\t}\\r\\n\\r\\n\\t// blur levels debug\\r\\n\\t// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n\\t// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n\\t// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n\\t// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n\\tcentered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tradius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tradius = sqrt(radius2);\\r\\n\\tdistorted_coords = getDistortedCoords(vUV);\\t\\t// we distort the screen coordinates (lens \\\"magnifying\\\" effect)\\r\\n\\tvec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);\\t// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n\\tfloat depth = texture2D(depthSampler, distorted_coords).r;\\t// depth value from DepthRenderer: 0 to 1\\r\\n\\tfloat distance = near + (far - near)*depth;\\t\\t// actual distance from the lens\\r\\n\\tvec4 color = texture2D(textureSampler, vUV);\\t// original raster\\r\\n\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// screen_distance is precomputed in code\\r\\n\\tfloat coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n\\t// disable blur\\r\\n\\tif (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n\\t// blur from edge blur effect\\r\\n\\tfloat edge_blur_amount = 0.0;\\r\\n\\tif (edge_blur > 0.0) {\\r\\n\\t\\tedge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n\\t}\\r\\n\\r\\n\\t// total blur amount\\r\\n\\tfloat blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n\\t// apply blur if necessary\\r\\n\\tif (blur_amount == 0.0) {\\r\\n\\t\\tgl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\r\\n\\t\\t// add blurred color\\r\\n\\t\\tgl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n\\t\\t// if we have computed highlights: enhance highlights\\r\\n\\t\\tif (highlights) {\\r\\n\\t\\t\\tgl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (blur_noise) {\\r\\n\\t\\t\\t// we put a slight amount of noise in the blurred color\\r\\n\\t\\t\\tvec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n\\t\\t\\tvec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n\\t\\t\\tgl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\t// apply grain\\r\\n\\tif (grain_amount > 0.0) {\\r\\n\\t\\tvec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n\\t\\tgl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n\\t}\\r\\n\\r\\n}\\r\\n\",\"displayPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",\"filterPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n\\tvec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",\"firePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\tvec2 p = vUV * 8.0;\\r\\n\\tfloat q = fbm(p - time * 0.1);\\r\\n\\tvec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n\\tvec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n\\tvec3 color = c * cos(shift * vUV.y);\\r\\n\\tfloat luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n\\tgl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",\"fxaaPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n\\tvec2 localTexelSize = texelSize;\\r\\n\\tvec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbM = texture2D(textureSampler, vUV);\\r\\n\\tvec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n\\tfloat lumaNW = dot(rgbNW, luma);\\r\\n\\tfloat lumaNE = dot(rgbNE, luma);\\r\\n\\tfloat lumaSW = dot(rgbSW, luma);\\r\\n\\tfloat lumaSE = dot(rgbSE, luma);\\r\\n\\tfloat lumaM = dot(rgbM, luma);\\r\\n\\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n\\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n\\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n\\tfloat dirReduce = max(\\r\\n\\t\\t(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n\\t\\tFXAA_REDUCE_MIN);\\r\\n\\r\\n\\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n\\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n\\t\\tmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n\\t\\tdir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n\\tvec4 rgbA = 0.5 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n\\tvec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * 0.5));\\r\\n\\tfloat lumaB = dot(rgbB, luma);\\r\\n\\tif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n\\t\\tgl_FragColor = rgbA;\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tgl_FragColor = rgbB;\\r\\n\\t}\\r\\n}\",\"grassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n\\tcolor = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n\\tcolor = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n\\tcolor = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"layerPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"layerVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"legacydefaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION\\t4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n\\treturn dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn 0.;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n\\tif (t <= moments.x)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat variance = moments.y - (moments.x * moments.x);\\r\\n\\tvariance = max(variance, 0.);\\r\\n\\r\\n\\tfloat d = t - moments.x;\\r\\n\\treturn variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n\\tresult[0] = ndl * diffuseColor.rgb;\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n\\t\\tresult[1] = specComp * specularColor * spotAtten;\\r\\n\\t\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult[0] = vec3(0.);\\r\\n\\tresult[1] = vec3(0.);\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tmat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tmat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tmat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"legacydefaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn position;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n}\",\"lensFlarePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"lensFlareVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",\"lensHighlightsPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n\\tvec4 highlight = color;\\r\\n\\tfloat luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n\\tfloat lum_threshold;\\r\\n\\tif (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n\\telse { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n\\tluminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n\\thighlight *= luminance * gain;\\r\\n\\thighlight.a = 1.0;\\r\\n\\r\\n\\treturn highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\t// quick exit if no highlight computing\\r\\n\\tif (gain == -1.0) {\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t\\treturn;\\r\\n\\t}\\r\\n\\r\\n\\tfloat w = 2.0 / screen_width;\\r\\n\\tfloat h = 2.0 / screen_height;\\r\\n\\r\\n\\tfloat weight = 1.0;\\r\\n\\r\\n\\t// compute blurred color\\r\\n\\tvec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n\\tif (pentagon) {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n\\t}\\r\\n\\r\\n\\tblurred /= 39.0;\\r\\n\\r\\n\\tgl_FragColor = blurred;\\r\\n\\r\\n\\t//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",\"marblePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n\\tfloat val = 0.0;\\r\\n\\tfloat freq = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++)\\r\\n\\t{\\r\\n\\t\\tval += abs(noise(P*freq) / freq);\\r\\n\\t\\tfreq *= 2.07;\\r\\n\\t}\\r\\n\\treturn val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n\\tvec3 col;\\r\\n\\tx = 0.5*(x + 1.);\\r\\n\\tx = sqrt(x);             \\r\\n\\tx = sqrt(x);\\r\\n\\tx = sqrt(x);\\r\\n\\tcol = vec3(.2 + .75*x);  \\r\\n\\tcol.b *= 0.95;           \\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfTilesWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfTilesHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.01;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n\\t\\tt += amplitude * turbulence(brickvUV.xy);\\r\\n\\t\\tt = sin(t);\\r\\n\\t\\tcolor = marble_color(t);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 0.0);\\r\\n}\",\"outlinePixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"outlineVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tvec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"particlesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",\"particlesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n\\tvec3 cornerPos;\\r\\n\\tfloat size = options.y;\\r\\n\\tfloat angle = options.x;\\r\\n\\tvec2 offset = options.zw;\\r\\n\\r\\n\\tcornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\t\\r\\n\\tvColor = color;\\r\\n\\tvUV = offset;\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tvec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",\"passPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tgl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",\"postprocessVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"proceduralVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvPosition = position;\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"refractionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n\\tfloat ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n\\tvec2 uv = vUV - vec2(0.5);\\r\\n\\tvec2 offset = uv * depth * ref;\\r\\n\\tvec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",\"roadPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n\\tvec3 color = roadColor * ratioy;\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"shadowMapPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n\\tconst vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n\\tvec4 res = fract(depth * bit_shift);\\r\\n\\tres -= res.xxyz * bit_mask;\\r\\n\\r\\n\\treturn res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n\\tconst vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n\\tvec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n\\treturn color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tfloat depth = vPosition.z / vPosition.w;\\r\\n\\tdepth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n\\tfloat moment1 = depth;\\r\\n\\tfloat moment2 = moment1 * moment1;\\r\\n\\r\\n\\tgl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n\\tgl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",\"shadowMapVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n\\tvPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\tgl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"spritesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tif (alphaTest) \\r\\n\\t{\\r\\n\\t\\tif (baseColor.a < 0.95)\\r\\n\\t\\t\\tdiscard;\\r\\n\\t}\\r\\n\\r\\n\\tbaseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tbaseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"spritesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n\\tvec2 cornerPos;\\r\\n\\t\\r\\n\\tfloat angle = position.w;\\r\\n\\tvec2 size = vec2(options.x, options.y);\\r\\n\\tvec2 offset = options.zw;\\r\\n\\tvec2 uvScale = textureInfos.xy;\\r\\n\\r\\n\\tcornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n\\t// Color\\r\\n\\tvColor = color;\\r\\n\\t\\r\\n\\t// Texture\\r\\n\\tvec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n\\tvUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",\"ssaoPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n\\tfloat depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n\\tfloat depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tconst float base = 0.2;\\r\\n\\r\\n\\tvec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n\\tfloat depth = texture2D(textureSampler, vUV).r;\\r\\n\\tvec3 position = vec3(vUV, depth);\\r\\n\\tvec3 normal = normalFromDepth(depth, vUV);\\r\\n\\tfloat radiusDepth = radius / depth;\\r\\n\\tfloat occlusion = 0.0;\\r\\n\\r\\n\\tvec3 ray;\\r\\n\\tvec3 hemiRay;\\r\\n\\tfloat occlusionDepth;\\r\\n\\tfloat difference;\\r\\n\\r\\n\\tfor (int i = 0; i < SAMPLES; i++)\\r\\n\\t{\\r\\n\\t\\tray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n\\t\\themiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n\\t\\tocclusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n\\t\\tdifference = depth - occlusionDepth;\\r\\n\\r\\n\\t\\tocclusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n\\t}\\r\\n\\r\\n\\tfloat ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n\\tfloat result = clamp(ao + base, 0.0, 1.0);\\r\\n\\tgl_FragColor.r = result;\\r\\n\\tgl_FragColor.g = result;\\r\\n\\tgl_FragColor.b = result;\\r\\n\\tgl_FragColor.a = 1.0;\\r\\n}\\r\\n\",\"ssaoCombinePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",\"stereoscopicInterlacePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n\\t    useCamB = vUV.x > 0.5;\\r\\n\\t    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n\\t    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n\\t    useCamB = vUV.y > 0.5;\\r\\n\\t    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n\\t    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\"volumetricLightScatteringPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n\\tvec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n\\tvec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n\\t\\tvec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",\"volumetricLightScatteringPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n\\tvec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (diffuseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n\\tfloat alpha = 1.0;\\r\\n\\r\\n\\t#ifdef OPACITYRGB\\r\\n\\topacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n\\t#else\\r\\n\\talpha *= opacityColor.a * opacityLevel;\\r\\n\\t#endif\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, alpha);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n\\t#endif\\r\\n\\r\\n\\tgl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = diffuseColor;\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, 1.0);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",\"vrDistortionCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n\\tvec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n\\tfloat rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n\\tvec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n\\treturn LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 tc = HmdWarp(vUV);\\r\\n\\tif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\telse{\\r\\n\\t\\tgl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n\\t}\\r\\n}\",\"woodPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n\\tvec3 wood = woodColor * ratioy;\\r\\n\\tgl_FragColor = vec4(wood, 1.0);\\r\\n}\"};\n 31855: BABYLON.CollisionWorker=\"var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\\\"no mesh geometry id\\\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\\\"couldn't find geometry\\\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\\\"./babylon.collisionCoordinator.js\\\"),importScripts(\\\"./babylon.collider.js\\\"),importScripts(\\\"../Math/babylon.math.js\\\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\\\"single worker init\\\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\\\"\\\",function(e){e[e.INIT=0]=\\\"INIT\\\",e[e.UPDATE=1]=\\\"UPDATE\\\",e[e.COLLIDE=2]=\\\"COLLIDE\\\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\\\"SUCCESS\\\",e[e.UNKNOWN_ERROR=1]=\\\"UNKNOWN_ERROR\\\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\\\"error returned from worker!\\\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\\\"Collisions/babylon.collisionWorker.js\\\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\\\"application/javascript\\\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\"}\\\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\" A:\\\"+this.a+\\\"}\\\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\"}\\\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"W:\\\"+this.w+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\" W:\\\"+this.w+\\\"}\\\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\\\"LOCAL\\\",t[t.WORLD=1]=\\\"WORLD\\\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\\\"CW\\\",t[t.CCW=1]=\\\"CCW\\\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\\\"step size should be less than 1.\\\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\\\"cannot add lines to closed paths\\\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\\\"cannot add arcs to closed paths\\\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\\\"normalized length position should be between 0 and 1.\\\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\\\"internal error\\\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\\\"continue\\\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\\\"IsEnabled\\\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\\\"x\\\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\\\"y\\\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\\\"z\\\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));\";\n 31856  if (((window && window.module) || (!window && module)) && module.exports) {\n 31857      module.exports = BABYLON;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var S=a.prototype.multiplyToArray,T=a.prototype.invertToRef,A=a.LookAtLHToRef,D=n.TransformCoordinatesToRef,E=n.TransformCoordinatesFromFloatsToRef,C=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=T,a.LookAtLHToRef=A,n.TransformCoordinatesToRef=D,n.TransformCoordinatesFromFloatsToRef=E,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=C}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,S,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,S=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,S=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,S=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,S=-1}var A=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",D=t[A](o,u,l,x,M,S,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,D)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,S=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[S]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var S,T,A,D,E,C,w,I,P,R,L=new Int32Array(a,0,d);if(L[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(S=L[b]){case l:T=8,A=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(S))}P=1,L[g]&o&&c!==!1&&(P=Math.max(1,L[y]));for(var O=L[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(D=L[v],E=L[_],w=L[m]+4,R=0;P>R;++R){if(h.isRGB)24==O?(C=D*E*3,I=t.GetRGBArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGB,D,E,0,i.RGB,i.UNSIGNED_BYTE,I)):(C=D*E*4,I=t.GetRGBAArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGBA,D,E,0,i.RGBA,i.UNSIGNED_BYTE,I));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=D,z=Math.floor((D+V-1)/V)*V;C=z*(E-1)+N,I=t.GetLuminanceArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.LUMINANCE,D,E,0,i.LUMINANCE,i.UNSIGNED_BYTE,I)}else C=Math.max(4,D)/4*Math.max(4,E)/4*T,I=new Uint8Array(a,w,C),i.compressedTexImage2D(F,R,A,D,E,0,I);w+=C,D*=.5,E*=.5,D=Math.max(1,D),E=Math.max(1,E)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   27  legacydefaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return position;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n}\",lensFlarePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",lensFlareVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",lensHighlightsPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n	vec4 highlight = color;\\r\\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n	float lum_threshold;\\r\\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n	highlight *= luminance * gain;\\r\\n	highlight.a = 1.0;\\r\\n\\r\\n	return highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	// quick exit if no highlight computing\\r\\n	if (gain == -1.0) {\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n		return;\\r\\n	}\\r\\n\\r\\n	float w = 2.0 / screen_width;\\r\\n	float h = 2.0 / screen_height;\\r\\n\\r\\n	float weight = 1.0;\\r\\n\\r\\n	// compute blurred color\\r\\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n	if (pentagon) {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n	}\\r\\n	else {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n	}\\r\\n\\r\\n	blurred /= 39.0;\\r\\n\\r\\n	gl_FragColor = blurred;\\r\\n\\r\\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",marblePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n	float val = 0.0;\\r\\n	float freq = 1.0;\\r\\n	for (int i = 0; i < 4; i++)\\r\\n	{\\r\\n		val += abs(noise(P*freq) / freq);\\r\\n		freq *= 2.07;\\r\\n	}\\r\\n	return val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n	vec3 col;\\r\\n	x = 0.5*(x + 1.);\\r\\n	x = sqrt(x);             \\r\\n	x = sqrt(x);\\r\\n	x = sqrt(x);\\r\\n	col = vec3(.2 + .75*x);  \\r\\n	col.b *= 0.95;           \\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n	float brickW = 1.0 / numberOfTilesWidth;\\r\\n	float brickH = 1.0 / numberOfTilesHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.01;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n		t += amplitude * turbulence(brickvUV.xy);\\r\\n		t = sin(t);\\r\\n		color = marble_color(t);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 0.0);\\r\\n}\",outlinePixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",outlineVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	vec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",particlesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",particlesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n	vec3 cornerPos;\\r\\n	float size = options.y;\\r\\n	float angle = options.x;\\r\\n	vec2 offset = options.zw;\\r\\n\\r\\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n	\\r\\n	vColor = color;\\r\\n	vUV = offset;\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",passPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	gl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",postprocessVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",proceduralVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n	vPosition = position;\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",refractionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n	vec2 uv = vUV - vec2(0.5);\\r\\n	vec2 offset = uv * depth * ref;\\r\\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",roadPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n	vec3 color = roadColor * ratioy;\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",shadowMapPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n	vec4 res = fract(depth * bit_shift);\\r\\n	res -= res.xxyz * bit_mask;\\r\\n\\r\\n	return res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n	vec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n	return color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n	float depth = vPosition.z / vPosition.w;\\r\\n	depth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n	float moment1 = depth;\\r\\n	float moment2 = moment1 * moment1;\\r\\n\\r\\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n	gl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",shadowMapVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n	gl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",spritesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	if (alphaTest) \\r\\n	{\\r\\n		if (baseColor.a < 0.95)\\r\\n			discard;\\r\\n	}\\r\\n\\r\\n	baseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",spritesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n	vec2 cornerPos;\\r\\n	\\r\\n	float angle = position.w;\\r\\n	vec2 size = vec2(options.x, options.y);\\r\\n	vec2 offset = options.zw;\\r\\n	vec2 uvScale = textureInfos.xy;\\r\\n\\r\\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n	// Color\\r\\n	vColor = color;\\r\\n	\\r\\n	// Texture\\r\\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",ssaoPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	const float base = 0.2;\\r\\n\\r\\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n	float depth = texture2D(textureSampler, vUV).r;\\r\\n	vec3 position = vec3(vUV, depth);\\r\\n	vec3 normal = normalFromDepth(depth, vUV);\\r\\n	float radiusDepth = radius / depth;\\r\\n	float occlusion = 0.0;\\r\\n\\r\\n	vec3 ray;\\r\\n	vec3 hemiRay;\\r\\n	float occlusionDepth;\\r\\n	float difference;\\r\\n\\r\\n	for (int i = 0; i < SAMPLES; i++)\\r\\n	{\\r\\n		ray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n		hemiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n		difference = depth - occlusionDepth;\\r\\n\\r\\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n	}\\r\\n\\r\\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n	float result = clamp(ao + base, 0.0, 1.0);\\r\\n	gl_FragColor.r = result;\\r\\n	gl_FragColor.g = result;\\r\\n	gl_FragColor.b = result;\\r\\n	gl_FragColor.a = 1.0;\\r\\n}\\r\\n\",ssaoCombinePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",stereoscopicInterlacePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n	    useCamB = vUV.x > 0.5;\\r\\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n	    useCamB = vUV.y > 0.5;\\r\\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\n   28: volumetricLightScatteringPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",volumetricLightScatteringPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (diffuseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n	float alpha = 1.0;\\r\\n\\r\\n	#ifdef OPACITYRGB\\r\\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n	#else\\r\\n	alpha *= opacityColor.a * opacityLevel;\\r\\n	#endif\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, alpha);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n	#endif\\r\\n\\r\\n	gl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = diffuseColor;\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, 1.0);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",vrDistortionCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n	float rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n	return LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 tc = HmdWarp(vUV);\\r\\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	else{\\r\\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n	}\\r\\n}\",woodPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n	vec3 wood = woodColor * ratioy;\\r\\n	gl_FragColor = vec4(wood, 1.0);\\r\\n}\"},BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\"no mesh geometry id\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\"couldn\\'t find geometry\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\"./babylon.collisionCoordinator.js\"),importScripts(\"./babylon.collider.js\"),importScripts(\"../Math/babylon.math.js\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\"single worker init\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\"\",function(e){e[e.INIT=0]=\"INIT\",e[e.UPDATE=1]=\"UPDATE\",e[e.COLLIDE=2]=\"COLLIDE\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\"SUCCESS\",e[e.UNKNOWN_ERROR=1]=\"UNKNOWN_ERROR\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\"error returned from worker!\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\"Collisions/babylon.collisionWorker.js\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\"application/javascript\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\"}\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\" A:\"+this.a+\"}\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\"}\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"W:\"+this.w+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\" W:\"+this.w+\"}\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\"LOCAL\",t[t.WORLD=1]=\"WORLD\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\"CW\",t[t.CCW=1]=\"CCW\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\"step size should be less than 1.\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\"cannot add lines to closed paths\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\"normalized length position should be between 0 and 1.\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\"internal error\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\"continue\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\"IsEnabled\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\"x\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\"y\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\"z\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));',\n   29  (window&&window.module||!window&&module)&&module.exports&&(module.exports=BABYLON);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.noworker.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var A=a.prototype.multiplyToArray,T=a.prototype.invertToRef,S=a.LookAtLHToRef,E=n.TransformCoordinatesToRef,C=n.TransformCoordinatesFromFloatsToRef,D=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=A,a.prototype.invertToRef=T,a.LookAtLHToRef=S,n.TransformCoordinatesToRef=E,n.TransformCoordinatesFromFloatsToRef=C,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=D}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,A,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,A=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,A=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,A=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,A=-1}var S=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",E=t[S](o,u,l,x,M,A,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,E)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,A=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[A]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var A,T,S,E,C,D,P,w,I,L,R=new Int32Array(a,0,d);if(R[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(A=R[b]){case l:T=8,S=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(A))}I=1,R[g]&o&&c!==!1&&(I=Math.max(1,R[y]));for(var O=R[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(E=R[v],C=R[_],P=R[m]+4,L=0;I>L;++L){if(h.isRGB)24==O?(D=E*C*3,w=t.GetRGBArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGB,E,C,0,i.RGB,i.UNSIGNED_BYTE,w)):(D=E*C*4,w=t.GetRGBAArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGBA,E,C,0,i.RGBA,i.UNSIGNED_BYTE,w));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=E,k=Math.floor((E+V-1)/V)*V;D=k*(C-1)+N,w=t.GetLuminanceArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.LUMINANCE,E,C,0,i.LUMINANCE,i.UNSIGNED_BYTE,w)}else D=Math.max(4,E)/4*Math.max(4,C)/4*T,w=new Uint8Array(a,P,D),i.compressedTexImage2D(F,L,S,E,C,0,w);P+=D,E*=.5,C*=.5,E=Math.max(1,E),C=Math.max(1,C)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\cannon.js:\n  423      numVecs++;\n  424      if(numVecs > 180)\n  425:         console.log(numVecs+\" created\");\n  426       */\n  427  };\n  ...\n 2198          //var inertia = b.calculateTransformedInertia(m,q);\n 2199          b.calculateLocalInertia(m,childInertia); // Todo transform!\n 2200:         //console.log(childInertia,m,b.volume(),V);\n 2201  \n 2202          // Add its inertia using the parallel axis theorem, i.e.\n ....\n 2358          n.negate(n);\n 2359          this.faceNormals.push(n);\n 2360:         //console.log(n.toString());\n 2361          var vertex = this.vertices[this.faces[i][0]];\n 2362          if(n.dot(vertex)<0){\n ....\n 2477          var minB = maxminB[1];\n 2478          if(maxA<minB || maxB<minA){\n 2479:             //console.log(minA,maxA,minB,maxB);\n 2480              return false; // Separated\n 2481          }\n ....\n 2516              quatA.vmult(faceANormalWS3,faceANormalWS3);\n 2517              //posA.vadd(faceANormalWS3,faceANormalWS3); // Needed?\n 2518:             //console.log(\"face normal:\",hullA.faceNormals[i].toString(),\"world face normal:\",faceANormalWS3);\n 2519              var d = hullA.testSepAxis(faceANormalWS3, hullB, posA, quatA, posB, quatB);\n 2520              if(d===false){\n ....\n 2534              quatB.vmult(Worldnormal1,Worldnormal1);\n 2535              //posB.vadd(Worldnormal1,Worldnormal1);\n 2536:             //console.log(\"facenormal\",hullB.faceNormals[i].toString(),\"world:\",Worldnormal1.toString());\n 2537              curPlaneTests++;\n 2538              var d = hullA.testSepAxis(Worldnormal1, hullB,posA,quatA,posB,quatB);\n ....\n 2557              //posA.vadd(worldEdge0,worldEdge0); // needed?\n 2558  \n 2559:             //console.log(\"edge0:\",worldEdge0.toString());\n 2560  \n 2561              for(var e1=0; e1<hullB.uniqueEdges.length; e1++){\n ....\n 2563                  quatB.vmult(worldEdge1,worldEdge1);\n 2564                  //posB.vadd(worldEdge1,worldEdge1); // needed?\n 2565:                 //console.log(\"edge1:\",worldEdge1.toString());\n 2566                  worldEdge0.cross(worldEdge1,Cross);\n 2567                  curEdgeEdge++;\n ....\n 2694          }\n 2695          if (closestFaceA<0){\n 2696:             console.log(\"--- did not find any closest face... ---\");\n 2697              return;\n 2698          }\n 2699:         //console.log(\"closest A: \",closestFaceA);\n 2700          // Get the face and construct connected faces\n 2701          var polyA = hullA.faces[closestFaceA];\n ....\n 2744  \n 2745              // Clip face against our constructed plane\n 2746:             //console.log(\"clipping polygon \",printFace(closestFaceA),\" against plane \",planeNormalWS, planeEqWS);\n 2747              this.clipFaceAgainstPlane(pVtxIn, pVtxOut, planeNormalWS, planeEqWS);\n 2748:             //console.log(\" - clip result: \",pVtxOut);\n 2749  \n 2750              // Throw away all clipped points, but save the reamining until next clip\n ....\n 2757          }\n 2758  \n 2759:         //console.log(\"Resulting points after clip:\",pVtxIn);\n 2760  \n 2761          // only keep contact points that are behind the witness face\n ....\n 2769          for (var i=0; i<pVtxIn.length; i++){\n 2770              var depth = planeNormalWS.dot(pVtxIn[i]) + planeEqWS; //???\n 2771:             /*console.log(\"depth calc from normal=\",planeNormalWS.toString(),\" and constant \"+planeEqWS+\" and vertex \",pVtxIn[i].toString(),\" gives \"+depth);*/\n 2772              if (depth <=minDist){\n 2773:                 console.log(\"clamped: depth=\"+depth+\" to minDist=\"+(minDist+\"\"));\n 2774                  depth = minDist;\n 2775              }\n ....\n 2778                  var point = pVtxIn[i];\n 2779                  if(depth<=0){\n 2780:                     /*console.log(\"Got contact point \",point.toString(),\n 2781                        \", depth=\",depth,\n 2782                        \"contact normal=\",separatingNormal.toString(),\n ....\n 3678  \n 3679              if(other.shape instanceof CANNON.Plane){\n 3680:                 //console.log(p.position.z+\"<\"+other.aabbmin.z+\" = \",p.position.z < other.aabbmin.z);\n 3681              }\n 3682  \n ....\n 5598              var q = convexConvex_q;\n 5599              si.clipAgainstHull(xi,qi,sj,xj,qj,sepAxis,-100,100,res);\n 5600:             //console.log(res.length);\n 5601              for(var j=0; j!==res.length; j++){\n 5602                  var r = makeResult(bi,bj);\n ....\n 6627      }\n 6628  \n 6629:     //console.log(\"GWlambda:\",GWlambda);\n 6630  \n 6631      return GWlambda;\n ....\n 6854      }\n 6855  \n 6856:     //console.log(\"GWlambda:\",GWlambda);\n 6857  \n 6858      return GWlambda;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KSectorSrv.js:\n  235      KSectorSrv.prototype.draw = function()\n  236      {\n  237:         console.log('actors'+this.actorList.length);\n  238          for(var row=this.sectorUnit-1; row>=0; --row)\n  239          {\n  240:             console.log(this.groundList[row]);\n  241          }\n  242      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  113          var posX = heroActor.actorData.position.x;\n  114          var posY = heroActor.actorData.position.y;\n  115:         console.log(posX+\" \"+posY);\n  116          var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117          var velY = 0;//heroActor.actorData.lastVelocity.y;\n  ...\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  120          var punch = this.createActor(user, username, physics, \"P\");\n  121:         console.log('punch');\n  122      }\n  123  \n  ...\n  129          var posX = heroActor.actorData.position.x;\n  130          var posY = heroActor.actorData.position.y;\n  131:         console.log(\"P\"+posX+\" \"+posY);\n  132          var velX = heroActor.actorData.lastVelocity.x*chargeTime;\n  133          var velY = heroActor.actorData.lastVelocity.y*chargeTime;\n  134:         console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  136          var username = user.userData.username.substring(0, 3)+'shoot';\n  137          var shoot = this.createActor(user, username, physics, \"S\");\n  138:         console.log('shoot');\n  139      }\n  140      KWorld.prototype.createActor = function(user, name, physics, visual)\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n   70  \n   71      io.on('connection', function (socket) {\n   72:     	console.log(\"Socket setup start\");\n   73      	\n   74  \n   ..\n   80  \n   81      	socket.on('c-userLaunch', function (populatedUserData) {\n   82:             console.log('Connection ' + populatedUserData.socketid + ' connecting');\n   83  \n   84              if (KUtil.findIndex(g_world.users, populatedUserData.socketid) > -1) {\n   85:                 console.log('That userID is already connected, kicking');\n   86                  socket.disconnect();\n   87              } else if (!KUtil.validNick(populatedUserData.username)) {\n   ..\n   90              } else {\n   91                  user.userData.clone(populatedUserData);\n   92:                 console.log('Connection ' + user.userData.socketid + ' connected');\n   93                  g_sockets[user.userData.socketid] = socket;\n   94  \n   95                  sendAddPacketsToSocket(user.userData.socketid);\n   96:                 console.log('Sent first data to ' + user.userData.socketid);\n   97  \n   98                  user.lastHeartbeat = new Date().getTime();\n   ..\n  102              	g_world.users.push(user);\n  103  \n  104:                 console.log('Total users: ' + g_world.users.length);\n  105              }\n  106  \n  ...\n  117          socket.on('c-requestSector', function (sectorData) {\n  118              \n  119:             console.log('requested sector');\n  120:             console.log(sectorData);\n  121  \n  122              var sector = g_world.getSectorSecPos(sectorData.x,sectorData.y);\n  ...\n  138                  turnLength: config.turnLength\n  139              });\n  140:             console.log('Connection ' + user.userData.socketid + ' initialized');\n  141          });\n  142  \n  ...\n  144              if (KUtil.findIndex(g_world.users, user.userData.socketid) > -1)\n  145                  g_world.users.splice(KUtil.findIndex(g_world.users, user.userData.socketid), 1);\n  146:             console.log('Connection' + user.userData.socketid + ' disconnected');\n  147  \n  148              socket.broadcast.emit('playerDisconnect', { name: user.userData.username });\n  ...\n  158              else\n  159              {\n  160:                 console.log('missing main actor');\n  161:                 console.log(user);\n  162              }\n  163          });\n  164:         console.log('Socket setup finish');\n  165      });\n  166      serverPort = process.env.PORT || config.port;\n  167      http.listen(serverPort, function() {\n  168:       console.log(\"Server is listening on port \" + serverPort);\n  169      });\n  170  \n  ...\n  208  \n  209  function sendReport() {\n  210: 	console.log('users');\n  211      g_world.users.forEach( function(user) \n  212      {\n  213:     	console.log(user.userData.socketid+','+user.userData.userID);\n  214  	});\n  215: 	console.log('actors');\n  216  	g_world.actors.forEach( function(actor) \n  217      {\n  218:         console.log(actor.actorData.actorname);\n  219:         console.log(actor.actorData.position);\n  220      });\n  221:     //console.log('sectorZero');\n  222      //var sector = g_world.getSectorSecPos(0,0);\n  223      //sector.draw();\n\n104 matches across 13 files\n\n\nSearching 42 files for \"console.log\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\app.js:\n   80  function validNick() {\n   81      var regex = /^\\w*$/;\n   82:     //console.log('Regex Test', regex.exec(playerNameInput.value));\n   83      return regex.exec(playerNameInput.value) !== null;\n   84  }\n   ..\n   97      socket.on('s-pong', function () {\n   98          var latency = Date.now() - startPingTime;\n   99:         console.log('Latency: ' + latency + 'ms');\n  100      });\n  101  \n  ...\n  108  \n  109      socket.on('s-kick', function () {\n  110:         console.log('kicked');\n  111          \n  112      });\n  ...\n  126  \n  127      game.setupGameSocket(socket);\n  128:     console.log(socket);\n  129  }\n  130  \n\n\\\\STRAWBERRY\\Code\\kiloio\\client\\js\\prep.js:\n    6  var hudCanvas = null;\n    7  \n    8: var checkNick = function() { console.log('checkNick'); }\n    9  var doHandleKeyDown = function(key) { }\n   10  var doHandleKeyUp = function(key) { }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  226          if( idx < 0 )\n  227          {\n  228:           //console.log(idx);\n  229:           //console.log(userData);\n  230:           //console.log(userData.userID);\n  231          }\n  232          else\n  ...\n  240          if( idx < 0 )\n  241          {\n  242:           //console.log(idx);\n  243:           //console.log(actorData);\n  244:           //console.log(actorData.actorID);\n  245          }\n  246          else\n  ...\n  309      if( uidx < 0 )\n  310      {\n  311:       console.log('rcvAddActor missing user');\n  312:       console.log(p_actorData.userID);\n  313      }\n  314      else\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KSectorCli.js:\n   37  			}\n   38  		}\n   39: 		//console.log('populated'+this.secX+','+this.secY);\n   40  		this.isPopulated = true;\n   41  	}\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n   32  \n   33      function showHelp() {\n   34:         console.log('See https://github.com/jrburke/r.js for usage.');\n   35      }\n   36  \n   ..\n   48  \n   49          exists = function () {\n   50:             console.log('x.js exists not applicable in browser env');\n   51              return false;\n   52          };\n   ..\n  124          };\n  125  \n  126:         //Define a console.log for easier logging. Don't\n  127          //get fancy though.\n  128          if (typeof console === 'undefined') {\n  ...\n  238          };\n  239  \n  240:         //Define a console.log for easier logging. Don't\n  241          //get fancy though.\n  242          if (typeof console === 'undefined') {\n  ...\n 1246                      //resolve the plugin, as it is built into that paths layer.\n 1247                      if (bundleId) {\n 1248:                         console.log(bundleId);\n 1249                          this.map.url = context.nameToUrl(bundleId);\n 1250                          this.load();\n ....\n 3369  \n 3370      function mkDir(dir) {\n 3371:         console.log('mkDir is no-op in browser');\n 3372      }\n 3373  \n 3374      function mkFullDir(dir) {\n 3375:         console.log('mkFullDir is no-op in browser');\n 3376      }\n 3377  \n ....\n 3435  \n 3436          getFilteredFileList: function (startDir, regExpFilters, makeUnixPaths) {\n 3437:             console.log('file.getFilteredFileList is no-op in browser');\n 3438          },\n 3439  \n 3440          copyDir: function (srcDir, destDir, regExpFilter, onlyCopyNew) {\n 3441:             console.log('file.copyDir is no-op in browser');\n 3442  \n 3443          },\n 3444  \n 3445          copyFile: function (srcFileName, destFileName, onlyCopyNew) {\n 3446:             console.log('file.copyFile is no-op in browser');\n 3447          },\n 3448  \n ....\n 3451           */\n 3452          renameFile: function (from, to) {\n 3453:             console.log('file.renameFile is no-op in browser');\n 3454          },\n 3455  \n ....\n 3498  \n 3499          deleteFile: function (fileName) {\n 3500:             console.log('file.deleteFile is no-op in browser');\n 3501          },\n 3502  \n ....\n 3505           */\n 3506          deleteEmptyDirs: function (startDir) {\n 3507:             console.log('file.deleteEmptyDirs is no-op in browser');\n 3508          }\n 3509      };\n ....\n 4457  define('browser/print', function () {\n 4458      function print(msg) {\n 4459:         console.log(msg);\n 4460      }\n 4461  \n ....\n 4477  define('node/print', function () {\n 4478      function print(msg) {\n 4479:         console.log(msg);\n 4480      }\n 4481  \n ....\n 23611                                  compressor.warn(ex.toString());\n 23612                              } else {\n 23613:                                 console.log(ex);\n 23614                                  throw ex;\n 23615                              }\n .....\n 24829          //moz_to_me = parse(moz_to_me).print_to_string({ beautify: true });\n 24830          //me_to_moz = parse(me_to_moz).print_to_string({ beautify: true });\n 24831:         //console.log(moz_to_me);\n 24832  \n 24833          moz_to_me = new Function(\"my_start_token\", \"my_end_token\", \"from_moz\", \"return(\" + moz_to_me + \")\")(\n .....\n 28305                      if (commonJsPath === \"convert\") {\n 28306                          //A request just to convert one file.\n 28307:                         console.log('\\n\\n' + commonJs.convert(savePath, file.readFile(savePath)));\n 28308                      } else {\n 28309:                         console.log(\"No files to convert in directory: \" + commonJsPath);\n 28310                      }\n 28311                  }\n .....\n 28360  \n 28361              } catch (e) {\n 28362:                 console.log(\"commonJs.convert: COULD NOT CONVERT: \" + fileName + \", so skipping it. Error was: \" + e);\n 28363                  return fileContents;\n 28364              }\n .....\n 29053                  }\n 29054  \n 29055:                 //console.log('PLUGIN COLLECTOR: ' + JSON.stringify(pluginCollector, null, \"  \"));\n 29056  \n 29057  \n .....\n 29554                      process.stdout.write(content);\n 29555                  } else {\n 29556:                     console.log(content);\n 29557                  }\n 29558              };\n .....\n 30471                      // turned off error logging. Since quit is\n 30472                      // called want to be sure a message is printed.\n 30473:                     console.log(err);\n 30474                      quit(1);\n 30475                  };\n .....\n 30569  \n 30570      } else if (commandOption === 'v') {\n 30571:         console.log('r.js: ' + version +\n 30572                      ', RequireJS: ' + this.requirejsVars.require.version +\n 30573                      ', UglifyJS2: 2.4.23, UglifyJS: 1.3.4');\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\pixi.js:\n 14092          else\n 14093          {\n 14094:           //  console.log(\"<<>>\")\n 14095              if (!sms.reverse)\n 14096              {\n .....\n 14536          });\n 14537  \n 14538:         console.log( makePropSetter( key, \" bloop\", uniform.type )  )\n 14539    //      Object.def\n 14540          //    location = uniform._location,\n .....\n 14884      if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS))\n 14885      {\n 14886:         console.log(this.gl.getShaderInfoLog(shader));\n 14887          return null;\n 14888      }\n .....\n 18150      }\n 18151  \n 18152:   //  console.log(frame);\n 18153  \n 18154      /**\n .....\n 19410              ];\n 19411  \n 19412:             window.console.log.apply(console, args); //jshint ignore:line\n 19413          }\n 19414          else if (window.console)\n 19415          {\n 19416:             window.console.log('Pixi.js ' + CONST.VERSION + ' - ' + type + ' - http://www.pixijs.com/'); //jshint ignore:line\n 19417          }\n 19418  \n .....\n 24766  InteractionManager.prototype.processTouchStart = function ( displayObject, hit )\n 24767  {\n 24768:     //console.log(\"hit\" + hit)\n 24769      if(hit)\n 24770      {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 4701          Tools._LogEnabled = function (message) {\n 4702              var formattedMessage = Tools._FormatMessage(message);\n 4703:             console.log(\"BJS - \" + formattedMessage);\n 4704              var entry = \"<div style='color:white'>\" + formattedMessage + \"</div><br>\";\n 4705              Tools._AddLogEntry(entry);\n ....\n 30387              });\n 30388              if (gCount > 1) {\n 30389:                 console.log(triangle, gCount);\n 30390              }\n 30391              return gCount > 1;\n .....\n 31853  //# sourceMappingURL=babylon.stereoscopicCameras.js.map\n 31854  BABYLON.Effect.ShadersStore={\"anaglyphPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n\\tvec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",\"blackAndWhitePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tfloat luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\tgl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",\"blurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat weights[7];\\r\\n\\tweights[0] = 0.05;\\r\\n\\tweights[1] = 0.1;\\r\\n\\tweights[2] = 0.2;\\r\\n\\tweights[3] = 0.3;\\r\\n\\tweights[4] = 0.2;\\r\\n\\tweights[5] = 0.1;\\r\\n\\tweights[6] = 0.05;\\r\\n\\r\\n\\tvec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n\\tvec2 texelStep = texelSize * direction * blurWidth;\\r\\n\\tvec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n\\tvec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n\\tvec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n\\tfor (int i = 0; i < 7; i++)\\r\\n\\t{\\r\\n\\t\\tbaseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n\\t\\ttexelOffset += texelStep;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"brickPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfBricksWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfBricksHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.05;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n\\t\\tif (brickColorSwitch == 0.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n\\t\\telse if (brickColorSwitch == 2.0)\\r\\n\\t\\t\\tcolor = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"chromaticAberrationPixelShader\":\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tfloat radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n\\t\\t+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tfloat radius = sqrt(radius2);\\r\\n\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tif (chromatic_aberration > 0.0) {\\r\\n\\t\\t//index of refraction of each color channel, causing chromatic dispersion\\r\\n\\t\\tvec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n\\t\\tfloat ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n\\t\\tfloat ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n\\t\\t// shifts for red, green & blue\\r\\n\\t\\tvec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n\\t\\tvec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n\\t\\toriginal.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n\\t\\toriginal.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n\\t\\toriginal.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = original;\\r\\n}\",\"cloudPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n\\tvec2 p = vUV * 12.0;\\r\\n\\tvec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n\\tgl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",\"colorPixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"colorVertexShader\":\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",\"colorCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// screen render\\r\\nuniform sampler2D colorTable;\\t\\t// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;\\t\\t// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n\\tfloat sliceSize = 1.0 / width;              // space of 1 slice\\r\\n\\tfloat slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n\\tfloat sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n\\tfloat zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n\\tfloat zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n\\tfloat xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n\\tfloat s0 = xOffset + (zSlice0 * sliceSize);\\r\\n\\tfloat s1 = xOffset + (zSlice1 * sliceSize);\\r\\n\\tvec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n\\tvec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n\\tfloat zOffset = mod(uv.z * width, 1.0);\\r\\n\\tvec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 screen_color = texture2D(textureSampler, vUV);\\r\\n\\tgl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",\"convolutionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n\\tvec4 colorSum =\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n\\t\\ttexture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n\\tfloat kernelWeight =\\r\\n\\t\\tkernel[0] +\\r\\n\\t\\tkernel[1] +\\r\\n\\t\\tkernel[2] +\\r\\n\\t\\tkernel[3] +\\r\\n\\t\\tkernel[4] +\\r\\n\\t\\tkernel[5] +\\r\\n\\t\\tkernel[6] +\\r\\n\\t\\tkernel[7] +\\r\\n\\t\\tkernel[8];\\r\\n\\r\\n\\tif (kernelWeight <= 0.0) {\\r\\n\\t\\tkernelWeight = 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",\"defaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn vPositionUVW;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n\\treturn dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn darkness;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat visibility = 1.;\\r\\n\\r\\n\\tvec2 poissonDisk[4];\\r\\n\\tpoissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n\\tpoissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n\\tpoissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n\\tpoissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n\\t// Poisson Sampling\\r\\n\\tfloat biasedDepth = depth.z - bias;\\r\\n\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\tif (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n\\treturn visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n\\treturn clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n\\tfloat p = smoothstep(compare - bias, compare, moments.x);\\r\\n\\tfloat variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n\\tfloat d = compare - moments.x;\\r\\n\\tfloat p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n\\treturn clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tdepth = 0.5 * depth + vec3(0.5);\\r\\n\\tvec2 uv = depth.xy;\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n\\t// get edge vectors of the pixel triangle\\r\\n\\tvec3 dp1 = dFdx(p);\\r\\n\\tvec3 dp2 = dFdy(p);\\r\\n\\tvec2 duv1 = dFdx(uv);\\r\\n\\tvec2 duv2 = dFdy(uv);\\r\\n\\r\\n\\t// solve the linear system\\r\\n\\tvec3 dp2perp = cross(dp2, normal);\\r\\n\\tvec3 dp1perp = cross(normal, dp1);\\r\\n\\tvec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n\\tvec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n\\t// construct a scale-invariant frame \\r\\n\\tfloat invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n\\treturn mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n\\tvec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n\\tmap = map * 255. / 127. - 128. / 127.;\\r\\n\\tmat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n\\treturn normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n\\tvec3 diffuse;\\r\\n\\tvec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tfloat attenuation = 1.0;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n\\t\\tattenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\t\\tlightVectorW = normalize(direction);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n\\tresult.diffuse = ndl * diffuseColor * attenuation;\\r\\n\\tresult.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\tvec3 direction = lightData.xyz - vPositionW;\\r\\n\\tvec3 lightVectorW = normalize(direction);\\r\\n\\tfloat attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n\\t\\tresult.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult.diffuse = vec3(0.);\\r\\n\\tresult.specular = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tlightingInfo result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n\\tresult.specular = specComp * specularColor;\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n\\talpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n#ifdef NORMAL\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n\\tvec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tnormalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tlightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tlightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tlightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF0\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF1\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n\\t#endif\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF2\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n\\t#ifdef SHADOWPCF3\\r\\n\\t\\tshadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n\\t#else\\r\\n\\t\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n\\t#endif\\t\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info.diffuse * shadow;\\r\\n\\tspecularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n\\talpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"defaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n\\tfinalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n\\r\\n\\t// Point size\\r\\n#ifdef POINTSIZE\\r\\n\\tgl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",\"depthPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tfloat depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n\\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",\"depthVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"depthBoxBlurPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 colorDepth = vec4(0.0);\\r\\n\\r\\n\\tfor (int x = -OFFSET; x <= OFFSET; x++)\\r\\n\\t\\tfor (int y = -OFFSET; y <= OFFSET; y++)\\r\\n\\t\\t\\tcolorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n\\tgl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",\"depthOfFieldPixelShader\":\"// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;\\t\\t// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;\\t\\t// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI \\t\\t3.14159265\\r\\n#define TWOPI \\t6.28318530\\r\\n#define inverse_focal_length 0.1\\t// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n\\tfloat noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n\\tfloat noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n\\treturn clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n\\tif (distortion == 0.0) { return coords; }\\r\\n\\r\\n\\tvec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n\\tvec2 dist_coords = vec2(0.5, 0.5);\\r\\n\\tdist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n\\tdist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n\\tfloat dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n\\tdist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n\\treturn dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n\\t// compute coords with offset (a random angle is added)\\r\\n\\tvec2 coords = distorted_coords;\\r\\n\\tfloat angle = rand(coords * 100.0).x * TWOPI;\\r\\n\\tcoords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n\\tcolor += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n\\treturn weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n\\treturn min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n\\tvec4 col = texture2D(textureSampler, distorted_coords);\\r\\n\\tif (size == 0.0) { return col; }\\r\\n\\r\\n\\t// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n\\t// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n\\tfloat blur_level = getBlurLevel(size);\\r\\n\\r\\n\\tfloat w = (size / screen_width);\\r\\n\\tfloat h = (size / screen_height);\\r\\n\\tfloat total_weight = 1.0;\\r\\n\\tvec2 sample_coords;\\r\\n\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n\\ttotal_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n\\tif (blur_level > 1.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n\\t}\\r\\n\\r\\n\\tif (blur_level > 2.0) {\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n\\t\\ttotal_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n\\t}\\r\\n\\r\\n\\tcol /= total_weight;\\t\\t// scales color according to weights\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t// darken if out of focus\\r\\n\\tif (darken > 0.0) {\\r\\n\\t\\tcol.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n\\t}\\r\\n\\r\\n\\t// blur levels debug\\r\\n\\t// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n\\t// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n\\t// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n\\t// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n\\tcentered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n\\tradius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n\\tradius = sqrt(radius2);\\r\\n\\tdistorted_coords = getDistortedCoords(vUV);\\t\\t// we distort the screen coordinates (lens \\\"magnifying\\\" effect)\\r\\n\\tvec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);\\t// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n\\tfloat depth = texture2D(depthSampler, distorted_coords).r;\\t// depth value from DepthRenderer: 0 to 1\\r\\n\\tfloat distance = near + (far - near)*depth;\\t\\t// actual distance from the lens\\r\\n\\tvec4 color = texture2D(textureSampler, vUV);\\t// original raster\\r\\n\\r\\n\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t// screen_distance is precomputed in code\\r\\n\\tfloat coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n\\t// disable blur\\r\\n\\tif (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n\\t// blur from edge blur effect\\r\\n\\tfloat edge_blur_amount = 0.0;\\r\\n\\tif (edge_blur > 0.0) {\\r\\n\\t\\tedge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n\\t}\\r\\n\\r\\n\\t// total blur amount\\r\\n\\tfloat blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n\\t// apply blur if necessary\\r\\n\\tif (blur_amount == 0.0) {\\r\\n\\t\\tgl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\r\\n\\t\\t// add blurred color\\r\\n\\t\\tgl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n\\t\\t// if we have computed highlights: enhance highlights\\r\\n\\t\\tif (highlights) {\\r\\n\\t\\t\\tgl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (blur_noise) {\\r\\n\\t\\t\\t// we put a slight amount of noise in the blurred color\\r\\n\\t\\t\\tvec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n\\t\\t\\tvec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n\\t\\t\\tgl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\t// apply grain\\r\\n\\tif (grain_amount > 0.0) {\\r\\n\\t\\tvec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n\\t\\tgl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n\\t}\\r\\n\\r\\n}\\r\\n\",\"displayPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",\"filterPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n\\tvec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",\"firePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\tvec2 p = vUV * 8.0;\\r\\n\\tfloat q = fbm(p - time * 0.1);\\r\\n\\tvec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n\\tvec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n\\tvec3 color = c * cos(shift * vUV.y);\\r\\n\\tfloat luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n\\tgl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",\"fxaaPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n\\tvec2 localTexelSize = texelSize;\\r\\n\\tvec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n\\tvec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n\\tvec4 rgbM = texture2D(textureSampler, vUV);\\r\\n\\tvec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n\\tfloat lumaNW = dot(rgbNW, luma);\\r\\n\\tfloat lumaNE = dot(rgbNE, luma);\\r\\n\\tfloat lumaSW = dot(rgbSW, luma);\\r\\n\\tfloat lumaSE = dot(rgbSE, luma);\\r\\n\\tfloat lumaM = dot(rgbM, luma);\\r\\n\\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n\\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n\\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n\\tfloat dirReduce = max(\\r\\n\\t\\t(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n\\t\\tFXAA_REDUCE_MIN);\\r\\n\\r\\n\\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n\\tdir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n\\t\\tmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n\\t\\tdir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n\\tvec4 rgbA = 0.5 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n\\tvec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n\\t\\ttexture2D(textureSampler, vUV + dir * 0.5));\\r\\n\\tfloat lumaB = dot(rgbB, luma);\\r\\n\\tif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n\\t\\tgl_FragColor = rgbA;\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tgl_FragColor = rgbB;\\r\\n\\t}\\r\\n}\",\"grassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n\\tcolor = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n\\tcolor = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n\\tcolor = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"layerPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"layerVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"legacydefaultPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION\\t4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\t\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n\\tfloat fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n\\treturn clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n\\tconst vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n\\treturn dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n\\treturn color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n\\tif (depth.z > shadow)\\r\\n\\t{\\r\\n\\t\\treturn 0.;\\r\\n\\t}\\r\\n\\treturn 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n\\tif (t <= moments.x)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tfloat variance = moments.y - (moments.x * moments.x);\\r\\n\\tvariance = max(variance, 0.);\\r\\n\\r\\n\\tfloat d = t - moments.x;\\r\\n\\treturn variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n\\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n\\tvec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n\\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n\\t{\\r\\n\\t\\treturn 1.0;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n\\tvec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n\\treturn clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW;\\r\\n\\tif (lightData.w == 0.)\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tlightVectorW = normalize(-lightData.xyz);\\r\\n\\t}\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n\\tresult[0] = ndl * diffuseColor.rgb;\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\tvec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n\\t// diffuse\\r\\n\\tfloat cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n\\tfloat spotAtten = 0.0;\\r\\n\\r\\n\\tif (cosAngle >= lightDirection.w)\\r\\n\\t{\\r\\n\\t\\tcosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n\\t\\tspotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n\\t\\t// Diffuse\\r\\n\\t\\tfloat ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n\\t\\t// Specular\\r\\n\\t\\tvec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n\\t\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\t\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\t\\tresult[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n\\t\\tresult[1] = specComp * specularColor * spotAtten;\\r\\n\\t\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\t\\treturn result;\\r\\n\\t}\\r\\n\\r\\n\\tresult[0] = vec3(0.);\\r\\n\\tresult[1] = vec3(0.);\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n\\tmat3 result;\\r\\n\\r\\n\\t// Diffuse\\r\\n\\tfloat ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n\\t// Specular\\r\\n\\tvec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n\\tfloat specComp = max(0., dot(vNormal, angleW));\\r\\n\\tspecComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n\\tresult[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n\\tresult[1] = specComp * specularColor;\\r\\n\\tresult[2] = vec3(0.);\\r\\n\\r\\n\\treturn result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n\\t// Base color\\r\\n\\tvec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n\\tvec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tbaseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tbaseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (baseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tbaseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Bump\\r\\n\\tvec3 normalW = normalize(vNormalW);\\r\\n\\r\\n\\t// Ambient color\\r\\n\\tvec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tbaseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Lighting\\r\\n\\tvec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\\tvec3 specularBase = vec3(0., 0., 0.);\\r\\n\\tfloat shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n\\tmat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n\\tmat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n\\tmat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n\\tinfo = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n\\tinfo = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n\\tinfo = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n\\tshadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n\\tshadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif\\t\\r\\n#else\\r\\n\\tshadow = 1.;\\r\\n#endif\\r\\n\\tdiffuseBase += info[0] * shadow;\\r\\n\\tspecularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n\\t// Reflection\\r\\n\\tvec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tif (vReflectionInfos.z != 0.0)\\r\\n\\t{\\r\\n\\t\\treflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n\\t\\tif (vReflectionInfos.x == MAP_PROJECTION)\\r\\n\\t\\t{\\r\\n\\t\\t\\tcoords /= vReflectionUVW.z;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tcoords.y = 1.0 - coords.y;\\r\\n\\r\\n\\t\\treflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n\\t}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n\\tfloat reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n\\treflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Alpha\\r\\n\\tfloat alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n\\topacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n\\talpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n\\talpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n\\tfloat opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n\\talpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n\\t// Emissive\\r\\n\\tvec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n\\temissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n\\tfloat emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n\\temissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Specular map\\r\\n\\tvec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n\\tspecularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n\\t// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n\\tfloat diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n\\tdiffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n\\t// Composition\\r\\n\\tvec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n\\tvec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n\\tvec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"legacydefaultVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT\\t0.\\r\\n#define MAP_SPHERICAL\\t1.\\r\\n#define MAP_PLANAR\\t\\t2.\\r\\n#define MAP_CUBIC\\t\\t3.\\r\\n#define MAP_PROJECTION\\t4.\\r\\n#define MAP_SKYBOX\\t\\t5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n\\tif (mode == MAP_SPHERICAL)\\r\\n\\t{\\r\\n\\t\\tvec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PLANAR)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 1));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_CUBIC)\\r\\n\\t{\\r\\n\\t\\tvec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n\\t\\tvec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n\\t\\treturn vec3(reflectionMatrix * vec4(coords, 0));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_PROJECTION)\\r\\n\\t{\\r\\n\\t\\treturn vec3(reflectionMatrix * (view * worldPos));\\r\\n\\t}\\r\\n\\telse if (mode == MAP_SKYBOX)\\r\\n\\t{\\r\\n\\t\\treturn position;\\r\\n\\t}\\r\\n\\r\\n\\treturn vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n\\tmat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n\\tfinalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n\\tfinalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n\\tvec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n\\tvPositionW = vec3(worldPos);\\r\\n\\tvNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n\\t// Texture coordinates\\r\\n#ifndef UV1\\r\\n\\tvec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n\\tvec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n\\tif (vDiffuseInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n\\tif (vAmbientInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tif (vOpacityInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n\\tvReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n\\tif (vEmissiveInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n\\tif (vSpecularInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n\\tif (vBumpInfos.x == 0.)\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n\\t}\\r\\n\\telse\\r\\n\\t{\\r\\n\\t\\tvBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n\\t}\\r\\n#endif\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n\\t// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n\\tvPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n\\tvPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n\\tvPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n\\tvPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n\\t// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n\\tvColor = color;\\r\\n#endif\\r\\n}\",\"lensFlarePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = baseColor * color;\\r\\n}\",\"lensFlareVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",\"lensHighlightsPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\t// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n\\tvec4 highlight = color;\\r\\n\\tfloat luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n\\tfloat lum_threshold;\\r\\n\\tif (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n\\telse { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n\\tluminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n\\thighlight *= luminance * gain;\\r\\n\\thighlight.a = 1.0;\\r\\n\\r\\n\\treturn highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n\\t// quick exit if no highlight computing\\r\\n\\tif (gain == -1.0) {\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t\\treturn;\\r\\n\\t}\\r\\n\\r\\n\\tfloat w = 2.0 / screen_width;\\r\\n\\tfloat h = 2.0 / screen_height;\\r\\n\\r\\n\\tfloat weight = 1.0;\\r\\n\\r\\n\\t// compute blurred color\\r\\n\\tvec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n\\tif (pentagon) {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n\\t\\tblurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n\\t}\\r\\n\\r\\n\\tblurred /= 39.0;\\r\\n\\r\\n\\tgl_FragColor = blurred;\\r\\n\\r\\n\\t//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",\"marblePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n\\tfloat val = 0.0;\\r\\n\\tfloat freq = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++)\\r\\n\\t{\\r\\n\\t\\tval += abs(noise(P*freq) / freq);\\r\\n\\t\\tfreq *= 2.07;\\r\\n\\t}\\r\\n\\treturn val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n\\treturn sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n\\tvec3 col;\\r\\n\\tx = 0.5*(x + 1.);\\r\\n\\tx = sqrt(x);             \\r\\n\\tx = sqrt(x);\\r\\n\\tx = sqrt(x);\\r\\n\\tcol = vec3(.2 + .75*x);  \\r\\n\\tcol.b *= 0.95;           \\r\\n\\treturn col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n\\tfloat brickW = 1.0 / numberOfTilesWidth;\\r\\n\\tfloat brickH = 1.0 / numberOfTilesHeight;\\r\\n\\tfloat jointWPercentage = 0.01;\\r\\n\\tfloat jointHPercentage = 0.01;\\r\\n\\tvec3 color = brickColor;\\r\\n\\tfloat yi = vUV.y / brickH;\\r\\n\\tfloat nyi = round(yi);\\r\\n\\tfloat xi = vUV.x / brickW;\\r\\n\\r\\n\\tif (mod(floor(yi), 2.0) == 0.0){\\r\\n\\t\\txi = xi - 0.5;\\r\\n\\t}\\r\\n\\r\\n\\tfloat nxi = round(xi);\\r\\n\\tvec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n\\tif (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n\\t\\tcolor = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n\\t}\\r\\n\\telse {\\r\\n\\t\\tfloat t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n\\t\\tt += amplitude * turbulence(brickvUV.xy);\\r\\n\\t\\tt = sin(t);\\r\\n\\t\\tcolor = marble_color(t);\\r\\n\\t}\\r\\n\\r\\n\\tgl_FragColor = vec4(color, 0.0);\\r\\n}\",\"outlinePixelShader\":\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = color;\\r\\n}\",\"outlineVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n\\tvec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n\\tgl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"particlesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n\\tif (fClipDistance > 0.0)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tgl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",\"particlesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n\\tvec3 cornerPos;\\r\\n\\tfloat size = options.y;\\r\\n\\tfloat angle = options.x;\\r\\n\\tvec2 offset = options.zw;\\r\\n\\r\\n\\tcornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\t\\r\\n\\tvColor = color;\\r\\n\\tvUV = offset;\\r\\n\\r\\n\\t// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n\\tvec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n\\tfClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",\"passPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n\\tgl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",\"postprocessVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"proceduralVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvPosition = position;\\r\\n\\tvUV = position * madd + madd;\\r\\n\\tgl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",\"refractionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n\\tfloat ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n\\tvec2 uv = vUV - vec2(0.5);\\r\\n\\tvec2 offset = uv * depth * ref;\\r\\n\\tvec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n\\tgl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",\"roadPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n\\tvec3 color = roadColor * ratioy;\\r\\n\\tgl_FragColor = vec4(color, 1.0);\\r\\n}\",\"shadowMapPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n\\tconst vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n\\tconst vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n\\tvec4 res = fract(depth * bit_shift);\\r\\n\\tres -= res.xxyz * bit_mask;\\r\\n\\r\\n\\treturn res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n\\tconst vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n\\tvec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n\\treturn color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n\\tif (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\tfloat depth = vPosition.z / vPosition.w;\\r\\n\\tdepth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n\\tfloat moment1 = depth;\\r\\n\\tfloat moment2 = moment1 * moment1;\\r\\n\\r\\n\\tgl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n\\tgl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",\"shadowMapVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n\\tmat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n\\tmat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n\\tmat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n\\tmat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n\\tmat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\tmat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n\\tfinalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n\\tvPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\tgl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n\\tvUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",\"spritesPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n\\tfloat fogCoeff = 1.0;\\r\\n\\tfloat fogStart = vFogInfos.y;\\r\\n\\tfloat fogEnd = vFogInfos.z;\\r\\n\\tfloat fogDensity = vFogInfos.w;\\r\\n\\r\\n\\tif (FOGMODE_LINEAR == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n\\t}\\r\\n\\telse if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n\\t{\\r\\n\\t\\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n\\t}\\r\\n\\r\\n\\treturn min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n\\tvec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n\\tif (alphaTest) \\r\\n\\t{\\r\\n\\t\\tif (baseColor.a < 0.95)\\r\\n\\t\\t\\tdiscard;\\r\\n\\t}\\r\\n\\r\\n\\tbaseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n\\tfloat fog = CalcFogFactor();\\r\\n\\tbaseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n\\tgl_FragColor = baseColor;\\r\\n}\",\"spritesVertexShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\t\\r\\n\\tvec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n\\tvec2 cornerPos;\\r\\n\\t\\r\\n\\tfloat angle = position.w;\\r\\n\\tvec2 size = vec2(options.x, options.y);\\r\\n\\tvec2 offset = options.zw;\\r\\n\\tvec2 uvScale = textureInfos.xy;\\r\\n\\r\\n\\tcornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n\\t// Rotate\\r\\n\\tvec3 rotatedCorner;\\r\\n\\trotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n\\trotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n\\trotatedCorner.z = 0.;\\r\\n\\r\\n\\t// Position\\r\\n\\tviewPos += rotatedCorner;\\r\\n\\tgl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n\\t// Color\\r\\n\\tvColor = color;\\r\\n\\t\\r\\n\\t// Texture\\r\\n\\tvec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n\\tvUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n\\t// Fog\\r\\n#ifdef FOG\\r\\n\\tfFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",\"ssaoPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n\\tfloat depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n\\tfloat depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tconst float base = 0.2;\\r\\n\\r\\n\\tvec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n\\tfloat depth = texture2D(textureSampler, vUV).r;\\r\\n\\tvec3 position = vec3(vUV, depth);\\r\\n\\tvec3 normal = normalFromDepth(depth, vUV);\\r\\n\\tfloat radiusDepth = radius / depth;\\r\\n\\tfloat occlusion = 0.0;\\r\\n\\r\\n\\tvec3 ray;\\r\\n\\tvec3 hemiRay;\\r\\n\\tfloat occlusionDepth;\\r\\n\\tfloat difference;\\r\\n\\r\\n\\tfor (int i = 0; i < SAMPLES; i++)\\r\\n\\t{\\r\\n\\t\\tray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n\\t\\themiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n\\t\\tocclusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n\\t\\tdifference = depth - occlusionDepth;\\r\\n\\r\\n\\t\\tocclusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n\\t}\\r\\n\\r\\n\\tfloat ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n\\tfloat result = clamp(ao + base, 0.0, 1.0);\\r\\n\\tgl_FragColor.r = result;\\r\\n\\tgl_FragColor.g = result;\\r\\n\\tgl_FragColor.b = result;\\r\\n\\tgl_FragColor.a = 1.0;\\r\\n}\\r\\n\",\"ssaoCombinePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n\\tgl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",\"stereoscopicInterlacePixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n\\t    useCamB = vUV.x > 0.5;\\r\\n\\t    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n\\t    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n\\t    useCamB = vUV.y > 0.5;\\r\\n\\t    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n\\t    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\"volumetricLightScatteringPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n\\tvec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n\\tvec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n\\t\\tvec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",\"volumetricLightScatteringPassPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n\\tvec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n\\tif (diffuseColor.a < 0.4)\\r\\n\\t\\tdiscard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n\\tvec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n\\tfloat alpha = 1.0;\\r\\n\\r\\n\\t#ifdef OPACITYRGB\\r\\n\\topacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n\\talpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n\\t#else\\r\\n\\talpha *= opacityColor.a * opacityLevel;\\r\\n\\t#endif\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, alpha);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n\\t#endif\\r\\n\\r\\n\\tgl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n\\t#if defined(BASIC_RENDER)\\r\\n\\tgl_FragColor = diffuseColor;\\r\\n\\t#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n\\tgl_FragColor = vec4(color.rgb, 1.0);\\r\\n\\t#else\\r\\n\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\t#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",\"vrDistortionCorrectionPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n\\tvec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n\\tfloat rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n\\tvec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n\\treturn LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\tvec2 tc = HmdWarp(vUV);\\r\\n\\tif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n\\telse{\\r\\n\\t\\tgl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n\\t}\\r\\n}\",\"woodPixelShader\":\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n\\treturn fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n\\tconst vec2 d = vec2(0.0, 1.0);\\r\\n\\tvec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n\\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n\\tfloat total = 0.0, amplitude = 1.0;\\r\\n\\tfor (int i = 0; i < 4; i++) {\\r\\n\\t\\ttotal += noise(n) * amplitude;\\r\\n\\t\\tn += n;\\r\\n\\t\\tamplitude *= 0.5;\\r\\n\\t}\\r\\n\\treturn total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n\\tfloat ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n\\tvec3 wood = woodColor * ratioy;\\r\\n\\tgl_FragColor = vec4(wood, 1.0);\\r\\n}\"};\n 31855: BABYLON.CollisionWorker=\"var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\\\"no mesh geometry id\\\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\\\"couldn't find geometry\\\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\\\"./babylon.collisionCoordinator.js\\\"),importScripts(\\\"./babylon.collider.js\\\"),importScripts(\\\"../Math/babylon.math.js\\\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\\\"single worker init\\\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\\\"\\\",function(e){e[e.INIT=0]=\\\"INIT\\\",e[e.UPDATE=1]=\\\"UPDATE\\\",e[e.COLLIDE=2]=\\\"COLLIDE\\\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\\\"SUCCESS\\\",e[e.UNKNOWN_ERROR=1]=\\\"UNKNOWN_ERROR\\\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\\\"error returned from worker!\\\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\\\"Collisions/babylon.collisionWorker.js\\\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\\\"application/javascript\\\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\"}\\\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\\\"{R: \\\"+this.r+\\\" G:\\\"+this.g+\\\" B:\\\"+this.b+\\\" A:\\\"+this.a+\\\"}\\\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\"}\\\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\"W:\\\"+this.w+\\\"}\\\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\\\"{X: \\\"+this.x+\\\" Y:\\\"+this.y+\\\" Z:\\\"+this.z+\\\" W:\\\"+this.w+\\\"}\\\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\\\"LOCAL\\\",t[t.WORLD=1]=\\\"WORLD\\\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\\\"CW\\\",t[t.CCW=1]=\\\"CCW\\\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\\\"step size should be less than 1.\\\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\\\"cannot add lines to closed paths\\\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\\\"cannot add arcs to closed paths\\\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\\\"normalized length position should be between 0 and 1.\\\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\\\"internal error\\\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\\\"continue\\\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\\\"IsEnabled\\\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\\\"x\\\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\\\"y\\\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\\\"z\\\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));\";\n 31856  if (((window && window.module) || (!window && module)) && module.exports) {\n 31857      module.exports = BABYLON;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var S=a.prototype.multiplyToArray,T=a.prototype.invertToRef,A=a.LookAtLHToRef,D=n.TransformCoordinatesToRef,E=n.TransformCoordinatesFromFloatsToRef,C=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=T,a.LookAtLHToRef=A,n.TransformCoordinatesToRef=D,n.TransformCoordinatesFromFloatsToRef=E,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=C}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,S,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,S=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,S=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,S=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,S=-1}var A=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",D=t[A](o,u,l,x,M,S,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,D)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,S=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[S]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var S,T,A,D,E,C,w,I,P,R,L=new Int32Array(a,0,d);if(L[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(S=L[b]){case l:T=8,A=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,A=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(S))}P=1,L[g]&o&&c!==!1&&(P=Math.max(1,L[y]));for(var O=L[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(D=L[v],E=L[_],w=L[m]+4,R=0;P>R;++R){if(h.isRGB)24==O?(C=D*E*3,I=t.GetRGBArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGB,D,E,0,i.RGB,i.UNSIGNED_BYTE,I)):(C=D*E*4,I=t.GetRGBAArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.RGBA,D,E,0,i.RGBA,i.UNSIGNED_BYTE,I));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=D,z=Math.floor((D+V-1)/V)*V;C=z*(E-1)+N,I=t.GetLuminanceArrayBuffer(D,E,w,C,a),i.texImage2D(F,R,i.LUMINANCE,D,E,0,i.LUMINANCE,i.UNSIGNED_BYTE,I)}else C=Math.max(4,D)/4*Math.max(4,E)/4*T,I=new Uint8Array(a,w,C),i.compressedTexImage2D(F,R,A,D,E,0,I);w+=C,D*=.5,E*=.5,D=Math.max(1,D),E=Math.max(1,E)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   27  legacydefaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 world;\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nuniform vec3 vEyePosition;\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return position;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = world * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = world * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n}\",lensFlarePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",lensFlareVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 viewportMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\\r\\n}\",lensHighlightsPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float gain;\\r\\nuniform float threshold;\\r\\nuniform bool pentagon;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// apply luminance filter\\r\\nvec4 highlightColor(vec4 color) {\\r\\n	vec4 highlight = color;\\r\\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\\r\\n	float lum_threshold;\\r\\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\\r\\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\\r\\n\\r\\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\\r\\n\\r\\n	highlight *= luminance * gain;\\r\\n	highlight.a = 1.0;\\r\\n\\r\\n	return highlight;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	// quick exit if no highlight computing\\r\\n	if (gain == -1.0) {\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n		return;\\r\\n	}\\r\\n\\r\\n	float w = 2.0 / screen_width;\\r\\n	float h = 2.0 / screen_height;\\r\\n\\r\\n	float weight = 1.0;\\r\\n\\r\\n	// compute blurred color\\r\\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\r\\n	if (pentagon) {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\\r\\n	}\\r\\n	else {\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\\r\\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\\r\\n	}\\r\\n\\r\\n	blurred /= 39.0;\\r\\n\\r\\n	gl_FragColor = blurred;\\r\\n\\r\\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\\r\\n}\",marblePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfTilesHeight;\\r\\nuniform float numberOfTilesWidth;\\r\\nuniform float amplitude;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\\r\\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat turbulence(vec2 P)\\r\\n{\\r\\n	float val = 0.0;\\r\\n	float freq = 1.0;\\r\\n	for (int i = 0; i < 4; i++)\\r\\n	{\\r\\n		val += abs(noise(P*freq) / freq);\\r\\n		freq *= 2.07;\\r\\n	}\\r\\n	return val;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvec3 marble_color(float x)\\r\\n{\\r\\n	vec3 col;\\r\\n	x = 0.5*(x + 1.);\\r\\n	x = sqrt(x);             \\r\\n	x = sqrt(x);\\r\\n	x = sqrt(x);\\r\\n	col = vec3(.2 + .75*x);  \\r\\n	col.b *= 0.95;           \\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main()\\r\\n{\\r\\n	float brickW = 1.0 / numberOfTilesWidth;\\r\\n	float brickH = 1.0 / numberOfTilesHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.01;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\\r\\n		t += amplitude * turbulence(brickvUV.xy);\\r\\n		t = sin(t);\\r\\n		color = marble_color(t);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 0.0);\\r\\n}\",outlinePixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",outlineVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\nattribute vec3 normal;\\r\\n\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\nuniform float offset;\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n	vec3 offsetPosition = position + normal * offset;\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",particlesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\nuniform vec4 textureMask;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\\r\\n}\",particlesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\nattribute vec4 color;\\r\\nattribute vec4 options;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nuniform mat4 invView;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \\r\\n	vec3 cornerPos;\\r\\n	float size = options.y;\\r\\n	float angle = options.x;\\r\\n	vec2 offset = options.zw;\\r\\n\\r\\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n	\\r\\n	vColor = color;\\r\\n	vUV = offset;\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n}\",passPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	gl_FragColor = texture2D(textureSampler, vUV);\\r\\n}\",postprocessVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",proceduralVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n	vPosition = position;\\r\\n	vUV = position * madd + madd;\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",refractionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D refractionSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec3 baseColor;\\r\\nuniform float depth;\\r\\nuniform float colorLevel;\\r\\n\\r\\nvoid main() {\\r\\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\\r\\n\\r\\n	vec2 uv = vUV - vec2(0.5);\\r\\n	vec2 offset = uv * depth * ref;\\r\\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\\r\\n}\",roadPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;                    \\r\\nuniform vec3 roadColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\\r\\n	vec3 color = roadColor * ratioy;\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",shadowMapPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvec4 pack(float depth)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\\r\\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\\r\\n\\r\\n	vec4 res = fract(depth * bit_shift);\\r\\n	res -= res.xxyz * bit_mask;\\r\\n\\r\\n	return res;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nvec2 packHalf(float depth) \\r\\n{ \\r\\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\\r\\n	vec2 color = vec2(depth, fract(depth * 255.));\\r\\n\\r\\n	return color - (color.yy * bitOffset);\\r\\n}\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n	float depth = vPosition.z / vPosition.w;\\r\\n	depth = depth * 0.5 + 0.5;\\r\\n\\r\\n#ifdef VSM\\r\\n	float moment1 = depth;\\r\\n	float moment2 = moment1 * moment1;\\r\\n\\r\\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\\r\\n#else\\r\\n	gl_FragColor = pack(depth);\\r\\n#endif\\r\\n}\",shadowMapVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\nvarying vec4 vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#endif\\r\\n\\r\\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n	gl_Position = vPosition;\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",spritesPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform bool alphaTest;\\r\\n\\r\\nvarying vec4 vColor;\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return min(1., max(0., fogCoeff));\\r\\n}\\r\\n#endif\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\\r\\n\\r\\n	if (alphaTest) \\r\\n	{\\r\\n		if (baseColor.a < 0.95)\\r\\n			discard;\\r\\n	}\\r\\n\\r\\n	baseColor *= vColor;\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",spritesVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec4 position;\\r\\nattribute vec4 options;\\r\\nattribute vec4 cellInfo;\\r\\nattribute vec4 color;\\r\\n\\r\\n// Uniforms\\r\\nuniform vec2 textureInfos;\\r\\nuniform mat4 view;\\r\\nuniform mat4 projection;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\nvarying vec4 vColor;\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {	\\r\\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \\r\\n	vec2 cornerPos;\\r\\n	\\r\\n	float angle = position.w;\\r\\n	vec2 size = vec2(options.x, options.y);\\r\\n	vec2 offset = options.zw;\\r\\n	vec2 uvScale = textureInfos.xy;\\r\\n\\r\\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\\r\\n\\r\\n	// Rotate\\r\\n	vec3 rotatedCorner;\\r\\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\\r\\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\\r\\n	rotatedCorner.z = 0.;\\r\\n\\r\\n	// Position\\r\\n	viewPos += rotatedCorner;\\r\\n	gl_Position = projection * vec4(viewPos, 1.0);   \\r\\n\\r\\n	// Color\\r\\n	vColor = color;\\r\\n	\\r\\n	// Texture\\r\\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\\r\\n\\r\\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = viewPos.z;\\r\\n#endif\\r\\n}\",ssaoPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define SAMPLES 16\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D randomSampler;\\r\\n\\r\\nuniform float randTextureTiles;\\r\\nuniform float samplesFactor;\\r\\nuniform vec3 sampleSphere[16];\\r\\n\\r\\nuniform float totalStrength;\\r\\nuniform float radius;\\r\\nuniform float area;\\r\\nuniform float fallOff;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 offset1 = vec2(0.0, 0.001);\\r\\nconst vec2 offset2 = vec2(0.001, 0.0);\\r\\n\\r\\nvec3 normalFromDepth(const float depth, const vec2 coords) {\\r\\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\\r\\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\\r\\n\\r\\n    vec3 p1 = vec3(offset1, depth1 - depth);\\r\\n    vec3 p2 = vec3(offset2, depth2 - depth);\\r\\n\\r\\n    vec3 normal = cross(p1, p2);\\r\\n    normal.z = -normal.z;\\r\\n\\r\\n    return normalize(normal);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	const float base = 0.2;\\r\\n\\r\\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\\r\\n	float depth = texture2D(textureSampler, vUV).r;\\r\\n	vec3 position = vec3(vUV, depth);\\r\\n	vec3 normal = normalFromDepth(depth, vUV);\\r\\n	float radiusDepth = radius / depth;\\r\\n	float occlusion = 0.0;\\r\\n\\r\\n	vec3 ray;\\r\\n	vec3 hemiRay;\\r\\n	float occlusionDepth;\\r\\n	float difference;\\r\\n\\r\\n	for (int i = 0; i < SAMPLES; i++)\\r\\n	{\\r\\n		ray = radiusDepth * reflect(sampleSphere[i], random);\\r\\n		hemiRay = position + sign(dot(ray, normal)) * ray;\\r\\n\\r\\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\\r\\n		difference = depth - occlusionDepth;\\r\\n\\r\\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\\r\\n	}\\r\\n\\r\\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\\r\\n\\r\\n	float result = clamp(ao + base, 0.0, 1.0);\\r\\n	gl_FragColor.r = result;\\r\\n	gl_FragColor.g = result;\\r\\n	gl_FragColor.b = result;\\r\\n	gl_FragColor.a = 1.0;\\r\\n}\\r\\n\",ssaoCombinePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D originalColor;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\\r\\n}\\r\\n\",stereoscopicInterlacePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D camASampler;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 stepSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    bool useCamB;\\r\\n    vec2 texCoord1;\\r\\n    vec2 texCoord2;\\r\\n    \\r\\n    vec3 frag1;\\r\\n    vec3 frag2;\\r\\n    \\r\\n#ifdef IS_STEREOSCOPIC_HORIZ\\r\\n	    useCamB = vUV.x > 0.5;\\r\\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\\r\\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\\r\\n#else\\r\\n	    useCamB = vUV.y > 0.5;\\r\\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\\r\\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\\r\\n#endif\\r\\n    \\r\\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\\r\\n    if (useCamB){\\r\\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\\r\\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\\r\\n    }else{\\r\\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\\r\\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\\r\\n    }\\r\\n    \\r\\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\\r\\n}\",\n   28: volumetricLightScatteringPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D lightScatteringSampler;\\r\\n\\r\\nuniform float decay;\\r\\nuniform float exposure;\\r\\nuniform float weight;\\r\\nuniform float density;\\r\\nuniform vec2 meshPositionOnScreen;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void) {\\r\\n    vec2 tc = vUV;\\r\\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\\r\\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\\r\\n\\r\\n    float illuminationDecay = 1.0;\\r\\n\\r\\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n\\r\\n    for(int i=0; i < NUM_SAMPLES; i++) {\\r\\n        tc -= deltaTexCoord;\\r\\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\\r\\n        sample *= illuminationDecay * weight;\\r\\n        color += sample;\\r\\n        illuminationDecay *= decay;\\r\\n    }\\r\\n\\r\\n    vec4 realColor = texture2D(textureSampler, vUV);\\r\\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\\r\\n}\\r\\n\",volumetricLightScatteringPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\n#if defined(DIFFUSE_COLOR_RENDER)\\r\\nuniform vec3 color;\\r\\n#endif\\r\\n\\r\\n#if defined(OPACITY)\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform float opacityLevel;\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (diffuseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\\r\\n	float alpha = 1.0;\\r\\n\\r\\n	#ifdef OPACITYRGB\\r\\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\\r\\n	#else\\r\\n	alpha *= opacityColor.a * opacityLevel;\\r\\n	#endif\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, alpha);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\\r\\n	#endif\\r\\n\\r\\n	gl_FragColor.a = alpha;\\r\\n#else\\r\\n\\r\\n	#if defined(BASIC_RENDER)\\r\\n	gl_FragColor = diffuseColor;\\r\\n	#elif defined(DIFFUSE_COLOR_RENDER)\\r\\n	gl_FragColor = vec4(color.rgb, 1.0);\\r\\n	#else\\r\\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	#endif\\r\\n#endif\\r\\n\\r\\n}\\r\\n\",vrDistortionCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 LensCenter;\\r\\nuniform vec2 Scale;\\r\\nuniform vec2 ScaleIn;\\r\\nuniform vec4 HmdWarpParam;\\r\\n\\r\\nvec2 HmdWarp(vec2 in01) {\\r\\n\\r\\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\\r\\n	float rSq = theta.x * theta.x + theta.y * theta.y;\\r\\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\\r\\n	return LensCenter + Scale * rvector;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 tc = HmdWarp(vUV);\\r\\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\\r\\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\\r\\n	else{\\r\\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\\r\\n	}\\r\\n}\",woodPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float ampScale;\\r\\nuniform vec3 woodColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\\r\\n	vec3 wood = woodColor * ratioy;\\r\\n	gl_FragColor = vec4(wood, 1.0);\\r\\n}\"},BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log(\"no mesh geometry id\");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log(\"couldn\\'t find geometry\",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts(\"./babylon.collisionCoordinator.js\"),importScripts(\"./babylon.collider.js\"),importScripts(\"../Math/babylon.math.js\"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log(\"single worker init\")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker=\"\",function(e){e[e.INIT=0]=\"INIT\",e[e.UPDATE=1]=\"UPDATE\",e[e.COLLIDE=2]=\"COLLIDE\"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]=\"SUCCESS\",e[e.UNKNOWN_ERROR=1]=\"UNKNOWN_ERROR\"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn(\"error returned from worker!\");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+\"Collisions/babylon.collisionWorker.js\":URL.createObjectURL(new Blob([e.CollisionWorker],{type:\"application/javascript\"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(e){var o=[];e.subMeshes&&(o=e.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var i=e.geometry?e.geometry.id:null;return{uniqueId:e.uniqueId,id:e.id,name:e.name,geometryId:i,sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:e.worldMatrixFromCache.asArray(),subMeshes:o,checkCollisions:e.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function t(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\"}\"},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b)},t.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2])},t.FromInts=function(i,o,n){return new t(i/255,o/255,n/255)},t.Lerp=function(i,o,n){var r=i.r+(o.r-i.r)*n,s=i.g+(o.g-i.g)*n,e=i.b+(o.b-i.b)*n;return new t(r,s,e)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();t.Color3=i;var o=function(){function t(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.toString=function(){return\"{R: \"+this.r+\" G:\"+this.g+\" B:\"+this.b+\" A:\"+this.a+\"}\"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.Lerp=function(i,o,n){var r=new t(0,0,0,0);return t.LerpToRef(i,o,n,r),r},t.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},t.FromArray=function(i,o){return void 0===o&&(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.FromInts=function(i,o,n,r){return new t(i/255,o/255,n/255,r/255)},t}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\"}\"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i){return i&&t.Tools.WithinEpsilon(this.x,i.x)&&t.Tools.WithinEpsilon(this.y,i.y)&&t.Tools.WithinEpsilon(this.z,i.z)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var u=i.TransformCoordinates(o,h),l=o.x*h.m[3]+o.y*h.m[7]+o.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(l,1)&&(u=u.scale(1/l)),u},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r,s,e,a=i.Normalize(t),h=(i.Normalize(o),i.Normalize(n)),u=f.X,l=f.Y,m=(f.Z,0),x=0,y=0,c=0,p=0,z=0,M=0,w=-1,I=(Math.PI,0),d=0;0==h.z?z=1:0==h.x?c=1:(M=h.z/h.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),s=new i(c,p,z),e=i.Cross(h,s),r=i.Cross(a,s),i.Dot(h,r)<0&&(w=1),d=i.Dot(a,s),y=Math.acos(d)*w,i.Dot(s,u)<0&&(y=Math.PI+y,s=s.scaleInPlace(-1),e=e.scaleInPlace(-1),I++);var D,S;return c=0,p=0,z=0,w=-1,0==h.z?c=1:(M=s.z/s.x,c=-M*Math.sqrt(1/(1+M*M)),z=Math.sqrt(1/(1+M*M))),D=new i(c,p,z),S=i.Cross(D,s),r=i.Cross(h,D),i.Dot(s,r)<0&&(w=1),d=i.Dot(h,D),x=Math.acos(d)*w,i.Dot(S,l)<0&&(x=Math.PI+x,S=S.scaleInPlace(-1),D=D.scaleInPlace(-1),I++),w=-1,r=i.Cross(u,s),i.Dot(r,l)<0&&(w=1),d=i.Dot(s,u),m=-Math.acos(d)*w,0>d&&2>I&&(m=Math.PI+m),new i(x,m,y)},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\"W:\"+this.w+\"}\"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i){return Math.abs(this.x-i.x)<t.Engine.Epsilon&&Math.abs(this.y-i.y)<t.Engine.Epsilon&&Math.abs(this.z-i.z)<t.Engine.Epsilon&&Math.abs(this.w-i.w)<t.Engine.Epsilon},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return\"{X: \"+this.x+\" Y:\"+this.y+\" Z:\"+this.z+\" W:\"+this.w+\"}\"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,I=u*p-f*x,d=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*I+h*d),g=s*M-e*I+h*D,T=-(s*w-e*d+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,A=e*c-a*y,F=s*p-h*x,P=s*c-a*x,C=s*y-e*x,L=a*f-h*m,q=e*f-h*l,Z=e*m-a*l,E=s*f-h*u,N=s*m-a*u,V=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*I+r*d)*R,t.m[9]=-(i*M-o*I+r*D)*R,t.m[13]=(i*w-o*d+n*D)*R,t.m[2]=(o*_-n*b+r*A)*R,t.m[6]=-(i*_-n*F+r*P)*R,t.m[10]=(i*b-o*F+r*C)*R,t.m[14]=-(i*A-o*P+n*C)*R,t.m[3]=-(o*L-n*q+r*Z)*R,t.m[7]=(i*L-n*E+r*N)*R,t.m[11]=-(i*q-o*E+r*V)*R,t.m[15]=(i*Z-o*N+n*V)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],I=t.m[1],d=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],A=t.m[11],F=t.m[12],P=t.m[13],C=t.m[14],L=t.m[15];return i[o]=n*w+r*S+s*R+e*F,i[o+1]=n*I+r*v+s*_+e*P,i[o+2]=n*d+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*A+e*L,i[o+4]=a*w+h*S+u*R+l*F,i[o+5]=a*I+h*v+u*_+l*P,i[o+6]=a*d+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*A+l*L,i[o+8]=m*w+f*S+x*R+y*F,i[o+9]=m*I+f*v+x*_+y*P,i[o+10]=m*d+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*A+y*L,i[o+12]=c*w+p*S+z*R+M*F,i[o+13]=c*I+p*v+z*_+M*P,i[o+14]=c*d+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*A+M*L,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],\\nr.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),I=SIMD.float32x4(0,1,0,0),d=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[10]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else{var r=1/this.direction.x,s=(t.x-this.origin.x)*r,e=(i.x-this.origin.x)*r;if(e===-(1/0)&&(e=1/0),s>e){var a=s;s=e,e=a}if(o=Math.max(s,o),n=Math.min(e,n),o>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(r=1/this.direction.y,s=(t.y-this.origin.y)*r,e=(i.y-this.origin.y)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(r=1/this.direction.z,s=(t.z-this.origin.z)*r,e=(i.z-this.origin.z)*r,e===-(1/0)&&(e=1/0),s>e&&(a=s,s=e,e=a),o=Math.max(s,o),n=Math.min(e,n),o>n)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]=\"LOCAL\",t[t.WORLD=1]=\"WORLD\"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]=\"CW\",t[t.CCW=1]=\"CCW\"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw\"step size should be less than 1.\";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error(\"cannot add lines to closed paths\"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error(\"normalized length position should be between 0 and 1.\"),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error(\"internal error\"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function t(t,i){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var o=0;o<t.length;o++)this._curve[o]=t[o].clone();this._compute(i)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},t.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u,l=1;i>l;l++)s=this._getLastNonNullVector(l),i-1>l&&(e=this._getFirstNonNullVector(l),this._tangents[l]=s.add(e),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+s.length(),a=this._tangents[l],h=this._normals[l-1],u=this._binormals[l-1],this._normals[l]=r.Cross(u,a),this._normals[l].normalize(),this._binormals[l]=r.Cross(a,this._normals[l]),this._binormals[l].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0==o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0==o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},t.prototype._normalVector=function(t,i,o){var n;if(void 0===o||null===o){var s;1!==i.y?s=new r(0,-1,0):1!==i.x?s=new r(1,0,0):1!==i.z&&(s=new r(0,0,1)),n=r.Cross(i,s)}else n=r.Cross(i,o),r.CrossToRef(n,i,n);return n.normalize(),n},t}();t.Path3D=w;var I=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype[\"continue\"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=I;var d=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=d;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,\"IsEnabled\",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,\"x\",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,\"y\",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,\"z\",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));',\n   29  (window&&window.module||!window&&module)&&module.exports&&(module.exports=BABYLON);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.noworker.js:\n    2  \n    3  },t.prototype.decompose=function(i,r,n){n.x=this.m[12],n.y=this.m[13],n.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var c=t.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,r),!0},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;16>r;r++)i.m[r]=e[r+t]},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=l,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,i,r,n,o,s,a,h,c,l,u,f,d,p,m,g){var _=new t;return _.m[0]=e,_.m[1]=i,_.m[2]=r,_.m[3]=n,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=l,_.m[10]=u,_.m[11]=f,_.m[12]=d,_.m[13]=p,_.m[14]=m,_.m[15]=g,_},t.Compose=function(e,i,r){var n=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return i.toRotationMatrix(o),n=n.multiply(o),n.setTranslation(r),n},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,i){var r=Math.sin(-i),n=Math.cos(-i),o=1-n;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+n,s.m[1]=e.x*e.y*o-e.z*r,s.m[2]=e.x*e.z*o+e.y*r,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*r,s.m[5]=e.y*e.y*o+n,s.m[6]=e.y*e.z*o-e.x*r,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*r,s.m[9]=e.z*e.y*o+e.x*r,s.m[10]=e.z*e.z*o+n,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),h=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},t.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,f,2,3,6,7);var _=SIMD.float32x4.shuffle(d,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),M=SIMD.float32x4.neg(s);M=SIMD.float32x4.withW(M,1),SIMD.float32x4.store(n,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(n,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(n,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(n,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,2,2,2,2),_),SIMD.float32x4.mul(SIMD.float32x4.swizzle(M,3,3,3,3),v)))))},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(e,i,r,n,o){var s=2/e,a=2/i,h=1/(n-r),c=r/(r-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,i,r,n,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(r-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(n-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(r+i)/(i-r),s.m[14]=n/(n-o),s.m[15]=1},t.PerspectiveLH=function(e,i,r,n){var o=t.Zero();return o.m[0]=2*r/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*r/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-n/(r-n),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n),o},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),h=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=h?a/i:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=h?a:a*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-n/(r-n),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=r*n/(r-n)},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,h=e.height,c=e.x,l=e.y,u=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+l,o,1);return i.multiply(r).multiply(n).multiply(u)},t.Transpose=function(e){var i=new t;return i.m[0]=e.m[0],i.m[1]=e.m[4],i.m[2]=e.m[8],i.m[3]=e.m[12],i.m[4]=e.m[1],i.m[5]=e.m[5],i.m[6]=e.m[9],i.m[7]=e.m[13],i.m[8]=e.m[2],i.m[9]=e.m[6],i.m[10]=e.m[10],i.m[11]=e.m[14],i.m[12]=e.m[3],i.m[13]=e.m[7],i.m[14]=e.m[11],i.m[15]=e.m[15],i},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=n.Zero(),t._yAxis=n.Zero(),t._zAxis=n.Zero(),t}();e.Matrix=a;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=a.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d,h=r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],c=r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],l=r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],u=r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15];return new e(h,c,l,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,l=o*c-s*h,u=s*a-n*c,f=n*h-o*a,d=Math.sqrt(l*l+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=l*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=n.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),r=t.getRenderHeight();return new e(this.x*i,this.y*r,this.width*i,this.height*r)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;6>r;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var u=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var n=1/this.direction.x,o=(e.x-this.origin.x)*n,s=(t.x-this.origin.x)*n;if(s===-(1/0)&&(s=1/0),o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),r=Math.min(s,r),i>r)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(n=1/this.direction.y,o=(e.y-this.origin.y)*n,s=(t.y-this.origin.y)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(n=1/this.direction.z,o=(e.z-this.origin.z)*n,s=(t.z-this.origin.z)*n,s===-(1/0)&&(s=1/0),o>s&&(a=o,o=s,s=a),i=Math.max(o,i),r=Math.min(s,r),i>r)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(o>=n)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;if(0>s)return!1;var a=n-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=n.Zero(),this._edge2=n.Zero(),this._pvec=n.Zero(),this._tvec=n.Zero(),this._qvec=n.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),n.CrossToRef(this.direction,this._edge2,this._pvec);var o=n.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=n.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;n.CrossToRef(this._tvec,this._edge1,this._qvec);var h=n.Dot(this.direction,this._qvec)*s;if(0>h||a+h>1)return null;var c=n.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,h,c)},t.CreateNew=function(e,i,r,o,s,a,h){var c=n.Unproject(new n(e,i,0),r,o,s,a,h),l=n.Unproject(new n(e,i,1),r,o,s,a,h),u=l.subtract(c);return u.normalize(),new t(c,u)},t.CreateNewFromTo=function(e,i,r){void 0===r&&(r=a.Identity());var n=i.subtract(e),o=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),t.Transform(new t(e,n,o),r)},t.Transform=function(e,i){var r=n.TransformCoordinates(e.origin,i),o=n.TransformNormal(e.direction,i);return new t(r,o,e.length)},t}();e.Ray=u,function(e){e[e.LOCAL=0]=\"LOCAL\",e[e.WORLD=1]=\"WORLD\"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,h=e,c=0;5>c;c++){var l=h*h,u=l*h,f=o*u+s*l+a*h,d=1/(3*o*l+2*s*h+a);h-=(f-e)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*n+Math.pow(h,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]=\"CW\",e[e.CCW=1]=\"CCW\"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t),n=Math.atan2(r.y,r.x);return new e(n)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-h>180&&(c-=360),-180>c-h&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-h?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?h-l:l-h)}return e}();e.Arc2=g;var _=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new n(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw\"step size should be less than 1.\";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=_;var v=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return t.prototype.addLineTo=function(t,i){if(closed)return e.Tools.Error(\"cannot add lines to closed paths\"),this;var n=new r(t,i),o=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(o).length(),this},t.prototype.addArcTo=function(t,i,n,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error(\"cannot add arcs to closed paths\"),this;var a=this._points[this._points.length-1],h=new r(t,i),c=new r(n,o),l=new g(a,h,c),u=l.angle.radians()/s;l.orientation===p.CW&&(u*=-1);for(var f=l.startAngle.radians()+u,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,_=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,_),f+=u}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error(\"normalized length position should be between 0 and 1.\"),r.Zero();for(var i=t*this.length(),n=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],h=this._points[s],c=h.subtract(a),l=c.length()+n;if(i>=n&&l>=i){var u=c.normalize(),f=i-n;return new r(a.x+u.x*f,a.y+u.y*f)}n=l}return e.Tools.Error(\"internal error\"),r.Zero()},t.StartingAt=function(e,i){return new t(e,i)},t}();e.Path2=v;var y=function(){function e(e,t){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,h,c,l=1;t>l;l++)o=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=o.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+o.length(),a=this._tangents[l],h=this._normals[l-1],c=this._binormals[l-1],this._normals[l]=n.Cross(c,a),this._normals[l].normalize(),this._binormals[l]=n.Cross(a,this._normals[l]),this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},e.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},e.prototype._normalVector=function(e,t,i){var r;if(void 0===i||null===i){var o;1!==t.y?o=new n(0,-1,0):1!==t.x?o=new n(1,0,0):1!==t.z&&(o=new n(0,0,1)),r=n.Cross(t,o)}else r=n.Cross(t,i),n.CrossToRef(r,t,r);return r.normalize(),r},e}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){var n=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r;return n},h=0;o>=h;h++)s.push(new n(a(h/o,t.x,i.x,r.x),a(h/o,t.y,i.y,r.y),a(h/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,r,n){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n;return o},c=0;s>=c;c++)a.push(new n(h(c/s,t.x,i.x,r.x,o.x),h(c/s,t.y,i.y,r.y,o.y),h(c/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,h=1/s,c=0;s>=c;c++)a.push(n.Hermite(t,i,r,o,c*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype[\"continue\"]=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));var s=new e(r);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var M=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=M;var A=a.prototype.multiplyToArray,T=a.prototype.invertToRef,S=a.LookAtLHToRef,E=n.TransformCoordinatesToRef,C=n.TransformCoordinatesFromFloatsToRef,D=function(){function e(){}return Object.defineProperty(e,\"IsEnabled\",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=A,a.prototype.invertToRef=T,a.LookAtLHToRef=S,n.TransformCoordinatesToRef=E,n.TransformCoordinatesFromFloatsToRef=C,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,n.TransformCoordinatesToRef=n.TransformCoordinatesToRefSIMD,n.TransformCoordinatesFromFloatsToRef=n.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(n.prototype,\"x\",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(n.prototype,\"y\",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(n.prototype,\"z\",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=D}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){r.enableSceneOffline=!1,r.enableTexturesOffline=!1,r.callbackManifestChecked(!1)}var i=this,r=this,n=this.currentSceneUrl+\".manifest\",o=new XMLHttpRequest,s=n+(null==n.match(/\\?/)?\"?\":\"&\")+(new Date).getTime();o.open(\"GET\",s,!0),o.addEventListener(\"load\",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);i.enableSceneOffline=r.enableSceneOffline,i.enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(i.manifestVersionFound=r.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(n){t()}else t()},!1),o.addEventListener(\"error\",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error(\"Error on XHR send request.\"),r.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function r(){o.isSupported=!1,i&&i()}var n=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open(\"babylonjs\",1);s.onerror=function(e){r()},s.onblocked=function(t){e.Tools.Error(\"IDB request blocked. Please reload the page.\"),r()},s.onsuccess=function(e){n.db=s.result,t()},s.onupgradeneeded=function(t){n.db=t.target.result;try{{n.db.createObjectStore(\"scenes\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"versions\",{keyPath:\"sceneUrl\"}),n.db.createObjectStore(\"textures\",{keyPath:\"textureUrl\"})}}catch(i){e.Tools.Error(\"Error while creating object stores. Exception: \"+i.message),r()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction([\"textures\"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error(\"Error loading image from blob URL: \"+s+\" switching back to web url: \"+t),i.src=t},i.src=s}else r()};var s=o.objectStore(\"textures\").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error(\"Error loading texture \"+t+\" from DB.\"),i.src=t}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}r.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open(\"GET\",i,!0),a.responseType=\"blob\",a.addEventListener(\"load\",function(){if(200===a.status){s=a.response;var e=n.db.transaction([\"textures\"],\"readwrite\");e.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var c=e.objectStore(\"textures\").put(h);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener(\"error\",function(t){e.Tools.Error(\"Error in XHR request in BABYLON.Database.\"),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(r){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported){var o;try{var s=this.db.transaction([\"versions\"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore(\"versions\").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error(\"Error loading version for scene \"+t+\" from DB.\"),i(-1)}}catch(h){e.Tools.Error(\"Error while accessing 'versions' object store (READ OP). Exception: \"+h.message),i(-1)}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota)try{var n=this.db.transaction([\"versions\"],\"readwrite\");n.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(r.hasReachedQuota=!0)}catch(t){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore(\"versions\").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error(\"Error in DB add version request in BABYLON.Database.\")}}catch(a){e.Tools.Error(\"Error while accessing 'versions' object store (WRITE OP). Exception: \"+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,h,o):n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported){var o;o=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error(\"Error loading file \"+t+\" from DB.\"),r()}}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(\".babylon\")?\"scenes\":\"textures\";var a,h=new XMLHttpRequest;h.open(\"GET\",t,!0),n&&(h.responseType=\"arraybuffer\"),h.onprogress=r,h.addEventListener(\"load\",function(){if(200===h.status||e.Tools.ValidateXHRData(h,n?6:1))if(a=n?h.response:h.responseText,o.hasReachedQuota)i(a);else{var r=o.db.transaction([s],\"readwrite\");r.onabort=function(e){try{e.srcElement.error&&\"QuotaExceededError\"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},r.oncomplete=function(e){i(a)};var c;c=\"scenes\"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=r.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error(\"Error in DB add file request in BABYLON.Database.\")}}catch(u){i(a)}}else i()},!1),h.addEventListener(\"error\",function(t){e.Tools.Error(\"error on XHR request.\"),i()},!1),h.send()}else e.Tools.Error(\"Error: IndexedDB not supported by your browser or BabylonJS Database is not open.\"),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement(\"a\");t.href=e;var i=e.substring(0,e.lastIndexOf(\"#\")),r=e.substring(i.lastIndexOf(\"/\")+1,e.length),n=e.substring(0,e.indexOf(r,0));return n},t.ReturnFullUrlLocation=function(e){\n    4: return-1===e.indexOf(\"http:/\")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error(\"Unable to load TGA file - Not enough data to contain header\");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error(\"Unable to load TGA file - Not enough data\");n+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,u,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(u=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,_=0,v=new Uint8Array(f);d>n&&d>_;)if(p=r[n++],m=(127&p)+1,128&p){for(g=0;f>g;++g)v[g]=r[n++];for(g=0;m>g;++g)l.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)l[_+g]=r[n++];_+=m}}else l=r.subarray(n,n+=a?o.width*o.height:d);var y,x,b,M,A,T;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,T=o.width,x=0,M=1,A=o.height;break;case t._ORIGIN_BL:y=0,b=1,T=o.width,x=o.height-1,M=-1,A=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,T=-1,x=0,M=1,A=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,T=-1,x=o.height-1,M=-1,A=-1}var S=\"_getImageData\"+(c?\"Grey\":\"\")+o.pixel_size+\"bits\",E=t[S](o,u,l,x,M,A,y,b,T);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,E)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,g++)c=f[g],_[4*(l+p*u)+3]=255,_[4*(l+p*u)+2]=d[3*c+0],_[4*(l+p*u)+1]=d[3*c+1],_[4*(l+p*u)+0]=d[3*c+2];return _},t._getImageData16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*u)+0]=(31744&c)>>7,g[4*(l+d*u)+1]=(992&c)>>2,g[4*(l+d*u)+2]=(31&c)>>3,g[4*(l+d*u)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=4)m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+1]=u[p+1],m[4*(c+f*l)+0]=u[p+2],m[4*(c+f*l)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,h){var c,l,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(l=s;l!==h;l+=a,m++)c=f[m],g[4*(l+d*u)+0]=c,g[4*(l+d*u)+1]=c,g[4*(l+d*u)+2]=c,g[4*(l+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,h){var c,l,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=r;l!==o;l+=n)for(c=s;c!==h;c+=a,p+=2)m[4*(c+f*l)+0]=u[p+0],m[4*(c+f*l)+1]=u[p+0],m[4*(c+f*l)+2]=u[p+0],m[4*(c+f*l)+3]=u[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=542327876,o=131072,s=512,a=4,h=64,c=131072,l=i(\"DXT1\"),u=i(\"DXT3\"),f=i(\"DXT5\"),d=31,p=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,M=22,A=28,T=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[A]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+4*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+3*(c+h*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var l=i+(c+h*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var A,T,S,E,C,D,P,w,I,L,R=new Int32Array(a,0,d);if(R[p]!=n)return void e.Tools.Error(\"Invalid magic number in DDS header\");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error(\"Unsupported format, must contain a FourCC, RGB or LUMINANCE code\");if(h.isFourCC)switch(A=R[b]){case l:T=8,S=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:T=16,S=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error(\"Unsupported FourCC code:\",r(A))}I=1,R[g]&o&&c!==!1&&(I=Math.max(1,R[y]));for(var O=R[M],B=0;x>B;B++){var F=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(E=R[v],C=R[_],P=R[m]+4,L=0;I>L;++L){if(h.isRGB)24==O?(D=E*C*3,w=t.GetRGBArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGB,E,C,0,i.RGB,i.UNSIGNED_BYTE,w)):(D=E*C*4,w=t.GetRGBAArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.RGBA,E,C,0,i.RGBA,i.UNSIGNED_BYTE,w));else if(h.isLuminance){var V=i.getParameter(i.UNPACK_ALIGNMENT),N=E,k=Math.floor((E+V-1)/V)*V;D=k*(C-1)+N,w=t.GetLuminanceArrayBuffer(E,C,P,D,a),i.texImage2D(F,L,i.LUMINANCE,E,C,0,i.LUMINANCE,i.UNSIGNED_BYTE,w)}else D=Math.max(4,E)/4*Math.max(4,C)/4*T,w=new Uint8Array(a,P,D),i.compressedTexImage2D(F,L,S,E,C,0,w);P+=D,E*=.5,C*=.5,E=Math.max(1,E),C=Math.max(1,C)}}},t}();t.DDSTools=T}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}return void 0},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t,i=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function r(){}return r.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},r.GetExponantOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r.GetFilename=function(e){var t=e.lastIndexOf(\"/\");return 0>t?e:e.substring(t+1)},r.GetDOMTextContent=function(e){for(var t=\"\",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},r.ToDegrees=function(e){return 180*e/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.ExtractMinAndMaxIndexed=function(t,i,r,n){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=r;r+n>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},r.ExtractMinAndMax=function(t,i,r){for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+r>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);n=e.Vector3.Minimize(a,n),o=e.Vector3.Maximize(a,o)}return{minimum:n,maximum:o}},r.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},r.GetPointerPrefix=function(){var e=\"pointer\";return navigator.pointerEnabled||(e=\"mouse\"),e},r.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},r.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},r.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},r.CleanUrl=function(e){return e=e.replace(/#/gm,\"%23\")},r.LoadImage=function(t,i,n,o){t=r.CleanUrl(t);var s=new Image;\"data:\"!==t.substr(0,5)&&(s.crossOrigin=\"anonymous\"),s.onload=function(){i(s)},s.onerror=function(e){n(s,e)};var a=function(){s.src=t},h=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(h,a);else if(-1===t.indexOf(\"file:\"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(u){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){r.Log(\"Error while trying to load texture: \"+l),s.src=null}return s},r.LoadFile=function(t,i,n,o,s,a){t=r.CleanUrl(t);var h=function(){var e=new XMLHttpRequest,o=r.BaseUrl+t;e.open(\"GET\",o,!0),s&&(e.responseType=\"arraybuffer\"),e.onprogress=n,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||r.ValidateXHRData(e,s?6:1))i(s?e.response:e.responseText);else{if(!a)throw new Error(\"Error status: \"+e.status+\" - Unable to load \"+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,i,n,h,s)};if(-1!==t.indexOf(\"file:\")){var l=t.substring(5);r.ReadFile(e.FilesInput.FilesToLoad[l],i,n,!0)}else o&&o.enableSceneOffline?o.openAsync(c,h):h()},r.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},r.ReadFile=function(e,t,i,n){var o=new FileReader;o.onerror=function(i){r.Log(\"Error while reading file: \"+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=i,n?o.readAsArrayBuffer(e):o.readAsText(e)},r.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},r.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},r.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},r.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},r.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return r>=-i&&i>=r},r.DeepCopy=function(e,t,r,n){for(var o in e)if((\"_\"!==o[0]||n&&-1!==n.indexOf(o))&&(!r||-1===r.indexOf(o))){var s=e[o],a=typeof s;if(\"function\"!==a)if(\"object\"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if(\"object\"==typeof s[0])for(var h=0;h<s.length;h++){var c=i(s[h],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=i(s,t);else t[o]=s}},r.IsEmpty=function(e){for(var t in e)return!1;return!0},r.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(r){}}},r.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(r){}}},r.DumpFramebuffer=function(e,i,r){for(var n=4*e,o=i/2,s=r.readPixels(0,0,e,i),a=0;o>a;a++)for(var h=0;n>h;h++){var c=h+a*n,l=i-a-1,u=h+l*n,f=s[c];s[c]=s[u],s[u]=f}t||(t=document.createElement(\"canvas\")),t.width=e,t.height=i;var d=t.getContext(\"2d\"),p=d.createImageData(e,i),m=p.data;m.set(s),d.putImageData(p,0,0);var g=t.toDataURL();if(\"download\"in document.createElement(\"a\")){var _=window.document.createElement(\"a\");_.href=g;var v=new Date,y=v.getFullYear()+\"/\"+v.getMonth()+\"/\"+v.getDate()+\"-\"+v.getHours()+\":\"+v.getMinutes();_.setAttribute(\"download\",\"screenshot-\"+y+\".png\"),window.document.body.appendChild(_),_.addEventListener(\"click\",function(){_.parentElement.removeChild(_)}),_.click()}else{var x=window.open(\"\"),b=x.document.createElement(\"img\");b.src=g,x.document.body.appendChild(b)}},r.CreateScreenshot=function(t,i,n){var o,s,a=i.getScene(),h=null;if(a.activeCamera!==i&&(h=a.activeCamera,a.activeCamera=i),n.precision)o=Math.round(t.getRenderWidth()*n.precision),s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.width&&n.height)o=n.width,s=n.height;else if(n.width&&!n.height)o=n.width,s=Math.round(o/t.getAspectRatio(i)),n={width:o,height:s};else if(n.height&&!n.width)s=n.height,o=Math.round(s*t.getAspectRatio(i)),n={width:o,height:s};else{if(isNaN(n))return void r.Error(\"Invalid 'size' parameter !\");s=n,o=n}var c=new e.RenderTargetTexture(\"screenShot\",n,a,!1,!1);c.renderList=a.meshes,c.onAfterRender=function(){r.DumpFramebuffer(o,s,t)},a.incrementRenderId(),c.render(!0),c.dispose(),h&&(a.activeCamera=h)},r.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(r,\"NoneLogLevel\",{get:function(){return r._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"MessageLogLevel\",{get:function(){return r._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"WarningLogLevel\",{get:function(){return r._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"ErrorLogLevel\",{get:function(){return r._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"AllLogLevel\",{get:function(){return r._MessageLogLevel|r._WarningLogLevel|r._ErrorLogLevel},enumerable:!0,configurable:!0}),r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(e){return 10>e?\"0\"+e:\"\"+e},i=new Date;return\"[\"+t(i.getHours())+\":\"+t(i.getMinutes())+\":\"+t(i.getSeconds())+\"]: \"+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log(\"BJS - \"+t);var i=\"<div style='color:white'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn(\"BJS - \"+t);var i=\"<div style='color:orange'>\"+t+\"</div><br>\";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){var t=r._FormatMessage(e);console.error(\"BJS - \"+t);var i=\"<div style='color:red'>\"+t+\"</div><br>\";r._AddLogEntry(i)},Object.defineProperty(r,\"LogCache\",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"LogLevels\",{set:function(e){r.Log=(e&r.MessageLogLevel)===r.MessageLogLevel?r._LogEnabled:r._LogDisabled,r.Warn=(e&r.WarningLogLevel)===r.WarningLogLevel?r._WarnEnabled:r._WarnDisabled,r.Error=(e&r.ErrorLogLevel)===r.ErrorLogLevel?r._ErrorEnabled:r._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceNoneLogLevel\",{get:function(){return r._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceUserMarkLogLevel\",{get:function(){return r._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceConsoleLogLevel\",{get:function(){return r._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,\"PerformanceLogLevel\",{set:function(e){return(e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel?(r.StartPerformanceCounter=r._StartUserMark,void(r.EndPerformanceCounter=r._EndUserMark)):(e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel?(r.StartPerformanceCounter=r._StartPerformanceConsole,void(r.EndPerformanceCounter=r._EndPerformanceConsole)):(r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,void(r.EndPerformanceCounter=r._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&r._performance.mark(e+\"-Begin\")},r._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&r._performance.mark&&(r._performance.mark(e+\"-End\"),r._performance.measure(e,e+\"-Begin\",e+\"-End\"))},r._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(r._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(r,\"Now\",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),r.GetFps=function(){return r.Warn(\"Tools.GetFps() is deprecated. Please use engine.getFps() instead\"),0},r.BaseUrl=\"\",r._NoneLogLevel=0,r._MessageLogLevel=1,r._WarningLogLevel=2,r._ErrorLogLevel=4,r._LogCache=\"\",r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r._PerformanceNoneLogLevel=0,r._PerformanceUserMarkLogLevel=1,r._PerformanceConsoleLogLevel=2,r._performance=window.performance,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}();e.Tools=r;var n=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;i>n;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"zOffset\",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cullFace\",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cull\",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthFunc\",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthMask\",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"depthTest\",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,\"isDirty\",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"alphaBlend\",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==i||this._blendFunctionParameters[3]!==r)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=i;var r=function(e,t,i,r){var n=e.createShader(\"vertex\"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(n,(r?r+\"\\n\":\"\")+t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n},n=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},o=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST),{min:o,mag:n}},s=function(t,i,r,n,s,a,h,c,l,u){void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),d=e.Tools.GetExponantOfTwo(n,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=n,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(u,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||c||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f._activeTexturesCache=[],r._removePendingData(t)},a=function(t,i,r,n,o){var s=function(){r[i]=h,r._internalCount++,n._removePendingData(h),6===r._internalCount&&o(r)},a=function(){n._removePendingData(h)},h=e.Tools.LoadImage(t,s,a,n.database);n._addPendingData(h)},h=function(e,t,i,r){var n=[];n._internalCount=0;for(var o=0;6>o;o++)a(e+r[o],o,n,t,i)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(r,n,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor=\"black\",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new i,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=r,o=o||{},o.antialias=n;try{this._gl=r.getContext(\"webgl\",o)||r.getContext(\"experimental-webgl\",o)}catch(h){throw new Error(\"WebGL not supported\")}if(!this._gl)throw new Error(\"WebGL not supported\");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener(\"blur\",this._onBlur),window.addEventListener(\"focus\",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension(\"WEBGL_debug_renderer_info\");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=\"Unknown vendor\"),this._glRenderer||(this._glRenderer=\"Unknown renderer\"),this._caps.standardDerivatives=null!==this._gl.getExtension(\"OES_standard_derivatives\"),this._caps.s3tc=this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\"),this._caps.textureFloat=null!==this._gl.getExtension(\"OES_texture_float\"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension(\"EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\")||this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension(\"ANGLE_instanced_arrays\"),this._caps.uintIndices=null!==this._gl.getExtension(\"OES_element_index_uint\"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=u.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(r.requestPointerLock=r.requestPointerLock||r.msRequestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock,r.requestPointerLock&&r.requestPointerLock())},document.addEventListener(\"fullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"mozfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"webkitfullscreenchange\",this._onFullscreenChange,!1),document.addEventListener(\"msfullscreenchange\",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r||document.pointerLockElement===r},document.addEventListener(\"pointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mspointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"mozpointerlockchange\",this._onPointerLockChange,!1),document.addEventListener(\"webkitpointerlockchange\",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log(\"Babylon.js engine (v\"+a.Version+\") launched\")}return Object.defineProperty(a,\"ALPHA_DISABLE\",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_ADD\",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"ALPHA_COMBINE\",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NONE\",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADED\",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_LOADING\",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"DELAYLOADSTATE_NOTLOADED\",{get:function(){\n    5  return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_ALPHA\",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_LUMINANCE_ALPHA\",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGB\",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTUREFORMAT_RGBA\",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_UNSIGNED_INT\",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"TEXTURETYPE_FLOAT\",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,\"Version\",{get:function(){return\"2.1.0\"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement(\"canvas\"),this._workingContext=this._workingCanvas.getContext(\"2d\"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,\"drawCalls\",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,i=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i){this.beginFrame();for(var r=0;r<this._activeRenderLoops.length;r++){var n=this._activeRenderLoops[r];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var i=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){i._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var r=0;t&&(r|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(r|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(r)},a.prototype.setViewport=function(e,t,i){var r=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),n=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},a.prototype.setDirectViewport=function(e,t,i,r){this._cachedViewport=null,this._gl.viewport(e,t,i,r)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===i&&(i=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var i,r=!1;if(this._caps.uintIndices){for(var n=0;n<e.length;n++)if(e[n]>65535){r=!0;break}i=r?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=r,t},a.prototype.bindBuffers=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=n.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,r,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var r=i.getAttributesNames(),n=0;n<r.length;n++){var o=i.getAttributeLocation(n);if(o>=0){var s=e[r[n]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var r=0;4>r;r++){var n=i[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,4,this._gl.FLOAT,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var r=t[i];this._gl.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls++;var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return r?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},a.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,r,n,o,s,a,h){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,u=c+\"+\"+l+\"@\"+o;if(this._compiledEffects[u])return this._compiledEffects[u];var f=new e.Effect(t,i,r,n,this,o,s,a,h);return f._key=u,this._compiledEffects[u]=f,f},a.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=\"\"),this.createEffect({vertex:\"particles\",fragmentElement:e},[\"position\",\"color\",\"options\"],[\"view\",\"projection\"].concat(t),[\"diffuseSampler\"].concat(i),r,n,o,s)},a.prototype.createShaderProgram=function(e,t,i){var n=r(this._gl,e,\"vertex\",i),o=r(this._gl,t,\"fragment\",i),s=this._gl.createProgram();this._gl.attachShader(s,n),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(n),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(n){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),r=0;i>r;r++){var n=e.getAttributeLocation(r);n>=0&&(this._vertexAttribArrays[n]=!0,this._gl.enableVertexAttribArray(n))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e,t,i){void 0===t&&(t=0),(this._depthCullingState.cull!==e||i)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var r=this._gl;r.bindTexture(r.TEXTURE_2D,t);var n=r.NEAREST,o=r.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(n=r.LINEAR,o=r.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(n=r.LINEAR,o=r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.bindTexture(r.TEXTURE_2D,null),t.samplingMode=i},a.prototype.createTexture=function(t,i,r,n,o,a,h,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null);var u,f=this._gl.createTexture(),d=!1;if(\"data:\"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(\":\"),t=p,u=d[1].substr(d[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&\".dds\"===u,g=\".tga\"===u;n._addPendingData(f),f.url=t,f.noMipmap=i,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var _=function(){n._removePendingData(f),h&&h()};if(g){var v=function(t){var h=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(h);s(f,l._gl,n,c.width,c.height,r,i,!1,function(){e.Internals.TGATools.UploadContent(l._gl,h),a&&a()},o)};d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0)}else if(m)v=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),c=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;s(f,l._gl,n,h.width,h.height,r,!c,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,h,c,1),a&&a()},o)},d instanceof Array?v(c):e.Tools.LoadFile(t,function(e){v(e)},_,n.database,!0);else{var y=function(t){s(f,l._gl,n,t.width,t.height,r,i,!1,function(i,r){var n=t.width===i&&t.height===r;n||(l._prepareWorkingCanvas(),l._workingCanvas.width=i,l._workingCanvas.height=r,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,n?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,_,n.database):e.Tools.LoadImage(t,y,_,n.database)}return f},a.prototype.createRawTexture=function(e,t,i,r,n,s,h){var c=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,c),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===s?1:s?1:0);var l=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:l=this._gl.RGBA}this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,t,i,0,l,this._gl.UNSIGNED_BYTE,e),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D);var u=o(h,n,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],c._baseWidth=t,c._baseHeight=i,c._width=t,c._height=i,c.isReady=!0,c.references=1,c.samplingMode=h,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,i,r,n,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=i,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponantOfTwo(i,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=i,s.isReady=!1,s.generateMipMaps=r,s.references=1,s.samplingMode=n,this.updateTextureSamplingMode(n,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var i=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement(\"canvas\"),e._workingContext=e._workingCanvas.getContext(\"2d\"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,i){var r=!1,s=!0,h=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(r=void 0===i.generateMipMaps?i:i.generateMipmaps,s=void 0===i.generateDepthBuffer?!0:i.generateDepthBuffer,h=void 0===i.type?h:i.type,void 0!==i.samplingMode&&(c=i.samplingMode),h===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u);var f=t.width||t,d=t.height||t,p=o(c,r,l);h!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,n(l,h),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u._framebuffer=g,s&&(u._depthBuffer=m),u._width=f,u._height=d,u.isReady=!0,u.generateMipMaps=r,u.references=1,u.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(u),u},a.prototype.createCubeTexture=function(t,i,r,n){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&\".dds\"===c;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,r?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i.width,a._height=i.height,a.isReady=!0},null,null,!0):h(t,i,function(t){var i=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),r=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=r;var h=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<h.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,i,r),s.texImage2D(h[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);n||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=i,a._height=r,a.isReady=!0},r),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl[\"TEXTURE\"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var r=this._loadedTexturesCache.indexOf(e);-1!==r&&this._loadedTexturesCache.splice(r,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl[\"TEXTURE\"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(this._gl.activeTexture(this._gl[\"TEXTURE\"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var n=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,n),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,n)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(t,i){var r=this._caps.textureAnisotropicFilterExtension,n=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(n=1),r&&i._cachedAnisotropicFilteringLevel!==n&&(this._gl.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=n)},a.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(0,0,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener(\"blur\",this._onBlur),window.removeEventListener(\"focus\",this._onFocus),document.removeEventListener(\"fullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"mozfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"webkitfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"msfullscreenchange\",this._onFullscreenChange),document.removeEventListener(\"pointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mspointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"mozpointerlockchange\",this._onPointerLockChange),document.removeEventListener(\"webkitpointerlockchange\",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement(\"div\"),this._loadingDiv.style.opacity=\"0\",this._loadingDiv.style.transition=\"opacity 1.5s ease\",this._loadingTextDiv=document.createElement(\"div\"),this._loadingTextDiv.style.position=\"absolute\",this._loadingTextDiv.style.left=\"0\",this._loadingTextDiv.style.top=\"50%\",this._loadingTextDiv.style.marginTop=\"80px\",this._loadingTextDiv.style.width=\"100%\",this._loadingTextDiv.style.height=\"20px\",this._loadingTextDiv.style.fontFamily=\"Arial\",this._loadingTextDiv.style.fontSize=\"14px\",this._loadingTextDiv.style.color=\"white\",this._loadingTextDiv.style.textAlign=\"center\",this._loadingTextDiv.innerHTML=\"Loading\",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==\",t.style.position=\"absolute\",t.style.left=\"50%\",t.style.top=\"50%\",t.style.marginLeft=\"-50px\",t.style.marginTop=\"-50px\",t.style.transition=\"transform 1.0s ease\",t.style.webkitTransition=\"-webkit-transform 1.0s ease\";var i=360,r=function(){i+=360,t.style.transform=\"rotateZ(\"+i+\"deg)\",t.style.webkitTransform=\"rotateZ(\"+i+\"deg)\"};t.addEventListener(\"transitionend\",r),t.addEventListener(\"webkitTransitionEnd\",r),this._loadingDiv.appendChild(t);var n=new Image;n.src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=\",\n    6  n.style.position=\"absolute\",n.style.left=\"50%\",n.style.top=\"50%\",n.style.marginLeft=\"-50px\",n.style.marginTop=\"-50px\",this._loadingDiv.appendChild(n),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position=\"absolute\",e._loadingDiv.style.left=t.left+\"px\",e._loadingDiv.style.top=t.top+\"px\",e._loadingDiv.style.width=t.width+\"px\",e._loadingDiv.style.height=t.height+\"px\"},this._resizeLoadingUI(),window.addEventListener(\"resize\",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity=\"1\",t.style.transform=\"rotateZ(360deg)\",t.style.webkitTransform=\"rotateZ(360deg)\"},0)},Object.defineProperty(a.prototype,\"loadingUIText\",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,\"loadingUIBackgroundColor\",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener(\"resize\",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity=\"0\",this._loadingDiv.addEventListener(\"transitionend\",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,r=0;t-1>r;r++)i+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r];this.fps=1e3/(i/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement(\"canvas\"),t=e.getContext(\"webgl\")||e.getContext(\"experimental-webgl\");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=4,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository=\"Babylon/\",a.ShadersRepository=\"Babylon/Shaders/\",a}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state=\"\",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];r.isDescendantOf(this)&&t.push(r)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=r,this._progressCallback=n,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener(\"dragenter\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"dragover\",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener(\"drop\",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case\"image/jpeg\":case\"image/png\":case\"image/bmp\":t.FilesTextures[this._filesToLoad[i].name]=this._filesToLoad[i];break;case\"image/targa\":case\"image/vnd.ms-dds\":case\"audio/wav\":case\"audio/x-wav\":case\"audio/mp3\":case\"audio/mpeg\":case\"audio/mpeg3\":case\"audio/x-mpeg-3\":case\"audio/ogg\":t.FilesToLoad[this._filesToLoad[i].name]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(\".babylon\")&&-1===this._filesToLoad[i].name.indexOf(\".manifest\")&&-1===this._filesToLoad[i].name.indexOf(\".incremental\")&&-1===this._filesToLoad[i].name.indexOf(\".babylonmeshdata\")&&-1===this._filesToLoad[i].name.indexOf(\".babylongeometrydata\")&&(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load(\"file:\",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error(\"Please provide a valid .babylon file.\")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t){if(void 0===t&&(t=!1),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var i=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(r,3*i[3*this.faceId]),o=e.Vector3.FromArray(r,3*i[3*this.faceId+1]),s=e.Vector3.FromArray(r,3*i[3*this.faceId+2]);n=n.scale(this.bu),o=o.scale(this.bv),s=s.scale(1-this.bu-this.bv);var a=new e.Vector3(n.x+o.x+s.x,n.y+o.y+s.y,n.z+o.z+s.z);return t&&(a=e.Vector3.TransformNormal(a,this.pickedMesh.getWorldMatrix())),a},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i),s=e.Vector3.DistanceSquared(r,o);return n*n>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var r=0;8>r;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var r=8,n=0;8>n&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.center,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return r(n.directions[0],n,o)&&r(n.directions[1],n,o)&&r(n.directions[2],n,o)&&r(o.directions[0],n,o)&&r(o.directions[1],n,o)&&r(o.directions[2],n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o)?!0:!1},t}();e.BoundingInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n){var o=this;t.call(this,r,n),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions)},n.addMesh(this)}return __extends(i,t),Object.defineProperty(i,\"BILLBOARDMODE_NONE\",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_X\",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Y\",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_Z\",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,\"BILLBOARDMODE_ALL\",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isBlocked\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,\"useBones\",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,\"worldMatrixFromCache\",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"absolutePosition\",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,\"isWorldMatrixFrozen\",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,r){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),r&&r!==e.Space.LOCAL){if(this.parent){var n=this.parent.getWorldMatrix().clone();n.invert(),t=e.Vector3.TransformNormal(t,n)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,r,n;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(n);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,r*a,n,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){\"rotation\"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera,n=r.getWorldMatrix(),o=new e.Vector3(n.m[12],n.m[13],n.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)!=i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&i.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var h=0;h<this._onAfterWorldMatrixUpdate.length;h++)this._onAfterWorldMatrixUpdate[h](this);return this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,r,n){i=i||0,r=r||0,n=n||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+r,n)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var r=this.getScene().getPhysicsEngine();if(r)return t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(i=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void r._unregisterMesh(this):(i?(i.mass||0===i.mass||(i.mass=0),i.friction||0===i.friction||(i.friction=.2),i.restitution||0===i.restitution||(i.restitution=.2)):i={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,r._registerMesh(this,t,i))},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,r){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,r)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;r>s;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){\n    .\n   22  else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn(\"InterpolateValueAction: Unsupported type (\"+typeof this.value+\")\");t=e.Animation.ANIMATIONTYPE_QUATERNION}var n=new e.Animation(\"InterpolateValueAction\",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);n.setKeys(r),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[n],0,100)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,r,n){e.call(this,t,n),this.propertyPath=r,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,r,n){e.call(this,t,n),this.value=r,this._target=i}return __extends(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,r,n,o){e.call(this,t,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){t.call(this,e,o),this.propertyPath=r,this.value=n,this._target=i}return __extends(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),\"number\"!=typeof this._target[this._property]&&e.Tools.Warn(\"Warning: IncrementValueAction can only be used with number values\")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=n;var o=function(e){function t(t,i,r,n,o,s){e.call(this,t,s),this.from=r,this.to=n,this.loop=o,this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=o;var s=function(e){function t(t,i,r){e.call(this,t,r),this._target=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,r){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)}return __extends(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,r){e.call(this,t,r),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){e.call(this,t,r),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var l=function(t){function i(e,i,r,n){t.call(this,e,n),this._target=i,this._parent=r}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l;var u=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=u;var f=function(e){function t(t,i,r){e.call(this,t,r),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n),t===e.VertexBuffer.PositionKind){n=this._vertexBuffers[t].getStrideSize(),this._totalVertices=i.length/n;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o,s=n.getStrideSize();this._totalVertices=i.length/s,r&&(o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices));for(var a=this._meshes,h=a.length,c=0;h>c;c++){var l=a[c];if(l._resetPointsArrayCache(),r){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var u=0;u<l.subMeshes.length;u++){var f=l.subMeshes[u];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(t&&1!==this._meshes.length){for(var n=r.length,o=[],s=0;n>s;s++)o.push(r[s]);return o}return r},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,r=i.length,n=0;r>n;n++)i[n]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;i>n;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);if(-1!==r){for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers)if(1===i&&this._vertexBuffers[r].create(),this._vertexBuffers[r]._buffer.references=i,r===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var n=e.Tools.ExtractMinAndMax(this._vertexBuffers[r].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var r=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;s>a;a++)r._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;r>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];for(var n=this.getIndices(),o=0;o<n.length;o++)r.indices.push(n[o]);var s=!1,a=!1;for(var h in this._vertexBuffers)r.set(this.getVerticesData(h).slice(0),h),a||(s=this.getVertexBuffer(h).isUpdatable(),a=!s);var c=new t(i,this._scene,r,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(h);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i=\"x\"===e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var r=function(e){function t(t,i,r,n,o){this._beingRegenerated=!0,this._canBeRegenerated=n,e.call(this,t,i,r,!1,o),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error(\"Abstract method\")},t.prototype.copy=function(e){throw new Error(\"Must be overriden in sub-classes.\")},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,h,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=n,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,i,r,this._regenerateVertexData(),h,c)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(r);i.Ribbon=n;var o=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Box=o;var s=function(t){function i(i,r,n,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.segments=n,this.diameter=o,this.side=h,t.call(this,i,r,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i}(r);i.Sphere=s;var a=function(t){function i(i,r,n,o,s,a,h,c,l,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.height=n,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u,t.call(this,i,r,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i}(r);i.Cylinder=a;var h=function(t){function i(i,r,n,o,s,a,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=n,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,i,r,this._regenerateVertexData(),a,h)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Torus=h;var c=function(t){function i(e,i,r,n,o,s,a){this.width=r,this.height=n,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var l=function(t){function i(e,i,r,n,o,s,a,h,c,l){this.xmin=r,this.zmin=n,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,l)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=l;var u=function(t){function i(i,r,n,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=n,this.side=a,t.call(this,i,r,this._regenerateVertexData(),o,s)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i}(r);i.Plane=u;var f=function(t){function i(i,r,n,o,s,a,h,c,l,u,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=n,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=c,this.side=f,t.call(this,i,r,this._regenerateVertexData(),l,u)}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i}(r);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r){t.call(this,i,r),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,\"subdivisions\",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var r=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),r=e.Ray.Transform(r,this._worldInverse);var n=this.intersects(r);return n.hit?n.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n){void 0===n&&(n=!1),t.call(this,i,r),this.color=new e.Color3(1,1,1),this.alpha=1,this._indices=new Array,this._colorShader=new e.ShaderMaterial(\"colorShader\",r,\"color\",{attributes:[\"position\"],uniforms:[\"worldViewProjection\",\"color\"],needAlphaBlending:!0})}return __extends(i,t),Object.defineProperty(i.prototype,\"material\",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"isPickable\",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,\"checkCollisions\",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(t,i,r){var n=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();n.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4(\"color\",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var r=this.getScene().getEngine();r.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(e,t){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat(\"offset\",r?0:h.outlineWidth),this._effect.setColor4(\"color\",r?h.overlayColor:h.outlineColor,r?h.overlayAlpha:1),this._effect.setMatrix(\"viewProjection\",o.getTransformMatrix()),h.useBones&&this._effect.setMatrices(\"mBones\",h.skeleton.getTransformMatrices()),h._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture(\"diffuseSampler\",l),this._effect.setMatrix(\"diffuseMatrix\",l.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix(\"world\",t)})}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"outline\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"offset\",\"color\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,r){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=r,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,function(){n.onError&&n.onError(n),r()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!1,function(){n.onError&&n.onError(n),r()})},t}();e.TextFileAssetTask=i;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()},null,t.database,!0,function(){n.onError&&n.onError(n),r()})},t}();e.BinaryFileAssetTask=r;var n=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var r=this,n=new Image;n.onload=function(){r.image=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),t()},n.onerror=function(){r.onError&&r.onError(r),i()},n.src=this.url},e}();e.ImageAssetTask=n;var o=function(){function t(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=r,this.invertY=n,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,r){var n=this,o=function(){n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),i()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,r)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,r,n){var o=new t(e,i,r,n);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addBinaryFileTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,r,n,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,r,n,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return __extends(i,t),i.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),window.addEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener(\"deviceorientation\",this._deviceOrientationHandler)},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o=!0),t.call(this,i,r,n),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(e,i){t.prototype.attachControl.call(this,e,i),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale){var o=n.getSize(),s=Math.max(o.width,o.height);s>r.maximumSize&&(n.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var i=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return i.isVisible&&i.isEnabled()?i.instances.length>0?!1:i.skeleton||i.hasLODLevels?!1:!0:!1},this.apply=function(t){for(var r=t.meshes.slice(0),n=r.length,o=0;n>o;o++){var s=new Array,a=r[o];if(i._canBeMerged(a)){s.push(a);for(var h=o+1;n>h;h++){var c=r[h];i._canBeMerged(c)&&c.material===a.material&&c.checkCollisions===a.checkCollisions&&(s.push(c),n--,r.splice(h,1),h--)}s.length<2||e.Mesh.MergeMeshes(s)}}return!0}}return __extends(i,t),i}(t);e.MergeMeshesOptimization=c;var l=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),h=0;return r.optimizations.push(new c(h)),r.optimizations.push(new n(h)),r.optimizations.push(new s(h)),h++,r.optimizations.push(new o(h)),r.optimizations.push(new a(h)),h++,r.optimizations.push(new i(h,1024)),r},e.ModerateDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,512)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,2)),l},e.HighDegradationAllowed=function(t){var l=new e(t),u=0;return l.optimizations.push(new c(u)),l.optimizations.push(new n(u)),l.optimizations.push(new s(u)),u++,l.optimizations.push(new o(u)),l.optimizations.push(new a(u)),u++,l.optimizations.push(new i(u,256)),u++,l.optimizations.push(new h(u)),u++,l.optimizations.push(new r(u,4)),l},e}();e.SceneOptimizerOptions=l;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var c=i.optimizations[h];c.priority===r&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&r++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,r,n){i||(i=l.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,(\"undefined\"!=typeof AudioContext||\"undefined\"!=typeof webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,\"audioContext\",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,\n   23  this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error(\"Web Audio: \"+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,r,n,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel=\"linear\",this._panningModel=\"equalpower\",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||\"linear\",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&(\"string\"==typeof i?e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,null,!0):i instanceof ArrayBuffer?this._soundLoaded(i):e.Tools.Error(\"Parameter must be a URL to the sound or an ArrayBuffer of the sound.\"))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error(\"Web Audio is not supported by your browser.\"),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error(\"Error while decoding audio data: \"+t.err)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel=\"HRTF\"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel=\"linear\",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel=\"HRTF\",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel=\"equalpower\",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t))},t.prototype.setDirectionalCone=function(t,i,r){return t>i?void e.Tools.Error(\"setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.\"):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=r,this._soundSource.onended=function(){i._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(n){e.Tools.Error(\"Error while trying to play audio: \"+this.name+\", \"+n.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),i&&(i.volume&&(this._outputAudioNode.gain.value=i.volume),i.mainTrack&&(this._isMainTrack=i.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor=\"orange\",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+\"px\",i._statsDiv.style.top=t.height-290+\"px\",i._statsDiv.style.width=\"400px\",i._statsDiv.style.height=\"auto\",i._statsSubsetDiv.style.maxHeight=\"240px\",i._optionsDiv.style.left=\"0px\",i._optionsDiv.style.top=\"10px\",i._optionsDiv.style.width=\"200px\",i._optionsDiv.style.height=\"auto\",i._optionsSubsetDiv.style.maxHeight=t.height-225+\"px\",i._logDiv.style.left=\"0px\",i._logDiv.style.top=t.height-170+\"px\",i._logDiv.style.width=\"600px\",i._logDiv.style.height=\"160px\",i._treeDiv.style.left=t.width-310+\"px\",i._treeDiv.style.top=\"10px\",i._treeDiv.style.width=\"300px\",i._treeDiv.style.height=\"auto\",i._treeSubsetDiv.style.maxHeight=t.height-340+\"px\"),i._globalDiv.style.left=t.left+\"px\",i._globalDiv.style.top=t.top+\"px\",i._drawingCanvas.style.left=\"0px\",i._drawingCanvas.style.top=\"0px\",i._drawingCanvas.style.width=e.getRenderWidth()+\"px\",i._drawingCanvas.style.height=e.getRenderHeight()+\"px\";var r=window.devicePixelRatio||1,n=i._drawingContext,o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i._ratio=r/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=\"\"):i._statsDiv.style.display=\"none\",i._logDiv.style.display=i._displayLogs?\"\":\"none\",i._displayTree?(i._treeDiv.style.display=\"\",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display=\"none\")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);for(var t=i._scene.getEngine(),r=i._camera.viewport,n=r.toGlobal(t),o=i._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],h=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(h,a.getWorldMatrix(),i._transformationMatrix,n);(a.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(a))&&i._renderAxis(c,a,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(a))&&i._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?\"red\":\"black\"})}var l=i._scene.cameras;for(s=0;s<l.length;s++){var u=l[s];u!==i._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(u))&&i._renderLabel(u.name,c,12,function(){i._camera.detachControl(t.getRenderingCanvas()),i._camera=u,i._camera.attachControl(t.getRenderingCanvas())},function(){return\"purple\"}))}var f=i._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,n),(!i.shouldDisplayLabel||i.shouldDisplayLabel(d))&&i._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?\"orange\":\"gray\"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+\" verts\",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,r,n){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=n,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font=\"normal 14px Segoe UI\",this._drawingContext.fillStyle=n,this._drawingContext.fillText(r,i.x,i.y)},t.prototype._renderAxis=function(t,i,r){var n=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),r.width,r.height,o,this._transformationMatrix),a=s.subtract(n).length(),h=e.Vector3.Project(n.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,r),c=e.Vector3.Project(n.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,h,c,\"x\",\"#FF0000\");var l=e.Vector3.Project(n.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,r),u=e.Vector3.Project(n.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,r);this._renderSingleAxis(t,l,u,\"y\",\"#00FF00\");var f=e.Vector3.Project(n.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,r),d=e.Vector3.Project(n.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,r);this._renderSingleAxis(t,f,d,\"z\",\"#0000FF\")},t.prototype._renderLabel=function(e,t,i,r,n){if(t.z>0&&t.z<1){this._drawingContext.font=\"normal 12px Segoe UI\";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&r(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=n(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle=\"#FFFFFF\",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle=\"#FFFFFF\",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,r){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+i?!1:this._clickPosition.y<t||this._clickPosition.y>t+r?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener(\"resize\",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener(\"click\",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var i=this._scene.getEngine();this._globalDiv=document.createElement(\"div\"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener(\"resize\",this._syncPositions),i.getRenderingCanvas().addEventListener(\"click\",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement(\"div\");i.innerHTML=t+\"&nbsp;\",i.style.textAlign=\"right\",i.style.width=\"100%\",i.style.color=\"white\",i.style.backgroundColor=\"Black\",i.style.padding=\"5px 5px 4px 0px\",i.style.marginLeft=\"-5px\",i.style.fontWeight=\"bold\",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var r=document.createElement(\"label\");r.innerHTML=t,r.style.color=i,e.appendChild(r),e.appendChild(document.createElement(\"br\"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"checkbox\",a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a);var h=document.createElement(\"span\"),c=document.createElement(\"span\"),l=document.createElement(\"span\");l.style.cssFloat=\"right\",c.innerHTML=t,l.innerHTML=i,l.style.fontSize=\"12px\",l.style.maxWidth=\"200px\",h.appendChild(c),h.appendChild(l),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateCheckBox=function(e,t,i,r,n){void 0===n&&(n=null);var o=document.createElement(\"label\"),s=document.createElement(\"input\");s.type=\"checkbox\",s.checked=i,s.addEventListener(\"change\",function(e){r(e.target,n)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement(\"br\"))},t.prototype._generateButton=function(e,t,i,r){void 0===r&&(r=null);var n=document.createElement(\"button\");n.innerHTML=t,n.style.height=\"24px\",n.style.color=\"#444444\",n.style.border=\"1px solid white\",n.className=\"debugLayerButton\",n.addEventListener(\"click\",function(e){i(e.target,r)}),e.appendChild(n),e.appendChild(document.createElement(\"br\"))},t.prototype._generateRadio=function(e,t,i,r,n,o){void 0===o&&(o=null);var s=document.createElement(\"label\"),a=document.createElement(\"input\");a.type=\"radio\",a.name=i,a.checked=r,a.addEventListener(\"change\",function(e){n(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement(\"br\"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id=\"DebugLayer\",this._globalDiv.style.position=\"absolute\",this._globalDiv.style.fontFamily=\"Segoe UI, Arial\",this._globalDiv.style.fontSize=\"14px\",this._globalDiv.style.color=\"white\",this._drawingCanvas=document.createElement(\"canvas\"),this._drawingCanvas.id=\"DebugLayerDrawingCanvas\",this._drawingCanvas.style.position=\"absolute\",this._drawingCanvas.style.pointerEvents=\"none\",this._drawingContext=this._drawingCanvas.getContext(\"2d\"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i=\"rgba(128, 128, 128, 0.4)\",r=\"rgb(180, 180, 180) solid 1px\";this._statsDiv=document.createElement(\"div\"),this._statsDiv.id=\"DebugLayerStats\",this._statsDiv.style.border=r,this._statsDiv.style.position=\"absolute\",this._statsDiv.style.background=i,this._statsDiv.style.padding=\"0px 0px 0px 5px\",this._generateheader(this._statsDiv,\"STATISTICS\"),this._statsSubsetDiv=document.createElement(\"div\"),this._statsSubsetDiv.style.paddingTop=\"5px\",this._statsSubsetDiv.style.paddingBottom=\"5px\",this._statsSubsetDiv.style.overflowY=\"auto\",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement(\"div\"),this._treeDiv.id=\"DebugLayerTree\",this._treeDiv.style.border=r,this._treeDiv.style.position=\"absolute\",this._treeDiv.style.background=i,this._treeDiv.style.padding=\"0px 0px 0px 5px\",this._treeDiv.style.display=\"none\",this._generateheader(this._treeDiv,\"MESHES TREE\"),this._treeSubsetDiv=document.createElement(\"div\"),this._treeSubsetDiv.style.paddingTop=\"5px\",this._treeSubsetDiv.style.paddingRight=\"5px\",this._treeSubsetDiv.style.overflowY=\"auto\",this._treeSubsetDiv.style.maxHeight=\"300px\",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement(\"div\"),this._logDiv.style.border=r,this._logDiv.id=\"DebugLayerLogs\",this._logDiv.style.position=\"absolute\",this._logDiv.style.background=i,this._logDiv.style.padding=\"0px 0px 0px 5px\",this._logDiv.style.display=\"none\",this._generateheader(this._logDiv,\"LOGS\"),this._logSubsetDiv=document.createElement(\"div\"),this._logSubsetDiv.style.height=\"127px\",this._logSubsetDiv.style.paddingTop=\"5px\",this._logSubsetDiv.style.overflowY=\"auto\",this._logSubsetDiv.style.fontSize=\"12px\",this._logSubsetDiv.style.fontFamily=\"consolas\",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement(\"div\"),this._optionsDiv.id=\"DebugLayerOptions\",this._optionsDiv.style.border=r,this._optionsDiv.style.position=\"absolute\",this._optionsDiv.style.background=i,this._optionsDiv.style.padding=\"0px 0px 0px 5px\",this._optionsDiv.style.overflowY=\"auto\",this._generateheader(this._optionsDiv,\"OPTIONS\"),this._optionsSubsetDiv=document.createElement(\"div\"),this._optionsSubsetDiv.style.paddingTop=\"5px\",this._optionsSubsetDiv.style.paddingBottom=\"5px\",this._optionsSubsetDiv.style.overflowY=\"auto\",this._optionsSubsetDiv.style.maxHeight=\"200px\",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,\"<b>Windows:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Statistics\",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Logs\",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Meshes tree\",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>General:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Bounding boxes\",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Clickable labels\",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,\"Generate user marks (F12)\",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Rendering mode:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Solid\",\"renderMode\",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Wireframe\",\"renderMode\",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,\"Point\",\"renderMode\",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Texture channels:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Diffuse\",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Ambient\",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Specular\",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Emissive\",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Bump\",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Opacity\",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Reflection\",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fresnel\",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Options:</b>\",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,\"Animations\",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Collisions\",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Fog\",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lens flares\",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Lights\",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Particles\",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Post-processes\",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Procedural textures\",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Render targets\",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Shadows\",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Skeletons\",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Sprites\",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,\"Textures\",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Audio:</b>\",this.accentColor),this._generateRadio(this._optionsSubsetDiv,\"Headphones\",\"panningModel\",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,\"Normal Speakers\",\"panningModel\",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,\"Disable audio\",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._generateTexBox(this._optionsSubsetDiv,\"<b>Tools:</b>\",this.accentColor),this._generateButton(this._optionsSubsetDiv,\"Dump rendertargets\",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement(\"br\")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),\n   24: this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),r=i.getGlInfo();this._statsSubsetDiv.innerHTML=\"Babylon.js v\"+e.Engine.Version+\" - <b>\"+e.Tools.Format(i.getFps(),0)+\" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: \"+t.meshes.length+\"<br>Total vertices: \"+t.getTotalVertices()+\"<br>Total materials: \"+t.materials.length+\"<br>Total textures: \"+t.textures.length+\"<br>Active meshes: \"+t.getActiveMeshes().length+\"<br>Active indices: \"+t.getActiveIndices()+\"<br>Active bones: \"+t.getActiveBones()+\"<br>Active particles: \"+t.getActiveParticles()+\"<br><b>Draw calls: \"+i.drawCalls+\"</b><br><br><b>Duration</b><br>Meshes selection:</i> \"+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+\" ms<br>Render Targets: \"+e.Tools.Format(t.getRenderTargetsDuration())+\" ms<br>Particles: \"+e.Tools.Format(t.getParticlesDuration())+\" ms<br>Sprites: \"+e.Tools.Format(t.getSpritesDuration())+\" ms<br><br>Render: <b>\"+e.Tools.Format(t.getRenderDuration())+\" ms</b><br>Frame: \"+e.Tools.Format(t.getLastFrameDuration())+\" ms<br>Potential FPS: \"+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+\"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: \"+(i.getCaps().standardDerivatives?\"Yes\":\"No\")+\"<br>Compressed textures: \"+(i.getCaps().s3tc?\"Yes\":\"No\")+\"<br>Hardware instances: \"+(i.getCaps().instancedArrays?\"Yes\":\"No\")+\"<br>Texture float: \"+(i.getCaps().textureFloat?\"Yes\":\"No\")+\"<br>32bits indices: \"+(i.getCaps().uintIndices?\"Yes\":\"No\")+\"<br><b>Caps.</b><br>Max textures units: \"+i.getCaps().maxTexturesImageUnits+\"<br>Max textures size: \"+i.getCaps().maxTextureSize+\"<br>Max anisotropy: \"+i.getCaps().maxAnisotropy+\"<br><br><br></div><br><b>Info</b><br>\"+r.version+\"<br>\"+r.renderer+\"<br>\",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h,c){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this._texture=s.getEngine().createRawTexture(i,r,n,o,a,h,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.CreateLuminanceTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,h=0;n>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\\.\\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){if(this._points=new i,this._outlinepoints=new i,this._holes=[],!(\"poly2tri\"in window))throw\"PolygonMeshBuilder cannot be used because poly2tri is not referenced\";this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new i;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1);var n=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),i>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});var u,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:u=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(u.index+l),d=-1}d++})}),this.addSide(s,o,a,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,a,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,a,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,h){for(var c=t.length/3,l=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),_=new e.Vector3(0,1,0),v=e.Vector3.Cross(g,_);v=v.normalize(),r.push(l/o.width,0),r.push(l/o.width,1),l+=g.length(),r.push(l/o.width,0),r.push(l/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var r=i.getSimplifier(t);r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.quadtreeRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.quadtreeRATIC=0]=\"quadtreeRATIC\"}(e.SimplificationType||(e.SimplificationType={}));var r=e.SimplificationType,n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,i,r,n,o,s,a,h){var c=this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[h];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;10>r;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var r=0,n=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-n.x<t.boundingBoxEpsilon||n.x-o.minimum.x>t.boundingBoxEpsilon)&&++r,(o.maximum.y==n.y||n.y==o.minimum.y)&&++r,(o.maximum.z==n.z||n.z==o.minimum.z)&&++r,r>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var h=1e-9*Math.pow(t+3,n.aggressiveness),c=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>h||r.deleted||r.isDirty))for(var o=0;3>o;++o)if(r.error[o]<h){var a=[],c=[],l=r.vertices[o],u=r.vertices[(o+1)%3];if(l.isBorder!==u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(l,u,f,d,p,m);var g=[];if(n.isFlipped(l,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,l,f,c,r.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var _=[];if(g.forEach(function(e){-1===_.indexOf(e)&&(e.deletePending=!0,_.push(e))}),_.length%2!=0)continue;l.q=u.q.add(l.q),l.updatePosition(f);var v=n.references.length;s=n.updateTriangles(l,l,a,s),s=n.updateTriangles(l,u,c,s);var y=n.references.length-v;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)n.references[l.triangleStart+x]=n.references[v+x]}else l.triangleStart=v;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,c,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){var i=t+c.verticesStart,r=e.Vector3.FromArray(a,3*i),n=l(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id==s.vertices.length&&s.vertices.push(n),u.push(n.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,i=3*t,r=h[i+0],o=h[i+1],a=h[i+2],l=s.vertices[u[r-c.verticesStart]],f=s.vertices[u[o-c.verticesStart]],d=s.vertices[u[a-c.verticesStart]],p=new n([l,f,d]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;3>n;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;3>r;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;3>o;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),_=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<r.length;++i){var n=r[i];[0,1,2].forEach(function(e){var t=y[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(n.vertices[e].id+i+g)})}this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];if(t>0){this._reconstructedMesh.subMeshes=[],_.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())});{new e.SubMesh(x.materialIndex,g,d,m,3*r.length,this._reconstructedMesh)}}},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+\"Decimated\",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var c=this.references[t.triangleStart+a].vertexId,l=h.vertices[(c+1)%3],u=h.vertices[(c+2)%3];if(l!==i&&u!==i){var f=l.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else n[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&r[a]!==h.id;)++a;a===i.length?(i.push(1),r.push(h.id)):i[a]++}for(t=0;t<i.length;++t)this.vertices[r[t]].isBorder=1===i[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;3>n;++n)o=r.vertices[n],h[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);c=Math.min(f,d,p),c===f?r&&r.copyFrom(t.position):c===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),r.y=1/l*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,r);return c},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement(\"canvas\"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position=\"absolute\",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+\"px\",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+\"px\",this._debugCanvasContext=this._debugCanvas.getContext(\"2d\"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle=\"rgb(0, 0, 0)\",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle=\"hsl(\"+h+\", 100%, 50%)\",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var r=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture(\"depthMap\",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix(\"viewProjection\",n.getTransformMatrix()),r._effect.setFloat(\"far\",n.activeCamera.maxZ),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture(\"diffuseSampler\",c),r._effect.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())}i.useBones&&r._effect.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix(\"world\",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(r.push(\"#define ALPHATEST\"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push(\"#define UV1\")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push(\"#define UV2\"))),o.useBones&&(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),r.push(\"#define BONES\"),r.push(\"#define BonesPerMesh \"+(o.skeleton.bones.length+1))),i&&(r.push(\"#define INSTANCES\"),n.push(\"world0\"),n.push(\"world1\"),n.push(\"world2\"),n.push(\"world3\"));var a=r.join(\"\\n\");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect(\"depth\",n,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"far\"],[\"diffuseSampler\"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){var s=this;t.call(this,r.getEngine(),i),this.SSAOOriginalSceneColorEffect=\"SSAOOriginalSceneColorEffect\",this.SSAORenderEffect=\"SSAORenderEffect\",this.SSAOBlurHRenderEffect=\"SSAOBlurHRenderEffect\",this.SSAOBlurVRenderEffect=\"SSAOBlurVRenderEffect\",this.SSAOCombineRenderEffect=\"SSAOCombineRenderEffect\",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=r,this._createRandomTexture(),this._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,h=n.combineRatio||n;this._originalColorPostProcess=new e.PassPostProcess(\"SSAOOriginalSceneColor\",h,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess(\"SSAOBlurH\",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess(\"SSAOBlurV\",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},i.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],n=1/16;this._ssaoPostProcess=new e.PostProcess(\"ssao\",\"ssao\",[\"sampleSphere\",\"samplesFactor\",\"randTextureTiles\",\"totalStrength\",\"radius\",\"area\",\"fallOff\"],[\"randomSampler\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3(\"sampleSphere\",r),e.setFloat(\"samplesFactor\",n),e.setFloat(\"randTextureTiles\",4/t),i._firstUpdate=!1),e.setFloat(\"totalStrength\",i.totalStrength),e.setFloat(\"radius\",i.radius),e.setFloat(\"area\",i.area),e.setFloat(\"fallOff\",i.fallOff),e.setTexture(\"textureSampler\",i._depthTexture),e.setTexture(\"randomSampler\",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess(\"ssaoCombine\",\"ssaoCombine\",[],[\"originalColor\"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess(\"originalColor\",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture(\"SSAORandomTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},n=0;t>n;n++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*r(0,1)),s.y=Math.floor(255*r(0,1)),s.z=Math.floor(255*r(0,1)),i.fillStyle=\"rgb(\"+s.x+\", \"+s.y+\", \"+s.z+\")\",i.fillRect(n,o,1,1)}this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(r,n,o,s,a,h,c,l){var u=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,\"volumetricLightScattering\",[\"decay\",\"exposure\",\"weight\",\"meshPositionOnScreen\",\"density\"],[\"lightScatteringSampler\"],n.postProcessRatio||n,o,h,c,l,\"#define NUM_SAMPLES \"+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926;var f=o.getScene();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(f.getEngine()),this.mesh=null!==s?s:i.CreateDefaultMesh(\"VolumetricLightScatteringMesh\",f),this._createPass(f,n.passRatio||n),this.onApply=function(e){u._updateMeshScreenCoordinates(f),e.setTexture(\"lightScatteringSampler\",u._volumetricLightScatteringRTT),e.setFloat(\"exposure\",u.exposure),e.setFloat(\"decay\",u.decay),e.setFloat(\"weight\",u.weight),e.setFloat(\"density\",u.density),e.setVector2(\"meshPositionOnScreen\",u._screenCoordinates)}}return __extends(i,t),i.prototype.isReady=function(t,i){var r=t.getMesh(),n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;r===this.mesh&&(n.push(this.useDiffuseColor?\"#define DIFFUSE_COLOR_RENDER\":\"#define BASIC_RENDER\"),n.push(\"#define NEED_UV\"),a=!0),s&&(s.needAlphaTesting()&&n.push(\"#define ALPHATEST\"),void 0!==s.opacityTexture&&(n.push(\"#define OPACITY\"),s.opacityTexture.getAlphaFromRGB&&n.push(\"#define OPACITYRGB\"),a||n.push(\"#define NEED_UV\")),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push(\"#define UV1\")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push(\"#define UV2\"))),r.useBones&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push(\"#define BONES\"),n.push(\"#define BonesPerMesh \"+(r.skeleton.bones.length+1))),i&&(n.push(\"#define INSTANCES\"),o.push(\"world0\"),o.push(\"world1\"),o.push(\"world2\"),o.push(\"world3\"));var h=n.join(\"\\n\");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({\n   25  vertexElement:\"depth\",fragmentElement:\"volumetricLightScatteringPass\"},o,[\"world\",\"mBones\",\"viewProjection\",\"diffuseMatrix\",\"opacityLevel\",\"color\"],[\"diffuseSampler\",\"opacitySampler\"],h)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture(\"volumetricLightScatteringMap\",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=i.getScene(),o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._volumetricLightScatteringPass),i._bind(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._volumetricLightScatteringPass.setMatrix(\"viewProjection\",n.getTransformMatrix()),h&&(i===r.mesh||h.needAlphaTesting()||void 0!==h.opacityTexture)){var c=h.getAlphaTestTexture();r.useDiffuseColor&&i===r.mesh?r._volumetricLightScatteringPass.setColor3(\"color\",h.diffuseColor):(r._volumetricLightScatteringPass.setTexture(\"diffuseSampler\",c),c&&r._volumetricLightScatteringPass.setMatrix(\"diffuseMatrix\",c.getTextureMatrix())),void 0!==h.opacityTexture&&(r._volumetricLightScatteringPass.setTexture(\"opacitySampler\",h.opacityTexture),r._volumetricLightScatteringPass.setFloat(\"opacityLevel\",h.opacityTexture.level))}i.useBones&&r._volumetricLightScatteringPass.setMatrices(\"mBones\",i.skeleton.getTransformMatrices()),i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return r._volumetricLightScatteringPass.setMatrix(\"world\",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<r.length;o++)s(r.data[o]);if(a.setAlphaTesting(!1),n.length){for(o=0;o<n.length;o++){var h=n.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=n.data.slice(0,n.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i=t.getTransformMatrix(),r=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),i,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);return r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,r.material=new e.StandardMaterial(t+\"Material\",i),r},i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;void 0===o&&(o=1),t.call(this,n.getEngine(),i),this.LensChromaticAberrationEffect=\"LensChromaticAberrationEffect\",this.HighlightsEnhancingEffect=\"HighlightsEnhancingEffect\",this.LensDepthOfFieldEffect=\"LensDepthOfFieldEffect\",this._scene=n,this._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?this._grainTexture=r.grain_texture:this._createGrainTexture(),this._edgeBlur=r.edge_blur?r.edge_blur:0,this._grainAmount=r.grain_amount?r.grain_amount:0,this._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,this._distortion=r.distortion?r.distortion:0,this._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,this._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,this._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,this._dofAperture=r.dof_aperture?r.dof_aperture:1,this._dofDarken=r.dof_darken?r.dof_darken:0,this._dofPentagon=void 0!==r.dof_pentagon?r.dof_pentagon:!0,this._blurNoise=void 0!==r.blur_noise?r.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(this),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},i.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess(\"LensChromaticAberration\",\"chromaticAberration\",[\"chromatic_aberration\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat(\"chromatic_aberration\",i._chromaticAberration),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess(\"LensHighlights\",\"lensHighlights\",[\"pentagon\",\"gain\",\"threshold\",\"screen_width\",\"screen_height\"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat(\"gain\",i._highlightsGain),e.setFloat(\"threshold\",i._highlightsThreshold),e.setBool(\"pentagon\",i._dofPentagon),e.setTextureFromPostProcess(\"textureSampler\",i._chromaticAberrationPostProcess),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess(\"LensDepthOfField\",\"depthOfField\",[\"grain_amount\",\"blur_noise\",\"screen_width\",\"screen_height\",\"distortion\",\"dof_enabled\",\"screen_distance\",\"aperture\",\"darken\",\"edge_blur\",\"highlights\",\"near\",\"far\"],[\"depthSampler\",\"grainSampler\",\"highlightsSampler\"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture(\"depthSampler\",i._depthTexture),e.setTexture(\"grainSampler\",i._grainTexture),e.setTextureFromPostProcess(\"textureSampler\",i._highlightsPostProcess),e.setTextureFromPostProcess(\"highlightsSampler\",i._depthOfFieldPostProcess),e.setFloat(\"grain_amount\",i._grainAmount),e.setBool(\"blur_noise\",i._blurNoise),e.setFloat(\"screen_width\",i._scene.getEngine().getRenderingCanvas().width),e.setFloat(\"screen_height\",i._scene.getEngine().getRenderingCanvas().height),e.setFloat(\"distortion\",i._distortion),e.setBool(\"dof_enabled\",-1!=i._dofDistance),e.setFloat(\"screen_distance\",1/(.1-1/i._dofDistance)),e.setFloat(\"aperture\",i._dofAperture),e.setFloat(\"darken\",i._dofDarken),e.setFloat(\"edge_blur\",i._edgeBlur),e.setBool(\"highlights\",-1!=i._highlightsGain),e.setFloat(\"near\",i._scene.activeCamera.minZ),e.setFloat(\"far\",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture(\"LensNoiseTexture\",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,r=this._grainTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*n(.42,.58)),r.fillStyle=\"rgb(\"+i+\", \"+i+\", \"+i+\")\",r.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o,s,a,h){var c=this;t.call(this,i,\"colorCorrection\",null,[\"colorTable\"],n,o,s,a,h),this._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture(\"colorTable\",c._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,h){t.call(this,i,r,n,o,s,h),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){t.call(this,i,r,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.FreeCamera);e.StereoscopicFreeCamera=n;var o=function(t){function i(i,r,n,o,s,a,h,c){t.call(this,i,r,n,o,s,c),this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=o;var s=function(t){function i(i,r,n,o,s){t.call(this,i,r,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n})}return __extends(i,t),i}(e.GamepadCamera);e.StereoscopicGamepadCamera=s}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D leftSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    vec4 leftFrag = texture2D(leftSampler, vUV);\\r\\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\\r\\n\\r\\n	vec4 rightFrag = texture2D(textureSampler, vUV);\\r\\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\\r\\n\\r\\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\\r\\n}\",blackAndWhitePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nvoid main(void) \\r\\n{\\r\\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\\r\\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\\r\\n}\",blurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\nuniform vec2 direction;\\r\\nuniform float blurWidth;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float weights[7];\\r\\n	weights[0] = 0.05;\\r\\n	weights[1] = 0.1;\\r\\n	weights[2] = 0.2;\\r\\n	weights[3] = 0.3;\\r\\n	weights[4] = 0.2;\\r\\n	weights[5] = 0.1;\\r\\n	weights[6] = 0.05;\\r\\n\\r\\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\\r\\n	vec2 texelStep = texelSize * direction * blurWidth;\\r\\n	vec2 start = vUV - 3.0 * texelStep;\\r\\n\\r\\n	vec4 baseColor = vec4(0., 0., 0., 0.);\\r\\n	vec2 texelOffset = vec2(0., 0.);\\r\\n\\r\\n	for (int i = 0; i < 7; i++)\\r\\n	{\\r\\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\\r\\n		texelOffset += texelStep;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = baseColor;\\r\\n}\",brickPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform float numberOfBricksHeight;\\r\\nuniform float numberOfBricksWidth;\\r\\nuniform vec3 brickColor;\\r\\nuniform vec3 jointColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nfloat round(float number){\\r\\n	return sign(number)*floor(abs(number) + 0.5);\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	float brickW = 1.0 / numberOfBricksWidth;\\r\\n	float brickH = 1.0 / numberOfBricksHeight;\\r\\n	float jointWPercentage = 0.01;\\r\\n	float jointHPercentage = 0.05;\\r\\n	vec3 color = brickColor;\\r\\n	float yi = vUV.y / brickH;\\r\\n	float nyi = round(yi);\\r\\n	float xi = vUV.x / brickW;\\r\\n\\r\\n	if (mod(floor(yi), 2.0) == 0.0){\\r\\n		xi = xi - 0.5;\\r\\n	}\\r\\n\\r\\n	float nxi = round(xi);\\r\\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\\r\\n\\r\\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\\r\\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\\r\\n	}\\r\\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\\r\\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\\r\\n	}\\r\\n	else {\\r\\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\\r\\n\\r\\n		if (brickColorSwitch == 0.0)\\r\\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\\r\\n		else if (brickColorSwitch == 2.0)\\r\\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",chromaticAberrationPixelShader:\"// BABYLON.JS Chromatic Aberration GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Separates very slightly R, G and B colors on the edges of the screen\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// original color\\r\\n\\r\\n// uniforms\\r\\nuniform float chromatic_aberration;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\\r\\n		+ centered_screen_pos.y*centered_screen_pos.y;\\r\\n	float radius = sqrt(radius2);\\r\\n\\r\\n	vec4 original = texture2D(textureSampler, vUV);\\r\\n\\r\\n	if (chromatic_aberration > 0.0) {\\r\\n		//index of refraction of each color channel, causing chromatic dispersion\\r\\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\\r\\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\\r\\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\\r\\n\\r\\n		// shifts for red, green & blue\\r\\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\\r\\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\\r\\n\\r\\n		original.r = texture2D(textureSampler, ref_coords_r).r;\\r\\n		original.g = texture2D(textureSampler, ref_coords_g).g;\\r\\n		original.b = texture2D(textureSampler, ref_coords_b).b;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = original;\\r\\n}\",cloudPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 skyColor;\\r\\nuniform vec3 cloudColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n\\r\\n	vec2 p = vUV * 12.0;\\r\\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\\r\\n	gl_FragColor = vec4(c, 1);\\r\\n\\r\\n}\",colorPixelShader:\"precision highp float;\\r\\n\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_FragColor = color;\\r\\n}\",colorVertexShader:\"precision highp float;\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 worldViewProjection;\\r\\n\\r\\nvoid main(void) {\\r\\n	gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n}\",colorCorrectionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;	// screen render\\r\\nuniform sampler2D colorTable;		// color table with modified colors\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\\r\\n// it means the image is 256x16 pixels\\r\\n\\r\\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\\r\\n	float sliceSize = 1.0 / width;              // space of 1 slice\\r\\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\\r\\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\\r\\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\\r\\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\\r\\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\\r\\n	float s0 = xOffset + (zSlice0 * sliceSize);\\r\\n	float s1 = xOffset + (zSlice1 * sliceSize);\\r\\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\\r\\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\\r\\n	float zOffset = mod(uv.z * width, 1.0);\\r\\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 screen_color = texture2D(textureSampler, vUV);\\r\\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\\r\\n\\r\\n}\",convolutionPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform vec2 screenSize;\\r\\nuniform float kernel[9];\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\\r\\n	vec4 colorSum =\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\\r\\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\\r\\n\\r\\n	float kernelWeight =\\r\\n		kernel[0] +\\r\\n		kernel[1] +\\r\\n		kernel[2] +\\r\\n		kernel[3] +\\r\\n		kernel[4] +\\r\\n		kernel[5] +\\r\\n		kernel[6] +\\r\\n		kernel[7] +\\r\\n		kernel[8];\\r\\n\\r\\n	if (kernelWeight <= 0.0) {\\r\\n		kernelWeight = 1.0;\\r\\n	}\\r\\n\\r\\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\\r\\n}\",defaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_EXPLICIT	0.\\r\\n#define MAP_SPHERICAL	1.\\r\\n#define MAP_PLANAR		2.\\r\\n#define MAP_CUBIC		3.\\r\\n#define MAP_PROJECTION	4.\\r\\n#define MAP_SKYBOX		5.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\n\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\nuniform vec3 shadowsInfo0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\nuniform vec3 shadowsInfo1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\nuniform vec3 shadowsInfo2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\nuniform vec3 shadowsInfo3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Reflection\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\nuniform mat4 reflectionMatrix;\\r\\nuniform mat4 view;\\r\\n\\r\\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\\r\\n{\\r\\n	if (mode == MAP_SPHERICAL)\\r\\n	{\\r\\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\\r\\n	}\\r\\n	else if (mode == MAP_PLANAR)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 1));\\r\\n	}\\r\\n	else if (mode == MAP_CUBIC)\\r\\n	{\\r\\n		vec3 viewDir = worldPos.xyz - vEyePosition;\\r\\n		vec3 coords = reflect(viewDir, worldNormal);\\r\\n\\r\\n		return vec3(reflectionMatrix * vec4(coords, 0));\\r\\n	}\\r\\n	else if (mode == MAP_PROJECTION)\\r\\n	{\\r\\n		return vec3(reflectionMatrix * (view * worldPos));\\r\\n	}\\r\\n	else if (mode == MAP_SKYBOX)\\r\\n	{\\r\\n		return vPositionUVW;\\r\\n	}\\r\\n\\r\\n	return vec3(0, 0, 0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\\r\\n	return dot(color, bit_shift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return darkness;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float visibility = 1.;\\r\\n\\r\\n	vec2 poissonDisk[4];\\r\\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\\r\\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\\r\\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\\r\\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\\r\\n\\r\\n	// Poisson Sampling\\r\\n	float biasedDepth = depth.z - bias;\\r\\n\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\\r\\n\\r\\n	return visibility;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat linstep(float low, float high, float v) {\\r\\n	return clamp((v - low) / (high - low), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\\r\\n{\\r\\n	float p = smoothstep(compare - bias, compare, moments.x);\\r\\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\\r\\n	float d = compare - moments.x;\\r\\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\\r\\n\\r\\n	return clamp(max(p, p_max), 0.0, 1.0);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	depth = 0.5 * depth + vec3(0.5);\\r\\n	vec2 uv = depth.xy;\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Bump\\r\\n#ifdef BUMP\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform sampler2D bumpSampler;\\r\\n\\r\\n// Thanks to http://www.thetenthplanet.de/archives/1180\\r\\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\\r\\n{\\r\\n	// get edge vectors of the pixel triangle\\r\\n	vec3 dp1 = dFdx(p);\\r\\n	vec3 dp2 = dFdy(p);\\r\\n	vec2 duv1 = dFdx(uv);\\r\\n	vec2 duv2 = dFdy(uv);\\r\\n\\r\\n	// solve the linear system\\r\\n	vec3 dp2perp = cross(dp2, normal);\\r\\n	vec3 dp1perp = cross(normal, dp1);\\r\\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\\r\\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\\r\\n\\r\\n	// construct a scale-invariant frame \\r\\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\\r\\n	return mat3(tangent * invmax, binormal * invmax, normal);\\r\\n}\\r\\n\\r\\nvec3 perturbNormal(vec3 viewDir)\\r\\n{\\r\\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\\r\\n	map = map * 255. / 127. - 128. / 127.;\\r\\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\\r\\n	return normalize(TBN * map);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nstruct lightingInfo\\r\\n{\\r\\n	vec3 diffuse;\\r\\n	vec3 specular;\\r\\n};\\r\\n\\r\\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	float attenuation = 1.0;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		vec3 direction = lightData.xyz - vPositionW;\\r\\n\\r\\n		attenuation = max(0., 1.0 - length(direction) / range);\\r\\n		lightVectorW = normalize(direction);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, max(1., vSpecularColor.a));\\r\\n\\r\\n	result.diffuse = ndl * diffuseColor * attenuation;\\r\\n	result.specular = specComp * specularColor * attenuation;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	vec3 direction = lightData.xyz - vPositionW;\\r\\n	vec3 lightVectorW = normalize(direction);\\r\\n	float attenuation = max(0., 1.0 - length(direction) / range);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\\r\\n		result.specular = specComp * specularColor * spotAtten * attenuation;\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result.diffuse = vec3(0.);\\r\\n	result.specular = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	lightingInfo result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\\r\\n	result.specular = specComp * specularColor;\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHAFROMDIFFUSE\\r\\n	alpha *= baseColor.a;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n#ifdef NORMAL\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n#else\\r\\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\\r\\n#endif\\r\\n\\r\\n\\r\\n#ifdef BUMP\\r\\n	normalW = perturbNormal(viewDirectionW);\\r\\n#endif\\r\\n\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF0\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF1\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\\r\\n	#endif\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF2\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\\r\\n#else\\r\\n	#ifdef SHADOWPCF3\\r\\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\\r\\n	#else\\r\\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\\r\\n	#endif	\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info.diffuse * shadow;\\r\\n	specularBase += info.specular * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\\r\\n\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n#ifdef SPECULAROVERALPHA\\r\\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\\r\\n#endif\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n   26  defaultVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec3 position;\\r\\n#ifdef NORMAL\\r\\nattribute vec3 normal;\\r\\n#endif\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#ifdef VERTEXCOLOR\\r\\nattribute vec4 color;\\r\\n#endif\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniforms\\r\\n\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 view;\\r\\nuniform mat4 viewProjection;\\r\\n\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform mat4 ambientMatrix;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform mat4 opacityMatrix;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform mat4 emissiveMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform mat4 specularMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\nvarying vec2 vBumpUV;\\r\\nuniform vec2 vBumpInfos;\\r\\nuniform mat4 bumpMatrix;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#ifdef POINTSIZE\\r\\nuniform float pointSize;\\r\\n#endif\\r\\n\\r\\n// Output\\r\\nvarying vec3 vPositionW;\\r\\n#ifdef NORMAL\\r\\nvarying vec3 vNormalW;\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nuniform vec4 vClipPlane;\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef FOG\\r\\nvarying float fFogDistance;\\r\\n#endif\\r\\n\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\nuniform mat4 lightMatrix0;\\r\\nvarying vec4 vPositionFromLight0;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\nuniform mat4 lightMatrix1;\\r\\nvarying vec4 vPositionFromLight1;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\nuniform mat4 lightMatrix2;\\r\\nvarying vec4 vPositionFromLight2;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\nuniform mat4 lightMatrix3;\\r\\nvarying vec4 vPositionFromLight3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vPositionUVW;\\r\\n#endif\\r\\n\\r\\nvoid main(void) {\\r\\n	mat4 finalWorld;\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	vPositionUVW = position;\\r\\n#endif \\r\\n\\r\\n#ifdef INSTANCES\\r\\n	finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n\\r\\n#ifdef BONES4\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n#else\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2);\\r\\n#endif \\r\\n\\r\\n#endif\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n\\r\\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\\r\\n	vPositionW = vec3(worldPos);\\r\\n\\r\\n#ifdef NORMAL\\r\\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\\r\\n#endif\\r\\n\\r\\n	// Texture coordinates\\r\\n#ifndef UV1\\r\\n	vec2 uv = vec2(0., 0.);\\r\\n#endif\\r\\n#ifndef UV2\\r\\n	vec2 uv2 = vec2(0., 0.);\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	if (vDiffuseInfos.x == 0.)\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	if (vAmbientInfos.x == 0.)\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY\\r\\n	if (vOpacityInfos.x == 0.)\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\n	if (vEmissiveInfos.x == 0.)\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\n	if (vSpecularInfos.x == 0.)\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n#ifdef BUMP\\r\\n	if (vBumpInfos.x == 0.)\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\\r\\n	}\\r\\n#endif\\r\\n\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	fClipDistance = dot(worldPos, vClipPlane);\\r\\n#endif\\r\\n\\r\\n	// Fog\\r\\n#ifdef FOG\\r\\n	fFogDistance = (view * worldPos).z;\\r\\n#endif\\r\\n\\r\\n	// Shadows\\r\\n#ifdef SHADOWS\\r\\n#ifdef LIGHT0\\r\\n	vPositionFromLight0 = lightMatrix0 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT1\\r\\n	vPositionFromLight1 = lightMatrix1 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT2\\r\\n	vPositionFromLight2 = lightMatrix2 * worldPos;\\r\\n#endif\\r\\n#ifdef LIGHT3\\r\\n	vPositionFromLight3 = lightMatrix3 * worldPos;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Vertex color\\r\\n#ifdef VERTEXCOLOR\\r\\n	vColor = color;\\r\\n#endif\\r\\n\\r\\n	// Point size\\r\\n#ifdef POINTSIZE\\r\\n	gl_PointSize = pointSize;\\r\\n#endif\\r\\n}\",depthPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#ifdef ALPHATEST\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\n#endif\\r\\n\\r\\nuniform float far;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef ALPHATEST\\r\\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\\r\\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\\r\\n}\",depthVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attribute\\r\\nattribute vec3 position;\\r\\n#ifdef BONES\\r\\nattribute vec4 matricesIndices;\\r\\nattribute vec4 matricesWeights;\\r\\n#endif\\r\\n\\r\\n// Uniform\\r\\n#ifdef INSTANCES\\r\\nattribute vec4 world0;\\r\\nattribute vec4 world1;\\r\\nattribute vec4 world2;\\r\\nattribute vec4 world3;\\r\\n#else\\r\\nuniform mat4 world;\\r\\n#endif\\r\\n\\r\\nuniform mat4 viewProjection;\\r\\n#ifdef BONES\\r\\nuniform mat4 mBones[BonesPerMesh];\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(NEED_UV)\\r\\nvarying vec2 vUV;\\r\\nuniform mat4 diffuseMatrix;\\r\\n#ifdef UV1\\r\\nattribute vec2 uv;\\r\\n#endif\\r\\n#ifdef UV2\\r\\nattribute vec2 uv2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n#ifdef INSTANCES\\r\\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\\r\\n#else\\r\\n	mat4 finalWorld = world;\\r\\n#endif\\r\\n\\r\\n#ifdef BONES\\r\\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\\r\\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\\r\\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\\r\\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\\r\\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#else\\r\\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\\r\\n#endif\\r\\n\\r\\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\\r\\n#ifdef UV1\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\\r\\n#endif\\r\\n#ifdef UV2\\r\\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\\r\\n#endif\\r\\n#endif\\r\\n}\",depthBoxBlurPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Parameters\\r\\nuniform vec2 screenSize;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec4 colorDepth = vec4(0.0);\\r\\n\\r\\n	for (int x = -OFFSET; x <= OFFSET; x++)\\r\\n		for (int y = -OFFSET; y <= OFFSET; y++)\\r\\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\\r\\n\\r\\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\\r\\n}\",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\\r\\n// Author: Olivier Guyot\\r\\n// Does depth-of-field blur, edge blur\\r\\n// Inspired by Francois Tarlier & Martins Upitis\\r\\n\\r\\n#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n\\r\\n// samplers\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D highlightsSampler;\\r\\nuniform sampler2D depthSampler;\\r\\nuniform sampler2D grainSampler;\\r\\n\\r\\n// uniforms\\r\\nuniform float grain_amount;\\r\\nuniform bool blur_noise;\\r\\nuniform float screen_width;\\r\\nuniform float screen_height;\\r\\nuniform float distortion;\\r\\nuniform bool dof_enabled;\\r\\n//uniform float focus_distance;		// not needed; already used to compute screen distance\\r\\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\\r\\nuniform float aperture;\\r\\nuniform float darken;\\r\\nuniform float edge_blur;\\r\\nuniform bool highlights;\\r\\n\\r\\n// preconputed uniforms (not effect parameters)\\r\\nuniform float near;\\r\\nuniform float far;\\r\\n\\r\\n// varyings\\r\\nvarying vec2 vUV;\\r\\n\\r\\n// constants\\r\\n#define PI 		3.14159265\\r\\n#define TWOPI 	6.28318530\\r\\n#define inverse_focal_length 0.1	// a property of the lens used\\r\\n\\r\\n// common calculations\\r\\nvec2 centered_screen_pos;\\r\\nvec2 distorted_coords;\\r\\nfloat radius2;\\r\\nfloat radius;\\r\\n\\r\\n\\r\\n// on-the-fly constant noise\\r\\nvec2 rand(vec2 co)\\r\\n{\\r\\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\\r\\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\\r\\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\\r\\n}\\r\\n\\r\\n// applies edge distortion on texture coords\\r\\nvec2 getDistortedCoords(vec2 coords) {\\r\\n\\r\\n	if (distortion == 0.0) { return coords; }\\r\\n\\r\\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\\r\\n	vec2 dist_coords = vec2(0.5, 0.5);\\r\\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\\r\\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\\r\\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\\r\\n\\r\\n	dist_coords = mix(coords, dist_coords, dist_amount);\\r\\n\\r\\n	return dist_coords;\\r\\n}\\r\\n\\r\\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\\r\\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\\r\\n\\r\\n	// compute coords with offset (a random angle is added)\\r\\n	vec2 coords = distorted_coords;\\r\\n	float angle = rand(coords * 100.0).x * TWOPI;\\r\\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\\r\\n\\r\\n	color += texture2D(textureSampler, coords)*weight;\\r\\n\\r\\n	return weight;\\r\\n}\\r\\n\\r\\n// returns blur level according to blur size required\\r\\nfloat getBlurLevel(float size) {\\r\\n	return min(3.0, ceil(size / 1.0));\\r\\n}\\r\\n\\r\\n// returns original screen color after blur\\r\\nvec4 getBlurColor(float size) {\\r\\n\\r\\n	vec4 col = texture2D(textureSampler, distorted_coords);\\r\\n	if (size == 0.0) { return col; }\\r\\n\\r\\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\\r\\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\\r\\n	float blur_level = getBlurLevel(size);\\r\\n\\r\\n	float w = (size / screen_width);\\r\\n	float h = (size / screen_height);\\r\\n	float total_weight = 1.0;\\r\\n	vec2 sample_coords;\\r\\n\\r\\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\\r\\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\\r\\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\\r\\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\\r\\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\\r\\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\\r\\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\\r\\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\\r\\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\\r\\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\\r\\n\\r\\n	if (blur_level > 1.0) {\\r\\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\\r\\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\\r\\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\\r\\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\\r\\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\\r\\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\\r\\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\\r\\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\\r\\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\\r\\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\\r\\n	}\\r\\n\\r\\n	if (blur_level > 2.0) {\\r\\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\\r\\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\\r\\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\\r\\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\\r\\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\\r\\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\\r\\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\\r\\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\\r\\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\\r\\n	}\\r\\n\\r\\n	col /= total_weight;		// scales color according to weights\\r\\n\\r\\n								// darken if out of focus\\r\\n	if (darken > 0.0) {\\r\\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\\r\\n	}\\r\\n\\r\\n	// blur levels debug\\r\\n	// if(blur_level == 1.0) { col.b *= 0.5; }\\r\\n	// if(blur_level == 2.0) { col.r *= 0.5; }\\r\\n	// if(blur_level == 3.0) { col.g *= 0.5; }\\r\\n\\r\\n	return col;\\r\\n}\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n\\r\\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\\r\\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\\r\\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\\r\\n	radius = sqrt(radius2);\\r\\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens \"magnifying\" effect)\\r\\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\\r\\n\\r\\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\\r\\n	float distance = near + (far - near)*depth;		// actual distance from the lens\\r\\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\\r\\n\\r\\n\\r\\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\\r\\n													// screen_distance is precomputed in code\\r\\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\\r\\n\\r\\n	// disable blur\\r\\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\\r\\n\\r\\n	// blur from edge blur effect\\r\\n	float edge_blur_amount = 0.0;\\r\\n	if (edge_blur > 0.0) {\\r\\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\\r\\n	}\\r\\n\\r\\n	// total blur amount\\r\\n	float blur_amount = max(edge_blur_amount, coc);\\r\\n\\r\\n	// apply blur if necessary\\r\\n	if (blur_amount == 0.0) {\\r\\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\\r\\n	}\\r\\n	else {\\r\\n\\r\\n		// add blurred color\\r\\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\\r\\n\\r\\n		// if we have computed highlights: enhance highlights\\r\\n		if (highlights) {\\r\\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\\r\\n		}\\r\\n\\r\\n		if (blur_noise) {\\r\\n			// we put a slight amount of noise in the blurred color\\r\\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\\r\\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\\r\\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\\r\\n		}\\r\\n	}\\r\\n\\r\\n\\r\\n	// apply grain\\r\\n	if (grain_amount > 0.0) {\\r\\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\\r\\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\\r\\n	}\\r\\n\\r\\n}\\r\\n',displayPassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform sampler2D passSampler;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n    gl_FragColor = texture2D(passSampler, vUV);\\r\\n}\",filterPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\nuniform mat4 kernelMatrix;\\r\\n\\r\\nvoid main(void)\\r\\n{\\r\\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\\r\\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\\r\\n\\r\\n	gl_FragColor = vec4(updatedColor, 1.0);\\r\\n}\",firePixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nuniform float time;\\r\\nuniform vec3 c1;\\r\\nuniform vec3 c2;\\r\\nuniform vec3 c3;\\r\\nuniform vec3 c4;\\r\\nuniform vec3 c5;\\r\\nuniform vec3 c6;\\r\\nuniform vec2 speed;\\r\\nuniform float shift;\\r\\nuniform float alphaThreshold;\\r\\n\\r\\nvarying vec2 vUV;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n	vec2 p = vUV * 8.0;\\r\\n	float q = fbm(p - time * 0.1);\\r\\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\\r\\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\\r\\n	vec3 color = c * cos(shift * vUV.y);\\r\\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\\r\\n\\r\\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\\r\\n}\",fxaaPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define FXAA_REDUCE_MIN   (1.0/128.0)\\r\\n#define FXAA_REDUCE_MUL   (1.0/8.0)\\r\\n#define FXAA_SPAN_MAX     8.0\\r\\n\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\nuniform vec2 texelSize;\\r\\n\\r\\nvoid main(){\\r\\n	vec2 localTexelSize = texelSize;\\r\\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\\r\\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\\r\\n	vec4 rgbM = texture2D(textureSampler, vUV);\\r\\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\\r\\n	float lumaNW = dot(rgbNW, luma);\\r\\n	float lumaNE = dot(rgbNE, luma);\\r\\n	float lumaSW = dot(rgbSW, luma);\\r\\n	float lumaSE = dot(rgbSE, luma);\\r\\n	float lumaM = dot(rgbM, luma);\\r\\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\r\\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\r\\n\\r\\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\\r\\n\\r\\n	float dirReduce = max(\\r\\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\\r\\n		FXAA_REDUCE_MIN);\\r\\n\\r\\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\r\\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\r\\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\r\\n		dir * rcpDirMin)) * localTexelSize;\\r\\n\\r\\n	vec4 rgbA = 0.5 * (\\r\\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\\r\\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\\r\\n\\r\\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\\r\\n		texture2D(textureSampler, vUV + dir *  -0.5) +\\r\\n		texture2D(textureSampler, vUV + dir * 0.5));\\r\\n	float lumaB = dot(rgbB, luma);\\r\\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\\r\\n		gl_FragColor = rgbA;\\r\\n	}\\r\\n	else {\\r\\n		gl_FragColor = rgbB;\\r\\n	}\\r\\n}\",grassPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\nvarying vec2 vPosition;\\r\\nvarying vec2 vUV;\\r\\n\\r\\nuniform vec3 herb1Color;\\r\\nuniform vec3 herb2Color;\\r\\nuniform vec3 herb3Color;\\r\\nuniform vec3 groundColor;\\r\\n\\r\\nfloat rand(vec2 n) {\\r\\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\\r\\n}\\r\\n\\r\\nfloat noise(vec2 n) {\\r\\n	const vec2 d = vec2(0.0, 1.0);\\r\\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\\r\\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\\r\\n}\\r\\n\\r\\nfloat fbm(vec2 n) {\\r\\n	float total = 0.0, amplitude = 1.0;\\r\\n	for (int i = 0; i < 4; i++) {\\r\\n		total += noise(n) * amplitude;\\r\\n		n += n;\\r\\n		amplitude *= 0.5;\\r\\n	}\\r\\n	return total;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\\r\\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\\r\\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\\r\\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\\r\\n	gl_FragColor = vec4(color, 1.0);\\r\\n}\",layerPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\nvarying vec2 vUV;\\r\\nuniform sampler2D textureSampler;\\r\\n\\r\\n// Color\\r\\nuniform vec4 color;\\r\\n\\r\\nvoid main(void) {\\r\\n	vec4 baseColor = texture2D(textureSampler, vUV);\\r\\n\\r\\n	gl_FragColor = baseColor * color;\\r\\n}\",layerVertexShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n// Attributes\\r\\nattribute vec2 position;\\r\\n\\r\\n// Uniforms\\r\\nuniform mat4 textureMatrix;\\r\\n\\r\\n// Output\\r\\nvarying vec2 vUV;\\r\\n\\r\\nconst vec2 madd = vec2(0.5, 0.5);\\r\\n\\r\\nvoid main(void) {	\\r\\n\\r\\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\\r\\n	gl_Position = vec4(position, 0.0, 1.0);\\r\\n}\",legacydefaultPixelShader:\"#ifdef GL_ES\\r\\nprecision highp float;\\r\\n#endif\\r\\n\\r\\n#define MAP_PROJECTION	4.\\r\\n\\r\\n// Constants\\r\\nuniform vec3 vEyePosition;\\r\\nuniform vec3 vAmbientColor;\\r\\nuniform vec4 vDiffuseColor;\\r\\nuniform vec4 vSpecularColor;\\r\\nuniform vec3 vEmissiveColor;\\r\\n\\r\\n// Input\\r\\nvarying vec3 vPositionW;\\r\\nvarying vec3 vNormalW;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\nvarying vec4 vColor;\\r\\n#endif\\r\\n\\r\\n// Lights\\r\\n#ifdef LIGHT0\\r\\nuniform vec4 vLightData0;\\r\\nuniform vec4 vLightDiffuse0;\\r\\nuniform vec3 vLightSpecular0;\\r\\n#ifdef SHADOW0\\r\\nvarying vec4 vPositionFromLight0;\\r\\nuniform sampler2D shadowSampler0;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT0\\r\\nuniform vec4 vLightDirection0;\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\nuniform vec3 vLightGround0;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\nuniform vec4 vLightData1;\\r\\nuniform vec4 vLightDiffuse1;\\r\\nuniform vec3 vLightSpecular1;\\r\\n#ifdef SHADOW1\\r\\nvarying vec4 vPositionFromLight1;\\r\\nuniform sampler2D shadowSampler1;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT1\\r\\nuniform vec4 vLightDirection1;\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\nuniform vec3 vLightGround1;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\nuniform vec4 vLightData2;\\r\\nuniform vec4 vLightDiffuse2;\\r\\nuniform vec3 vLightSpecular2;\\r\\n#ifdef SHADOW2\\r\\nvarying vec4 vPositionFromLight2;\\r\\nuniform sampler2D shadowSampler2;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT2\\r\\nuniform vec4 vLightDirection2;\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\nuniform vec3 vLightGround2;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\nuniform vec4 vLightData3;\\r\\nuniform vec4 vLightDiffuse3;\\r\\nuniform vec3 vLightSpecular3;\\r\\n#ifdef SHADOW3\\r\\nvarying vec4 vPositionFromLight3;\\r\\nuniform sampler2D shadowSampler3;\\r\\n#endif\\r\\n#ifdef SPOTLIGHT3\\r\\nuniform vec4 vLightDirection3;\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\nuniform vec3 vLightGround3;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n// Samplers\\r\\n#ifdef DIFFUSE\\r\\nvarying vec2 vDiffuseUV;\\r\\nuniform sampler2D diffuseSampler;\\r\\nuniform vec2 vDiffuseInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef AMBIENT\\r\\nvarying vec2 vAmbientUV;\\r\\nuniform sampler2D ambientSampler;\\r\\nuniform vec2 vAmbientInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITY	\\r\\nvarying vec2 vOpacityUV;\\r\\nuniform sampler2D opacitySampler;\\r\\nuniform vec2 vOpacityInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTION\\r\\nvarying vec3 vReflectionUVW;\\r\\nuniform samplerCube reflectionCubeSampler;\\r\\nuniform sampler2D reflection2DSampler;\\r\\nuniform vec3 vReflectionInfos;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVE\\r\\nvarying vec2 vEmissiveUV;\\r\\nuniform vec2 vEmissiveInfos;\\r\\nuniform sampler2D emissiveSampler;\\r\\n#endif\\r\\n\\r\\n#ifdef SPECULAR\\r\\nvarying vec2 vSpecularUV;\\r\\nuniform vec2 vSpecularInfos;\\r\\nuniform sampler2D specularSampler;\\r\\n#endif\\r\\n\\r\\n// Fresnel\\r\\n#ifdef FRESNEL\\r\\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\\r\\n{\\r\\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\\r\\n	return clamp(fresnelTerm, 0., 1.);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSEFRESNEL\\r\\nuniform vec4 diffuseLeftColor;\\r\\nuniform vec4 diffuseRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\nuniform vec4 opacityParts;\\r\\n#endif\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\nuniform vec4 reflectionLeftColor;\\r\\nuniform vec4 reflectionRightColor;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\nuniform vec4 emissiveLeftColor;\\r\\nuniform vec4 emissiveRightColor;\\r\\n#endif\\r\\n\\r\\n// Shadows\\r\\n#ifdef SHADOWS\\r\\n\\r\\nfloat unpack(vec4 color)\\r\\n{\\r\\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\\r\\n	return dot(color, bitShift);\\r\\n}\\r\\n\\r\\nfloat unpackHalf(vec2 color)\\r\\n{\\r\\n	return color.x + (color.y / 255.0);\\r\\n}\\r\\n\\r\\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float shadow = unpack(texture2D(shadowSampler, uv));\\r\\n\\r\\n	if (depth.z > shadow)\\r\\n	{\\r\\n		return 0.;\\r\\n	}\\r\\n	return 1.;\\r\\n}\\r\\n\\r\\n// Thanks to http://devmaster.net/\\r\\nfloat ChebychevInequality(vec2 moments, float t)\\r\\n{\\r\\n	if (t <= moments.x)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	float variance = moments.y - (moments.x * moments.x);\\r\\n	variance = max(variance, 0.);\\r\\n\\r\\n	float d = t - moments.x;\\r\\n	return variance / (variance + d * d);\\r\\n}\\r\\n\\r\\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\\r\\n{\\r\\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\\r\\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\\r\\n\\r\\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\\r\\n	{\\r\\n		return 1.0;\\r\\n	}\\r\\n\\r\\n	vec4 texel = texture2D(shadowSampler, uv);\\r\\n\\r\\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\\r\\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n#ifdef CLIPPLANE\\r\\nvarying float fClipDistance;\\r\\n#endif\\r\\n\\r\\n// Fog\\r\\n#ifdef FOG\\r\\n\\r\\n#define FOGMODE_NONE    0.\\r\\n#define FOGMODE_EXP     1.\\r\\n#define FOGMODE_EXP2    2.\\r\\n#define FOGMODE_LINEAR  3.\\r\\n#define E 2.71828\\r\\n\\r\\nuniform vec4 vFogInfos;\\r\\nuniform vec3 vFogColor;\\r\\nvarying float fFogDistance;\\r\\n\\r\\nfloat CalcFogFactor()\\r\\n{\\r\\n	float fogCoeff = 1.0;\\r\\n	float fogStart = vFogInfos.y;\\r\\n	float fogEnd = vFogInfos.z;\\r\\n	float fogDensity = vFogInfos.w;\\r\\n\\r\\n	if (FOGMODE_LINEAR == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\\r\\n	}\\r\\n	else if (FOGMODE_EXP == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\\r\\n	}\\r\\n	else if (FOGMODE_EXP2 == vFogInfos.x)\\r\\n	{\\r\\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\\r\\n	}\\r\\n\\r\\n	return clamp(fogCoeff, 0.0, 1.0);\\r\\n}\\r\\n#endif\\r\\n\\r\\n// Light Computing\\r\\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW;\\r\\n	if (lightData.w == 0.)\\r\\n	{\\r\\n		lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		lightVectorW = normalize(-lightData.xyz);\\r\\n	}\\r\\n\\r\\n	// diffuse\\r\\n	float ndl = max(0., dot(vNormal, lightVectorW));\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\\r\\n\\r\\n	result[0] = ndl * diffuseColor.rgb;\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\\r\\n\\r\\n	// diffuse\\r\\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\\r\\n	float spotAtten = 0.0;\\r\\n\\r\\n	if (cosAngle >= lightDirection.w)\\r\\n	{\\r\\n		cosAngle = max(0., pow(cosAngle, lightData.w));\\r\\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\\r\\n\\r\\n		// Diffuse\\r\\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\\r\\n\\r\\n		// Specular\\r\\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\\r\\n		float specComp = max(0., dot(vNormal, angleW));\\r\\n		specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\\r\\n		result[1] = specComp * specularColor * spotAtten;\\r\\n		result[2] = vec3(0.);\\r\\n\\r\\n		return result;\\r\\n	}\\r\\n\\r\\n	result[0] = vec3(0.);\\r\\n	result[1] = vec3(0.);\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\\r\\n	mat3 result;\\r\\n\\r\\n	// Diffuse\\r\\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\\r\\n\\r\\n	// Specular\\r\\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\\r\\n	float specComp = max(0., dot(vNormal, angleW));\\r\\n	specComp = pow(specComp, vSpecularColor.a);\\r\\n\\r\\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\\r\\n	result[1] = specComp * specularColor;\\r\\n	result[2] = vec3(0.);\\r\\n\\r\\n	return result;\\r\\n}\\r\\n\\r\\nvoid main(void) {\\r\\n	// Clip plane\\r\\n#ifdef CLIPPLANE\\r\\n	if (fClipDistance > 0.0)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\\r\\n\\r\\n	// Base color\\r\\n	vec4 baseColor = vec4(1., 1., 1., 1.);\\r\\n	vec3 diffuseColor = vDiffuseColor.rgb;\\r\\n\\r\\n#ifdef VERTEXCOLOR\\r\\n	baseColor.rgb *= vColor.rgb;\\r\\n#endif\\r\\n\\r\\n#ifdef DIFFUSE\\r\\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\\r\\n\\r\\n#ifdef ALPHATEST\\r\\n	if (baseColor.a < 0.4)\\r\\n		discard;\\r\\n#endif\\r\\n\\r\\n	baseColor.rgb *= vDiffuseInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Bump\\r\\n	vec3 normalW = normalize(vNormalW);\\r\\n\\r\\n	// Ambient color\\r\\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\\r\\n\\r\\n#ifdef AMBIENT\\r\\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Lighting\\r\\n	vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n	vec3 specularBase = vec3(0., 0., 0.);\\r\\n	float shadow = 1.;\\r\\n\\r\\n#ifdef LIGHT0\\r\\n#ifdef SPOTLIGHT0\\r\\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef HEMILIGHT0\\r\\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT0\\r\\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\\r\\n#endif\\r\\n#ifdef SHADOW0\\r\\n#ifdef SHADOWVSM0\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT1\\r\\n#ifdef SPOTLIGHT1\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef HEMILIGHT1\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT1\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\\r\\n#endif\\r\\n#ifdef SHADOW1\\r\\n#ifdef SHADOWVSM1\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\\r\\n#endif\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT2\\r\\n#ifdef SPOTLIGHT2\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef HEMILIGHT2\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT2\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\\r\\n#endif\\r\\n#ifdef SHADOW2\\r\\n#ifdef SHADOWVSM2\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n#ifdef LIGHT3\\r\\n#ifdef SPOTLIGHT3\\r\\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef HEMILIGHT3\\r\\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\\r\\n#endif\\r\\n#ifdef POINTDIRLIGHT3\\r\\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\\r\\n#endif\\r\\n#ifdef SHADOW3\\r\\n#ifdef SHADOWVSM3\\r\\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\\r\\n#else\\r\\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\\r\\n#endif	\\r\\n#else\\r\\n	shadow = 1.;\\r\\n#endif\\r\\n	diffuseBase += info[0] * shadow;\\r\\n	specularBase += info[1] * shadow;\\r\\n#endif\\r\\n\\r\\n	// Reflection\\r\\n	vec3 reflectionColor = vec3(0., 0., 0.);\\r\\n\\r\\n#ifdef REFLECTION\\r\\n	if (vReflectionInfos.z != 0.0)\\r\\n	{\\r\\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n	else\\r\\n	{\\r\\n		vec2 coords = vReflectionUVW.xy;\\r\\n\\r\\n		if (vReflectionInfos.x == MAP_PROJECTION)\\r\\n		{\\r\\n			coords /= vReflectionUVW.z;\\r\\n		}\\r\\n\\r\\n		coords.y = 1.0 - coords.y;\\r\\n\\r\\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\\r\\n	}\\r\\n\\r\\n#ifdef REFLECTIONFRESNEL\\r\\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\\r\\n\\r\\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n	// Alpha\\r\\n	float alpha = vDiffuseColor.a;\\r\\n\\r\\n#ifdef OPACITY\\r\\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\\r\\n#ifdef OPACITYRGB\\r\\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\\r\\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\\r\\n#else\\r\\n	alpha *= opacityMap.a * vOpacityInfos.y;\\r\\n#endif\\r\\n#endif\\r\\n\\r\\n#ifdef VERTEXALPHA\\r\\n	alpha *= vColor.a;\\r\\n#endif\\r\\n\\r\\n#ifdef OPACITYFRESNEL\\r\\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\\r\\n\\r\\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\\r\\n#endif\\r\\n\\r\\n	// Emissive\\r\\n	vec3 emissiveColor = vEmissiveColor;\\r\\n#ifdef EMISSIVE\\r\\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\\r\\n#endif\\r\\n\\r\\n#ifdef EMISSIVEFRESNEL\\r\\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\\r\\n\\r\\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Specular map\\r\\n	vec3 specularColor = vSpecularColor.rgb;\\r\\n#ifdef SPECULAR\\r\\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\\r\\n#endif\\r\\n\\r\\n	// Fresnel\\r\\n#ifdef DIFFUSEFRESNEL\\r\\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\\r\\n\\r\\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\\r\\n#endif\\r\\n\\r\\n	// Composition\\r\\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\\r\\n	vec3 finalSpecular = specularBase * specularColor;\\r\\n\\r\\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\\r\\n\\r\\n#ifdef FOG\\r\\n	float fog = CalcFogFactor();\\r\\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\\r\\n#endif\\r\\n\\r\\n	gl_FragColor = color;\\r\\n}\",\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\cannon.js:\n  423      numVecs++;\n  424      if(numVecs > 180)\n  425:         console.log(numVecs+\" created\");\n  426       */\n  427  };\n  ...\n 2198          //var inertia = b.calculateTransformedInertia(m,q);\n 2199          b.calculateLocalInertia(m,childInertia); // Todo transform!\n 2200:         //console.log(childInertia,m,b.volume(),V);\n 2201  \n 2202          // Add its inertia using the parallel axis theorem, i.e.\n ....\n 2358          n.negate(n);\n 2359          this.faceNormals.push(n);\n 2360:         //console.log(n.toString());\n 2361          var vertex = this.vertices[this.faces[i][0]];\n 2362          if(n.dot(vertex)<0){\n ....\n 2477          var minB = maxminB[1];\n 2478          if(maxA<minB || maxB<minA){\n 2479:             //console.log(minA,maxA,minB,maxB);\n 2480              return false; // Separated\n 2481          }\n ....\n 2516              quatA.vmult(faceANormalWS3,faceANormalWS3);\n 2517              //posA.vadd(faceANormalWS3,faceANormalWS3); // Needed?\n 2518:             //console.log(\"face normal:\",hullA.faceNormals[i].toString(),\"world face normal:\",faceANormalWS3);\n 2519              var d = hullA.testSepAxis(faceANormalWS3, hullB, posA, quatA, posB, quatB);\n 2520              if(d===false){\n ....\n 2534              quatB.vmult(Worldnormal1,Worldnormal1);\n 2535              //posB.vadd(Worldnormal1,Worldnormal1);\n 2536:             //console.log(\"facenormal\",hullB.faceNormals[i].toString(),\"world:\",Worldnormal1.toString());\n 2537              curPlaneTests++;\n 2538              var d = hullA.testSepAxis(Worldnormal1, hullB,posA,quatA,posB,quatB);\n ....\n 2557              //posA.vadd(worldEdge0,worldEdge0); // needed?\n 2558  \n 2559:             //console.log(\"edge0:\",worldEdge0.toString());\n 2560  \n 2561              for(var e1=0; e1<hullB.uniqueEdges.length; e1++){\n ....\n 2563                  quatB.vmult(worldEdge1,worldEdge1);\n 2564                  //posB.vadd(worldEdge1,worldEdge1); // needed?\n 2565:                 //console.log(\"edge1:\",worldEdge1.toString());\n 2566                  worldEdge0.cross(worldEdge1,Cross);\n 2567                  curEdgeEdge++;\n ....\n 2694          }\n 2695          if (closestFaceA<0){\n 2696:             console.log(\"--- did not find any closest face... ---\");\n 2697              return;\n 2698          }\n 2699:         //console.log(\"closest A: \",closestFaceA);\n 2700          // Get the face and construct connected faces\n 2701          var polyA = hullA.faces[closestFaceA];\n ....\n 2744  \n 2745              // Clip face against our constructed plane\n 2746:             //console.log(\"clipping polygon \",printFace(closestFaceA),\" against plane \",planeNormalWS, planeEqWS);\n 2747              this.clipFaceAgainstPlane(pVtxIn, pVtxOut, planeNormalWS, planeEqWS);\n 2748:             //console.log(\" - clip result: \",pVtxOut);\n 2749  \n 2750              // Throw away all clipped points, but save the reamining until next clip\n ....\n 2757          }\n 2758  \n 2759:         //console.log(\"Resulting points after clip:\",pVtxIn);\n 2760  \n 2761          // only keep contact points that are behind the witness face\n ....\n 2769          for (var i=0; i<pVtxIn.length; i++){\n 2770              var depth = planeNormalWS.dot(pVtxIn[i]) + planeEqWS; //???\n 2771:             /*console.log(\"depth calc from normal=\",planeNormalWS.toString(),\" and constant \"+planeEqWS+\" and vertex \",pVtxIn[i].toString(),\" gives \"+depth);*/\n 2772              if (depth <=minDist){\n 2773:                 console.log(\"clamped: depth=\"+depth+\" to minDist=\"+(minDist+\"\"));\n 2774                  depth = minDist;\n 2775              }\n ....\n 2778                  var point = pVtxIn[i];\n 2779                  if(depth<=0){\n 2780:                     /*console.log(\"Got contact point \",point.toString(),\n 2781                        \", depth=\",depth,\n 2782                        \"contact normal=\",separatingNormal.toString(),\n ....\n 3678  \n 3679              if(other.shape instanceof CANNON.Plane){\n 3680:                 //console.log(p.position.z+\"<\"+other.aabbmin.z+\" = \",p.position.z < other.aabbmin.z);\n 3681              }\n 3682  \n ....\n 5598              var q = convexConvex_q;\n 5599              si.clipAgainstHull(xi,qi,sj,xj,qj,sepAxis,-100,100,res);\n 5600:             //console.log(res.length);\n 5601              for(var j=0; j!==res.length; j++){\n 5602                  var r = makeResult(bi,bj);\n ....\n 6627      }\n 6628  \n 6629:     //console.log(\"GWlambda:\",GWlambda);\n 6630  \n 6631      return GWlambda;\n ....\n 6854      }\n 6855  \n 6856:     //console.log(\"GWlambda:\",GWlambda);\n 6857  \n 6858      return GWlambda;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KSectorSrv.js:\n  235      KSectorSrv.prototype.draw = function()\n  236      {\n  237:         console.log('actors'+this.actorList.length);\n  238          for(var row=this.sectorUnit-1; row>=0; --row)\n  239          {\n  240:             console.log(this.groundList[row]);\n  241          }\n  242      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  113          var posX = heroActor.actorData.position.x;\n  114          var posY = heroActor.actorData.position.y;\n  115:         console.log(posX+\" \"+posY);\n  116          var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117          var velY = 0;//heroActor.actorData.lastVelocity.y;\n  ...\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  120          var punch = this.createActor(user, username, physics, \"P\");\n  121:         console.log('punch');\n  122      }\n  123  \n  ...\n  129          var posX = heroActor.actorData.position.x;\n  130          var posY = heroActor.actorData.position.y;\n  131:         console.log(\"P\"+posX+\" \"+posY);\n  132          var velX = heroActor.actorData.lastVelocity.x*chargeTime;\n  133          var velY = heroActor.actorData.lastVelocity.y*chargeTime;\n  134:         console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135          var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  136          var username = user.userData.username.substring(0, 3)+'shoot';\n  137          var shoot = this.createActor(user, username, physics, \"S\");\n  138:         console.log('shoot');\n  139      }\n  140      KWorld.prototype.createActor = function(user, name, physics, visual)\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n   70  \n   71      io.on('connection', function (socket) {\n   72:     	console.log(\"Socket setup start\");\n   73      	\n   74  \n   ..\n   80  \n   81      	socket.on('c-userLaunch', function (populatedUserData) {\n   82:             console.log('Connection ' + populatedUserData.socketid + ' connecting');\n   83  \n   84              if (KUtil.findIndex(g_world.users, populatedUserData.socketid) > -1) {\n   85:                 console.log('That userID is already connected, kicking');\n   86                  socket.disconnect();\n   87              } else if (!KUtil.validNick(populatedUserData.username)) {\n   ..\n   90              } else {\n   91                  user.userData.clone(populatedUserData);\n   92:                 console.log('Connection ' + user.userData.socketid + ' connected');\n   93                  g_sockets[user.userData.socketid] = socket;\n   94  \n   95                  sendAddPacketsToSocket(user.userData.socketid);\n   96:                 console.log('Sent first data to ' + user.userData.socketid);\n   97  \n   98                  user.lastHeartbeat = new Date().getTime();\n   ..\n  102              	g_world.users.push(user);\n  103  \n  104:                 console.log('Total users: ' + g_world.users.length);\n  105              }\n  106  \n  ...\n  117          socket.on('c-requestSector', function (sectorData) {\n  118              \n  119:             console.log('requested sector');\n  120:             console.log(sectorData);\n  121  \n  122              var sector = g_world.getSectorSecPos(sectorData.x,sectorData.y);\n  ...\n  138                  turnLength: config.turnLength\n  139              });\n  140:             console.log('Connection ' + user.userData.socketid + ' initialized');\n  141          });\n  142  \n  ...\n  144              if (KUtil.findIndex(g_world.users, user.userData.socketid) > -1)\n  145                  g_world.users.splice(KUtil.findIndex(g_world.users, user.userData.socketid), 1);\n  146:             console.log('Connection' + user.userData.socketid + ' disconnected');\n  147  \n  148              socket.broadcast.emit('playerDisconnect', { name: user.userData.username });\n  ...\n  158              else\n  159              {\n  160:                 console.log('missing main actor');\n  161:                 console.log(user);\n  162              }\n  163          });\n  164:         console.log('Socket setup finish');\n  165      });\n  166      serverPort = process.env.PORT || config.port;\n  167      http.listen(serverPort, function() {\n  168:       console.log(\"Server is listening on port \" + serverPort);\n  169      });\n  170  \n  ...\n  208  \n  209  function sendReport() {\n  210: 	console.log('users');\n  211      g_world.users.forEach( function(user) \n  212      {\n  213:     	console.log(user.userData.socketid+','+user.userData.userID);\n  214  	});\n  215: 	console.log('actors');\n  216  	g_world.actors.forEach( function(actor) \n  217      {\n  218:         console.log(actor.actorData.actorname);\n  219:         console.log(actor.actorData.position);\n  220      });\n  221:     //console.log('sectorZero');\n  222      //var sector = g_world.getSectorSecPos(0,0);\n  223      //sector.draw();\n\n104 matches across 13 files\n\n\nSearching 42 files for \"ttl\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n 6076              }\n 6077              if (prevToken.value === '}') {\n 6078:                 // Dividing a function by anything makes little sense,\n 6079                  // but we have to check for that.\n 6080                  if (extra.tokens[extra.openCurlyToken - 3] &&\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\pixi.js:\n 2369          this.hostname[this.hostname.length - 1] === ']';\n 2370  \n 2371:     // validate a little.\n 2372      if (!ipv6Hostname) {\n 2373        var hostparts = this.hostname.split(/\\./);\n ....\n 12948          \"\\nprecision mediump float;\\n\\nattribute vec2 aVertexPosition;\\nattribute vec2 aTextureCoord;\\nattribute vec4 aColor;\\n\\nuniform mat3 projectionMatrix;\\nuniform vec2 resolution;\\n\\nvarying vec2 vTextureCoord;\\nvarying vec4 vColor;\\n\\nvarying vec2 vResolution;\\n\\n//texcoords computed in vertex step\\n//to avoid dependent texture reads\\nvarying vec2 v_rgbNW;\\nvarying vec2 v_rgbNE;\\nvarying vec2 v_rgbSW;\\nvarying vec2 v_rgbSE;\\nvarying vec2 v_rgbM;\\n\\n\\nvoid texcoords(vec2 fragCoord, vec2 resolution,\\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\\n            out vec2 v_rgbM) {\\n    vec2 inverseVP = 1.0 / resolution.xy;\\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\\n    v_rgbM = vec2(fragCoord * inverseVP);\\n}\\n\\nvoid main(void){\\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\\n   vTextureCoord = aTextureCoord;\\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\\n   vResolution = resolution;\\n\\n   //compute the texture coords and send them to varyings\\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\\n}\\n\",\n 12949          // fragment shader\n 12950:         \"precision lowp float;\\n\\n\\n/**\\nBasic FXAA implementation based on the code on geeks3d.com with the\\nmodification that the texture2DLod stuff was removed since it's\\nunsupported by WebGL.\\n\\n--\\n\\nFrom:\\nhttps://github.com/mitsuhiko/webgl-meincraft\\n\\nCopyright (c) 2011 by Armin Ronacher.\\n\\nSome rights reserved.\\n\\nRedistribution and use in source and binary forms, with or without\\nmodification, are permitted provided that the following conditions are\\nmet:\\n\\n    * Redistributions of source code must retain the above copyright\\n      notice, this list of conditions and the following disclaimer.\\n\\n    * Redistributions in binary form must reproduce the above\\n      copyright notice, this list of conditions and the following\\n      disclaimer in the documentation and/or other materials provided\\n      with the distribution.\\n\\n    * The names of the contributors may not be used to endorse or\\n      promote products derived from this software without specific\\n      prior written permission.\\n\\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\\n\\\"AS IS\\\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n*/\\n\\n#ifndef FXAA_REDUCE_MIN\\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\\n#endif\\n#ifndef FXAA_REDUCE_MUL\\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\\n#endif\\n#ifndef FXAA_SPAN_MAX\\n    #define FXAA_SPAN_MAX     8.0\\n#endif\\n\\n//optimized version for mobile, where dependent\\n//texture reads can be a bottleneck\\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\\n            vec2 v_rgbNW, vec2 v_rgbNE,\\n            vec2 v_rgbSW, vec2 v_rgbSE,\\n            vec2 v_rgbM) {\\n    vec4 color;\\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\\n    vec4 texColor = texture2D(tex, v_rgbM);\\n    vec3 rgbM  = texColor.xyz;\\n    vec3 luma = vec3(0.299, 0.587, 0.114);\\n    float lumaNW = dot(rgbNW, luma);\\n    float lumaNE = dot(rgbNE, luma);\\n    float lumaSW = dot(rgbSW, luma);\\n    float lumaSE = dot(rgbSE, luma);\\n    float lumaM  = dot(rgbM,  luma);\\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\n\\n    mediump vec2 dir;\\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\\n\\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\\n\\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\n              dir * rcpDirMin)) * inverseVP;\\n\\n    vec3 rgbA = 0.5 * (\\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\\n\\n    float lumaB = dot(rgbB, luma);\\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\\n        color = vec4(rgbA, texColor.a);\\n    else\\n        color = vec4(rgbB, texColor.a);\\n    return color;\\n}\\n\\n\\nvarying vec2 vTextureCoord;\\nvarying vec4 vColor;\\nvarying vec2 vResolution;\\n\\n//texcoords computed in vertex step\\n//to avoid dependent texture reads\\nvarying vec2 v_rgbNW;\\nvarying vec2 v_rgbNE;\\nvarying vec2 v_rgbSW;\\nvarying vec2 v_rgbSE;\\nvarying vec2 v_rgbM;\\n\\nuniform sampler2D uSampler;\\n\\n\\nvoid main(void){\\n\\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\\n\\n}\\n\",\n 12951          // uniforms\n 12952          {\n .....\n 16456                  //TODO - i KNOW this can be optimised! Once v3 is stable il look at this next...\n 16457                  shader.uniforms.projectionMatrix.value = this.renderer.currentRenderTarget.projectionMatrix.toArray(true);\n 16458:                 //Make this a little more dynamic / intelligent!\n 16459                  shader.syncUniforms();\n 16460  \n .....\n 17741       * @param [clear=false] {boolean} If true the texture will be cleared before the displayObject is drawn\n 17742       * @param [updateTransform=true] {boolean} If true the displayObject's worldTransform/worldAlpha and all children\n 17743:      *  transformations will be restored. Not restoring this information will be a little faster.\n 17744       */\n 17745      this.render = null;\n .....\n 17854   * @param [clear=false] {boolean} If true the texture will be cleared before the displayObject is drawn\n 17855   * @param [updateTransform=true] {boolean} If true the displayObject's worldTransform/worldAlpha and all children\n 17856:  *  transformations will be restored. Not restoring this information will be a little faster.\n 17857   */\n 17858  RenderTexture.prototype.renderWebGL = function (displayObject, matrix, clear, updateTransform)\n .....\n 21087      // this could be more elegent..\n 21088      var cachedRenderTarget = renderer.currentRenderTarget;\n 21089:     // We also store the filter stack - I will definitely look to change how this works a little later down the line.\n 21090      var stack = renderer.filterManager.filterStack;\n 21091  \n .....\n 21148  };\n 21149  \n 21150: //TODO this can be the same as the webGL verison.. will need to do a little tweaking first though..\n 21151  /**\n 21152  * Prepares the Canvas renderer to cache the sprite\n .....\n 24193  \n 24194      /**\n 24195:      * Tiny little interactiveData pool !\n 24196       *\n 24197       * @member {Array}\n .....\n 24379  /**\n 24380   * Updates the state of interactive objects.\n 24381:  * Invoked by a throttled ticker update from\n 24382   * {@link PIXI.ticker.shared}.\n 24383   *\n .....\n 25900      var points = this.points;\n 25901  \n 25902:     // if too little points, or texture hasn't got UVs set yet just move on.\n 25903      if (points.length < 1 || !this._texture._uvs)\n 25904      {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 31565           *      dof_gain: number;                   // depth-of-field: highlights gain; unset to disable (disabled by default)\n 31566           *      dof_threshold: number;              // depth-of-field: highlights threshold (default: 1)\n 31567:          *      blur_noise: boolean;                // add a little bit of noise to the blur (default: true)\n 31568           * }\n 31569           * Note: if an effect parameter is unset, effect is disabled\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\oimo.js:\n 6838  \n 6839      // Calculates the distance using the inner product and put the amount of embedment \n 6840:     //  However a vertical separation axis and side to weight a little to avoid vibration \n 6841      // And end when there is a separate axis that is remote even one \n 6842:     //  I look for separation axis with little to dent most \n 6843      // Men and if separation axis of the first six - end collision \n 6844      // Heng If it separate axis of nine other - side collision \n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\commonjs\\KActorData.js:\n   15          this.momentum = 0.2;\n   16          this.mass = 1.0;\n   17:         this.ttl = -1;\n   18          this.visual = \"a\";\n   19      }\n   ..\n   32          this.momentum = p_other.momentum;\n   33          this.mass = p_other.mass;\n   34:         this.ttl = p_other.ttl;\n   35          this.visual = p_other.visual;\n   36      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   31          this.actors.push(actor.actorID);\n   32          this.userData.actorIDs.push(actor.actorID);\n   33:         actor.actorData.ttl = p_physics.ttl;\n   34          actor.actorData.velocity.x = p_physics.vx;\n   35          actor.actorData.velocity.y = p_physics.vy;\n   ..\n   61          actor.actorData.velocity.x = p_velocity.x;\n   62          actor.actorData.velocity.y = p_velocity.y;\n   63:         actor.actorData.ttl = 1;\n   64          this.actors.push(actor.actorID);\n   65          this.userData.actorIDs.push(actor.actorID);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n   84                      var posX = user.userData.homePosition.x - 10+20*user.actors.length;\n   85                      var posY = user.userData.homePosition.y - 10+20*user.actors.length;\n   86:                     var physics = {x:posX, y:posY, vx:0, vy:0, r:g_unit*0.4, ttl:-1}\n   87  \n   88                      var username = user.userData.username.substring(0, 3);\n   ..\n  116          var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117          var velY = 0;//heroActor.actorData.lastVelocity.y;\n  118:         var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  120          var punch = this.createActor(user, username, physics, \"P\");\n  ...\n  133          var velY = 5;//heroActor.actorData.lastVelocity.y*chargeTime;\n  134          console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135:         var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  136          var username = user.userData.username.substring(0, 3)+'shoot';\n  137          var shoot = this.createActor(user, username, physics, \"S\");\n\n23 matches across 7 files\n\n\nSearching 42 files for \"actorState\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\commonjs\\KActorData.js:\n   11          this.facingEngine = { x: 0, y: 0 };\n   12          this.lastVelocity = { x: 0, y: 0 };\n   13:         this.actorState = 0;\n   14          this.speed = 0.4;\n   15          this.momentum = 0.2;\n\n1 match in 1 file\n\n\nSearching 42 files for \"addCircle\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   21          this.chargeTime = 0;\n   22      }\n   23:     KActorSrv.prototype.addCircle = function(p_x, p_y, p_r)\n   24      {        \n   25          this.circle = new SAT.Circle(new SAT.Vector(p_x, p_y), p_r);;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   28          var actorID = this.userData.userID+this.actors.length;\n   29          var actor = new KActorSrv(this.userData.userID, actorID, p_name+actorID, p_sector, p_visual);\n   30:         actor.addCircle(p_physics.x, p_physics.y, p_physics.r);\n   31          this.actors.push(actor.actorID);\n   32          this.userData.actorIDs.push(actor.actorID);\n\n2 matches across 2 files\n\n\nSearching 42 files for \"momentumDesireMove\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   48      }\n   49      \n   50:     KActorSrv.prototype.momentumDesireMove = function(config)\n   51      {\n   52          this.actorData.velocity.x += this.actorData.lastVelocity.x*this.actorData.momentum;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KItemSrv.js:\n   14          this.sector.actorList.push(this);\n   15      }\n   16:     KItemSrv.prototype.momentumDesireMove = function(config)\n   17      {\n   18          this.actorData.velocity.x += this.actorData.lastVelocity.x*this.actorData.momentum;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  163          {\n  164              actor.beforeMove();\n  165:             actor.momentumDesireMove(config);\n  166              actor.inputDesireMove(config);\n  167              actor.finishDesireMove(config);\n\n3 matches across 3 files\n\n\nSearching 42 files for \"ttl\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\longrequire.js:\n 6076              }\n 6077              if (prevToken.value === '}') {\n 6078:                 // Dividing a function by anything makes little sense,\n 6079                  // but we have to check for that.\n 6080                  if (extra.tokens[extra.openCurlyToken - 3] &&\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\pixi.js:\n 2369          this.hostname[this.hostname.length - 1] === ']';\n 2370  \n 2371:     // validate a little.\n 2372      if (!ipv6Hostname) {\n 2373        var hostparts = this.hostname.split(/\\./);\n ....\n 12948          \"\\nprecision mediump float;\\n\\nattribute vec2 aVertexPosition;\\nattribute vec2 aTextureCoord;\\nattribute vec4 aColor;\\n\\nuniform mat3 projectionMatrix;\\nuniform vec2 resolution;\\n\\nvarying vec2 vTextureCoord;\\nvarying vec4 vColor;\\n\\nvarying vec2 vResolution;\\n\\n//texcoords computed in vertex step\\n//to avoid dependent texture reads\\nvarying vec2 v_rgbNW;\\nvarying vec2 v_rgbNE;\\nvarying vec2 v_rgbSW;\\nvarying vec2 v_rgbSE;\\nvarying vec2 v_rgbM;\\n\\n\\nvoid texcoords(vec2 fragCoord, vec2 resolution,\\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\\n            out vec2 v_rgbM) {\\n    vec2 inverseVP = 1.0 / resolution.xy;\\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\\n    v_rgbM = vec2(fragCoord * inverseVP);\\n}\\n\\nvoid main(void){\\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\\n   vTextureCoord = aTextureCoord;\\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\\n   vResolution = resolution;\\n\\n   //compute the texture coords and send them to varyings\\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\\n}\\n\",\n 12949          // fragment shader\n 12950:         \"precision lowp float;\\n\\n\\n/**\\nBasic FXAA implementation based on the code on geeks3d.com with the\\nmodification that the texture2DLod stuff was removed since it's\\nunsupported by WebGL.\\n\\n--\\n\\nFrom:\\nhttps://github.com/mitsuhiko/webgl-meincraft\\n\\nCopyright (c) 2011 by Armin Ronacher.\\n\\nSome rights reserved.\\n\\nRedistribution and use in source and binary forms, with or without\\nmodification, are permitted provided that the following conditions are\\nmet:\\n\\n    * Redistributions of source code must retain the above copyright\\n      notice, this list of conditions and the following disclaimer.\\n\\n    * Redistributions in binary form must reproduce the above\\n      copyright notice, this list of conditions and the following\\n      disclaimer in the documentation and/or other materials provided\\n      with the distribution.\\n\\n    * The names of the contributors may not be used to endorse or\\n      promote products derived from this software without specific\\n      prior written permission.\\n\\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\\n\\\"AS IS\\\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n*/\\n\\n#ifndef FXAA_REDUCE_MIN\\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\\n#endif\\n#ifndef FXAA_REDUCE_MUL\\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\\n#endif\\n#ifndef FXAA_SPAN_MAX\\n    #define FXAA_SPAN_MAX     8.0\\n#endif\\n\\n//optimized version for mobile, where dependent\\n//texture reads can be a bottleneck\\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\\n            vec2 v_rgbNW, vec2 v_rgbNE,\\n            vec2 v_rgbSW, vec2 v_rgbSE,\\n            vec2 v_rgbM) {\\n    vec4 color;\\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\\n    vec4 texColor = texture2D(tex, v_rgbM);\\n    vec3 rgbM  = texColor.xyz;\\n    vec3 luma = vec3(0.299, 0.587, 0.114);\\n    float lumaNW = dot(rgbNW, luma);\\n    float lumaNE = dot(rgbNE, luma);\\n    float lumaSW = dot(rgbSW, luma);\\n    float lumaSE = dot(rgbSE, luma);\\n    float lumaM  = dot(rgbM,  luma);\\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\\n\\n    mediump vec2 dir;\\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\\n\\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\\n\\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\\n              dir * rcpDirMin)) * inverseVP;\\n\\n    vec3 rgbA = 0.5 * (\\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\\n\\n    float lumaB = dot(rgbB, luma);\\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\\n        color = vec4(rgbA, texColor.a);\\n    else\\n        color = vec4(rgbB, texColor.a);\\n    return color;\\n}\\n\\n\\nvarying vec2 vTextureCoord;\\nvarying vec4 vColor;\\nvarying vec2 vResolution;\\n\\n//texcoords computed in vertex step\\n//to avoid dependent texture reads\\nvarying vec2 v_rgbNW;\\nvarying vec2 v_rgbNE;\\nvarying vec2 v_rgbSW;\\nvarying vec2 v_rgbSE;\\nvarying vec2 v_rgbM;\\n\\nuniform sampler2D uSampler;\\n\\n\\nvoid main(void){\\n\\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\\n\\n}\\n\",\n 12951          // uniforms\n 12952          {\n .....\n 16456                  //TODO - i KNOW this can be optimised! Once v3 is stable il look at this next...\n 16457                  shader.uniforms.projectionMatrix.value = this.renderer.currentRenderTarget.projectionMatrix.toArray(true);\n 16458:                 //Make this a little more dynamic / intelligent!\n 16459                  shader.syncUniforms();\n 16460  \n .....\n 17741       * @param [clear=false] {boolean} If true the texture will be cleared before the displayObject is drawn\n 17742       * @param [updateTransform=true] {boolean} If true the displayObject's worldTransform/worldAlpha and all children\n 17743:      *  transformations will be restored. Not restoring this information will be a little faster.\n 17744       */\n 17745      this.render = null;\n .....\n 17854   * @param [clear=false] {boolean} If true the texture will be cleared before the displayObject is drawn\n 17855   * @param [updateTransform=true] {boolean} If true the displayObject's worldTransform/worldAlpha and all children\n 17856:  *  transformations will be restored. Not restoring this information will be a little faster.\n 17857   */\n 17858  RenderTexture.prototype.renderWebGL = function (displayObject, matrix, clear, updateTransform)\n .....\n 21087      // this could be more elegent..\n 21088      var cachedRenderTarget = renderer.currentRenderTarget;\n 21089:     // We also store the filter stack - I will definitely look to change how this works a little later down the line.\n 21090      var stack = renderer.filterManager.filterStack;\n 21091  \n .....\n 21148  };\n 21149  \n 21150: //TODO this can be the same as the webGL verison.. will need to do a little tweaking first though..\n 21151  /**\n 21152  * Prepares the Canvas renderer to cache the sprite\n .....\n 24193  \n 24194      /**\n 24195:      * Tiny little interactiveData pool !\n 24196       *\n 24197       * @member {Array}\n .....\n 24379  /**\n 24380   * Updates the state of interactive objects.\n 24381:  * Invoked by a throttled ticker update from\n 24382   * {@link PIXI.ticker.shared}.\n 24383   *\n .....\n 25900      var points = this.points;\n 25901  \n 25902:     // if too little points, or texture hasn't got UVs set yet just move on.\n 25903      if (points.length < 1 || !this._texture._uvs)\n 25904      {\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\babylon.2.1.debug.js:\n 31565           *      dof_gain: number;                   // depth-of-field: highlights gain; unset to disable (disabled by default)\n 31566           *      dof_threshold: number;              // depth-of-field: highlights threshold (default: 1)\n 31567:          *      blur_noise: boolean;                // add a little bit of noise to the blur (default: true)\n 31568           * }\n 31569           * Note: if an effect parameter is unset, effect is disabled\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientlib\\babylon\\oimo.js:\n 6838  \n 6839      // Calculates the distance using the inner product and put the amount of embedment \n 6840:     //  However a vertical separation axis and side to weight a little to avoid vibration \n 6841      // And end when there is a separate axis that is remote even one \n 6842:     //  I look for separation axis with little to dent most \n 6843      // Men and if separation axis of the first six - end collision \n 6844      // Heng If it separate axis of nine other - side collision \n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\commonjs\\KActorData.js:\n   15          this.momentum = 0.2;\n   16          this.mass = 1.0;\n   17:         this.ttl = -1;\n   18          this.visual = \"a\";\n   19      }\n   ..\n   32          this.momentum = p_other.momentum;\n   33          this.mass = p_other.mass;\n   34:         this.ttl = p_other.ttl;\n   35          this.visual = p_other.visual;\n   36      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   38      KActorSrv.prototype.afterTurn = function(config)\n   39      {\n   40:         if( this.actorData.ttl > 0)\n   41          {\n   42:             this.actorData.ttl--;\n   43:             if( this.actorData.ttl == 0 )\n   44              {\n   45                  this.actorData.actorState = \"D\";\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   32          this.actors.push(actor.actorID);\n   33          this.userData.actorIDs.push(actor.actorID);\n   34:         actor.actorData.ttl = p_physics.ttl;\n   35          actor.actorData.velocity.x = p_physics.vx;\n   36          actor.actorData.velocity.y = p_physics.vy;\n   ..\n   74          actor.actorData.velocity.x = p_velocity.x;\n   75          actor.actorData.velocity.y = p_velocity.y;\n   76:         actor.actorData.ttl = 1;\n   77          this.actors.push(actor.actorID);\n   78          this.userData.actorIDs.push(actor.actorID);\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n   84                      var posX = user.userData.homePosition.x - 10+20*user.actors.length;\n   85                      var posY = user.userData.homePosition.y - 10+20*user.actors.length;\n   86:                     var physics = {x:posX, y:posY, vx:0, vy:0, r:g_unit*0.4, ttl:-1}\n   87  \n   88                      var username = user.userData.username.substring(0, 3);\n   ..\n  116          var velX = 0;//heroActor.actorData.lastVelocity.x;\n  117          var velY = 0;//heroActor.actorData.lastVelocity.y;\n  118:         var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  119          var username = user.userData.username.substring(0, 3)+'punch';\n  120          var punch = this.createActor(user, username, physics, \"P\");\n  ...\n  133          var velY = 5;//heroActor.actorData.lastVelocity.y*chargeTime;\n  134          console.log(\"V\"+velX+\" \"+velY+\" \"+chargeTime);\n  135:         var physics = {x:posX, y:posY, vx:velX, vy:velY, r:g_unit*0.1, ttl:3}\n  136          var username = user.userData.username.substring(0, 3)+'shoot';\n  137          var shoot = this.createActor(user, username, physics, \"S\");\n\n26 matches across 8 files\n\n\nSearching 42 files for \"makeActor\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KUserSrv.js:\n   24      }\n   25  \n   26:     KUserSrv.prototype.makeActor = function(p_name, p_physics, p_sector, p_visual) {    \n   27  \n   28          var actorID = this.userData.userID+this.actors.length;\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  142          var sector = this.getSectorRealPos(physics.x, physics.y);\n  143  \n  144:         var actor = user.makeActor(name, physics, sector, visual);\n  145          this.actors.push(actor);\n  146  \n\n2 matches across 2 files\n\n\nSearching 42 files for \"\"D\"\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   43              if( this.actorData.timeToLive == 0 )\n   44              {\n   45:                 this.actorData.actorState = \"D\";\n   46              }\n   47          }\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  180          {\n  181              var actor = this.actors[i];\n  182:             if( actor.actorData.actorState === \"D\")\n  183              {\n  184                  var uidx = KUtil.findUser(this.users, actor.actorData.userID);\n\n2 matches across 2 files\n\n\nSearching 42 files for \"afterTurn\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KActorSrv.js:\n   36          this.actorData.facingEngine.y = this.inputData.rsy;\n   37      }\n   38:     KActorSrv.prototype.afterTurn = function(config)\n   39      {\n   40          if( this.actorData.timeToLive > 0)\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  175              actor.applyMove(config);\n  176              actor.doAbilities(config, world);\n  177:             actor.afterTurn();\n  178          });\n  179          for(var i = this.actors.Count; i >= 0; ++i)\n\n2 matches across 2 files\n\n\nSearching 42 files for \"addactordata\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  219          game.rcvAddSector(sectorData);\n  220        });\n  221:     socket.on('s-addActorData', function (actorData) {\n  222          game.rcvAddActor(actorData);\n  223        });\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  145          this.actors.push(actor);\n  146  \n  147:         this.io.emit('s-addActorData', actor.actorData );\n  148          return actor;\n  149      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n  179      g_world.actors.forEach( function(actor) \n  180      {\n  181:         g_sockets[socketid].emit('s-addActorData', actor.actorData );\n  182      });\n  183  }\n\n3 matches across 3 files\n\n\nSearching 42 files for \"addactordata\"\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\clientjs\\KGame.js:\n  219          game.rcvAddSector(sectorData);\n  220        });\n  221:     socket.on('s-addActorData', function (actorData) {\n  222          game.rcvAddActor(actorData);\n  223        });\n\n\\\\STRAWBERRY\\Code\\kiloio\\common\\serverjs\\KWorld.js:\n  145          this.actors.push(actor);\n  146  \n  147:         this.io.emit('s-addActorData', actor.actorData );\n  148          return actor;\n  149      }\n\n\\\\STRAWBERRY\\Code\\kiloio\\server\\fishserver.js:\n  179      g_world.actors.forEach( function(actor) \n  180      {\n  181:         g_sockets[socketid].emit('s-addActorData', actor.actorData );\n  182      });\n  183  }\n\n3 matches across 3 files\n",
			"settings":
			{
				"buffer_size": 3134893,
				"line_ending": "Windows",
				"name": "Find Results",
				"scratch": true
			}
		},
		{
			"file": "common/clientjs/KSectorCli.js",
			"settings":
			{
				"buffer_size": 2032,
				"line_ending": "Windows"
			}
		},
		{
			"file": "common/clientjs/KGame.js",
			"settings":
			{
				"buffer_size": 13934,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/clientjs/KUserCli.js",
			"settings":
			{
				"buffer_size": 1150,
				"line_ending": "Unix"
			}
		},
		{
			"file": "server/fishserver.js",
			"settings":
			{
				"buffer_size": 7002,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/serverjs/KUserSrv.js",
			"settings":
			{
				"buffer_size": 3442,
				"line_ending": "Unix"
			}
		},
		{
			"file": "common/commonjs/KUtil.js",
			"settings":
			{
				"buffer_size": 2202,
				"line_ending": "Unix"
			}
		}
	],
	"build_system": "",
	"build_system_choices":
	[
	],
	"build_varint": "",
	"command_palette":
	{
		"height": 392.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"pa",
				"Package Control: Install Package"
			]
		],
		"width": 400.0
	},
	"console":
	{
		"height": 126.0,
		"history":
		[
			"import urllib.request,os,hashlib; h = '2deb499853c4371624f5a07e27c334aa' + 'bf8c4e67d14fb0525ba4f89698a6d7e1'; pf = 'Package Control.sublime-package'; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( 'http://packagecontrol.io/' + pf.replace(' ', '%20')).read(); dh = hashlib.sha256(by).hexdigest(); print('Error validating download (got %s instead of %s), please try manual install' % (dh, h)) if dh != h else open(os.path.join( ipp, pf), 'wb' ).write(by)"
		]
	},
	"distraction_free":
	{
		"menu_visible": true,
		"show_minimap": false,
		"show_open_files": false,
		"show_tabs": false,
		"side_bar_visible": false,
		"status_bar_visible": false
	},
	"expanded_folders":
	[
		"//STRAWBERRY/Code/kiloio",
		"//STRAWBERRY/Code/kiloio/client",
		"//STRAWBERRY/Code/kiloio/client/css",
		"//STRAWBERRY/Code/kiloio/client/js",
		"//STRAWBERRY/Code/kiloio/common",
		"//STRAWBERRY/Code/kiloio/common/clientjs",
		"//STRAWBERRY/Code/kiloio/common/clientlib",
		"//STRAWBERRY/Code/kiloio/common/commonjs",
		"//STRAWBERRY/Code/kiloio/common/serverjs",
		"//STRAWBERRY/Code/kiloio/common/serverlib",
		"//STRAWBERRY/Code/kiloio/server"
	],
	"file_history":
	[
		"//STRAWBERRY/Code/kiloio/common/commonjs/KGlob.js",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KGame.js",
		"//STRAWBERRY/Code/kiloio/server/fishserver.js",
		"//STRAWBERRY/Code/kiloio/common/serverjs/KActorSrv.js",
		"//STRAWBERRY/Code/kiloio/common/serverjs/KUserSrv.js",
		"//STRAWBERRY/Code/kiloio/common/commonjs/KActorData.js",
		"//STRAWBERRY/Code/kiloio/common/serverjs/KItemSrv.js",
		"//STRAWBERRY/Code/kiloio/common/commonjs/KUserData.js",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KActorCli.js",
		"//STRAWBERRY/Code/kiloio/server/config.json",
		"//STRAWBERRY/Code/kiloio/client/index.html",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KSectorCli.js",
		"//STRAWBERRY/Code/kiloio/client/js/app.js",
		"//STRAWBERRY/Code/kiloio/common/commonlib/json.js",
		"//STRAWBERRY/Code/kiloio/client/js/prep.js",
		"//STRAWBERRY/Code/kiloio/common/serverjs/KSectorSrv.js",
		"//STRAWBERRY/Code/kiloio/common/serverjs/KWorld.js",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KUserCli.js",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KWorldCli.js",
		"//STRAWBERRY/Code/kiloio/common/clientlib/longrequire.js",
		"//STRAWBERRY/Code/kiloio/server/serverjs/KUtil.js",
		"//STRAWBERRY/Code/kiloio/server/serverjs/KUserSrv.js",
		"//STRAWBERRY/Code/kiloio/client/clientlib/require.js",
		"//STRAWBERRY/Code/kiloio/client/clientlib/longrequire.js",
		"//STRAWBERRY/Code/kiloio/server/serverjs/KActorSrv.js",
		"//STRAWBERRY/Code/kiloio/server/serverjs/KSectorSrv.js",
		"//STRAWBERRY/Code/kiloio/server/lib/require.js",
		"//STRAWBERRY/Code/kiloio/server/lib/quadtree.js",
		"//STRAWBERRY/Code/kiloio/client/lib/babylon/babylon.2.1.debug.js",
		"//STRAWBERRY/Code/kiloio/client/lib/babylon/babylon.2.1.js",
		"//STRAWBERRY/Code/kiloio/client/lib/babylon/babylon.2.1.noworker.js",
		"//STRAWBERRY/Code/kiloio/server/lib/text.js",
		"//STRAWBERRY/Code/kiloio/server/lib/config.json",
		"//STRAWBERRY/Code/kiloio/server/lib/util.js",
		"/C/Users/3up_000/Desktop/text.js",
		"//STRAWBERRY/Code/kiloio/server/lib/KActorSrv.js",
		"//STRAWBERRY/Code/kiloio/common/commonjs/KInputData.js",
		"/I/w/ClickThink/ClickThink/AIBrain.cs",
		"/I/w/ClickThink/ClickThink/ActionInterface.cs",
		"/I/w/ClickThink/ClickThink/GameActor.cs",
		"//STRAWBERRY/Code/kiloio/server/lib/KInputData.js",
		"//STRAWBERRY/Code/kiloio/client/js/KCamera.js",
		"//STRAWBERRY/Code/kiloio/client/js/clientutil.js",
		"//STRAWBERRY/Code/kiloio/client/js/globals.js",
		"//STRAWBERRY/Code/testnodejs/client/js/app.js",
		"//STRAWBERRY/Code/kiloio/common/commonjs/testgame.js",
		"//STRAWBERRY/Code/kiloio/common/clientjs/KApp.js",
		"//STRAWBERRY/Code/kiloio/client/js/KApp.js",
		"/I/w/kiloio/client/js/KApp.js",
		"//STRAWBERRY/Code/kiloio/client/js/KActorData.js",
		"//STRAWBERRY/Code/kiloio/server/lib/KSectorSrv.js",
		"//STRAWBERRY/Code/kiloio/server/lib/KActorData.js",
		"//STRAWBERRY/Code/kiloio/server/lib/KWorld.js",
		"//STRAWBERRY/Code/kiloio/client/js/KUserData.js",
		"/I/w/kiloio/client/index.html",
		"//STRAWBERRY/Code/testnodejs/client/index.html",
		"//STRAWBERRY/Code/RequireJS-example-of-use-lib-on-server-side-and-client-side-master/client/js/app.js",
		"//STRAWBERRY/Code/testnodejs/lib/pyandex/core.js",
		"//STRAWBERRY/Code/kiloio/commonjs/testgame.js",
		"//STRAWBERRY/Code/RequireJS-example-of-use-lib-on-server-side-and-client-side-master/package.json",
		"//STRAWBERRY/Code/testnodejs/package.json",
		"//STRAWBERRY/Code/testnodejs/server/app.js",
		"//STRAWBERRY/Code/testnodejs/client/js/require.js",
		"//STRAWBERRY/Code/testnodejs/client/README.md",
		"//STRAWBERRY/Code/kiloio/package.json",
		"//STRAWBERRY/Code/RequireJS-example-of-use-lib-on-server-side-and-client-side-master/server/app.js",
		"//STRAWBERRY/Code/RequireJS-example-of-use-lib-on-server-side-and-client-side-master/lib/pyandex/core.js",
		"//STRAWBERRY/Code/kiloio/client/js/KActorCli.js",
		"//STRAWBERRY/Code/kiloio/client/css/main.css",
		"//STRAWBERRY/Code/kiloio/client/js/KGame.js",
		"//STRAWBERRY/Code/webkilo/client/js/KGame.js",
		"//STRAWBERRY/Code/webkilo/client/js/KCamera.js",
		"//STRAWBERRY/Code/webkilo/client/lib/babylon/babylon.2.1.debug.js",
		"//STRAWBERRY/Code/webkilo/client/js/KActorData.js",
		"//STRAWBERRY/Code/webkilo/client/js/KWorldCli.js",
		"//STRAWBERRY/Code/webkilo/client/js/globals.js",
		"//STRAWBERRY/Code/webkilo/client/index.html",
		"//STRAWBERRY/Code/webkilo/client/js/KSectorCli.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KUserData.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KUserSrv.js",
		"//STRAWBERRY/Code/webkilo/client/js/KActorCli.js",
		"//STRAWBERRY/Code/webkilo/client/js/KUserCli.js",
		"//STRAWBERRY/Code/webkilo/client/js/KApp.js",
		"//STRAWBERRY/Code/webkilo/client/js/KMapCli.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KActorData.js",
		"//STRAWBERRY/Code/webkilo/client/js/util.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KActorSrv.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KSectorSrv.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KWorld.js",
		"//STRAWBERRY/Code/webkilo/client/js/game.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KUser.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KActor.js",
		"//STRAWBERRY/Code/webkilo/client/js/kiloapp.js",
		"//STRAWBERRY/Code/webkilo/client/js/actor.js",
		"//STRAWBERRY/Code/webkilo/client/js/map.js",
		"//STRAWBERRY/Code/webkilo/client/js/sector.js",
		"//STRAWBERRY/Code/webkilo/server/lib/quadtree.js",
		"//STRAWBERRY/Code/webkilo/server/config.json",
		"//STRAWBERRY/Code/webkilo/package.json",
		"//STRAWBERRY/Code/webkilo/client/js/user.js",
		"//STRAWBERRY/Code/webkilo/server/fishserver.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KBlock.js",
		"//STRAWBERRY/Code/webkilo/server/lib/KSector.js",
		"//STRAWBERRY/Code/webkilo/client/js/camera.js",
		"//STRAWBERRY/Code/webkilo/client/css/main.css",
		"/C/Users/3up_000/Desktop/index.html",
		"//STRAWBERRY/Code/webkilo/webk.sublime-project",
		"//STRAWBERRY/Code/webkilo/webk.sublime-workspace",
		"//STRAWBERRY/Code/webfish-clone/src/client/js/app.js",
		"//STRAWBERRY/Code/webfish-clone/src/server/server.js",
		"//STRAWBERRY/Code/webfish/client/index.html",
		"//STRAWBERRY/Code/webfish/webf.sublime-project",
		"//STRAWBERRY/Code/webfish/server/lib/util.js",
		"//STRAWBERRY/Code/webfish/server/config.json",
		"//STRAWBERRY/Code/webfish/package.json",
		"//STRAWBERRY/Code/webfish-clone/config.json",
		"//STRAWBERRY/Code/webfish/app.json",
		"//STRAWBERRY/Code/webfish/config.json",
		"//STRAWBERRY/Code/webfish/manifest.yml",
		"//STRAWBERRY/Code/webfish/LICENSE.md",
		"//STRAWBERRY/Code/webfish/README.md",
		"//STRAWBERRY/Code/webfish/src/client/index.html",
		"/I/w/threefish/Assets/Code/UserManager.cs",
		"/I/w/threefish/Assets/Code/Utils.cs",
		"/I/w/threefish/Assets/Code/Actors/Actor.cs",
		"/I/w/threefish/Assets/Code/Actors/ActorMotor.cs",
		"/I/w/threefish/Assets/Plugins/VectrosityScripts/VectorLine.cs",
		"/I/w/threefish/Assets/Code/Brains/Brain.cs"
	],
	"find":
	{
		"height": 34.0
	},
	"find_in_files":
	{
		"height": 90.0,
		"where_history":
		[
			"*.*",
			"actorHUD*.*",
			"*.*",
			"*.html",
			"*.css",
			"*.html",
			"*.cs",
			"",
			"*.cs",
			"fac*.cs",
			"*.cs",
			"*.*workspace",
			"*.cs",
			"GooglePlayGames/*.cs",
			"GooglePlayGames\\*",
			"*.cs",
			"I:\\w\\Tetrified\\Assets\\Code\\Game",
			""
		]
	},
	"find_state":
	{
		"case_sensitive": false,
		"find_history":
		[
			"game.users",
			"game.actors",
			"rcvAddActor",
			"addactordata",
			"count",
			"afterTurn",
			"\"D\"",
			"makeActor",
			"ttl",
			"for",
			"momentumDesireMove",
			"addCircle",
			"actorState",
			"ttl",
			"console.log",
			"makeActor",
			"KActorSrv",
			"addModel",
			"'0'",
			"rfy",
			"lastVelocity",
			"createactor",
			"g_world",
			"g_unit",
			"io",
			"dopunch",
			"makeItemActor",
			"'s'",
			"tickLoop",
			"makeHeroActor",
			"makeItemActor",
			"doAbilities",
			"sendAddPacketsToSocket",
			"config",
			"tickUser",
			"moveUser",
			"sendUpdates",
			"io",
			"turnLoop",
			"doPunch",
			"findActor",
			"g_actor",
			"g_world.actors",
			"g_users",
			"makeHeroActor",
			"makeItemActor",
			"KUtil",
			"doAbilities",
			"dopunch",
			"makeac",
			"actorIDs",
			"circle.p",
			"worlduser",
			"new kactorsrv",
			"moveperiod",
			"turnLoop",
			"tickLoop",
			"moveperiod",
			"s-gameSetup",
			"turnloop",
			"4",
			"movePeriod",
			"moveLoop",
			"'0'",
			"g_",
			"KUtil",
			"clientjs/",
			"serverjs/",
			"commonjs/",
			"serverjs",
			"KUtil",
			"requestanim",
			"gameloop",
			"handleLogic",
			"for",
			"clientTransmit",
			"'0'",
			"url =",
			"map.url",
			"url",
			"libjs",
			"console",
			"new kuserdata",
			"new KActorData",
			"command",
			"commandQueue",
			"sendAddPacketsToSocket",
			"addactor",
			"lastVelocity",
			"SAT",
			"'text!",
			"('text",
			"'text",
			"'test",
			"text!",
			"momentumDesireMove",
			"config",
			"libjs/",
			"libjs.qu",
			"QUAD",
			"KUtil",
			"util.",
			"util",
			"gameStart",
			"util",
			"exports",
			"util.",
			"cfg",
			"config",
			"config.json",
			"config.js",
			"quadtree",
			"new ",
			"gameStart",
			"util",
			"quadtree",
			"new KActorSrv",
			"KActorSrv",
			"KActorData",
			"inputjoy",
			"localActorData.inputJoy",
			"inputjoy",
			"setSoftTarget",
			"cameraAnchor",
			"cameraAnchor.position",
			"actorCameraLock",
			"doHandleKeyUp",
			"doHandleKeyDown"
		],
		"highlight": true,
		"in_selection": false,
		"preserve_case": false,
		"regex": false,
		"replace_history":
		[
			"client/",
			"server/",
			"common/",
			"quadtree",
			"localInput",
			"actorList",
			"KWorldCli",
			"KCamera",
			"userID",
			"actorID",
			"KSector",
			"KUser",
			"KSector",
			"KActor",
			"bufferCollider",
			"imageCharlie",
			"imageBravo",
			"imageAlpha",
			"double",
			"humanActor",
			"GL_TEXTURE0",
			"mTexture0",
			"mAttributeCoord2d",
			"m_config",
			"pConfig",
			"mProgram",
			"mVboQuad",
			"slot",
			"slidecover",
			"slide4",
			"slide3",
			"slide2",
			"slide1",
			"slidx",
			"top: 128px;",
			"opacity: 0.7",
			"opacity: 0.5",
			"RetryFailedState",
			"weaponType",
			"throwerType",
			"movingTurnSpeed",
			"stationaryTurnSpeed",
			"gravMultiplier",
			"runCycleLegOffset",
			"animSpeedMultiplier",
			"groundCheckDistance",
			"groundCheckDistanceDefault",
			"groundCheckDistance",
			"isCrouching",
			"thisCapsule",
			"capsuleCenter",
			"capsuleHeight",
			"groundNormal",
			"forwardAmount",
			"turnAmount",
			"isGrounded",
			"thisAnimator",
			"thisRigidbody",
			"thisCharacter",
			"thisCam",
			"moveVec",
			"doJump",
			"()",
			"Invalidate",
			"Validate",
			"ValidOFf",
			"Die()",
			"",
			"isPropel",
			"propelVel",
			"coastVel",
			"VehicleActor",
			"AgentGoal",
			");",
			"BasicTimer",
			"GumboTask.Tick",
			"GumboTask.Start",
			"static bool? Tick",
			"static bool Tick",
			"static void Start",
			"GumboTask task, GumboAgent agent",
			"GumboTask task,",
			"FinishDeleg",
			"TickDeleg",
			"StartDeleg",
			"tickDict",
			"startDict",
			"GetTick",
			"StartDeleg",
			"TickDeleg",
			"NvTimer",
			"LazySingletonBehavior",
			"",
			"activeWeapon",
			"Ability",
			"GetNormalActor",
			"normal",
			"NormalActor",
			"GetGenericActor",
			"velocity",
			"RogueFish",
			"GetActorUID",
			"EntityProperties",
			"GoogLogger.e",
			"LazySingletonBehavior",
			"logGumbo",
			"GoogLogger.",
			"Logger.Error(",
			"Logger.Warn(",
			"Logger.Info(",
			"Logger.Debug(",
			"PieceCubeType",
			"cubeType",
			"mDirector",
			"TetrDirector",
			"TetrBridge"
		],
		"reverse": false,
		"show_context": true,
		"use_buffer2": true,
		"whole_word": false,
		"wrap": true
	},
	"groups":
	[
		{
			"selected": 7,
			"sheets":
			[
				{
					"buffer": 0,
					"file": "common/serverjs/KWorld.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 8408,
						"regions":
						{
						},
						"selection":
						[
							[
								6167,
								6666
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 2347.0,
						"zoom_level": 1.0
					},
					"stack_index": 3,
					"type": "text"
				},
				{
					"buffer": 1,
					"file": "common/serverjs/KActorSrv.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 5113,
						"regions":
						{
						},
						"selection":
						[
							[
								1318,
								1327
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 335.0,
						"zoom_level": 1.0
					},
					"stack_index": 6,
					"type": "text"
				},
				{
					"buffer": 2,
					"file": "common/commonjs/KActorData.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 1361,
						"regions":
						{
						},
						"selection":
						[
							[
								1284,
								1284
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 8,
					"type": "text"
				},
				{
					"buffer": 3,
					"file": "common/clientjs/KActorCli.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 7003,
						"regions":
						{
						},
						"selection":
						[
							[
								5770,
								5770
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 2174.0,
						"zoom_level": 1.0
					},
					"stack_index": 2,
					"type": "text"
				},
				{
					"buffer": 4,
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 3134893,
						"regions":
						{
							"match":
							{
								"flags": 112,
								"regions":
								[
									[
										259,
										262
									],
									[
										553,
										556
									],
									[
										903,
										906
									],
									[
										955,
										958
									],
									[
										1188,
										1201
									],
									[
										1562,
										1575
									],
									[
										1814,
										1827
									],
									[
										2180,
										2191
									],
									[
										2505,
										2516
									],
									[
										2794,
										2805
									],
									[
										2914,
										2925
									],
									[
										3276,
										3288
									],
									[
										3564,
										3576
									],
									[
										3592,
										3604
									],
									[
										3619,
										3631
									],
									[
										3926,
										3938
									],
									[
										4025,
										4037
									],
									[
										4254,
										4266
									],
									[
										4348,
										4360
									],
									[
										4731,
										4743
									],
									[
										4830,
										4842
									],
									[
										5095,
										5107
									],
									[
										5161,
										5173
									],
									[
										5497,
										5509
									],
									[
										5570,
										5582
									],
									[
										5932,
										5935
									],
									[
										8059,
										8062
									],
									[
										86266,
										86269
									],
									[
										246518,
										246521
									],
									[
										332498,
										332501
									],
									[
										332677,
										332680
									],
									[
										332695,
										332698
									],
									[
										332950,
										332953
									],
									[
										333191,
										333194
									],
									[
										333419,
										333422
									],
									[
										333601,
										333604
									],
									[
										333794,
										333797
									],
									[
										333954,
										333957
									],
									[
										334144,
										334147
									],
									[
										334436,
										334439
									],
									[
										334739,
										334747
									],
									[
										334948,
										334956
									],
									[
										335176,
										335184
									],
									[
										335408,
										335416
									],
									[
										335681,
										335690
									],
									[
										335848,
										335857
									],
									[
										336039,
										336048
									],
									[
										336264,
										336273
									],
									[
										336472,
										336481
									],
									[
										336624,
										336633
									],
									[
										336815,
										336824
									],
									[
										336985,
										336994
									],
									[
										337145,
										337154
									],
									[
										337328,
										337337
									],
									[
										337480,
										337489
									],
									[
										337641,
										337650
									],
									[
										337775,
										337784
									],
									[
										337907,
										337916
									],
									[
										338018,
										338027
									],
									[
										338216,
										338225
									],
									[
										338337,
										338346
									],
									[
										338383,
										338392
									],
									[
										338561,
										338570
									],
									[
										338877,
										338886
									],
									[
										339188,
										339197
									],
									[
										339563,
										339572
									],
									[
										339873,
										339882
									],
									[
										340139,
										340150
									],
									[
										340395,
										340406
									],
									[
										340535,
										340546
									],
									[
										340655,
										340666
									],
									[
										340811,
										340822
									],
									[
										341074,
										341085
									],
									[
										341264,
										341275
									],
									[
										341301,
										341312
									],
									[
										341343,
										341354
									],
									[
										341481,
										341492
									],
									[
										341518,
										341529
									],
									[
										341561,
										341572
									],
									[
										341688,
										341699
									],
									[
										341742,
										341753
									],
									[
										341893,
										341904
									],
									[
										342102,
										342113
									],
									[
										342257,
										342268
									],
									[
										342424,
										342435
									],
									[
										342608,
										342619
									],
									[
										342901,
										342912
									],
									[
										343105,
										343116
									],
									[
										343220,
										343231
									],
									[
										343408,
										343419
									],
									[
										343594,
										343605
									],
									[
										343773,
										343784
									],
									[
										343942,
										343953
									],
									[
										344102,
										344113
									],
									[
										344278,
										344289
									],
									[
										344465,
										344476
									],
									[
										344600,
										344611
									],
									[
										344802,
										344813
									],
									[
										345100,
										345111
									],
									[
										345421,
										345432
									],
									[
										345565,
										345576
									],
									[
										345761,
										345772
									],
									[
										345999,
										346010
									],
									[
										346225,
										346236
									],
									[
										346478,
										346489
									],
									[
										346640,
										346651
									],
									[
										346938,
										346949
									],
									[
										347070,
										347081
									],
									[
										347327,
										347338
									],
									[
										347461,
										347472
									],
									[
										347572,
										347583
									],
									[
										347731,
										347742
									],
									[
										347985,
										347996
									],
									[
										348265,
										348276
									],
									[
										348539,
										348550
									],
									[
										462694,
										462705
									],
									[
										462802,
										462813
									],
									[
										465533,
										465544
									],
									[
										577858,
										577869
									],
									[
										733455,
										733466
									],
									[
										879872,
										879883
									],
									[
										879978,
										879989
									],
									[
										882702,
										882713
									],
									[
										994905,
										994916
									],
									[
										1150502,
										1150513
									],
									[
										1252428,
										1252439
									],
									[
										1252651,
										1252662
									],
									[
										1252865,
										1252876
									],
									[
										1253097,
										1253108
									],
									[
										1253358,
										1253369
									],
									[
										1253729,
										1253740
									],
									[
										1254047,
										1254058
									],
									[
										1254329,
										1254340
									],
									[
										1254549,
										1254560
									],
									[
										1254667,
										1254678
									],
									[
										1254920,
										1254931
									],
									[
										1255131,
										1255142
									],
									[
										1255320,
										1255331
									],
									[
										1255614,
										1255625
									],
									[
										1255824,
										1255835
									],
									[
										1256069,
										1256080
									],
									[
										1256342,
										1256353
									],
									[
										1256601,
										1256612
									],
									[
										1256770,
										1256781
									],
									[
										1256881,
										1256892
									],
									[
										1257087,
										1257098
									],
									[
										1257229,
										1257240
									],
									[
										1257478,
										1257489
									],
									[
										1257812,
										1257823
									],
									[
										1257992,
										1258003
									],
									[
										1258185,
										1258196
									],
									[
										1258485,
										1258496
									],
									[
										1258719,
										1258730
									],
									[
										1258877,
										1258888
									],
									[
										1259071,
										1259082
									],
									[
										1259371,
										1259382
									],
									[
										1259608,
										1259619
									],
									[
										1259826,
										1259837
									],
									[
										1260021,
										1260032
									],
									[
										1260073,
										1260084
									],
									[
										1260291,
										1260302
									],
									[
										1260601,
										1260612
									],
									[
										1260849,
										1260860
									],
									[
										1260907,
										1260918
									],
									[
										1260981,
										1260992
									],
									[
										1261150,
										1261161
									],
									[
										1261284,
										1261295
									],
									[
										1261381,
										1261392
									],
									[
										1261463,
										1261474
									],
									[
										1261563,
										1261574
									],
									[
										1261618,
										1261629
									],
									[
										1261685,
										1261696
									],
									[
										1261983,
										1261994
									],
									[
										1262239,
										1262250
									],
									[
										1262379,
										1262390
									],
									[
										1262499,
										1262510
									],
									[
										1262655,
										1262666
									],
									[
										1262892,
										1262903
									],
									[
										1262929,
										1262940
									],
									[
										1262971,
										1262982
									],
									[
										1263109,
										1263120
									],
									[
										1263146,
										1263157
									],
									[
										1263189,
										1263200
									],
									[
										1263316,
										1263327
									],
									[
										1263370,
										1263381
									],
									[
										1263521,
										1263532
									],
									[
										1263730,
										1263741
									],
									[
										1263885,
										1263896
									],
									[
										1264052,
										1264063
									],
									[
										1264236,
										1264247
									],
									[
										1264529,
										1264540
									],
									[
										1264733,
										1264744
									],
									[
										1264848,
										1264859
									],
									[
										1265036,
										1265047
									],
									[
										1265222,
										1265233
									],
									[
										1265401,
										1265412
									],
									[
										1265570,
										1265581
									],
									[
										1265730,
										1265741
									],
									[
										1265906,
										1265917
									],
									[
										1266093,
										1266104
									],
									[
										1266228,
										1266239
									],
									[
										1266430,
										1266441
									],
									[
										1266728,
										1266739
									],
									[
										1267049,
										1267060
									],
									[
										1267193,
										1267204
									],
									[
										1267389,
										1267400
									],
									[
										1267627,
										1267638
									],
									[
										1267853,
										1267864
									],
									[
										1268106,
										1268117
									],
									[
										1268268,
										1268279
									],
									[
										1268566,
										1268577
									],
									[
										1268698,
										1268709
									],
									[
										1268955,
										1268966
									],
									[
										1269089,
										1269100
									],
									[
										1269200,
										1269211
									],
									[
										1269359,
										1269370
									],
									[
										1269613,
										1269624
									],
									[
										1269893,
										1269904
									],
									[
										1270167,
										1270178
									],
									[
										1384322,
										1384333
									],
									[
										1384430,
										1384441
									],
									[
										1387161,
										1387172
									],
									[
										1499486,
										1499497
									],
									[
										1655083,
										1655094
									],
									[
										1801500,
										1801511
									],
									[
										1801606,
										1801617
									],
									[
										1804330,
										1804341
									],
									[
										1916533,
										1916544
									],
									[
										2072130,
										2072141
									],
									[
										2174056,
										2174067
									],
									[
										2174279,
										2174290
									],
									[
										2174493,
										2174504
									],
									[
										2174725,
										2174736
									],
									[
										2174986,
										2174997
									],
									[
										2175357,
										2175368
									],
									[
										2175675,
										2175686
									],
									[
										2175957,
										2175968
									],
									[
										2176177,
										2176188
									],
									[
										2176295,
										2176306
									],
									[
										2176548,
										2176559
									],
									[
										2176759,
										2176770
									],
									[
										2176948,
										2176959
									],
									[
										2177242,
										2177253
									],
									[
										2177452,
										2177463
									],
									[
										2177697,
										2177708
									],
									[
										2177970,
										2177981
									],
									[
										2178229,
										2178240
									],
									[
										2178398,
										2178409
									],
									[
										2178509,
										2178520
									],
									[
										2178715,
										2178726
									],
									[
										2178857,
										2178868
									],
									[
										2179106,
										2179117
									],
									[
										2179440,
										2179451
									],
									[
										2179620,
										2179631
									],
									[
										2179813,
										2179824
									],
									[
										2180113,
										2180124
									],
									[
										2180347,
										2180358
									],
									[
										2180505,
										2180516
									],
									[
										2180699,
										2180710
									],
									[
										2180999,
										2181010
									],
									[
										2181236,
										2181247
									],
									[
										2181454,
										2181465
									],
									[
										2181649,
										2181660
									],
									[
										2181701,
										2181712
									],
									[
										2181919,
										2181930
									],
									[
										2182229,
										2182240
									],
									[
										2182477,
										2182488
									],
									[
										2182535,
										2182546
									],
									[
										2182609,
										2182620
									],
									[
										2182778,
										2182789
									],
									[
										2182912,
										2182923
									],
									[
										2183009,
										2183020
									],
									[
										2183091,
										2183102
									],
									[
										2183191,
										2183202
									],
									[
										2183246,
										2183257
									],
									[
										2183313,
										2183324
									],
									[
										2183611,
										2183622
									],
									[
										2183867,
										2183878
									],
									[
										2184007,
										2184018
									],
									[
										2184127,
										2184138
									],
									[
										2184283,
										2184294
									],
									[
										2184520,
										2184531
									],
									[
										2184557,
										2184568
									],
									[
										2184599,
										2184610
									],
									[
										2184737,
										2184748
									],
									[
										2184774,
										2184785
									],
									[
										2184817,
										2184828
									],
									[
										2184944,
										2184955
									],
									[
										2184998,
										2185009
									],
									[
										2185151,
										2185162
									],
									[
										2185360,
										2185371
									],
									[
										2185515,
										2185526
									],
									[
										2185682,
										2185693
									],
									[
										2185866,
										2185877
									],
									[
										2186159,
										2186170
									],
									[
										2186363,
										2186374
									],
									[
										2186478,
										2186489
									],
									[
										2186666,
										2186677
									],
									[
										2186852,
										2186863
									],
									[
										2187031,
										2187042
									],
									[
										2187200,
										2187211
									],
									[
										2187360,
										2187371
									],
									[
										2187536,
										2187547
									],
									[
										2187723,
										2187734
									],
									[
										2187858,
										2187869
									],
									[
										2188060,
										2188071
									],
									[
										2188358,
										2188369
									],
									[
										2188679,
										2188690
									],
									[
										2188823,
										2188834
									],
									[
										2189019,
										2189030
									],
									[
										2189257,
										2189268
									],
									[
										2189483,
										2189494
									],
									[
										2189736,
										2189747
									],
									[
										2189898,
										2189909
									],
									[
										2190196,
										2190207
									],
									[
										2190328,
										2190339
									],
									[
										2190585,
										2190596
									],
									[
										2190719,
										2190730
									],
									[
										2190830,
										2190841
									],
									[
										2190989,
										2191000
									],
									[
										2191243,
										2191254
									],
									[
										2191523,
										2191534
									],
									[
										2191797,
										2191808
									],
									[
										2305952,
										2305963
									],
									[
										2306060,
										2306071
									],
									[
										2308791,
										2308802
									],
									[
										2421116,
										2421127
									],
									[
										2576713,
										2576724
									],
									[
										2723130,
										2723141
									],
									[
										2723236,
										2723247
									],
									[
										2725960,
										2725971
									],
									[
										2838163,
										2838174
									],
									[
										2993760,
										2993771
									],
									[
										3095686,
										3095697
									],
									[
										3095909,
										3095920
									],
									[
										3096123,
										3096134
									],
									[
										3096355,
										3096366
									],
									[
										3096616,
										3096627
									],
									[
										3096987,
										3096998
									],
									[
										3097305,
										3097316
									],
									[
										3097587,
										3097598
									],
									[
										3097807,
										3097818
									],
									[
										3097925,
										3097936
									],
									[
										3098178,
										3098189
									],
									[
										3098389,
										3098400
									],
									[
										3098578,
										3098589
									],
									[
										3098872,
										3098883
									],
									[
										3099082,
										3099093
									],
									[
										3099327,
										3099338
									],
									[
										3099600,
										3099611
									],
									[
										3099859,
										3099870
									],
									[
										3100028,
										3100039
									],
									[
										3100139,
										3100150
									],
									[
										3100345,
										3100356
									],
									[
										3100487,
										3100498
									],
									[
										3100736,
										3100747
									],
									[
										3101070,
										3101081
									],
									[
										3101250,
										3101261
									],
									[
										3101443,
										3101454
									],
									[
										3101743,
										3101754
									],
									[
										3101977,
										3101988
									],
									[
										3102135,
										3102146
									],
									[
										3102329,
										3102340
									],
									[
										3102629,
										3102640
									],
									[
										3102866,
										3102877
									],
									[
										3103084,
										3103095
									],
									[
										3103279,
										3103290
									],
									[
										3103331,
										3103342
									],
									[
										3103549,
										3103560
									],
									[
										3103859,
										3103870
									],
									[
										3104107,
										3104118
									],
									[
										3104165,
										3104176
									],
									[
										3104239,
										3104250
									],
									[
										3104408,
										3104419
									],
									[
										3104542,
										3104553
									],
									[
										3104639,
										3104650
									],
									[
										3104721,
										3104732
									],
									[
										3104821,
										3104832
									],
									[
										3104876,
										3104887
									],
									[
										3104943,
										3104954
									],
									[
										3105310,
										3105313
									],
									[
										3105599,
										3105602
									],
									[
										3109191,
										3109194
									],
									[
										3111964,
										3111967
									],
									[
										3112395,
										3112398
									],
									[
										3112786,
										3112789
									],
									[
										3113132,
										3113135
									],
									[
										3113333,
										3113336
									],
									[
										3113487,
										3113490
									],
									[
										3113661,
										3113664
									],
									[
										3113814,
										3113817
									],
									[
										3114339,
										3114342
									],
									[
										3114720,
										3114723
									],
									[
										3114872,
										3114875
									],
									[
										3115182,
										3115185
									],
									[
										3115355,
										3115358
									],
									[
										3115369,
										3115372
									],
									[
										3115625,
										3115628
									],
									[
										3115641,
										3115644
									],
									[
										3115915,
										3115918
									],
									[
										3116358,
										3116361
									],
									[
										3116672,
										3116675
									],
									[
										3117055,
										3117058
									],
									[
										3117459,
										3117469
									],
									[
										3117736,
										3117745
									],
									[
										3118125,
										3118134
									],
									[
										3118466,
										3118484
									],
									[
										3118763,
										3118781
									],
									[
										3119047,
										3119065
									],
									[
										3119429,
										3119432
									],
									[
										3119718,
										3119721
									],
									[
										3123310,
										3123313
									],
									[
										3126083,
										3126086
									],
									[
										3126514,
										3126517
									],
									[
										3126905,
										3126908
									],
									[
										3127251,
										3127254
									],
									[
										3127452,
										3127455
									],
									[
										3127606,
										3127609
									],
									[
										3127780,
										3127783
									],
									[
										3127933,
										3127936
									],
									[
										3128458,
										3128461
									],
									[
										3128839,
										3128842
									],
									[
										3128991,
										3128994
									],
									[
										3129301,
										3129304
									],
									[
										3129474,
										3129477
									],
									[
										3129488,
										3129491
									],
									[
										3129714,
										3129717
									],
									[
										3129774,
										3129777
									],
									[
										3129819,
										3129822
									],
									[
										3130100,
										3130103
									],
									[
										3130116,
										3130119
									],
									[
										3130390,
										3130393
									],
									[
										3130833,
										3130836
									],
									[
										3131147,
										3131150
									],
									[
										3131530,
										3131533
									],
									[
										3131860,
										3131869
									],
									[
										3132170,
										3132179
									],
									[
										3132501,
										3132504
									],
									[
										3132715,
										3132718
									],
									[
										3133057,
										3133066
									],
									[
										3133324,
										3133333
									],
									[
										3133620,
										3133632
									],
									[
										3133851,
										3133863
									],
									[
										3134083,
										3134095
									],
									[
										3134346,
										3134358
									],
									[
										3134577,
										3134589
									],
									[
										3134809,
										3134821
									]
								],
								"scope": ""
							}
						},
						"selection":
						[
							[
								3134354,
								3134354
							]
						],
						"settings":
						{
							"detect_indentation": false,
							"line_numbers": false,
							"output_tag": 23,
							"result_base_dir": "",
							"result_file_regex": "^([A-Za-z\\\\/<].*):$",
							"result_line_regex": "^ +([0-9]+):",
							"scroll_past_end": true,
							"syntax": "Packages/Default/Find Results.hidden-tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 621315.0,
						"zoom_level": 1.0
					},
					"stack_index": 4,
					"type": "text"
				},
				{
					"buffer": 5,
					"file": "common/clientjs/KSectorCli.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2032,
						"regions":
						{
						},
						"selection":
						[
							[
								900,
								900
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage"
						},
						"translation.x": 0.0,
						"translation.y": 245.0,
						"zoom_level": 1.0
					},
					"stack_index": 9,
					"type": "text"
				},
				{
					"buffer": 6,
					"file": "common/clientjs/KGame.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 13934,
						"regions":
						{
						},
						"selection":
						[
							[
								11451,
								11451
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 2,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 5332.0,
						"zoom_level": 1.0
					},
					"stack_index": 1,
					"type": "text"
				},
				{
					"buffer": 7,
					"file": "common/clientjs/KUserCli.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 1150,
						"regions":
						{
						},
						"selection":
						[
							[
								363,
								363
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 2,
							"translate_tabs_to_spaces": true
						},
						"translation.x": -0.0,
						"translation.y": 45.0,
						"zoom_level": 1.0
					},
					"stack_index": 0,
					"type": "text"
				},
				{
					"buffer": 8,
					"file": "server/fishserver.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 7002,
						"regions":
						{
						},
						"selection":
						[
							[
								5716,
								5716
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 2375.0,
						"zoom_level": 1.0
					},
					"stack_index": 5,
					"type": "text"
				}
			]
		},
		{
			"selected": 0,
			"sheets":
			[
				{
					"buffer": 9,
					"file": "common/serverjs/KUserSrv.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 3442,
						"regions":
						{
						},
						"selection":
						[
							[
								1213,
								1223
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 97.0,
						"zoom_level": 1.0
					},
					"stack_index": 7,
					"type": "text"
				},
				{
					"buffer": 10,
					"file": "common/commonjs/KUtil.js",
					"semi_transient": true,
					"settings":
					{
						"buffer_size": 2202,
						"regions":
						{
						},
						"selection":
						[
							[
								148,
								148
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JavaScript.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 10,
					"type": "text"
				}
			]
		}
	],
	"incremental_find":
	{
		"height": 23.0
	},
	"input":
	{
		"height": 31.0
	},
	"layout":
	{
		"cells":
		[
			[
				0,
				0,
				1,
				1
			],
			[
				1,
				0,
				2,
				1
			]
		],
		"cols":
		[
			0.0,
			0.584588811604,
			1.0
		],
		"rows":
		[
			0.0,
			1.0
		]
	},
	"menu_visible": true,
	"output.exec":
	{
		"height": 100.0
	},
	"output.find_results":
	{
		"height": 0.0
	},
	"output.variable_get":
	{
		"height": 100.0
	},
	"pinned_build_system": "",
	"project": "webk.sublime-project",
	"replace":
	{
		"height": 42.0
	},
	"save_all_on_build": true,
	"select_file":
	{
		"height": 0.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"kus",
				"common\\serverjs\\KUserSrv.js"
			],
			[
				"kse",
				"common\\serverjs\\KSectorSrv.js"
			],
			[
				"kaco",
				"common\\commonjs\\KActorData.js"
			],
			[
				"ka",
				"server\\serverjs\\KActorSrv.js"
			],
			[
				"kuti",
				"server\\serverjs\\KUtil.js"
			],
			[
				"ksec",
				"server\\serverjs\\KSectorSrv.js"
			],
			[
				"ks",
				"server\\serverjs\\KUserSrv.js"
			],
			[
				"users",
				"server\\lib\\KUserSrv.js"
			],
			[
				"kactorsr",
				"server\\lib\\KActorSrv.js"
			],
			[
				"fishs",
				"server\\fishserver.js"
			],
			[
				"kga",
				"client\\js\\KGame.js"
			],
			[
				"wo",
				"server\\lib\\KWorld.js"
			],
			[
				"ku",
				"client\\js\\KUserCli.js"
			],
			[
				"actors",
				"server\\lib\\KActorSrv.js"
			],
			[
				"kgam",
				"client\\js\\KGame.js"
			],
			[
				"kuserc",
				"client\\js\\KUserCli.js"
			],
			[
				"userm",
				"Code\\UserManager.cs"
			],
			[
				"inputb",
				"Code\\InputBoss.cs"
			],
			[
				"us",
				"Code\\User.cs"
			],
			[
				"boa",
				"Code\\BoatCameraControl.cs"
			],
			[
				"spawbn",
				"Code\\SpawnBoss.cs"
			],
			[
				"actorm",
				"Code\\Actors\\ActorMotor.cs"
			],
			[
				"ac",
				"Code\\Actors\\Actor.cs"
			],
			[
				"bra",
				"Code\\Brains\\Brain.cs"
			],
			[
				"uti",
				"Code\\Utils.cs"
			],
			[
				"vectorl",
				"Plugins\\VectrosityScripts\\VectorLine.cs"
			],
			[
				"act",
				"Code\\Actors\\Actor.cs"
			],
			[
				"fish",
				"Code\\Actors\\Fish.cs"
			],
			[
				"vect",
				"Plugins\\VectrosityScripts\\VectorLine.cs"
			],
			[
				"basicm",
				"CodeLib\\GumboLib\\BasicMachine.cs"
			],
			[
				"acto",
				"Code\\Actors\\Actor.cs"
			],
			[
				"spawnb",
				"Code\\SpawnBoss.cs"
			],
			[
				"basicma",
				"CodeLib\\GumboLib\\BasicMachine.cs"
			],
			[
				"actorhu",
				"Code\\Actors\\ActorHUD.cs"
			],
			[
				"actorb",
				"Code\\Actors\\ActorBody.cs"
			],
			[
				"hook",
				"Code\\Actors\\Hook.cs"
			],
			[
				"boatc",
				"Code\\BoatCameraControl.cs"
			],
			[
				"food",
				"Code\\Actors\\Food.cs"
			],
			[
				"basict",
				"CodeLib\\BasicCommon\\BasicTimer.cs"
			],
			[
				"wor",
				"Code\\World.cs"
			],
			[
				"control",
				"Code\\GameControls.cs"
			],
			[
				"aima",
				"Code\\Brains\\AIManager.cs"
			],
			[
				"foodm",
				"Code\\Actors\\FoodModifier.cs"
			],
			[
				"userma",
				"Code\\UserManager.cs"
			],
			[
				"brainr",
				"Code\\Brains\\BrainRecord.cs"
			],
			[
				"basi",
				"CodeLib\\BasicCommon\\BasicTimer.cs"
			],
			[
				"hoo",
				"Code\\Actors\\Hook.cs"
			],
			[
				"gamec",
				"Code\\GameControls.cs"
			],
			[
				"fishc",
				"Code\\FishCameraControl.cs"
			],
			[
				"boat",
				"Code\\Actors\\Boat.cs"
			],
			[
				"u",
				"Code\\User.cs"
			],
			[
				"world",
				"Code\\World.cs"
			],
			[
				"aich",
				"Code\\AICharacterControl.cs"
			],
			[
				"game",
				"Code\\Game.cs"
			],
			[
				"bas",
				"CodeLib\\BasicCommon\\BasicTimer.cs"
			],
			[
				"gam",
				"Code\\Game.cs"
			],
			[
				"baasic",
				"CodeLib\\BasicCommon\\BasicTimer.cs"
			],
			[
				"thirdp",
				"Code\\ThirdPersonUserControl.cs"
			],
			[
				"actorin",
				"Code\\Actors\\ActorInfo.cs"
			],
			[
				"enti",
				"Code\\Game\\Entity.cs"
			],
			[
				"gamem",
				"Code\\GameMgr.cs"
			],
			[
				"con",
				"Code\\Constants.cs"
			],
			[
				"a",
				"Code\\Game\\Ability.cs"
			],
			[
				"googm",
				"Code\\UI\\GoogMgr.cs"
			],
			[
				"nor",
				"Code\\Game\\NormalActor.cs"
			],
			[
				"abi",
				"Code\\Game\\Ability.cs"
			],
			[
				"veh",
				"Code\\Game\\VehicleActor.cs"
			],
			[
				"va",
				"Code\\Game\\Vars.cs"
			],
			[
				"co",
				"Code\\Constants.cs"
			],
			[
				"v",
				"Code\\Game\\Vars.cs"
			],
			[
				"we",
				"Code\\Game\\Weapon.cs"
			],
			[
				"ent",
				"Code\\Game\\Entity.cs"
			],
			[
				"norm",
				"Code\\Game\\NormalActor.cs"
			],
			[
				"en",
				"Code\\Game\\Entity.cs"
			],
			[
				"fac",
				"Code\\Game\\FactoryEntity.cs"
			],
			[
				"wea",
				"Code\\Game\\Weapon.cs"
			],
			[
				"bitm",
				"CodeLib\\BasicCommon\\BitMask.cs"
			],
			[
				"aia",
				"Code\\Game\\AIAgent.cs"
			],
			[
				"vehi",
				"Code\\Game\\VehicleActor.cs"
			],
			[
				"vit",
				"Code\\Game\\Vitals.cs"
			],
			[
				"boata",
				"Code\\Game\\BoatActor.cs"
			],
			[
				"basicti",
				"CodeLib\\BasicCommon\\BasicTimer.cs"
			],
			[
				"worlf",
				"Code\\WorldFactory.cs"
			],
			[
				"cons",
				"Code\\Constants.cs"
			],
			[
				"abil",
				"Code\\Game\\Ability.cs"
			],
			[
				"log",
				"CodeLib\\BasicCommon\\Logger.cs"
			],
			[
				"nvt",
				"CodeLib\\Common\\NvTimer.cs"
			],
			[
				"gumboag",
				"Code\\GumboAI\\GumboCore\\GumboAgent.cs"
			],
			[
				"gumbota",
				"Code\\GumboAI\\GumboCore\\GumboTask.cs"
			],
			[
				"gumbos",
				"Code\\GumboAI\\GumboCore\\GumboSense.cs"
			],
			[
				"eff",
				"Code\\Game\\Effect.cs"
			],
			[
				"typ",
				"GooglePlayGames\\Platforms\\Native\\Cwrapper\\Types.cs"
			],
			[
				"vi",
				"Code\\Game\\Vitals.cs"
			],
			[
				"ab",
				"Code\\Game\\Ability.cs"
			],
			[
				"e",
				"Code\\Game\\Entity.cs"
			],
			[
				"bo",
				"Code\\Game\\BoatActor.cs"
			],
			[
				"ut",
				"CodeLib\\Common\\Utilities.cs"
			],
			[
				"pre",
				"CodeLib\\Common\\PrefsFile.cs"
			],
			[
				"inp",
				"Code\\UI\\InputMgr.cs"
			],
			[
				"db",
				"Code\\UI\\Dbg.cs"
			],
			[
				"",
				"Code\\Game\\Actor.cs"
			],
			[
				"w",
				"Code\\World.cs"
			],
			[
				"emo",
				"Code\\Game\\FactoryEmoji.cs"
			],
			[
				"it",
				"Code\\Game\\Item.cs"
			],
			[
				"i",
				"Code\\Game\\Item.cs"
			],
			[
				"ite",
				"Code\\Game\\Item.cs"
			],
			[
				"ai",
				"Code\\Game\\AIAgent.cs"
			],
			[
				"fa",
				"Code\\Game\\FactoryEntity.cs"
			],
			[
				"no",
				"Code\\Game\\NormalActor.cs"
			],
			[
				"fisha",
				"Code\\Game\\FishActor.cs"
			],
			[
				"fis",
				"Code\\Game\\FishActor.cs"
			],
			[
				"goog",
				"Code\\UI\\GoogMgr.cs"
			],
			[
				"fact",
				"Code\\Game\\FactoryEntity.cs"
			],
			[
				"debugv",
				"Code\\Debug\\DebugView.cs"
			],
			[
				"camerm",
				"Code\\Interact\\CameraMgr.cs"
			],
			[
				"blo",
				"Code\\Game\\BlockMgr.cs"
			],
			[
				"vars",
				"Code\\Game\\Vars.cs"
			],
			[
				"user",
				"Code\\User.cs"
			],
			[
				"playg",
				"GooglePlayGames\\ISocialPlatform\\PlayGamesPlatform.cs"
			],
			[
				"googl",
				"GooglePlayGames\\OurUtils\\GoogLogger.cs"
			],
			[
				"uiw",
				"Code\\UI\\UIWheel.cs"
			],
			[
				"inpu",
				"Code\\UI\\InputMgr.cs"
			],
			[
				"mak",
				"Code\\Interact\\Maker.cs"
			],
			[
				"threa",
				"Code\\Game\\ThreatList.cs"
			],
			[
				"go",
				"Code\\UI\\GoogMgr.cs"
			],
			[
				"uiwh",
				"Code\\UI\\UIWheel.cs"
			],
			[
				"uie",
				"Code\\UI\\UIEntity.cs"
			],
			[
				"threatl",
				"Code\\ThreatList.cs"
			]
		],
		"width": 0.0
	},
	"select_project":
	{
		"height": 500.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"",
				"I:\\w\\OneArrow\\Assets\\TauFactory.sublime-project"
			]
		],
		"width": 380.0
	},
	"select_symbol":
	{
		"height": 392.0,
		"last_filter": "",
		"selected_items":
		[
		],
		"width": 392.0
	},
	"selected_group": 0,
	"settings":
	{
	},
	"show_minimap": true,
	"show_open_files": false,
	"show_tabs": true,
	"side_bar_visible": true,
	"side_bar_width": 300.0,
	"status_bar_visible": true,
	"template_settings":
	{
	}
}
